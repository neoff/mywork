diff --git a/.gitignore b/.gitignore
index cc5e1a3..792fec9 100755
--- a/.gitignore
+++ b/.gitignore
@@ -17,9 +17,4 @@
 \.buildpath
 *.lock
 *.cache
-*config.ini
-<<<<<<< HEAD
-*omg/*.jpg
-=======
-*img/*.jpg
->>>>>>> origin/freezed-r02
+*config.ini
\ No newline at end of file
diff --git a/config/config.php b/config/config.php
index 61e3c09..a07a5c3 100644
--- a/config/config.php
+++ b/config/config.php
@@ -9,13 +9,48 @@
  * @category   none
  */
 
+	/*
+	 * поднимаем AR
+	 */
 	ActiveRecord\Config::initialize(function($cfg)
 	{
-		$cfg->set_model_directory('.');
+		$cfg->set_model_directory(ROOT_PATH . '/model');
 		$cfg->set_connections(array(
-			'test' => 'mysql://root:123456@localhost/test',
+			'test' => 'mysql://root:123456@localhost/test', 
 			'develop' => 'mysql://baseadmin:C0ffeAmerikan0@diablopeerslave:33306/mvideo',
 			'deploy' => 'mysql://baseadmin:C0ffeAmerikan0@diablopeerslave:33306/mvideo',
 			'develop_test' => 'mysql://baseadmin:C0ffeAmerikan0@localhost:33306/mvideo',
 		));
+	});
+	
+	/*
+	 * поднимаем урл
+	 */
+	Routing\Config::initialize(function($cfg)
+	{
+		$cfg->set_controller_directory(ROOT_PATH . '/controllers');
+		
+		$prefix = "mobile";
+		
+		if(get_key('region_id', 0) != 0) 
+		{	
+			$_SERVER['REQUEST_URI'] = makeUrl(array($prefix,"shop"));;
+			
+			if(get_key('category_id', -1) >= 0 || get_key('action', -1) >=0 || get_key('search')) 
+				$_SERVER['REQUEST_URI'] = makeUrl(array($prefix,"category"));
+			if(get_key('product_id')) 
+				$_SERVER['REQUEST_URI'] = makeUrl(array($prefix,"product"));
+		}
+		else {
+			if(get_key('start') == 1)
+			{
+				$_SERVER['REQUEST_URI'] = makeUrl(array($prefix,"start"));
+			}
+		}
+		
+		$cfg->Map("^\/?$prefix\/(\?region_id=0)?$", $controler="Region", $action="index");
+		$cfg->Map("^\/?$prefix\/shop\/?$", $controler="Shops", $action="index", $_GET);
+		$cfg->Map("^\/?$prefix\/category\/?$", $controler="Category", $action="index", $_GET);
+		$cfg->Map("^\/?$prefix\/product\/?$", $controler="Product", $action="index", $_GET);
+		$cfg->Map("^\/?$prefix\/start\/?$", $controler="Start", $action="index", $_GET);
 	});
\ No newline at end of file
diff --git a/config/routing.php b/config/routing.php
deleted file mode 100644
index 37907b4..0000000
--- a/config/routing.php
+++ /dev/null
@@ -1,61 +0,0 @@
-<?php
-/**
- * Файл конфигурации url 
- *
- * @since      07.10.2010 10:12:00
- * @author     enesterov
- * @category   none
- */
-
-	
-
-	Routing\Config::initialize(function($cfg)
-	{
-		/* ****************************  */
-		$prefix = "mobile";
-		$url_prefix = "\/$prefix";
-		$region_id = (!array_key_exists('region_id', $_GET))?0:$_GET['region_id'];
-		$shop_id = (!array_key_exists('shop_id', $_GET))?0:$_GET['shop_id'];
-		$product_id = (!array_key_exists('product_id', $_GET))?false:$_GET['product_id'];
-		$act = (!array_key_exists('action', $_GET))?-1:$_GET['action'];
-		$category_id = (!array_key_exists('category_id', $_GET))?-1:$_GET['category_id'];
-		#IN CATEGORIES
-		$page = (!array_key_exists('page', $_GET))?False:$_GET['page'];
-		$ask = (!array_key_exists('aks', $_GET))?false:$_GET['aks'];
-		$reviews = (!array_key_exists('reviews', $_GET))?false:$_GET['reviews'];
-		$search = (!array_key_exists('search', $_GET))?false:$_GET['search'];
-		
-		$width = (!array_key_exists('width', $_GET))?false:$_GET['width'];
-		$height = (!array_key_exists('height', $_GET))?false:$_GET['height'];
-		if($region_id!=0) 
-		{
-			$_SERVER['REQUEST_URI'] = "/$prefix/shop/";
-			
-			if($category_id >= 0 || $act >=0 || $search) 
-				$_SERVER['REQUEST_URI'] = "/$prefix/category/";
-			if($product_id) 
-				$_SERVER['REQUEST_URI'] = "/$prefix/product/";
-		}
-		
-		$cfg->set_controller_directory( ROOT_PATH . '/controllers');
-		//$cfg->MapSet("$prefix");
-		$cfg->Map("^$url_prefix\/(\?region_id=0)?$", $controler="Region", $action="index", $region_id);
-		
-		#shop
-		#$cfg->Map("^^$url_prefix\/\?region_id=[1-9]\d*$", $controler="Shops",$action="index", array($region_id, $width, $height));
-		$cfg->Map("^$url_prefix\/shop\/?$", $controler="Shops", 
-					$action="index", array($region_id, $width, $height));
-		#category
-		#$cfg->Map("^$url_prefix\/\?region_id=[1-9]\d*&category_id=\d+?$", $controler="Category", $action="index", array($region_id, $category_id));
-		$cfg->Map("^$url_prefix\/category\/?$", $controler="Category", 
-					$action="index", array($region_id, $category_id, $act, $search, $page));
-		
-		#product
-		#$cfg->Map("^$url_prefix\/\?region_id=[1-9]\d*&product_id=\d+$", $controler="Product", $action="index", array($region_id, $product_id));
-		$cfg->Map("^$url_prefix\/product\/?$", $controler="Product", 
-					$action="index", array($region_id, $product_id, $ask, $reviews, $page));
-//		#action
-//		#$cfg->Map("^$url_prefix\/\?region_id=[1-9]\d*&product_id=\d+&action=\d+$", $controler="Product", $action="index", array($region_id, $product_id, $action));
-//		$cfg->Map("^$url_prefix\/action\/?$", $controler="Category", 
-//					$action="index", array($region_id, $category_id, $act, $search));
-	});
\ No newline at end of file
diff --git a/config/template.php b/config/template.php
deleted file mode 100644
index 9c8062d..0000000
--- a/config/template.php
+++ /dev/null
@@ -1,51 +0,0 @@
-<?php
-/**  
- *  РїР°РєРµС‚ РїРѕРґРєР»СЋС‡РµРЅРёСЏ С€Р°Р±РѕР»РЅРѕРІ Рё РёСЃРїРѕР»РЅРµРЅРёСЏ РєРѕРґР°
- * 
- * @package    controllers
- * @subpackage templaets
- * @since      07.10.2010 12:13:10
- * @author     enesterov
- * @category   controller
- */
-
-	namespace Controllers;
-	
-class Template{
-	private $xml;
-	public $head;
-	
-	public function __construct()
-	{
-		$child = get_called_class();
-		
-		$dtd = preg_replace("/Controllers\\C/", "", $child);
-		$dtd = preg_replace("/Controller/", "", $dtd);
-		$dtd = strtolower($dtd);
-		
-		$xmlstr = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mvideo_xml SYSTEM \"/mobile/public/$dtd.dtd\">\n<mvideo_xml date=\"" . date("Y-m-d H:i:s") . "\">\n</mvideo_xml>";
-		$this->xml = new \SimpleXMLElement($xmlstr);
-		
-	}
-	public function __destruct()
-	{
-		header('Content-type: text/xml; charset=utf-8');
-		echo preg_replace("/></", ">\n<", $this->xml->asXML());
-		//echo $this->xml->asXML();
-	}
-	
-	public function SetType($doc)
-	{
-		$this->head = $doc;
-	}
-	
-	public function Set( $param, $val="" )
-	{
-		return $this->xml->addChild( $param, $val );
-	}
-
-
-}
-
-
-
diff --git a/config/template_.php b/config/template_.php
deleted file mode 100644
index cdff3ec..0000000
--- a/config/template_.php
+++ /dev/null
@@ -1,51 +0,0 @@
-<?php
-/**  
- *  РїР°РєРµС‚ РїРѕРґРєР»СЋС‡РµРЅРёСЏ С€Р°Р±РѕР»РЅРѕРІ Рё РёСЃРїРѕР»РЅРµРЅРёСЏ РєРѕРґР°
- * 
- * @package    controllers
- * @subpackage templaets
- * @since      07.10.2010 12:13:10
- * @author     enesterov
- * @category   controller
- */
-
-	namespace Controllers;
-	
-class Template{
-	private $xml;
-	public $head;
-	
-	public function __construct()
-	{
-		$child = get_called_class();
-		
-		$dtd = preg_replace("/Controllers\\C/", "", $child);
-		$dtd = preg_replace("/Controller/", "", $dtd);
-		$dtd = strtolower($dtd);
-		
-		$xmlstr = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mvideo_xml SYSTEM \"/public/$dtd.dtd\">\n<mvideo_xml date=\"" . date("Y-m-d H:i:s") . "\">\n</mvideo_xml>";
-		$this->xml = new \SimpleXMLElement($xmlstr);
-		
-	}
-	public function __destruct()
-	{
-		header('Content-type: text/xml; charset=utf-8');
-		echo preg_replace("/></", ">\n<", $this->xml->asXML());
-		//echo $this->xml->asXML();
-	}
-	
-	public function SetType($doc)
-	{
-		$this->head = $doc;
-	}
-	
-	public function Set( $param, $val="" )
-	{
-		return $this->xml->addChild( $param, $val );
-	}
-
-
-}
-
-
-
diff --git a/controllers/Category.php b/controllers/Category.php
index ae2ff9c..ca78bf8 100644
--- a/controllers/Category.php
+++ b/controllers/Category.php
@@ -1,795 +1,985 @@
-<?php
-/**  
- * 
- * 
- * @package    Category
- * @subpackage Template
- * @since      08.10.2010 14:00:27
- * @author     enesterov
- * @category   controller
- */
-
-
-	namespace Controllers;
-	use Models;
-	use ActiveRecord;
-	use Template;
-	use Closure;
-	
-
-class ControllerCategory extends Template\Template{
-	
-	private $parent_name;
-	private $parent_id;
-	protected $region_id;
-	protected $category_id;
-	private $actions;
-	private $action_val = array();
-	private $searches;
-	private $parents;
-	private $category;
-	private $options;
-	private $page;
-	
-	protected static $TmpDir = array();
-	protected static $GlobalConfig = array();
-	protected static $Brands = array();
-	protected static $Dirs = array();
-	protected static $Classes = array();
-	protected static $Groups = array();
-	protected static $Mult = 1000000000;
-	protected static $MultC = 100000;
-	protected static $MultG = 1;
-	
-	protected $dir_id;
-	protected $class_id;
-	protected $group_id;
-	
-	public function index( $array )
-	{
-		
-		
-		if($array)
-		{
-			$this->setVar();
-		}
-		
-		$GlobalConfig=array();
-		$rfile = MVIDEO_PATH;
-		
-		$GlobalConfig['RegionID']=$this->region_id;
-		require_once $rfile . '/lib/federal_info.lib.php';
-		require_once $rfile . '/lib/sdirs.lib.php';
-		require_once $rfile . '/www/classifier_'.$this->region_id.'.inc.php';
-		
-		self::$GlobalConfig = $GlobalConfig;
-		self::$Brands = $Brands;
-		self::$Dirs = $Dirs;
-		self::$Classes = $Classes;
-		self::$Groups = $Groups;
-		
-		
-		if($this->searches)
-		{
-			$this->search = $this->searches; #XML тег search!!!! не удалять
-			$search = iconv("UTF-8",'CP1251', $this->searches);
-			$this->searches = " AND (UPPER(w.ware) like \"%".strtoupper($search)."%\" or UPPER(w.FullName) like \"%".strtoupper($search)."%\")";
-		}
-			
-		if($this->actions > 0)
-			$this->category = $this->getActions();
-		
-		
-		
-		/*if($this->category_id >=0 && !$this->searches && $this->actions < 0)
-		{
-			$this->parentNode();
-		}
-		else*/if($this->category_id >=0 && ($this->searches || $this->actions > 0))
-			$this->category = $this->createDirAction();
-			
-		if($this->category_id >=0 && !$this->searches && $this->actions < 0)
-		{
-			$this->createParent();
-			
-			if($this->category_id == 0)
-				$this->category = $this->createRoot();
-			else 
-			{
-				if($this->category_id < self::$Mult)
-					$this->category = $this->createDir();
-				else
-				{
-					
-					//print $this->class_id;
-					if(!$this->class_id)
-						$this->category = $this->createClasses();
-				}
-			}
-		}
-		
-		if($this->class_id)
-			if($this->group_id || $this->actions > 0)
-				$this->createProduct();
-			else
-				$this->createGroup();
-	}
-	
-	
-	
-	protected function createRoot()
-	{
-		$this->displayCategoryNode( $this->parent_name );
-		$wwwarez =  Models\Warez::getRootCategoryChild($this->region_id);
-		$this->all_dirs($wwwarez);
-		
-		foreach (self::$GlobalConfig['smenu'] as $key => $value) 
-		{
-			$amount = 0;
-			foreach ($value['dirs'] as $v) 
-			{
-				if(!in_array($v, $wwwarez))
-					continue 2;
-				
-				$amount++;
-				$one_key = $v;
-			}
-			$id = $key;
-			
-			if($amount == 0)
-				continue;
-				
-			if($amount == 1 )
-			{
-				$key = self::ToDir($one_key);
-				if($this->action_val)
-					$value['name'] = self::$Dirs[$one_key];
-			}
-			
-			
-				
-			$this->displayCategoryRoot($key, $value, $amount, $id);
-		}
-	}
-	
-	
-	/**
-	 * ф-я выводит диры в рутовой категории
-	 * Enter description here ...
-	 */
-	protected function createDir()
-	{
-		$this->displayCategoryNode(ToUTF(self::$GlobalConfig['smenu'][$this->category_id]['name']));
-		$wwwarez =  Models\Warez::getRootCategoryChild($this->region_id, $this->action_val, $this->searches);
-		$this->all_dirs($wwwarez);
-		
-		
-		
-		foreach (self::$GlobalConfig['smenu'][$this->category_id]['dirs'] as $value) 
-		{
-			$amount = 0;
-			if(!in_array($value, $wwwarez))
-				continue;
-				
-			$id = self::ToDir($value);
-			$wwwcat =  Models\Warez::getClassId($value, $this->region_id, $this->action_val, $this->searches);
-			if($wwwcat)
-				$amount = count($wwwcat);
-			
-			if($amount == 1)
-				$id = self::ToDir($value, $wwwcat[0]->result);
-			
-			if($amount == 0)
-				continue;
-				
-			$this->displayCategoryDir($id, $value, $amount);
-		}
-		return False;
-	}
-	
-	
-	/**
-	 * ф-я выводит классы в дирах
-	 * Enter description here ...
-	 */
-	protected function createClasses()
-	{
-		$this->displayCategoryNode(ToUTF(self::$Dirs[$this->dir_id]));
-		
-		if($this->searches)
-			return $this->createProduct();
-		
-		$wwwarez =  Models\Warez::getClassId($this->dir_id, $this->region_id, $this->action_val);
-		$this->all_dirs($wwwarez);
-		foreach (array_keys(self::$Groups[$this->dir_id]) as $value) 
-		{
-			$amount = 0;
-			if(!in_array($value, $wwwarez))
-				continue;
-			
-			if($wwwcat)
-				$amount = count($wwwcat);
-			
-			$id = self::ToDir($this->dir_id, $value);
-			if($amount == 1)
-			{
-				$id = self::ToDir($this->dir_id, $value, $wwwcat[0]->result);
-				$wwwcat =  Models\Warez::getWaresId($this->dir_id, $value, $wwwcat[0]->result,
-													$this->region_id, $this->action_val, $this->searches);
-				if($wwwcat)
-					$amount = count($wwwcat);
-			}
-			if($amount == 0)
-				continue;
-			
-			$this->displayCategoryClass($id, $value, $amount);
-		}
-		return False;
-	}
-	/**
-	 * функция рисует на странице информацию о категориях 
-	 */
-	protected function createGroup()
-	{
-		$this->displayCategoryNode($this->parent_name);
-		$wwwarez =  Models\Warez::getGroupId($this->dir_id, $this->class_id, $this->region_id, $this->action_val, $this->searches);
-		$this->all_dirs($wwwarez);
-		foreach (array_keys(self::$Groups[$this->dir_id][$this->class_id]) as $value) 
-		{
-			$amount = 0;
-			if(!in_array($value, $wwwarez))
-				continue;
-				
-			$wwwcat =  Models\Warez::getWaresId($this->dir_id, $this->class_id, $value,
-													$this->region_id, $this->action_val, $this->searches);
-			if($wwwcat)
-				$amount = count($wwwcat);
-			
-			if($amount == 0)
-				continue;
-					
-			$id = self::ToDir($this->dir_id, $this->class_id, $value);
-			$this->displayCategoryGroup($id, $value, $amount);
-		}
-		return False;
-		
-		
-	}
-	/**
-	 * функция рисует на странице информацию о продуктах в категории 
-	 */
-	private function createProduct()
-	{
-		//print 4;
-		//var_dump($this->parents);
-		if($this->actions > 0 && $this->action_val)
-			$this->parents->dirid .= " and w.warecode in (".implode(",", $this->action_val).") ";#$this->parents->search
-		if($this->searches)
-			$this->parents->dirid .= $this->searches;
-		if($this->parents)
-		{
-			#print "ads";
-			$productes_all = Models\Warez::getWarez($this->region_id, $this->parents, False);
-			$productes_count = 0;
-			$productes_count = count($productes_all);
-			$productes_m = Models\Warez::getWarez($this->region_id, $this->parents, $this->page);
-			
-			//add params
-			$grid=array();
-			$markid = array();
-			$this->params="";
-			
-			$param_m = $this->displayProductMark();
-			$param_g = $this->displayProductGroup();
-			
-			$this->displayProductNode();
-			
-			if($this->page)
-				$this->displayPageNode($productes_count);
-				
-			if($productes_m)
-			{
-				foreach ($productes_m as $key => $val)
-				{
-					if (!in_array($val->grid, $grid))
-						$grid[]=$val->grid;
-					if (!in_array($val->mark, $markid))
-						$markid[]=$val->mark;
-					$this->displayProduct( $val );
-				}
-			}
-			
-			$this->getProductMarkVal( $markid, &$param_m );
-			$this->getProductGroupVal($grid, $param_g);
-			
-		}
-	}
-	
-	
-	
-	
-	
-	private function createDirAction()
-	{
-		$this->createParent();
-		$wwwarez =  Models\Warez::getRootCategoryChild($this->region_id, $this->action_val, $this->searches);
-		$res = $wwwarez;
-		$this->all_dirs($wwwarez);
-		if($this->dir_id)
-		{
-			$this->parents->classid = "";
-			$this->parents->grid = "";
-			if(!$this->class_id)
-				return $this->createProduct();
-			return false;
-		}
-		else 
-		{
-			$this->displayCategoryNode($this->parent_name);
-		}
-		
-		foreach ($res as $val) 
-		{
-			$value = $val->result;
-			$amount = 0;
-			if(in_array($value, array_keys(self::$Dirs)))
-			{
-				if(!in_array($value, $wwwarez))
-					continue;
-					
-				$wwwcat =  Models\Warez::getWarezAction($value, $this->region_id, $this->action_val, $this->searches);
-				
-				if($wwwcat)
-					$amount = count($wwwcat);
-				
-				if($amount == 0)
-					continue;
-					
-				$id = self::ToDir($value);
-				$this->displayCategoryDir($id, $value, $amount);
-			}
-		}
-		return False;
-	}
-	
-	/**
-	 * устанавливаем ноду parent_category
-	 * проверяем название и предыдущую категорию 
-	 * 
-	 * @param int $category_id
-	 * @param object $parents_m
-	 * @return array $options
-	 */
-	private function createParent()
-	{
-		/*
-		 * ставим заголовки блока parents
-		 * если parent = 0 то ставим список всех категорий
-		 */
-		$cat_parrent_name = $this->parents->parent_name = "Список категорий";
-		$cat_parrent_id = $this->parents->parent_id = 0;
-		//если пустой category_id
-		if(!$this->category_id || $this->category_id<0 )
-		{
-			//$this->options = array('conditions' => "parent_id is null");
-			$cat_parrent_name = $this->parent_name = "Список категорий";
-			$cat_parrent_id = $this->parent_id = 0;
-			$this->category_id = 0;
-		}
-		//если не пустой category_id
-		else
-		{
-			//category_id меньше модификатора
-			if($this->category_id < self::$Mult)
-			{
-				$cat_parrent_name = $this->parent_name = "Список категорий";
-				$cat_parrent_id = $this->parent_id = 0;
-				//$this->dir_id = $this->category_id;
-				
-				
-			}
-			else
-			{
-				/*
-				 * проверяем parent текущей категории
-				 * и выставляем id и name у родительского нода
-				 */
-				$this->ToClass();
-				
-				$this->parents->dirid = $this->dir_id;
-				$this->parents->classid = $this->class_id;
-				$this->parents->grid = $this->group_id;
-				$this->parents->parent_name = ToUTF(self::$Dirs[$this->dir_id]);
-				
-				//если есть класс
-				if($this->class_id)
-				{
-					$this->parents->parent_id = self::ToDir($this->dir_id, $this->class_id);
-					$this->parents->parent_name = ToUTF(self::$Classes[$this->dir_id][$this->class_id]);
-					$cat_parrent_id = self::ToDir($this->dir_id);
-					$cat_parrent_name = ToUTF(self::$Dirs[$this->dir_id]);
-					//если еть группа
-					if($this->group_id)
-					{
-						$this->parents->parent_id = self::ToDir($this->dir_id, $this->class_id, $this->group_id);
-						$this->parents->parent_name = ToUTF(self::$Groups[$this->dir_id][$this->class_id][$this->group_id]);
-						$cat_parrent_id = self::ToDir($this->dir_id, $this->class_id);
-						$cat_parrent_name = ToUTF(self::$Classes[$this->dir_id][$this->class_id]);
-					}
-				}
-				//если нет класса проверяем родительские категории
-				else 
-				{
-					foreach (self::$GlobalConfig['smenu'] as $key => $value) 
-					{
-						if(in_array($this->parents->dirid, $value['dirs']))
-							{
-								$cat_parrent_id = $this->parents->parent_id = ToUTF($key);
-								$cat_parrent_name = $this->parents->parent_name = ToUTF($value['name']);
-								break;
-							}
-					}
-				}
-				
-				$this->parent_name = $this->parents->parent_name;
-				$this->parent_id = $this->parents->parent_id;
-			}
-		}
-		
-		$this->displayCategoryParentNode($cat_parrent_id, $cat_parrent_name);
-		return false;//$this->options;
-	}
-	
-	private function getActions()
-	{
-		switch ((int)$this->actions)
-		{
-			case 1:
-				$action = 6;
-				break;
-			case 3:
-				$action = 0;
-				return $this->getActionFederal();
-				break;
-			case 4:
-				$action = 24;
-				break;
-			case 5:
-				$action = 25;
-				break;
-			case 6:
-				$action = 29;
-				break;
-			case 7:
-				$action = 28;
-				break;
-			default:
-				$action = $this->actions;
-				break;
-		}
-		$act = Models\Actions::first(array("segment_id"=>$action, "hidden"=>0));
-		
-		if($act)
-			return $this->displayCategoryAction($act->segment_name, $act->segment_info);
-	}
-	
-	/**
-	 * текущая федеральная акция
-	 */
-	private function getActionFederal()
-	{
-		$time = time();
-		
-		foreach (self::$GlobalConfig['fed_act'] as $key => $val) 
-		{
-			
-			if($key < $time)
-			{
-				if($val['end_date']>=$time)
-				{
-					$url = str_replace("/", "", $val['link']);//link
-					$imgfile = "imgs/action/main/$url.jpg";
-					return $this->displayCategoryAction($val['link'], $val['name'], $imgfile);
-					/*
-					$this->action = "";
-					$this->displayActionImage($imgfile);
-					
-					$this->action->addChild("description", ToUTF($val['name']));//descr
-					
-					$this->action->addChild("url", "http://www.mvideo.ru/".$url."-cond/");
-					$this->action->addChild("link", "http://www.mvideo.ru/".$url."/");
-					
-					return $this->putActions($url);*/
-				}
-			}
-		}
-		
-	}
-	/**
-	 * собирает товары участвующие в акции
-	 * в массив $this->action_val
-	 * @param unknown_type $name
-	 */
-	private function getActionsVal($name)
-	{
-		
-		$options = array('select' => 'w.warecode',
-						'from' => 'segment_cache sc',
-						'joins'=>" join warez_$this->region_id w on (sc.warecode=w.warecode)",
-						'conditions' =>"sc.region_id=$this->region_id and sc.segment_name='$name' ");
-		
-		if($this->searches)
-			$options['conditions'] .= $this->searches;
-		$segment = Models\Segments::find('all', $options);
-		foreach ($segment as $val)
-		{
-			$this->action_val[] = $val->warecode;
-		}
-		return False;
-	}
-	
-	private function getProductMarkVal( $markid, &$param )
-	{
-		foreach($markid as $val)
-		{
-			$group = Models\Marks::find('first', array("markid"=>$val));
-			if($group)
-			{
-				$this->displayProductGroupOption(&$param, StripTags($group->markname), $val);
-			}
-		}
-	}
-	
-	private function getProductGroupVal( $grid, &$param )
-	{
-		foreach($grid as $val)
-		{
-			$group = Models\Groups::find('first', array("grid"=>$val));
-			if($group)
-			{
-				$this->displayProductGroupOption(&$param, ToUTF($group->grname), $val);
-			}
-		}
-	}
-	
-	private function displayCategoryAction($name, $description, $imgfile = "")
-	{
-		$url = str_replace("/", "", $name);//link
-		$url_name = "http://www.mvideo.ru/".$url."-cond/";
-		
-		if(!$imgfile)
-		{
-			$imgfile = "imgs/action/header_$url.jpg";
-			$url_name = "http://www.mvideo.ru/".str_replace("_", "-", $url)."/?ref=left_bat_".$name;
-		}
-		
-		$this->action = "";
-		//print $imgfile;
-		$this->displayActionImage($imgfile);
-		
-		$this->action->addChild("description", ToUTF($description));
-		$this->action->addChild("url", $url_name);
-		$this->action->addChild("link", "http://www.mvideo.ru/".$url."/");
-		$categorys = $this->getActionsVal($url);
-		return $categorys;
-	}
-	
-	private function displayCategoryRoot($key, $value, $amount, $id)
-	{
-			$category = $this->categories->addChild("category");
-			$category->addChild("category_id", $key);
-			$category->addChild("category_name", ToUTF($value['name']));
-			$this->displayCategotyIcon($category, $id, $amount);
-	}
-	
-	private function displayCategoryDir($id, $value, $amount)
-	{
-		$name = ToUTF(self::$Dirs[$value]);
-		$this->displayCategorySection($name, $id, $amount);
-	}
-	
-	private function displayCategoryClass($id, $value, $amount)
-	{
-		$name = ToUTF(self::$Classes[$this->dir_id][$value]);
-		$this->displayCategorySection($name, $id, $amount);
-	}
-	
-	private function displayCategoryGroup($id, $value, $amount)
-	{
-		$name = ToUTF(self::$Groups[$this->dir_id][$this->class_id][$value]);
-		$this->displayCategorySection($name, $id, $amount);
-	}
-	
-	private function displayCategorySection($name, $id, $amount)
-	{
-		$category = $this->categories->addChild("category");
-		$category->addChild("category_id", $id);
-		$category->addChild("category_name", $name);
-		$this->displayCategotyIcon($category, $id, $amount);
-	}
-	
-	private function displayCategotyIcon(&$category, $id, $amount)
-	{
-		$category->addChild("amount", $amount); 
-		$icon = $category->addChild("category_icon", 
-			"http://www.mvideo.ru/mobile/public/img/".$id.".jpg"
-		); 
-		$icon->addAttribute("width", "180");
-		$icon->addAttribute("height", "180");
-	}
-	
-	private function displayCategoryNode( $name )
-	{
-		$this->categories="";
-		$this->categories->addAttribute("category_id", $this->category_id);
-		$this->categories->addAttribute("category_name", $name );
-	}
-	
-	private function displayCategoryParentNode($cat_parrent_id, $cat_parrent_name)
-	{
-		$this->parent_category="";
-		$this->parent_category->addChild("category_id", $cat_parrent_id);
-		$this->parent_category->addChild("category_name", $cat_parrent_name);
-	}
-	
-	private function displayProduct( $val )
-	{
-		$product = $this->products->addChild("product");
-		$product->addChild("product_id", ToUTF($val->warecode));
-		$product->addChild("title", StripTags($val->name));
-		$val->getDesctiptions();
-		$product->addChild("description", StripTags($val->description));
-		$val->getRatingRev();
-		$product->addChild("rating", $val->rating);
-		$product->addChild("reviews_num", $val->reviews);
-		$product->addChild("inet_price", $val->inetprice);
-		
-		$dic = $val->getInetDiscountStatus($val->warecode, $this->region_id);
-		$product->addChild("card_discount", $dic);
-		
-		if($val->oldprice)
-			$old_price = $val->oldprice;
-		else
-			$old_price = $val->price;
-			
-		$product->addChild("old_price", $old_price);
-		
-		$product->addChild("price", $val->price);
-		$image = $product->addChild("image", "http://www.mvideo.ru/Pdb/$val->warecode.jpg"); 
-		$image->addAttribute("width", "180");
-		$image->addAttribute("height", "180");
-	}
-	
-	private function displayProductNode()
-	{
-		$name = $this->parent_name;
-		if(property_exists($this->parents, 'name'))
-			$name = ToUTF($this->parents->name);
-				
-		$this->products="";
-		$this->products->addAttribute("category_id", $this->category_id);
-		$this->products->addAttribute("category_name", $name);
-	}
-	
-	private function displayProductMark()
-	{
-		$param = $this->params->addChild("param"); 
-		$param->addAttribute("param_name", "mark");
-		$param->addAttribute("title", "Производители");
-		$param->addAttribute("current_value", "0");
-		$option = $param->addChild("option", "Все производители");
-		$option->addAttribute("value", "0");
-		return $param;
-	}
-	
-	
-	private function displayProductGroup()
-	{
-		$param = $this->params->addChild("param"); 
-		$param->addAttribute("param_name", "grid");
-		$param->addAttribute("title", "Группы");
-		$param->addAttribute("current_value", "0");
-		$option = $param->addChild("option", "Все группы");
-		$option->addAttribute("value", "0");
-		
-		return $param;
-	}
-	
-	
-	
-	private function displayProductGroupOption(&$param, $name, $val)
-	{
-		$option = $param->addChild("option", $name);
-		$option->addAttribute("value", $val);
-	}
-	
-	private function displayPageNode($productes_count)
-	{
-		$this->pages="";
-		$this->pages->addChild("amount", $productes_count);
-		$this->pages->addChild("onpage", "20");
-		$this->pages->addChild("page", $this->page);
-	}
-	/**
-	 * создает ноду с картинкой для акции
-	 * @param unknown_type $img
-	 */
-	private function displayActionImage($img)
-	{
-		$imgdir = MVIDEO_PATH;
-		$fimgs = "http://www.mvideo.ru/$img";
-		
-		if(file_exists($imgdir."/www/".$img))
-		{
-			$imgsize = getimagesize($imgdir."/www/".$img);
-		
-			//создаем картинку
-			$images = $this->action->addChild("image", $fimgs);
-			
-			//задаем размеры
-			$images->addAttribute("width", $imgsize[0]);
-			$images->addAttribute("height", $imgsize[1]);
-		}
-	}
-	
-	/**
-	 * собирает уникальные ID директорий из БД
-	 * @param object $a
-	 */
-	protected function all_dirs(&$a)
-	{
-		foreach ($a as $value) {
-			self::$TmpDir[] = $value->result;
-		}
-		$a=self::$TmpDir;
-		return $a;
-	}
-	
-	/**
-	 * устанавливает основные переменные из $_GET запроса
-	 */
-	private function setVar()
-	{
-		$this->region_id = get_key('region_id', 0);
-		$this->category_id = get_key('category_id', -1);
-		$this->actions = get_key('action', -1);
-		$this->searches = get_key('search');
-		$this->page = get_key('page', 0);
-	}
-	
-	/**
-	 * собирает ID категории
-	 * @param int $d
-	 * @param int $c
-	 * @param int $g
-	 * @return long
-	 */
-	protected static function ToDir($d, $c = 0, $g = 0)
-	{
-		$d = $d*self::$Mult;
-		$c = $c*self::$MultC;
-		$g = $g*self::$MultG;
-		return $d+$c+$g;
-	}
-	
-	/**
-	 * разбирает ID категории превращая их в DirID, ClassID, GrID из БД
-	 * и назначает основные переменные
-	 */
-	protected function ToClass()
-	{
-		$this->dir_id = floor($this->category_id / self::$Mult);
-		$this->class_id = floor(($this->category_id % self::$Mult) / self::$MultC);
-		$this->group_id = floor((($this->category_id % self::$Mult) % self::$MultC) / self::$MultG);
-	}
-}
-	/**
-	 * возвращает значение глобальной переменной $_GET или значение $returns
-	 * @param string $key
-	 * @param (string|bool) $returns
-	 */
-	function get_key($key, $returns = false)
-	{
-		return (!array_key_exists($key, $_GET))?$returns:$_GET[$key];
-	}
-
+<?php
+/**  
+ * 
+ * 
+ * @package    Category
+ * @subpackage Template
+ * @since      08.10.2010 14:00:27
+ * @author     enesterov
+ * @category   controller
+ */
+
+
+	namespace Controllers;
+	use Models;
+	use ActiveRecord;
+	use Template;
+	
+class ControllerCategory extends Template\Template{
+	
+	private $parent_name;
+	private $parent_id;
+	protected $region_id;
+	protected $category_id;
+	private $actions;
+	private $action_val = array();
+	private $searches;
+	private $parents;
+	private $category;
+	private $options;
+	private $page;
+	
+	protected static $TmpDir = array();
+	protected static $GlobalConfig = array();
+	protected static $Brands = array();
+	protected static $Dirs = array();
+	protected static $Classes = array();
+	protected static $Groups = array();
+	protected static $Mult = 1000000000;
+	protected static $MultC = 100000;
+	protected static $MultG = 1;
+	
+	protected $dir_id;
+	protected $class_id;
+	protected $group_id;
+	
+	
+	public function index( $array )
+	{
+		
+		
+		if($array)
+		{
+			$this->setVar();
+		}
+		
+		$GlobalConfig=array();
+		$rfile = MVIDEO_PATH;
+		
+		$GlobalConfig['RegionID']=$this->region_id;
+		require_once $rfile . '/lib/federal_info.lib.php';
+		require_once $rfile . '/lib/sdirs.lib.php';
+		require_once $rfile . '/www/classifier_'.$this->region_id.'.inc.php';
+		
+		self::$GlobalConfig = $GlobalConfig;
+		self::$Brands = $Brands;
+		self::$Dirs = $Dirs;
+		self::$Classes = $Classes;
+		self::$Groups = $Groups;
+		
+		
+		if($this->searches)
+		{
+			$this->search = $this->searches; #XML тег search!!!! не удалять
+			$search = iconv("UTF-8",'CP1251', $this->searches);
+			$this->searches = " AND (UPPER(w.ware) like \"%".strtoupper($search)."%\" or UPPER(w.FullName) like \"%".strtoupper($search)."%\")";
+		}
+			
+		if($this->actions > 0)
+			$this->category = $this->getActions();
+		
+		
+		
+		/*if($this->category_id >=0 && !$this->searches && $this->actions < 0)
+		{
+			$this->parentNode();
+		}
+		else*/if($this->category_id >=0 && ($this->searches || $this->actions > 0))
+			$this->category = $this->createDirAction();
+			
+		if($this->category_id >=0 && !$this->searches && $this->actions < 0)
+		{
+			$this->createParent();
+			
+			if($this->category_id == 0)
+				$this->category = $this->createRoot();
+			else 
+			{
+				if($this->category_id < self::$Mult)
+					$this->category = $this->createDir();
+				else
+				{
+					
+					//print $this->class_id;
+					if(!$this->class_id)
+						$this->category = $this->createClasses();
+				}
+			}
+		}
+		
+		if($this->class_id)
+			if($this->group_id || $this->actions > 0)
+				$this->createProduct();
+			else
+				$this->createGroup();
+	}
+	
+	
+	
+	protected function createRoot()
+	{
+		$this->displayCategoryNode( $this->parent_name );
+		$wwwarez =  Models\Warez::getRootCategoryChild($this->region_id);
+		$this->all_dirs($wwwarez);
+		
+		foreach (self::$GlobalConfig['smenu'] as $key => $value) 
+		{
+			$amount = 0;
+			foreach ($value['dirs'] as $v) 
+			{
+				if(!in_array($v, $wwwarez))
+					continue 2;
+				
+				$amount++;
+				$one_key = $v;
+			}
+			$id = $key;
+			
+			if($amount == 0)
+				continue;
+				
+			if($amount == 1 )
+			{
+				$key = self::ToDir($one_key);
+				if($this->action_val)
+					$value['name'] = self::$Dirs[$one_key];
+			}
+			
+			
+				
+			$this->displayCategoryRoot($key, $value, $amount, $id);
+		}
+	}
+	
+	
+	/**
+	 * ф-я выводит диры в рутовой категории
+	 * Enter description here ...
+	 */
+	protected function createDir()
+	{
+		$this->displayCategoryNode(ToUTF(self::$GlobalConfig['smenu'][$this->category_id]['name']));
+		/*
+		$q = 'SELECT distinct w.DirID as result 
+			FROM warez_'.$this->region_id.' as w';
+		
+		if($this->searches)
+			$q .= " WHERE w.warecode ".$this->searches;
+			
+		if($this->action_val)
+			$q = 'SELECT distinct w.DirID as result 
+					FROM warez_'.$this->region_id." as w
+					WHERE w.warecode in (".implode(",", $this->action_val).")
+					$this->searches";
+					*/
+		//print $q;
+		$wwwarez =  Models\Warez::getRootCategoryChild($this->region_id, $this->action_val, $this->searches);
+		$this->all_dirs($wwwarez);
+		
+		
+		
+		foreach (self::$GlobalConfig['smenu'][$this->category_id]['dirs'] as $value) 
+		{
+			$amount = 0;
+			if(!in_array($value, $wwwarez))
+				continue;
+
+				
+			$id = self::ToDir($value);
+			/*if($this->action_val)
+				$q = 'SELECT distinct w.ClassID as result, w.warecode
+					FROM warez_'.$this->region_id." as w
+					WHERE w.warecode in (".implode(",", $this->action_val).")
+					$this->searches
+					AND w.DirID = ".$value." group by result order by w.hit DESC, w.price DESC ";
+			else 
+				$q = 'SELECT distinct ClassID as result, w.warecode 
+					FROM warez_'.$this->region_id." as w
+					
+					WHERE DirID = ".$value.$this->searches." group by result order by w.hit DESC, w.price DESC ";*/
+				
+			$wwwcat =  Models\Warez::getClassId($value, $this->region_id, $this->action_val, $this->searches);
+			//print_r($wwwcat);
+			//$this->all_dirs($wwwcat);
+			//print_r($wwwcat);
+			if($wwwcat)
+				$amount = count($wwwcat);
+			
+			/*if($this->action_val)
+				if(!in_array($value, $wwwcat))
+					continue;*/
+						
+			if($amount == 1)
+				$id = self::ToDir($value, $wwwcat[0]->result);
+			
+			if($amount == 0)
+				continue;
+				
+			$this->displayCategoryDir($id, $value, $amount);
+		}
+		return False;
+	}
+	
+	
+	/**
+	 * ф-я выводит классы в дирах
+	 * Enter description here ...
+	 */
+	protected function createClasses()
+	{
+		$this->displayCategoryNode(ToUTF(self::$Dirs[$this->dir_id]));
+		
+		/*$q = 'SELECT distinct w.ClassID as result 
+			FROM warez_'.$this->region_id." as w
+			WHERE w.DirID = ".$this->dir_id;
+		
+		if($this->action_val)
+			$q .= " AND w.warecode in (".implode(",", $this->action_val).")";
+		*/
+		
+		if($this->searches)
+			return $this->createProduct();
+			
+		#print $q;
+		//$wwwarez =  Models\Warez::find_by_sql($q);
+		$wwwarez =  Models\Warez::getClassId($this->dir_id, $this->region_id, $this->action_val);
+		$this->all_dirs($wwwarez);
+		//print $this->dir_id;
+		//print_r(array_keys(self::$Groups[$this->dir_id]));
+		foreach (array_keys(self::$Groups[$this->dir_id]) as $value) 
+		{
+			$amount = 0;
+			if(!in_array($value, $wwwarez))
+				continue;
+			
+			/*if($this->action_val)
+				$q = 'SELECT distinct w.GrID as result, w.warecode 
+					FROM warez_'.$this->region_id." as w
+					WHERE w.warecode in (".implode(",", $this->action_val).")
+					$this->searches
+					AND w.DirID = ".$this->dir_id."
+					AND w.ClassID = ".$value." group by result order by w.hit DESC, w.price DESC ";
+			else 
+				$q = 'SELECT distinct w.GrID as result, w.warecode 
+						FROM warez_'.$this->region_id." as w
+						WHERE w.DirID = ".$this->dir_id."
+						$this->searches
+						AND w.ClassID = ".$value." group by result order by w.hit DESC, w.price DESC ";
+				
+			$wwwcat =  Models\Warez::find_by_sql($q);*/
+			$wwwcat =  Models\Warez::getGroupId($this->dir_id, $value, $this->region_id, $this->action_val, $this->searches);
+			//print_r($wwwcat);
+			//$this->all_dirs($wwwcat);
+			if($wwwcat)
+				$amount = count($wwwcat);
+			
+			/*if($this->action_val)
+				if(!in_array($value, $wwwcat))
+					continue;*/
+			$id = self::ToDir($this->dir_id, $value);
+			if($amount == 1)
+			{
+				/*if($this->action_val)
+					$q = 'SELECT distinct w.warecode as result, w.warecode 
+						FROM warez_'.$this->region_id." as w
+						WHERE w.warecode in (".implode(",", $this->action_val).")
+						$this->searches
+						AND w.DirID = ".$this->dir_id."
+						AND w.ClassID = ".$value."
+						AND w.GrID = ".$wwwcat[0]->result." group by result order by w.hit DESC, w.price DESC ";
+				else 
+					$q = 'SELECT distinct w.warecode as result, w.warecode 
+							FROM warez_'.$this->region_id." as w
+							WHERE w.DirID = ".$this->dir_id."
+							$this->searches
+							AND w.ClassID = ".$value."
+							AND w.GrID = ".$wwwcat[0]->result." group by result order by w.hit DESC, w.price DESC ";
+						*/
+				//print $q;
+				$id = self::ToDir($this->dir_id, $value, $wwwcat[0]->result);
+				//$wwwcats =  Models\Warez::find_by_sql($q);
+				$wwwcat =  Models\Warez::getWaresId($this->dir_id, $value, $wwwcat[0]->result,
+													$this->region_id, $this->action_val, $this->searches);
+				if($wwwcat)
+					$amount = count($wwwcat);
+			}
+			if($amount == 0)
+				continue;
+			//print_r($wwwcats);
+			/*$category = $this->categories->addChild("category");
+			$category->addChild("category_id", $id);
+			$category->addChild("category_name", ToUTF(self::$Classes[$this->dir_id][$value]));
+			$category->addChild("amount", $amount); 
+			$icon = $category->addChild("category_icon", 
+				#"http://www.mvideo.ru/Pdb/".$wwwcat[0]->warecode.".jpg"
+				"http://www.mvideo.ru/mobile/public/img/".$id.".jpg"
+			); 
+		#"http://www.mvideo.ru/mobile/public/img/".$val->dirid."_".$val->classid."_".$val->grid.".jpg");
+			$icon->addAttribute("width", "180");
+			$icon->addAttribute("height", "180");*/
+				$this->displayCategoryClass($id, $value, $amount);
+		}
+		return False;
+	}
+	/**
+	 * функция рисует на странице информацию о категориях 
+	 */
+	protected function createGroup()
+	{
+		$this->displayCategoryNode($this->parent_name);
+		
+		/*$q = 'SELECT distinct w.GrID as result 
+			FROM warez_'.$this->region_id." as w
+			WHERE w.DirID = ".$this->dir_id."
+			$this->searches
+			AND w.ClassID = ".$this->class_id;*/
+		$wwwarez =  Models\Warez::getGroupId($this->dir_id, $this->class_id, $this->region_id, $this->action_val, $this->searches);
+		//$wwwarez =  Models\Warez::find_by_sql($q);
+		$this->all_dirs($wwwarez);
+		#print $this->group_id;
+		//print_r(array_keys(self::$Groups[$this->dir_id]));
+		foreach (array_keys(self::$Groups[$this->dir_id][$this->class_id]) as $value) 
+		{
+			$amount = 0;
+			if(!in_array($value, $wwwarez))
+				continue;
+				
+				
+			/*if($this->action_val)
+				$q = 'SELECT distinct w.warecode as result, w.warecode 
+					FROM warez_'.$this->region_id." as w
+					WHERE w.warecode in (".implode(",", $this->action_val).")
+					$this->searches
+					AND w.DirID = ".$this->dir_id."
+					AND w.ClassID = ".$this->class_id."
+					AND w.GrID = ".$value." group by result order by w.hit DESC, w.price DESC ";
+			else 
+				$q = 'SELECT distinct w.warecode as result, w.warecode 
+						FROM warez_'.$this->region_id." as w
+						WHERE w.DirID = ".$this->dir_id."
+						$this->searches
+						AND w.ClassID = ".$this->class_id."
+						AND w.GrID = ".$value." group by result order by w.hit DESC, w.price ASC ";*/
+				
+			//$wwwcat =  Models\Warez::find_by_sql($q);
+			$wwwcat =  Models\Warez::getWaresId($this->dir_id, $this->class_id, $value,
+													$this->region_id, $this->action_val, $this->searches);
+			//print_r($wwwcat);
+			//$this->all_dirs($wwwcat);
+			if($wwwcat)
+				$amount = count($wwwcat);
+			
+			/*if($this->action_val)
+				if(!in_array($value, $wwwcat))
+					continue;*/
+					
+			if($amount == 0)
+				continue;
+					
+			/*$category = $this->categories->addChild("category");
+			$category->addChild("category_id", self::ToDir($this->dir_id, $this->class_id, $value));
+			$category->addChild("category_name", ToUTF(self::$Groups[$this->dir_id][$this->class_id][$value]));
+			$category->addChild("amount", $amount); 
+			$icon = $category->addChild("category_icon", 
+				#"http://www.mvideo.ru/Pdb/".$wwwcat[0]->warecode.".jpg" 
+				"http://www.mvideo.ru/mobile/public/img/".self::ToDir($this->dir_id, $this->class_id, $value).".jpg"
+			); 
+		#"http://www.mvideo.ru/mobile/public/img/".$val->dirid."_".$val->classid."_".$val->grid.".jpg");
+			$icon->addAttribute("width", "180");
+			$icon->addAttribute("height", "180");*/
+			$id = self::ToDir($this->dir_id, $this->class_id, $value);
+			$this->displayCategoryGroup($id, $value, $amount);
+		}
+		return False;
+		
+		
+	}
+	/**
+	 * функция рисует на странице информацию о продуктах в категории 
+	 */
+	private function createProduct()
+	{
+		//print 4;
+		//var_dump($this->parents);
+		if($this->actions > 0 && $this->action_val)
+			$this->parents->dirid .= " and w.warecode in (".implode(",", $this->action_val).") ";#$this->parents->search
+		if($this->searches)
+			$this->parents->dirid .= $this->searches;
+		if($this->parents)
+		{
+			#print "ads";
+			$productes_all = Models\Warez::getWarez($this->region_id, $this->parents, False);
+			$productes_count = 0;
+			$productes_count = count($productes_all);
+			$productes_m = Models\Warez::getWarez($this->region_id, $this->parents, $this->page);
+			
+			//add params
+			$grid=array();
+			$markid = array();
+			$this->params="";
+			
+			$param_m = $this->displayProductMark();
+			$param_g = $this->displayProductGroup();
+			
+			$this->displayProductNode();
+			
+			if($this->page)
+				$this->displayPageNode($productes_count);
+				
+			if($productes_m)
+			{
+				foreach ($productes_m as $key => $val)
+				{
+					if (!in_array($val->grid, $grid))
+						$grid[]=$val->grid;
+					if (!in_array($val->mark, $markid))
+						$markid[]=$val->mark;
+					//add products
+					$this->displayProduct( $val );
+					
+				}
+			}
+			
+			$this->getProductMarkVal( $markid, &$param_m );
+			$this->getProductGroupVal($grid, $param_g);
+			
+		}
+	}
+	
+	
+	
+	
+	
+	private function createDirAction()
+	{
+		$this->createParent();
+		/*$q = 'SELECT distinct w.DirID as result, COUNT(w.warecode) as c 
+			FROM warez_'.$this->region_id.' as w ';
+		
+		if($this->searches)
+			$q .= " WHERE w.warecode ".$this->searches;
+			
+		$q .= " GROUP BY result
+			ORDER BY c DESC";
+		
+		if($this->action_val)
+			$q = 'SELECT distinct w.DirID as result, COUNT(w.warecode) as c 
+					FROM warez_'.$this->region_id." as w
+					WHERE w.warecode in (".implode(",", $this->action_val).")
+					$this->searches
+					GROUP BY result
+					ORDER BY c DESC";
+		
+		*/
+		//print "<!--\ ".$q." \-->";
+		//$wwwarez =  Models\Warez::find_by_sql($q);
+		//$dcg = array($this->dir_id);
+		$wwwarez =  ActiveRecord\Warez::getRootCategoryChild($this->region_id, $this->action_val, $this->searches);
+		$res = $wwwarez;
+		$this->all_dirs($wwwarez);
+		#print $this->group_id;
+		//print_r(array_keys(self::$Groups[$this->dir_id]));
+		if($this->dir_id)
+		{
+			$this->parents->classid = "";
+			$this->parents->grid = "";
+			//var_dump($this->parents);
+			if(!$this->class_id)
+				return $this->createProduct();
+			return false;
+		}
+		else 
+		{
+			$this->displayCategoryNode($this->parent_name);
+		}
+		//foreach (array_keys(self::$Dirs) as $value) 
+		foreach ($res as $val) 
+		{
+			$value = $val->result;
+			$amount = 0;
+			if(in_array($value, array_keys(self::$Dirs)))
+			{
+				if(!in_array($value, $wwwarez))
+					continue;
+					
+					
+				/*if($this->action_val)
+					$q = 'SELECT distinct w.warecode 
+						FROM warez_'.$this->region_id." as w
+						WHERE w.warecode in (".implode(",", $this->action_val).")
+						$this->searches
+						AND w.DirID = ".$value;
+				else 
+					$q = 'SELECT distinct w.warecode  
+							FROM warez_'.$this->region_id." as w
+							WHERE w.DirID = ".$value."
+							$this->searches";*/
+					
+				$wwwcat =  Models\Warez::getWarezAction($value, $this->region_id, $this->action_val, $this->searches);
+				//print_r($wwwcat);
+				//$this->all_dirs($wwwcat);
+				if($wwwcat)
+					$amount = count($wwwcat);
+				
+				/*if($this->action_val)
+					if(!in_array($value, $wwwcat))
+						continue;*/
+						
+				if($amount == 0)
+					continue;
+						
+				/*$category = $this->categories->addChild("category");
+				$category->addChild("category_id", self::ToDir($value));
+				$category->addChild("category_name", ToUTF(self::$Dirs[$value]));
+				$category->addChild("amount", $amount); 
+				$icon = $category->addChild("category_icon", 
+					#"http://www.mvideo.ru/Pdb/".$wwwcat[0]->warecode.".jpg"
+					"http://www.mvideo.ru/mobile/public/img/".self::ToDir($value).".jpg"
+				); 
+			#"http://www.mvideo.ru/mobile/public/img/".$val->dirid."_".$val->classid."_".$val->grid.".jpg");
+				$icon->addAttribute("width", "180");
+				$icon->addAttribute("height", "180");*/
+				$id = self::ToDir($value);
+				$this->displayCategoryDir($id, $value, $amount);
+			}
+		}
+		return False;
+	}
+	
+	/**
+	 * устанавливаем ноду parent_category
+	 * проверяем название и предыдущую категорию 
+	 * 
+	 * @param int $category_id
+	 * @param object $parents_m
+	 * @return array $options
+	 */
+	private function createParent()
+	{
+		/*
+		 * ставим заголовки блока parents
+		 * если parent = 0 то ставим список всех категорий
+		 */
+		$cat_parrent_name = $this->parents->parent_name = "Список категорий";
+		$cat_parrent_id = $this->parents->parent_id = 0;
+		//если пустой category_id
+		if(!$this->category_id || $this->category_id<0 )
+		{
+			//$this->options = array('conditions' => "parent_id is null");
+			$cat_parrent_name = $this->parent_name = "Список категорий";
+			$cat_parrent_id = $this->parent_id = 0;
+			$this->category_id = 0;
+		}
+		//если не пустой category_id
+		else
+		{
+			//category_id меньше модификатора
+			if($this->category_id < self::$Mult)
+			{
+				$cat_parrent_name = $this->parent_name = "Список категорий";
+				$cat_parrent_id = $this->parent_id = 0;
+				//$this->dir_id = $this->category_id;
+				
+				
+			}
+			else
+			{
+				/*
+				 * проверяем parent текущей категории
+				 * и выставляем id и name у родительского нода
+				 */
+				$this->ToClass();
+				
+				$this->parents->dirid = $this->dir_id;
+				$this->parents->classid = $this->class_id;
+				$this->parents->grid = $this->group_id;
+				$this->parents->parent_name = ToUTF(self::$Dirs[$this->dir_id]);
+				
+				//если есть класс
+				if($this->class_id)
+				{
+					$this->parents->parent_id = self::ToDir($this->dir_id, $this->class_id);
+					$this->parents->parent_name = ToUTF(self::$Classes[$this->dir_id][$this->class_id]);
+					$cat_parrent_id = self::ToDir($this->dir_id);
+					$cat_parrent_name = ToUTF(self::$Dirs[$this->dir_id]);
+					//если еть группа
+					if($this->group_id)
+					{
+						$this->parents->parent_id = self::ToDir($this->dir_id, $this->class_id, $this->group_id);
+						$this->parents->parent_name = ToUTF(self::$Groups[$this->dir_id][$this->class_id][$this->group_id]);
+						$cat_parrent_id = self::ToDir($this->dir_id, $this->class_id);
+						$cat_parrent_name = ToUTF(self::$Classes[$this->dir_id][$this->class_id]);
+					}
+				}
+				//если нет класса проверяем родительские категории
+				else 
+				{
+					foreach (self::$GlobalConfig['smenu'] as $key => $value) 
+					{
+						if(in_array($this->parents->dirid, $value['dirs']))
+							{
+								$cat_parrent_id = $this->parents->parent_id = ToUTF($key);
+								$cat_parrent_name = $this->parents->parent_name = ToUTF($value['name']);
+								break;
+							}
+					}
+				}
+				
+				$this->parent_name = $this->parents->parent_name;
+				$this->parent_id = $this->parents->parent_id;
+			}
+		}
+		
+		$this->displayCategoryParentNode($cat_parrent_id, $cat_parrent_name);
+		return false;//$this->options;
+	}
+	
+	private function getActions()
+	{
+		switch ((int)$this->actions)
+		{
+			case 1:
+				$action = 6;
+				break;
+			case 3:
+				$action = 0;
+				return $this->getActionFederal();
+				break;
+			case 4:
+				$action = 24;
+				break;
+			case 5:
+				$action = 25;
+				break;
+			case 6:
+				$action = 29;
+				break;
+			case 7:
+				$action = 28;
+				break;
+			default:
+				$action = $this->actions;
+				break;
+		}
+		//print $action;
+		$act = Models\Actions::first(array("segment_id"=>$action, "hidden"=>0));
+		//print_r($act);
+		if($act)
+			return $this->displayCategoryAction( $act );
+	}
+	/**
+	 * текущая федеральная акция
+	 */
+	private function getActionFederal()
+	{
+		$time = time();
+		
+		//$keys = array_keys(self::$GlobalConfig['fed_act']);
+		foreach (self::$GlobalConfig['fed_act'] as $key => $val) 
+		{
+			
+			if($key < $time)
+			{
+				if($val['end_date']>=$time)
+				{
+					//print 1;
+					$url = str_replace("/", "", $val['link']);//link
+					$imgfile = "imgs/action/main/$url.jpg";
+					$this->action = "";
+					$this->displayActionImage($imgfile);
+					
+					$this->action->addChild("description", ToUTF($val['name']));//descr
+					
+					$this->action->addChild("url", "http://www.mvideo.ru/".$url."-cond/");
+					$this->action->addChild("link", "http://www.mvideo.ru/".$url."/");
+					//print $url;
+					return $this->putActions($url);
+				}
+			}
+		}
+		
+	}
+	/**
+	 * собирает товары участвующие в акции
+	 * в массив $this->action_val
+	 * @param unknown_type $name
+	 */
+	private function getActionsVal($name)
+	{
+		
+		$options = array('select' => 'w.warecode',
+						'from' => 'segment_cache sc',
+						'joins'=>" join warez_$this->region_id w on (sc.warecode=w.warecode)",
+						'conditions' =>"sc.region_id=$this->region_id and sc.segment_name='$name' ");
+		//print $this->searches;
+		if($this->searches)
+			$options['conditions'] .= $this->searches;
+		$segment = Models\Segments::find('all', $options);
+		foreach ($segment as $val)
+		{
+			$this->action_val[] = $val->warecode;
+		}
+		return False;
+	}
+	
+	private function getProductMarkVal( $markid, &$param )
+	{
+		foreach($markid as $val)
+		{
+			$group = Models\Marks::find('first', array("markid"=>$val));
+			if($group)
+			{
+				$this->displayProductGroupOption(&$param, StripTags($group->markname), $val);
+			}
+		}
+	}
+	
+	private function getProductGroupVal( $grid, &$param )
+	{
+		foreach($grid as $val)
+		{
+			$group = Models\Groups::find('first', array("grid"=>$val));
+			if($group)
+			{
+				$this->displayProductGroupOption(&$param, ToUTF($group->grname), $val);
+			}
+		}
+	}
+	
+	private function displayCategoryAction( $act )
+	{
+		$url = str_replace("/", "", $act->segment_name);//link
+		$imgfile = "imgs/action/header_$url.jpg";
+		
+		$this->action = "";
+		$this->displayActionImage($imgfile);
+		
+		$this->action->addChild("description", ToUTF($act->segment_info));
+		$this->action->addChild("url", "http://www.mvideo.ru/".str_replace("_", "-", $act->segment_name)
+															."/?ref=left_bat_". $act->segment_name);
+		$this->action->addChild("link", "http://www.mvideo.ru/".$url."/");
+		$categorys = $this->getActionsVal($act->segment_name);
+		return $categorys;
+	}
+	
+	private function displayCategoryRoot($key, $value, $amount, $id)
+	{
+			$category = $this->categories->addChild("category");
+			$category->addChild("category_id", $key);
+			$category->addChild("category_name", ToUTF($value['name']));
+			$this->displayCategotyIcon($category, $id, $amount);
+	}
+	
+	private function displayCategoryDir($id, $value, $amount)
+	{
+		$name = ToUTF(self::$Dirs[$value]);
+		$this->displayCategorySection($name, $id, $amount);
+	}
+	
+	private function displayCategoryClass($id, $value, $amount)
+	{
+		$name = ToUTF(self::$Classes[$this->dir_id][$value]);
+		$this->displayCategorySection($name, $id, $amount);
+	}
+	
+	private function displayCategoryGroup($id, $value, $amount)
+	{
+		$name = ToUTF(self::$Groups[$this->dir_id][$this->class_id][$value]);
+		$this->displayCategorySection($name, $id, $amount);
+	}
+	
+	private function displayCategorySection($name, $id, $amount)
+	{
+		$category = $this->categories->addChild("category");
+		$category->addChild("category_id", $id);
+		$category->addChild("category_name", $name);
+		$this->displayCategotyIcon($category, $id, $amount);
+	}
+	
+	private function displayCategotyIcon(&$category, $id, $amount)
+	{
+		$category->addChild("amount", $amount); 
+		$icon = $category->addChild("category_icon", 
+			#"http://www.mvideo.ru/Pdb/".$wwwcat[0]->warecode.".jpg"
+			"http://www.mvideo.ru/mobile/public/img/".$id.".jpg"
+		); 
+		#"http://www.mvideo.ru/mobile/public/img/".$val->dirid."_".$val->classid."_".$val->grid.".jpg");
+		$icon->addAttribute("width", "180");
+		$icon->addAttribute("height", "180");
+	}
+	
+	
+	
+	
+	
+	
+	
+	
+	private function displayCategoryNode( $name )
+	{
+		$this->categories="";
+		$this->categories->addAttribute("category_id", $this->category_id);
+		$this->categories->addAttribute("category_name", $name );
+	}
+	
+	private function displayCategoryParentNode($cat_parrent_id, $cat_parrent_name)
+	{
+		$this->parent_category="";
+		$this->parent_category->addChild("category_id", $cat_parrent_id);
+		$this->parent_category->addChild("category_name", $cat_parrent_name);
+	}
+	
+	private function displayProduct( $val )
+	{
+		$product = $this->products->addChild("product");
+		$product->addChild("product_id", ToUTF($val->warecode));
+		$product->addChild("title", StripTags($val->name));
+		$val->getDesctiptions();
+		$product->addChild("description", StripTags($val->description));
+		//$rewiews = Models\Reviews::first(array('select' => 'count(rating) c, sum(rating) s', 'conditions' => array('warecode = ?', $val->warecode)));
+		$val->getRatingRev();
+		$product->addChild("rating", $val->rating);
+		$product->addChild("reviews_num", $val->reviews);
+		$product->addChild("inet_price", $val->inetprice);
+		
+		$dic = $val->getInetDiscountStatus($val->warecode, $this->region_id);
+		$product->addChild("card_discount", $dic);
+		
+		if($val->oldprice)
+			$old_price = $val->oldprice;
+		else
+			$old_price = $val->price;
+			
+		$product->addChild("old_price", $old_price);
+		
+		$product->addChild("price", $val->price);
+		$image = $product->addChild("image", "http://www.mvideo.ru/Pdb/$val->warecode.jpg"); 
+		$image->addAttribute("width", "180");
+		$image->addAttribute("height", "180");
+	}
+	
+	private function displayProductNode()
+	{
+		$name = $this->parent_name;
+		if(property_exists($this->parents, 'name'))
+			$name = ToUTF($this->parents->name);
+				
+		$this->products="";
+		$this->products->addAttribute("category_id", $this->category_id);
+		$this->products->addAttribute("category_name", $name);
+	}
+	
+	private function displayProductMark()
+	{
+		$param = $this->params->addChild("param"); 
+		$param->addAttribute("param_name", "mark");
+		$param->addAttribute("title", "Производители");
+		$param->addAttribute("current_value", "0");
+		$option = $param->addChild("option", "Все производители");
+		$option->addAttribute("value", "0");
+		return $param;
+	}
+	
+	
+	private function displayProductGroup()
+	{
+		$param = $this->params->addChild("param"); 
+		$param->addAttribute("param_name", "grid");
+		$param->addAttribute("title", "Группы");
+		$param->addAttribute("current_value", "0");
+		$option = $param->addChild("option", "Все группы");
+		$option->addAttribute("value", "0");
+		
+		return $param;
+	}
+	
+	
+	
+	private function displayProductGroupOption(&$param, $name, $val)
+	{
+		$option = $param->addChild("option", $name);
+		$option->addAttribute("value", $val);
+	}
+	
+	private function displayPageNode($productes_count)
+	{
+		$this->pages="";
+		$this->pages->addChild("amount", $productes_count);
+		$this->pages->addChild("onpage", "20");
+		$this->pages->addChild("page", $this->page);
+	}
+	/**
+	 * создает ноду с картинкой для акции
+	 * @param unknown_type $img
+	 */
+	private function displayActionImage($img)
+	{
+		$imgdir = dirname(dirname($_SERVER["SCRIPT_FILENAME"]));
+		
+		$fimgs = "http://www.mvideo.ru/$img";
+		//print $imgdir."/".$imgfile;
+		if(file_exists($imgdir."/".$img))
+		{
+			$imgsize = getimagesize($imgdir."/".$img);
+		
+			//создаем картинку
+			$images = $this->action->addChild("image", $fimgs);
+			
+			//задаем размеры
+			$images->addAttribute("width", $imgsize[0]);
+			$images->addAttribute("height", $imgsize[1]);
+		}
+	}
+	
+	/**
+	 * собирает уникальные ID директорий из БД
+	 * @param object $a
+	 */
+	protected function all_dirs(&$a)
+	{
+		//SELECT distinct DirID, ClassID, GrID from warez_1;
+		foreach ($a as $value) {
+			self::$TmpDir[] = $value->result;
+		}
+		$a=self::$TmpDir;
+		return $a;
+	}
+	
+	/**
+	 * устанавливает основные переменные из $_GET запроса
+	 */
+	private function setVar()
+	{
+		$this->region_id = get_key('region_id', 0);
+		$this->category_id = get_key('category_id', -1);
+		$this->actions = get_key('action', -1);
+		$this->searches = get_key('search');
+		$this->page = get_key('page', 0);
+	}
+	
+	/**
+	 * собирает ID категории
+	 * @param int $d
+	 * @param int $c
+	 * @param int $g
+	 * @return long
+	 */
+	protected static function ToDir($d, $c = 0, $g = 0)
+	{
+		$d = $d*self::$Mult;
+		$c = $c*self::$MultC;
+		$g = $g*self::$MultG;
+		return $d+$c+$g;
+	}
+	
+	/**
+	 * разбирает ID категории превращая их в DirID, ClassID, GrID из БД
+	 * и назначает основные переменные
+	 */
+	protected function ToClass()
+	{
+		$this->dir_id = floor($this->category_id / self::$Mult);
+		$this->class_id = floor(($this->category_id % self::$Mult) / self::$MultC);
+		$this->group_id = floor((($this->category_id % self::$Mult) % self::$MultC) / self::$MultG);
+	}
+}
\ No newline at end of file
diff --git a/controllers/CategoryImage.php b/controllers/CategoryImage.php
deleted file mode 100644
index 2d342a7..0000000
--- a/controllers/CategoryImage.php
+++ /dev/null
@@ -1,214 +0,0 @@
-<?php
-/**  
- * 
- * 
- * @package    controllers
- * @subpackage Category
- * @since      08.10.2010 14:00:27
- * @author     enesterov
- * @category   controller
- */
-
-
-	/*namespace Controllers;
-	use Models;*/
-	//ini_set('display_errors', True);
-	error_reporting(0);
-	date_default_timezone_set( 'Europe/Moscow' );
-	define( "ROOT_PATH", dirname(dirname(__FILE__)) );
-	
-	
-	define("FILE", ROOT_PATH . "/config.ini");
-	require_once ROOT_PATH . '/conf_parse.php';
-	
-	$conn = new config(FILE);
-	define( "DEBUG", ($conn->debug)?$conn->debug:True );
-	define( 'CONNECTION', ($conn->base)?$conn->base:'develop' );
-	$_SERVER['HTTP_HOST'] = "localhost";
-	$_SERVER["SCRIPT_FILENAME"] = "/www/sites/newmvideo/www/mobile/controllers";
-	
-	require_once ROOT_PATH . '/lib/ActiveRecord.php';
-	require_once ROOT_PATH . '/lib/Template.php';
-	require_once ROOT_PATH . '/config/config.php';
-	require_once ROOT_PATH . '/model/__init__.php';
-	require_once ROOT_PATH . '/controllers/Category.php';
-	
-class ControllerCategoryImage extends Controllers\ControllerCategory{
-	
-	public function image()
-	{
-		$this->region_id = "1";
-		$this->index(array());
-		$this->rootCategories();
-		
-	}
-	
-	private function getFile($file, $warecode)
-	{
-		$file = ROOT_PATH . "/public/img/$file.jpg";
-		$imgdir = dirname(ROOT_PATH);
-		$ln = "$imgdir/Pdb/$warecode.jpg";
-		$idir = "ln -s $ln " . $file . "\n";
-		//print $idir;
-		if(file_exists($ln))
-			if(!file_exists($file))
-				exec($idir);
-		
-	}
-	private function rootCategories()
-	{
-		$q = 'SELECT distinct w.DirID as result, w.warecode 
-				FROM warez_'.$this->region_id." as w
-				GROUP BY w.DirID";
-		
-		//print $q;
-		$wwwarez =  Models\Warez::find_by_sql($q);
-		$this->all_dirs($wwwarez);
-		//var_dump($wwwarez);
-		foreach (self::$GlobalConfig['smenu'] as $key => $value) 
-		{
-			$amount = 0;
-			foreach ($value['dirs'] as $v) 
-			{
-				//array_keys($wwwarez, "blue")
-				if(!in_array($v, $wwwarez))
-					continue 2;
-				
-				
-				if($amount!=0)
-					break;
-				$wdir =  Models\Warez::first(array('conditions'=>"dirid = ". $v, 'order' => 'price ASC'));
-				$this->getFile("s".$key, $wdir->warecode);
-				$amount = $v;
-			}
-			
-			$this->category_id = $key;
-			$this->Dirs();
-		}
-		return True;
-	}
-	
-	/**
-	 * ф-я выводит диры в рутовой категории
-	 * Enter description here ...
-	 */
-	private function Dirs()
-	{
-		
-		
-		$q = 'SELECT distinct w.DirID as result 
-			FROM warez_'.$this->region_id.' as w';
-		
-		
-		//print $q;
-		$wwwarez =  Models\Warez::find_by_sql($q);
-		$this->all_dirs($wwwarez);
-		
-		
-		
-		foreach (self::$GlobalConfig['smenu'][$this->category_id]['dirs'] as $value) 
-		{
-			$amount = 0;
-			if(!in_array($value, $wwwarez))
-				continue;
-			
-			$this->dir_id = $value;
-			$id = $this->ToDir($value);
-			$q = 'SELECT distinct ClassID as result, w.warecode 
-					FROM warez_'.$this->region_id." as w
-					
-					WHERE DirID = ".$value." group by result order by w.hit DESC, w.price DESC ";
-				
-			$wwwcat =  Models\Warez::find_by_sql($q);
-			if(!$wwwcat)
-				continue;
-			$this->getFile($id, $wwwcat[0]->warecode);
-			$this->Classes();
-		}
-		return True;
-	}
-	/**
-	 * ф-я выводит классы в дирах
-	 * Enter description here ...
-	 */
-	private function Classes()
-	{
-		$q = 'SELECT distinct w.ClassID as result 
-			FROM warez_'.$this->region_id." as w
-			WHERE w.DirID = ".$this->dir_id;
-		
-		$wwwarez =  Models\Warez::find_by_sql($q);
-		$this->all_dirs($wwwarez);
-		//print $this->dir_id;
-		//print_r(array_keys(self::$Groups[$this->dir_id]));
-		foreach (array_keys(self::$Groups[$this->dir_id]) as $value) 
-		{
-			$amount = 0;
-			if(!in_array($value, $wwwarez))
-				continue;
-			
-			$q = 'SELECT distinct w.GrID as result, w.warecode 
-						FROM warez_'.$this->region_id." as w
-						WHERE w.DirID = ".$this->dir_id."
-						AND w.ClassID = ".$value." group by result order by w.hit DESC, w.price DESC ";
-				
-			$wwwcat =  Models\Warez::find_by_sql($q);
-			if(!$wwwcat)
-				continue;
-			$this->class_id = $value;
-			$id = $this->ToDir($this->dir_id, $value);
-			$this->getFile($id, $wwwcat[0]->warecode);
-			$this->Groups();
-			#"http://www.mvideo.ru/mobile/public/img/".$this->dir_id."_".$value."_.jpg"
-		
-		}
-		return True;
-	}
-	/**
-	 * функция рисует на странице информацию о категориях 
-	 */
-	private function Groups()
-	{
-		$q = 'SELECT distinct w.GrID as result 
-			FROM warez_'.$this->region_id." as w
-			WHERE w.DirID = ".$this->dir_id."
-			AND w.ClassID = ".$this->class_id;
-		
-		$wwwarez =  Models\Warez::find_by_sql($q);
-		$this->all_dirs($wwwarez);
-		#print $this->group_id;
-		//print_r(array_keys(self::$Groups[$this->dir_id]));
-		foreach (array_keys(self::$Groups[$this->dir_id][$this->class_id]) as $value) 
-		{
-			$amount = 0;
-			if(!in_array($value, $wwwarez))
-				continue;
-				
-				
-			$q = 'SELECT distinct w.warecode as result, w.warecode 
-						FROM warez_'.$this->region_id." as w
-						WHERE w.DirID = ".$this->dir_id."
-						AND w.ClassID = ".$this->class_id."
-						AND w.GrID = ".$value." group by result order by w.hit DESC, w.price ASC ";
-				
-			$wwwcat =  Models\Warez::find_by_sql($q);
-			if(!$wwwcat)
-				continue;
-			//print_r($wwwcat);
-			//$this->all_dirs($wwwcat);
-			$id = $this->ToDir($this->dir_id, $this->class_id, $value);
-			$this->getFile($id, $wwwcat[0]->warecode);
-		}
-		return True;
-		
-		
-	}
-	public function __destruct()
-	{
-		return False;
-	}
-	
-}
-
-$run = new ControllerCategoryImage();
-$run->image();
\ No newline at end of file
diff --git a/controllers/Product.php b/controllers/Product.php
index 95cab0f..696348a 100644
--- a/controllers/Product.php
+++ b/controllers/Product.php
@@ -18,21 +18,32 @@ class ControllerProduct extends Template\Template{
 	private static $Mult = 1000000000;
 	private static $MultC = 100000;
 	private static $MultG = 1;
+	private $region_id;
+	private $product_id;
+	private $ask = "";
+	private $reviews = "";
+	private $page = 0;
+	
+	
 	public function index( $array )
 	{
 		//print_r($array);
-		list($region_id, $product_id, $ask, $reviews, $page)=$array;
+		if($array)
+		{
+			$this->setVar();
+		}
+		//list($region_id, $product_id, $ask, $reviews, $page)=$array;
 		
-		$options = array("_warecode"=>$product_id);
-		list($where, $array) = Models\Warez::SetParam($region_id, $options);
-		$productes = Models\Warez::sql($region_id, $where, $array);
+		$options = array("_warecode"=>$this->product_id);
+		list($where, $array) = Models\Warez::SetParam($this->region_id, $options);
+		$productes = Models\Warez::sql($this->region_id, $where, $array);
 		if($productes)
 		{
 			$productes = $productes[0];
 			
 			
-			$rfile = dirname(dirname(dirname($_SERVER["SCRIPT_FILENAME"])));
-			require_once $rfile . '/www/classifier_'.$region_id.'.inc.php';
+			$rfile = MVIDEO_PATH;
+			require_once $rfile . '/www/classifier_'.$this->region_id.'.inc.php';
 			$d = $productes->dirid*self::$Mult;
 			$c = $productes->classid*self::$MultC;
 			$g = $productes->grid*self::$MultG;
@@ -46,21 +57,21 @@ class ControllerProduct extends Template\Template{
 			if($productes->inetqty>0)
 				$this->product->addAttribute("inetSale", 1);
 			
-			$dic = $productes->getInetDiscountStatus($productes->warecode, $region_id);
+			$dic = $productes->getInetDiscountStatus($productes->warecode, $this->region_id);
 			$this->product->addAttribute("card_discount", $dic);
 			
-			$this->product->addChild("product_id", $product_id);
-			$this->product->addChild("region_id", $region_id);
+			$this->product->addChild("product_id", $this->product_id);
+			$this->product->addChild("region_id", $this->region_id);
 			$this->product->addChild("title", StripTags($productes->ware));
 			
 			$imgs = $this->product->addChild("images");
-			$img = $imgs->addChild("img", "http://www.mvideo.ru/Pdb/$product_id.jpg");
+			$img = $imgs->addChild("img", "http://www.mvideo.ru/Pdb/$this->product_id.jpg");
 			$img->addAttribute("width", "180");
 			$img->addAttribute("height", "180");
 			$img->addAttribute("main", "1");
 			
 			$mov = $this->product->addChild("movies");
-			//$mov->addChild("video", "http://www.mvideo.ru/Pdb/$product_id.jpg");
+			//$mov->addChild("video", "http://www.mvideo.ru/Pdb/$this->product_id.jpg");
 			
 			$this->product->addChild("inet_price", $productes->inetprice);
 			if($productes->oldprice)
@@ -77,10 +88,10 @@ class ControllerProduct extends Template\Template{
 			$productes->getDesctiptions();
 			$this->product->addChild("description", StripTags($productes->description));
 			
-			//if(!$ask && !$reviews)
+			//if(!$this->ask && !$reviews)
 			//{
 				$options = $this->product->addChild("options");
-				$options_m=Models\Optionlist::all(array('warecode'=>$product_id));
+				$options_m=Models\Optionlist::all(array('warecode'=>$this->product_id));
 				foreach ($options_m as $key => $val)
 				{
 					$option = $options->addChild("option");
@@ -88,15 +99,15 @@ class ControllerProduct extends Template\Template{
 					$option->addChild("value", StripTags($val->prval));
 				}
 			//}
-			if($ask)
+			if($this->ask)
 			{
 				$limit = true;
-				if($ask==2)
+				if($this->ask==2)
 					$limit = false;
 				$ask = $this->product->addChild("aks");
 				//$ask_m=array();
 				
-				$ask_m=Models\Link::getAccess($region_id, $product_id, $limit);
+				$ask_m=Models\Link::getAccess($this->region_id, $this->product_id, $limit);
 				//print_r($ask_m);
 				$group = "";
 				foreach ($ask_m as $key => $val)
@@ -134,10 +145,10 @@ class ControllerProduct extends Template\Template{
 					$image->addAttribute("height", "180");
 				}
 			}
-			if($reviews)
+			if($this->reviews)
 			{
 				$reviews = $this->product->addChild("reviews");
-				$reviews_m=Models\Reviews::all(array('warecode'=>$product_id, "approved"=>1));
+				$reviews_m=Models\Reviews::all(array('warecode'=>$this->product_id, "approved"=>1));
 				foreach ($reviews_m as $key => $val)
 				{
 					$review = $reviews->addChild("review");
@@ -154,4 +165,16 @@ class ControllerProduct extends Template\Template{
 			}
 		}
 	}
+	
+	/**
+	 * устанавливает основные переменные из $_GET запроса
+	 */
+	private function setVar()
+	{
+		$this->region_id = get_key('region_id', 0);
+		$this->product_id = get_key('product_id');
+		$this->ask = get_key('aks');
+		$this->reviews = get_key('reviews');
+		$this->page = get_key('page', 0);
+	}
 }
\ No newline at end of file
diff --git a/controllers/Region.php b/controllers/Region.php
index 0c0f1da..3dea1bc 100644
--- a/controllers/Region.php
+++ b/controllers/Region.php
@@ -7,6 +7,9 @@
  * @since      08.10.2010 14:00:27
  * @author     enesterov
  * @category   controller
+ * 
+ * @global ControllerRegion
+ * @method index
  */
 
 	namespace Controllers;
@@ -15,7 +18,10 @@
 	
 class ControllerRegion extends Template\Template{
 	
-	public function index( $region_id = 0 )
+	/**
+	 * выбирает регион из БД
+	 */
+	public function index()
 	{
 		$region_m = Models\Regions::all(array("virtual"=>0));
 		$this->regions = "";
@@ -24,17 +30,25 @@ class ControllerRegion extends Template\Template{
 		{
 			if($val->id != 8)
 			{
-			$region = $this->regions->addChild("region");
-			
-				$region->addChild("region_id", $val->id );
-				$region->addChild("region_name", ToUTF($val->name));
-				$region->addChild("region_domain", $val->domain );
-				$coordinates = $region->addChild("coordinates");
-				$val->coordinates();
-				$coordinates->addChild("longitude", $val->longitude);
-				$coordinates->addChild("latitude", $val->latitude);
+				$this->displayRegionPage($val);
 			}
 			
 		}
 	}
+	
+	/**
+	 * создает страницу с xml
+	 * @param object $val
+	 */
+	private function displayRegionPage( $val )
+	{
+		$region = $this->regions->addChild("region");
+		$region->addChild("region_id", $val->id );
+		$region->addChild("region_name", ToUTF($val->name));
+		$region->addChild("region_domain", $val->domain );
+		$coordinates = $region->addChild("coordinates");
+		$val->coordinates();
+		$coordinates->addChild("longitude", $val->longitude);
+		$coordinates->addChild("latitude", $val->latitude);
+	}
 }
\ No newline at end of file
diff --git a/controllers/Start.php b/controllers/Start.php
new file mode 100644
index 0000000..3bc3a38
--- /dev/null
+++ b/controllers/Start.php
@@ -0,0 +1,25 @@
+<?php
+/**
+  * выдает стартовую страницу и банер
+  * 
+  * @package    Start.php
+  * @subpackage cotroller
+  * @since      15.04.2011 13:09:29
+  * @author     enesterov
+  * @category   controller
+  */
+
+	namespace Controllers;
+	use Models;
+	use Template;
+	
+class ControllerStart extends Template\Template{
+	public function index()
+	{
+		$this->startpage = "";
+		$this->startpage->addChild("name");
+		$this->startpage->addChild("banner_img");
+		$this->startpage->addChild("action_name");
+		$this->startpage->addChild("action_id");
+	}
+}
\ No newline at end of file
diff --git a/example/catalog.dtd b/example/catalog.dtd
deleted file mode 100644
index d2b4df6..0000000
--- a/example/catalog.dtd
+++ /dev/null
@@ -1,90 +0,0 @@
-<?xml encoding="UTF-8"?>
-
-<!ELEMENT mvideo_xml (parent_category,params,products,pages)>
-<!ATTLIST mvideo_xml
-  xmlns CDATA #FIXED ''
-  date CDATA #REQUIRED>
-
-<!ELEMENT parent_category (category_id,category_name)>
-<!ATTLIST parent_category
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT params (param)+>
-<!ATTLIST params
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT products (product)+>
-<!ATTLIST products
-  xmlns CDATA #FIXED ''
-  category_id CDATA #REQUIRED
-  category_name NMTOKEN #REQUIRED>
-
-<!ELEMENT pages (amount,onpage,page)>
-<!ATTLIST pages
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_id (#PCDATA)>
-<!ATTLIST category_id
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_name (#PCDATA)>
-<!ATTLIST category_name
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT param (option)+>
-<!ATTLIST param
-  xmlns CDATA #FIXED ''
-  current_value CDATA #REQUIRED
-  param_name NMTOKEN #REQUIRED
-  title NMTOKEN #REQUIRED>
-
-<!ELEMENT product (product_id,title,description,rating,small_price,price,image)>
-<!ATTLIST product
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT amount (#PCDATA)>
-<!ATTLIST amount
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT onpage (#PCDATA)>
-<!ATTLIST onpage
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT page (#PCDATA)>
-<!ATTLIST page
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT option (#PCDATA)>
-<!ATTLIST option
-  xmlns CDATA #FIXED ''
-  value CDATA #REQUIRED>
-
-<!ELEMENT product_id (#PCDATA)>
-<!ATTLIST product_id
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT title (#PCDATA)>
-<!ATTLIST title
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT description (#PCDATA)>
-<!ATTLIST description
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT rating (#PCDATA)>
-<!ATTLIST rating
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT small_price (#PCDATA)>
-<!ATTLIST small_price
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT price (#PCDATA)>
-<!ATTLIST price
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT image (#PCDATA)>
-<!ATTLIST image
-  xmlns CDATA #FIXED ''
-  height CDATA #REQUIRED
-  width CDATA #REQUIRED>
diff --git a/example/catalog.xml b/example/catalog.xml
deleted file mode 100644
index 4067938..0000000
--- a/example/catalog.xml
+++ /dev/null
@@ -1,57 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE catalog SYSTEM "http://localhost/public/catalog.dtd">
-<mvideo_xml date="2010-06-16 01:28">
-    <parent_category>
-        <category_id>1000</category_id>
-        <category_name>Телевизоры </category_name>
-    </parent_category>
-    <params>
-        <param param_name="mark_id" title="Производители" current_value="0">
-            <option value="0">Все производители</option>
-            <option value="11">Philips</option>
-        </param>
-        <param param_name="mark_id" title="Производители" current_value="0">
-            <option value="0">Все производители</option>
-            <option value="11">Philips</option>
-        </param>
-        <param param_name="mark_id" title="Производители" current_value="0">
-            <option value="0">Все производители</option>
-            <option value="11">Philips</option>
-        </param>
-    </params>
-    <products category_id="2000" category_name="LED-телевизоры">
-        <product>
-            <product_id>11024203</product_id>
-            <title>ЖК-телевизор 32" LG 32 LH2000</title>
-            <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready)</description>
-            <rating>4.5</rating>
-            <small_price>15990</small_price>
-            <price>14390</price>
-            <image width="150" height="150">http://www.mvideo.ru/Pdb/11024203.jpg</image>
-        </product>
-        <product>
-            <product_id>11024203</product_id>
-            <title>ЖК-телевизор 32" LG 32 LH2000</title>
-            <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready)</description>
-            <rating>4.5</rating>
-            <small_price>15990</small_price>
-            <price>14390</price>
-            <image width="150" height="150">http://www.mvideo.ru/Pdb/11024203.jpg</image>
-        </product>
-        <product>
-            <product_id>11024203</product_id>
-            <title>ЖК-телевизор 32" LG 32 LH2000</title>
-            <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready)</description>
-            <rating>4.5</rating>
-            <small_price>15990</small_price>
-            <price>14390</price>
-            <image width="150" height="150">http://www.mvideo.ru/Pdb/11024203.jpg</image>
-        </product>
-    </products>
-    <pages>
-        <amount>11</amount>
-        <onpage>20</onpage>
-        <page>1</page>
-    </pages>
-</mvideo_xml>
-
diff --git a/example/catalog_action.dtd b/example/catalog_action.dtd
deleted file mode 100644
index faead3a..0000000
--- a/example/catalog_action.dtd
+++ /dev/null
@@ -1,98 +0,0 @@
-<?xml encoding="UTF-8"?>
-
-<!ELEMENT mvideo_xml (action,parent_category,params,products,pages)>
-<!ATTLIST mvideo_xml
-  xmlns CDATA #FIXED ''
-  date CDATA #REQUIRED>
-
-<!ELEMENT action (image,description,url)>
-<!ATTLIST action
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT parent_category (category_id,category_name)>
-<!ATTLIST parent_category
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT params (param)+>
-<!ATTLIST params
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT products (product)+>
-<!ATTLIST products
-  xmlns CDATA #FIXED ''
-  category_id CDATA #REQUIRED
-  category_name NMTOKEN #REQUIRED>
-
-<!ELEMENT pages (amount,onpage,page)>
-<!ATTLIST pages
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT url (#PCDATA)>
-<!ATTLIST url
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_id (#PCDATA)>
-<!ATTLIST category_id
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_name (#PCDATA)>
-<!ATTLIST category_name
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT param (option)+>
-<!ATTLIST param
-  xmlns CDATA #FIXED ''
-  current_value CDATA #REQUIRED
-  param_name NMTOKEN #REQUIRED
-  title NMTOKEN #REQUIRED>
-
-<!ELEMENT product (product_id,title,description,rating,small_price,price,image)>
-<!ATTLIST product
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT amount (#PCDATA)>
-<!ATTLIST amount
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT onpage (#PCDATA)>
-<!ATTLIST onpage
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT page (#PCDATA)>
-<!ATTLIST page
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT option (#PCDATA)>
-<!ATTLIST option
-  xmlns CDATA #FIXED ''
-  value CDATA #REQUIRED>
-
-<!ELEMENT product_id (#PCDATA)>
-<!ATTLIST product_id
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT title (#PCDATA)>
-<!ATTLIST title
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT rating (#PCDATA)>
-<!ATTLIST rating
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT small_price (#PCDATA)>
-<!ATTLIST small_price
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT price (#PCDATA)>
-<!ATTLIST price
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT image (#PCDATA)>
-<!ATTLIST image
-  xmlns CDATA #FIXED ''
-  height CDATA #REQUIRED
-  width CDATA #REQUIRED>
-
-<!ELEMENT description (#PCDATA)>
-<!ATTLIST description
-  xmlns CDATA #FIXED ''>
diff --git a/example/catalog_action.xml b/example/catalog_action.xml
deleted file mode 100644
index df2508d..0000000
--- a/example/catalog_action.xml
+++ /dev/null
@@ -1,48 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<mvideo_xml date="2010-06-16 01:28">
-    <action>
-        <image width="150" height="150">http://www.mvideo.ru/imgs/test.jpg</image>
-        <description>Успей купить с 10 по 1</description>
-        <url>http://www.mvideo.ru/action_url/</url>
-    </action>
-    <parent_category>
-        <category_id>1000</category_id>
-        <category_name>Телевизоры </category_name>
-    </parent_category>
-    <params>
-        <param param_name="mark_id" title="Производители" current_value="0">
-            <option value="0">Все производители</option>
-            <option value="11">Philips</option>
-        </param>
-        <param param_name="mark_id" title="Производители" current_value="0">
-            <option value="0">Все производители</option>
-            <option value="11">Philips</option>
-        </param>
-    </params>
-    <products category_id="2000" category_name="LED-телевизоры">
-        <product>
-            <product_id>11024203</product_id>
-            <title>ЖК-телевизор 32" LG 32 LH2000</title>
-            <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready)</description>
-            <rating>4.5</rating>
-            <small_price>15990</small_price>
-            <price>14390</price>
-            <image width="150" height="150">http://www.mvideo.ru/Pdb/11024203.jpg</image>
-        </product>
-        <product>
-            <product_id>11024203</product_id>
-            <title>ЖК-телевизор 32" LG 32 LH2000</title>
-            <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready)</description>
-            <rating>4.5</rating>
-            <small_price>15990</small_price>
-            <price>14390</price>
-            <image width="150" height="150">http://www.mvideo.ru/Pdb/11024203.jpg</image>
-        </product>
-    </products>
-    <pages>
-        <amount>11</amount>
-        <onpage>20</onpage>
-        <page>1</page>
-    </pages>
-</mvideo_xml>
-
diff --git a/example/categories.xml b/example/categories.xml
deleted file mode 100644
index de25ad9..0000000
--- a/example/categories.xml
+++ /dev/null
@@ -1,28 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<mvideo_xml date="2010-06-16 01:28">
-    <parent_category>
-        <category_id>0</category_id>
-        <category_name>Список категорий</category_name>
-    </parent_category>
-    <categories category_id="1000" category_name="Телевизоры">
-        <category>
-            <category_id>2000</category_id>
-            <category_name>LED-телевизоры</category_name>
-            <amount>123</amount>
-            <category_icon width="50" height="50"> http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-        <category>
-            <category_id>2000</category_id>
-            <category_name>LED-телевизоры</category_name>
-            <amount>123</amount>
-            <category_icon width="50" height="50"> http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-        <category>
-            <category_id>2000</category_id>
-            <category_name>LED-телевизоры</category_name>
-            <amount>123</amount>
-            <category_icon width="50" height="50"> http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-    </categories>
-</mvideo_xml>
-
diff --git a/example/categories_action.dtd b/example/categories_action.dtd
deleted file mode 100644
index a89fd22..0000000
--- a/example/categories_action.dtd
+++ /dev/null
@@ -1,56 +0,0 @@
-<?xml encoding="UTF-8"?>
-
-<!ELEMENT mvideo_xml (action,parent_category,categories)>
-<!ATTLIST mvideo_xml
-  xmlns CDATA #FIXED ''
-  date CDATA #REQUIRED>
-
-<!ELEMENT action (image,description,url)>
-<!ATTLIST action
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT parent_category (category_id,category_name)>
-<!ATTLIST parent_category
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT categories (category)+>
-<!ATTLIST categories
-  xmlns CDATA #FIXED ''
-  category_id CDATA #REQUIRED
-  category_name NMTOKEN #REQUIRED>
-
-<!ELEMENT image (#PCDATA)>
-<!ATTLIST image
-  xmlns CDATA #FIXED ''
-  height CDATA #REQUIRED
-  width CDATA #REQUIRED>
-
-<!ELEMENT description (#PCDATA)>
-<!ATTLIST description
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT url (#PCDATA)>
-<!ATTLIST url
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category (category_id,category_name,amount,category_icon)>
-<!ATTLIST category
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT amount (#PCDATA)>
-<!ATTLIST amount
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_icon (#PCDATA)>
-<!ATTLIST category_icon
-  xmlns CDATA #FIXED ''
-  height CDATA #REQUIRED
-  width CDATA #REQUIRED>
-
-<!ELEMENT category_id (#PCDATA)>
-<!ATTLIST category_id
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_name (#PCDATA)>
-<!ATTLIST category_name
-  xmlns CDATA #FIXED ''>
diff --git a/example/categories_action.xml b/example/categories_action.xml
deleted file mode 100644
index 3a6929c..0000000
--- a/example/categories_action.xml
+++ /dev/null
@@ -1,33 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<mvideo_xml date="2010-06-16 01:28">
-    <action>
-        <image width="150" height="150">http://www.mvideo.ru/imgs/test.jpg</image>
-        <description>Успей купить с 10 по 1</description>
-        <url>http://www.mvideo.ru/action_url/</url>
-    </action>
-    <parent_category>
-        <category_id>0</category_id>
-        <category_name>Список категорий</category_name>
-    </parent_category>
-    <categories category_id="1000" category_name="Телевизоры">
-        <category>
-            <category_id>2000</category_id>
-            <category_name>LED-телевизоры</category_name>
-            <amount>123</amount>
-            <category_icon width="50" height="50"> http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-        <category>
-            <category_id>2000</category_id>
-            <category_name>LED-телевизоры</category_name>
-            <amount>123</amount>
-            <category_icon width="50" height="50"> http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-        <category>
-            <category_id>2000</category_id>
-            <category_name>LED-телевизоры</category_name>
-            <amount>123</amount>
-            <category_icon width="50" height="50"> http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-    </categories>
-</mvideo_xml>
-
diff --git a/example/file.xml b/example/file.xml
deleted file mode 100644
index cda7081..0000000
--- a/example/file.xml
+++ /dev/null
@@ -1,31 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" ?> 
-<!DOCTYPE sgml [
-  <!ELEMENT mvideo_xml (regions)>
-  <!ELEMENT regions (region)>
-
-]>
-<mvideo_xml date="2010-10-18 16:44:07">
-<regions>
-<region>
-<region_id>1</region_id>
-<region_name>Москва</region_name>
-<coordinates>
-<longitude>
-</longitude>
-<latitude>
-</latitude>
-</coordinates>
-</region>
-<region>
-
-<region_id>2</region_id>
-<region_name>Ростов-на-Дону</region_name>
-<coordinates>
-<longitude>
-</longitude>
-<latitude>
-</latitude>
-</coordinates>
-</region>
-</regions>
-</mvideo_xml>
diff --git a/example/iphone_data.php b/example/iphone_data.php
deleted file mode 100644
index a682c34..0000000
--- a/example/iphone_data.php
+++ /dev/null
@@ -1,429 +0,0 @@
-<?php
-
-/**
-
- * ��������� ���������
-
- * 
-
- * 1 - �������
-
- * 2 - offers - ����������� �����
-
- * 3 - discounts - ����� � ������
-
- * 4 - gifts for him
-
- * 5 - gifts for her
-
- * 6 - gifts for family
-
- * 7 - gifts for children
-
- * 8 - wareinfo + ids
-
- */
-
-list ($dev_id, $dev_name) = split(",", isset($_GET['device']) ? $_GET['device'] : ',');
-if ($appdb = new PDO('sqlite:/www/sites/newmvideo/data/iphone_app.sqlite'))
-	$appdb->Query("insert into app_stats values(datetime('now'), '{$_SERVER['REMOTE_ADDR']}', '{$dev_id}', '{$dev_name}')");
-
-error_log("".date("Y/m/d H:i:s")."\t".$_SERVER['REMOTE_ADDR']."\t".$_GET['device']."\n", 3, '/tmp/iphone_data_device.log');
-
-if (isset($_GET['token'])) {
-	error_log("".date("Y/m/d H:i:s")."\t".$_SERVER['REMOTE_ADDR']."\t".$_GET['device']."\t".$_GET['token']."\n", 3, '/tmp/token.log');
-	if ($appdb = new PDO('sqlite:/www/sites/newmvideo/data/iphone_app.sqlite'))
-		$appdb->Query("insert into notification values(datetime('now'), '{$_SERVER['REMOTE_ADDR']}', '{$dev_id}', '{$dev_name}', '{$_GET[token]}')");
-	exit;
-}
-
-// ������� , ��� ��� xml
-
-
-
-
-
-// ����������� � �����
-
-$db = new DB_Mvideo;
-
-
-
-// ������ �� ��������� - 1
-
-$GlobalConfig["RegionID"] = 1;
-
-if (isset($_GET['region'])) {
-
-  $GlobalConfig["RegionID"] = (int)$_GET['region'];
-
-}
-
-
-
-// ��������� �� ��������� - 1
-
-$category = 1;
-
-if (isset($_GET['category'])) {
-
-  $category = (int)$_GET['category'];
-
-}
-
-if (isset($_GET['ids'])) {
-
-  $ids = (int)$_GET['ids'];
-
-}
-
-
-
-// �������� �������� �� ���������
-
-switch($category) {
-
-  case 1:
-
-   $tpl->assign("type","novelty");
-    
-    $ids = array();
-     
-	/**
-   * 
-   */
-  $query = "
-	  SELECT warecode
-	  FROM segment_cache
-	  WHERE segment_name='novelty'
-	  AND region_id=".$GlobalConfig['RegionID']."
-	  ORDER BY promo_hour DESC,important DESC
-  ";
-  $db->query($query);
-	if (mysql_num_rows($db->Query_ID) > 0) {
-		while ($row = mysql_fetch_assoc($db->Query_ID)) {
-          $ids[] = $row['warecode'];
-        }
-      }
-      
-    $params = array("ids" => $ids,"homeshop" => ($GlobalConfig["RegionID"]==1?1:0));
-
-    break;
-
-        
-
-  case 2:
-
-    $tpl->assign("type","offers");
-
-    //$params = array("BestPrice" => 2, "homeshop" => ($GlobalConfig["RegionID"]==1?1:0));
-    $params = array("Hit" => 1, "homeshop" => ($GlobalConfig["RegionID"]==1?1:0));
-
-    break;
-
-        
-
-  case 3:
-
-    $tpl->assign("type","discounts");
-
-    
-
-    if ($GlobalConfig["RegionID"] == 1) {
-
-    	
-
-      $ids = array();
-
-      $sql = "
-
-        SELECT warecode
-
-        FROM t_buy_now
-
-        WHERE start_date <= now()
-
-        AND end_date >= now()
-
-      ";
-
-      $db->query($sql);
-
-      if (mysql_num_rows($db->Query_ID) > 0) {
-
-        while ($row = mysql_fetch_assoc($db->Query_ID)) {
-
-          $ids[] = $row['warecode'];
-
-        }
-
-      }
-
-
-
-      $params = array("ids" => $ids, "rows" => 10);
-
-
-
-    } else {
-
-    	
-
-      $params = array("BestPrice" => 1, "rows" => 10);
-
-        
-
-    }
-
-    break;
-
-        
-
-  case 4:
-
-  	$tpl->assign("type","gifts_for_him");
-
-    $params = array("top_gifts"=>1,"gift_theme"=>1,"rows"=>30,"order_b"=>4);
-    $params = array("gift_theme"=>1,"rows"=>10,"order_b"=>4);
-
-    break;
-
-      	
-
-  case 5:
-
-  	$tpl->assign("type","gifts_for_her");
-
-    $params = array("top_gifts"=>1,"gift_theme"=>2,"rows"=>30,"order_b"=>4);
-    $params = array("gift_theme"=>2,"rows"=>10,"order_b"=>4);
-
-    break;
-
-      	
-
-  case 6:
-
-    $tpl->assign("type","gifts_for_family");
-
-    $params = array("top_gifts"=>1,"gift_theme"=>3,"rows"=>30,"order_b"=>4);
-    $params = array("gift_theme"=>3,"rows"=>10,"order_b"=>4);
-
-    break;
-
-      	
-
-  case 7:
-
-  	$tpl->assign("type","gifts_for_children");
-
-    $params = array("top_gifts"=>1,"gift_theme"=>4,"rows"=>30,"order_b"=>4);
-    $params = array("gift_theme"=>4,"rows"=>10,"order_b"=>4);
-
-    break;
-    
-    
-    case 8:
-    	
-    $tpl->assign("type","novelty");
-    
-    
-    
-
-    $params = array("ids" => (int)$ids);
-
-    break;
-
-    
-
-  default:
-
-  	header("HTTP/1.0 404 Not Found", true, 404);
-
-	exit();
-
-  	break;
-
-}
-
-		$GlobalConfig['cur_action']['descr'] = str_replace('<','',$GlobalConfig['cur_action']['descr']);
-		$GlobalConfig['cur_action']['descr'] = str_replace('>','',$GlobalConfig['cur_action']['descr']);
-
-		
-		
-		
-
-
-
-$itemsList = Find(0,$params,"shortlist&props");
-
-//print_R(Find(0,$params,"shortlist&props","stringsql"));
-
-
-
-// ���� ���-�� ���� �������
-
-if (is_array($itemsList) && count($itemsList)) {
-
-	
-
-  $warecodes = array_keys($itemsList);
-
-
-
-  // previewText - 3 �����
-
-  $sql = "
-
-    SELECT *
-
-    FROM new_options
-
-    WHERE warecode in (".join(",",$warecodes).")
-
-    ORDER BY sort
-
-    LIMIT 3
-
-  ";
-
-  $db->query($sql);
-
-  if (mysql_num_rows($db->Query_ID) > 0) {
-
-    while ($row = mysql_fetch_assoc($db->Query_ID)) {
-
-      if ($row['title']) {
-
-        $itemsList[$row['warecode']]['options'][] = $row;
-
-      }
-
-    }
-
-  }
-
-  
-
-  // detailText - ���-�� + �� ��������
-
-  foreach($itemsList as $k =>$val) {
-
-  	
-
-    if (is_array($val['props']) && count($val['props'])) {
-
-    	
-
-      foreach($val['props'] as $k1 => $prop) {
-
-        if (strpos($prop['PrVal'], '�����')) {
-
-          unset($itemsList[$k]['props'][$k1]);
-
-        }
-
-
-
-        $prop['PrName'] = str_replace('&nbsp;',' ', $prop['PrName']);
-        $prop['PrName'] = str_replace('&laquo;','"', $prop['PrName']);
-        $prop['PrName'] = str_replace('&raquo;','"', $prop['PrName']);
-        $prop['PrName'] = str_replace('&','and', $prop['PrName']);
-    $prop['FullName'] = str_replace('&nbsp;', ' ',$prop['FullName']);
-    $prop['FullName'] = str_replace('&laquo', '"',$prop['FullName']);
-    $prop['FullName'] = str_replace('&raquo', '"',$prop['FullName']);
-    $prop['FullName'] = str_replace('&', 'and',$prop['FullName']);
-
-        $itemsList[$k]['props'][$k1]['PrName'] = strip_tags($prop['PrName']);
-
-      }
-
-    }
-
-
-
-    $itemsList[$k]['FullName'] = str_replace('&nbsp;',' ', $itemsList[$k]['FullName']);
-    $itemsList[$k]['FullName'] = str_replace('&laquo;','"', $itemsList[$k]['FullName']);
-    $itemsList[$k]['FullName'] = str_replace('&raquo;','"', $itemsList[$k]['FullName']);
-    $itemsList[$k]['FullName'] = str_replace('&','and', $itemsList[$k]['FullName']);
-    if ($GlobalConfig['cur_action']['priceTextType'] && $_GET['category'] == 2) {
-
-      $itemsList[$k]['priceTextVal'] = $val[$GlobalConfig['cur_action']['priceTextType']];
-
-    }
-
-//    $cat[$val['DirID'] . ':' . $val['ClassID']] += 1;
-    $categories[$val['DirID']] += 1;
-
-  }
-
-  if ($categories) {
-	$res = $db->query('SELECT * FROM dirs WHERE DirID IN ('.join(",",array_keys($categories)).')');
-	while ($row = @mysql_fetch_assoc($db->Query_ID)) {
-		$categories[$row['DirID']] = array( 'DirName' => $row['DirName'], 'count' => $categories[$row['DirID']]);
-	}
-  }
-
-
-
-  // ����������� ������� ��������
-
-  $sql = "
-
-    SELECT *
-
-    FROM warereviews_new
-
-    WHERE warecode in (".join(",",$warecodes).")
-
-  ";
-
-  $res = $db->query($sql);
-
-  while ($row=@mysql_fetch_assoc($db->Query_ID)) {
-
-
-
-    $s1 = str_replace(array('<br>','<br/>'), '\n',$row['ReviewText']);
-
-    $s1 = str_replace('&nbsp;', ' ',$s1);
-    $s1 = str_replace('&laquo;', '"',$s1);
-    $s1 = str_replace('&raquo', '"',$s1);
-    $s1 = str_replace('&', 'and',$s1);
-    $row['FullName'] = str_replace('&nbsp;', ' ',$row['FullName']);
-    $row['FullName'] = str_replace('&laquo;', '"',$row['FullName']);
-    $row['FullName'] = str_replace('&raquo;', '"',$row['FullName']);
-    $row['FullName'] = str_replace('&', 'and',$row['FullName']);
-
-    $s1 = html_entity_decode($s1);
-
-    $itemsList[$row['warecode']]['ReviewText'] = strip_tags($s1);
-
-
-
-  }
-
-}
-
-
-header ("Content-type: text/xml");
-
-
-
-// ������ �����
-
-
-
-if (!$catalog)
-	$tpl->assign("itemsList",$itemsList);
-else
-	$tpl->assign("categories",$categories);
-
-$tpl->assign("RegionID",$GlobalConfig["RegionID"]);
-
-$tpl->assign("RegionHost",$GlobalConfig['RegionDomains'][$GlobalConfig["RegionID"]]);
-
-$tpl->display("cache/iphone_data.xml.tpl");
-
-
-
-?>
diff --git a/example/iphone_data.xml.tpl b/example/iphone_data.xml.tpl
deleted file mode 100644
index 966cf4d..0000000
--- a/example/iphone_data.xml.tpl
+++ /dev/null
@@ -1,41 +0,0 @@
-<?xml version="1.0" encoding="windows-1251"?>
-<itemsList date="{$smarty.now|date_format:"%Y-%m-%d %H:%M"}" type="{$type}">
-{if $type=="offers" && $GlobalConfig.cur_action|@count}
-<actionInfo>
-<name>{$GlobalConfig.cur_action.name}</name>
-<dateEnd>{$GlobalConfig.cur_action.end_date}</dateEnd>
-<link>http://{$RegionHost}{$GlobalConfig.cur_action.link}</link>
-<descr>{$GlobalConfig.cur_action.descr}</descr>
-</actionInfo>
-{/if}
-{if $categories}
-<categories>
-{foreach from=$categories item=catitem key=catkey}
-<category>
-<id>{$catkey}</id>
-<name>{$catitem.DirName}</name>
-<count>{$catitem.count}</count>
-<icon>http://www.mvideo.ru/imgs/catalog/dir_{$catkey}.gif</icon>
-</category>
-{/foreach}
-</categories>
-{/if}
-{foreach from=$itemsList item=item key=key}
-<item>
-<id>{$item.warecode}</id>
-{if $item.DirID}<DirID>{$item.DirID}</DirID>{/if}
-<name>{$item.FullName}</name>
-<previewText>{if $item.options|@count}{foreach from=$item.options item=opt}{$opt.title};\n{/foreach}{else}{$ware.descr}{/if}</previewText>
-<inetPrice>{if $type!="offers" && $RegionID==1 && $item.InetPrice && $item.InetQty && $item.InetPrice<$item.Price}{$item.InetPrice}{/if}</inetPrice>
-<price>{$item.Price}</price>
-<oldPrice>{if $item.Price<$item.OldPrice}{$item.OldPrice}{/if}</oldPrice>
-<priceText>{if $type=="offers" && $GlobalConfig.cur_action|@count && $GlobalConfig.cur_action.priceText && $GlobalConfig.cur_action.priceTextType}{$GlobalConfig.cur_action.priceText}{$item.priceTextVal}{/if}</priceText>
-<onlinePrice>{if $RegionID==1 && $item.OnlinePrice} -      5%    -.{/if}</onlinePrice>
-<currency>RUR</currency>
-<previewImageUrl>http://www.mvideo.ru/Pdb/{$item.warecode}s.jpg</previewImageUrl>
-<detailImageUrl>http://www.mvideo.ru/Pdb/{$item.warecode}.jpg</detailImageUrl>
-<detailText>{if $item.props|@count}{foreach from=$item.props item=property}{$property.PrName}{if $property.PrVal} - {$property.PrVal}{/if};\n{/foreach}\n\n{/if}{$item.ReviewText}</detailText>
-<url>http://{$RegionHost}/products/{$item.warecode}.html</url>
-</item>
-{/foreach}
-</itemsList>
diff --git a/example/product.xml b/example/product.xml
deleted file mode 100644
index 8d251c7..0000000
--- a/example/product.xml
+++ /dev/null
@@ -1,77 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<mvideo_xml date="2010-06-16 01:28">
-    <product>
-        <product_id>11024203</product_id>
-        <region_id>1</region_id>
-        <category_id>2000</category_id>
-        <title>ЖК-телевизор 32" LG 32 LH2000</title>
-        <small_price>15990</small_price>
-        <price>14390</price>
-        <rating>4.5</rating>
-        <reviews_num>5</reviews_num>
-        <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready).</description>
-        <options>
-            <option>
-                <name>Размер диагонали экрана</name>
-                <value>32"(81.2 см)</value>
-            </option>
-            <option>
-                <name>Размер диагонали экрана</name>
-                <value>32"(81.2 см)</value>
-            </option>
-            <option>
-                <name>Размер диагонали экрана</name>
-                <value>32"(81.2 см)</value>
-            </option>
-        </options>
-        <ask>
-            <product>
-                <product_id>11024203</product_id>
-                <title>ЖК-телевизор 32" LG 32 LH2000</title>
-                <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready)</description>
-                <rating>4.5</rating>
-                <reviews_num>5</reviews_num>
-                <small_price>15990</small_price>
-                <price>14390</price>
-                <image width="150" height="150">http://www.mvideo.ru/Pdb/11024203.jpg</image>
-            </product>
-            <product>
-                <product_id>11024203</product_id>
-                <title>ЖК-телевизор 32" LG 32 LH2000</title>
-                <description>ЖК-телевизор LG 32 LH2000 отличается простотой в эксплуатации и крайне низким энергопотреблением благодаря интеллектуальной технологии энергосбережения. Экран с диагональю экрана 81,2 см и динамической контрастностью 30 000:1 поддерживает разрешение 1366 х 768 пикс. (HD Ready)</description>
-                <rating>4.5</rating>
-                <reviews_num>5</reviews_num>
-                <small_price>15990</small_price>
-                <price>14390</price>
-                <image width="150" height="150">http://www.mvideo.ru/Pdb/11024203.jpg</image>
-            </product>
-        </ask>
-        <reviews>
-            <review>
-                <date>2010-04-04</date>
-                <author>Анжела</author>
-                <city>Москва</city>
-                <rating>2.0</rating>
-                <title>Сломались детали в барабане</title>
-                <text>Я купила машинку 2 недели назад.Стирала по инструкции.Понемножку.Купила даже шарик от извести.Сегодня отлетела одна из 3 пластмассовых деталей в барабане.Что это?Люди стирают годами.У меня никогда не было машины.Вот купила.Знала бы .купила подороже.Но без пластмассовых деталей.</text>
-            </review>
-            <review>
-                <date>2010-04-04</date>
-                <author>Анжела</author>
-                <city>Москва</city>
-                <rating>2.0</rating>
-                <title>Сломались детали в барабане</title>
-                <text>Я купила машинку 2 недели назад.Стирала по инструкции.Понемножку.Купила даже шарик от извести.Сегодня отлетела одна из 3 пластмассовых деталей в барабане.Что это?Люди стирают годами.У меня никогда не было машины.Вот купила.Знала бы .купила подороже.Но без пластмассовых деталей.</text>
-            </review>
-            <review>
-                <date>2010-04-04</date>
-                <author>Анжела</author>
-                <city>Москва</city>
-                <rating>2.0</rating>
-                <title>Сломались детали в барабане</title>
-                <text>Я купила машинку 2 недели назад.Стирала по инструкции.Понемножку.Купила даже шарик от извести.Сегодня отлетела одна из 3 пластмассовых деталей в барабане.Что это?Люди стирают годами.У меня никогда не было машины.Вот купила.Знала бы .купила подороже.Но без пластмассовых деталей.</text>
-            </review>
-        </reviews>
-    </product>
-</mvideo_xml>
-
diff --git a/example/region.xml b/example/region.xml
deleted file mode 100644
index 272716c..0000000
--- a/example/region.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<mvideo_xml date="2010-06-16 01:28">
-    <regions>
-        <region>
-            <region_id>10</region_id>
-            <region_name>Уфа</region_name>
-            <coordinates>
-                <longitude>55.652922</longitude>
-                <latitude>37.617493</latitude>
-            </coordinates>
-        </region>
-    </regions>
-</mvideo_xml>
\ No newline at end of file
diff --git a/example/regions.dtd b/example/regions.dtd
deleted file mode 100644
index 154f375..0000000
--- a/example/regions.dtd
+++ /dev/null
@@ -1,34 +0,0 @@
-<?xml encoding="UTF-8"?>
-
-<!ELEMENT mvideo_xml (regions)>
-<!ATTLIST mvideo_xml
-  xmlns CDATA #FIXED ''
-  date CDATA #REQUIRED>
-
-<!ELEMENT regions (region)>
-<!ATTLIST regions
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT region (region_id,region_name,coordinates)>
-<!ATTLIST region
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT region_id (#PCDATA)>
-<!ATTLIST region_id
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT region_name (#PCDATA)>
-<!ATTLIST region_name
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT coordinates (longitude,latitude)>
-<!ATTLIST coordinates
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT longitude (#PCDATA)>
-<!ATTLIST longitude
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT latitude (#PCDATA)>
-<!ATTLIST latitude
-  xmlns CDATA #FIXED ''>
diff --git a/example/regions.xml b/example/regions.xml
deleted file mode 100644
index 549f2f2..0000000
--- a/example/regions.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-
-<mvideo_xml date="2010-06-16 01:28">
-    <regions>
-        <region>
-            <region_id>10</region_id>
-            <region_name>Уфа</region_name>
-            <coordinates>
-                <longitude>55.652922</longitude>
-                <latitude>37.617493</latitude>
-            </coordinates>
-        </region>
-        <region>
-            <region_id>10</region_id>
-            <region_name>Уфа</region_name>
-            <coordinates>
-                <longitude>55.652922</longitude>
-                <latitude>37.617493</latitude>
-            </coordinates>
-        </region>
-    </regions>
-</mvideo_xml>
\ No newline at end of file
diff --git a/example/search_category.dtd b/example/search_category.dtd
deleted file mode 100644
index 6a8604e..0000000
--- a/example/search_category.dtd
+++ /dev/null
@@ -1,42 +0,0 @@
-<?xml encoding="UTF-8"?>
-
-<!ELEMENT mvideo_xml (search,parent_category,categories)>
-<!ATTLIST mvideo_xml
-  xmlns CDATA #FIXED ''
-  date CDATA #REQUIRED>
-
-<!ELEMENT search (#PCDATA)>
-<!ATTLIST search
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT parent_category (category_id,category_name)>
-<!ATTLIST parent_category
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT categories (category)+>
-<!ATTLIST categories
-  xmlns CDATA #FIXED ''
-  category_id CDATA #REQUIRED
-  category_name NMTOKEN #REQUIRED>
-
-<!ELEMENT category (category_id,amount,category_name,category_icon)>
-<!ATTLIST category
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT amount (#PCDATA)>
-<!ATTLIST amount
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_icon (#PCDATA)>
-<!ATTLIST category_icon
-  xmlns CDATA #FIXED ''
-  height CDATA #REQUIRED
-  width CDATA #REQUIRED>
-
-<!ELEMENT category_id (#PCDATA)>
-<!ATTLIST category_id
-  xmlns CDATA #FIXED ''>
-
-<!ELEMENT category_name (#PCDATA)>
-<!ATTLIST category_name
-  xmlns CDATA #FIXED ''>
diff --git a/example/search_category.xml b/example/search_category.xml
deleted file mode 100644
index f25b4dd..0000000
--- a/example/search_category.xml
+++ /dev/null
@@ -1,28 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<mvideo_xml date="2010-06-16 01:28">
-    <search>телевизор</search>
-    <parent_category>
-        <category_id>0</category_id>
-        <category_name>Список категорий</category_name>
-    </parent_category>
-    <categories category_id="1000" category_name="Телевизоры">
-        <category>
-            <category_id>2000</category_id>
-            <amount>123</amount>
-            <category_name>LED-телевизоры</category_name>
-            <category_icon width="50" height="50">http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-        <category>
-            <category_id>2000</category_id>
-            <amount>123</amount>
-            <category_name>LED-телевизоры</category_name>
-            <category_icon width="50" height="50">http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-        <category>
-            <category_id>2000</category_id>
-            <amount>123</amount>
-            <category_name>LED-телевизоры</category_name>
-            <category_icon width="50" height="50">http://www.mvideo.ru/imgs/catalog/dir_1.gif</category_icon>
-        </category>
-    </categories>
-</mvideo_xml>
diff --git a/example/shops.xml b/example/shops.xml
deleted file mode 100644
index 86ce4fa..0000000
--- a/example/shops.xml
+++ /dev/null
@@ -1,59 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<mvideo_xml date="2010-06-16 01:28">
-    <shops region_id="1">
-        <shop>
-            <shop_id>11</shop_id>
-            <shop_name>Чонгарский бульвар</shop_name>
-            <metro>Варшавская</metro>
-            <address>Чонгарский бульвар, дом 3, корпус 2</address>
-            <day_hours>0-24</day_hours>
-            <holiday_hours>0-24</holiday_hours>
-            <phone>777-777-5</phone>
-            <coordinates>
-                <longitude>55.652922</longitude>
-                <latitude>37.617493</latitude>
-            </coordinates>
-            <wayTo>пройдите направо</wayTo>
-            <zoom>15</zoom>
-            <images>
-                    <image width="500" height="375">http://www.mvideo.ru/imgs/shops/face/big_978.gif</image>
-             </images>
-        </shop>
-        <shop>
-            <shop_id>12</shop_id>
-            <shop_name>Чонгарский бульвар</shop_name>
-            <metro>Варшавская</metro>
-            <address>Чонгарский бульвар, дом 3, корпус 2</address>
-            <day_hours>0-24</day_hours>
-            <holiday_hours>0-24</holiday_hours>
-            <phone>777-777-5</phone>
-            <coordinates>
-                <longitude>55.652922</longitude>
-                <latitude>37.617493</latitude>
-            </coordinates>
-            <wayTo>пройдите направо</wayTo>
-            <zoom>15</zoom>
-            <images>
-                <image width="500" height="375">http://www.mvideo.ru/imgs/shops/face/big_978.gif</image>
-            </images>
-        </shop>
-        <shop>
-            <shop_id>13</shop_id>
-            <shop_name>Чонгарский бульвар</shop_name>
-            <metro>Варшавская</metro>
-            <address>Чонгарский бульвар, дом 3, корпус 2</address>
-            <day_hours>0-24</day_hours>
-            <holiday_hours>0-24</holiday_hours>
-            <phone>777-777-5</phone>
-            <coordinates>
-                <longitude>55.652922</longitude>
-                <latitude>37.617493</latitude>
-            </coordinates>
-            <wayTo>пройдите направо</wayTo>
-            <zoom>15</zoom>
-            <images>
-                <image width="500" height="375">http://www.mvideo.ru/imgs/shops/face/big_978.gif</image>
-            </images>
-        </shop>
-    </shops>
-</mvideo_xml>
diff --git a/example/show.py b/example/show.py
deleted file mode 100644
index 2476ba8..0000000
--- a/example/show.py
+++ /dev/null
@@ -1,282 +0,0 @@
-# -*- coding: utf-8 -*-
-#!/usr/bin/env python
-'''
-Created on 14.01.2011
-
-@author: enesterov
-'''
-import wx
-import wx.html
-import urllib
-import urllib2
-import xml.dom.minidom
-from wx.lib.art import flagart, img2pyartprov
-import  cStringIO
-import base64
-from PIL import Image
-import sys,os
-import urlparse
-
-
-proxies = {'http': 'http://isa-wan:8080/'}
-proxy_handler = urllib2.ProxyHandler({'http': 'http://10.95.1.79:3128/'})
-proxy_handler = urllib2.ProxyHandler(proxies)
-
-opener = urllib2.build_opener(proxy_handler)
-urllib2.install_opener(opener)
-
-class xmlParser():
-	toPage = ""
-	toPageBack = ""
-	def parseRegion(self, dat):
-		d = xml.dom.minidom.parseString(dat)
-		slides = d.getElementsByTagName("region")
-		self.toPage = ""
-		for slide in slides:
-			link = slide.getElementsByTagName("region_id")[0]
-			title = slide.getElementsByTagName("region_name")[0]
-			self.toPage += "<a href=%s>%s</a> <a href=\"%s&category_id=0\">Category</a>\n<br />"%(
-																self.getText(link.childNodes), 
-																self.getText(title.childNodes), 
-																self.getText(link.childNodes))
-		return self.toPage
-	
-	def parseShop(self, dat):
-		#d = xml.dom.minidom.parseString(dat)
-		slides = dat#d.getElementsByTagName("shop")
-		self.toPage = ""
-		for slide in slides:
-			link = slide.getElementsByTagName("shop_id")[0]
-			title = slide.getElementsByTagName("shop_name")[0]
-			self.toPage += "<a href=%s&category_id=0>%s</a>\n<br />"%(self.getText(link.childNodes), 
-																self.getText(title.childNodes))
-		return self.toPage
-
-	def getContent(self, dat):
-		d = xml.dom.minidom.parseString(dat)
-		elems = d.getElementsByTagName("parent_category")
-		categories = d.getElementsByTagName("categories")
-		slides = d.getElementsByTagName("category")
-		shops = d.getElementsByTagName("shop")
-		if not shops:
-			if categories:
-				categories = categories[0]
-			else:
-				categories = d.getElementsByTagName("products")[0]
-			
-		for elem in elems:
-			
-			parent = elem.getElementsByTagName("category_id")[0]
-			parent_name = elem.getElementsByTagName("category_name")[0]
-			
-			print self.getText(parent_name.childNodes)
-			self.toPageBack = " &larr;<a href=%s>  %s</a> \n" % (
-										self.getText(parent.childNodes),
-										self.getText(parent_name.childNodes))
-		if not shops:
-			self.toPageBack += "&nbsp&nbsp&nbsp;&rarr;<a href=%s>%s</a>&larr;<br /><br />\n" % (
-									categories.attributes["category_id"].value,
-									categories.attributes["category_name"].value)
-		
-		if len(shops) > 0:
-			return self.parseShop(shops)
-		else:
-			if len(slides) > 0:
-				return self.parseCategory(slides)
-			else:
-				return self.parseProduct(dat)
-		
-	def getImage(self, url, i):
-		tmp = "%s.jpg" % i
-		
-		try: 
-			data = opener.open(url)
-			f = open(tmp, "wb")
-			stream = cStringIO.StringIO(data.read())
-			f.write(stream.read())
-			data.close()
-			f.close()
-		except urllib2.HTTPError, e:
-			print "!!!!! - "+url#print e.reason
-			tmp = "none.jpg"
-		return tmp
-	
-	def parseProduct(self, dat):
-		d = xml.dom.minidom.parseString(dat)
-		slides = d.getElementsByTagName("product")
-		#slides = d.getElementsByTagName("product")
-		self.toPage = ""
-		self.toPage += self.toPageBack
-		i = 0
-		for slide in slides:
-			link = slide.getElementsByTagName("product_id")[0]
-			title = slide.getElementsByTagName("title")[0]
-			ico = slide.getElementsByTagName("image")[0]
-			print self.getText(ico.childNodes)
-			
-			tmp = self.getImage(self.getText(ico.childNodes), i)
-			self.toPage += "<a href=%s><img border=0 height=80 width=80 src=\"%s\">%s</a> \n<br />"%(
-																self.getText(link.childNodes),
-																tmp, 
-																self.getText(title.childNodes))
-			i+=1
-		return self.toPage
-	
-	
-	def parseCategory(self, slides):
-		self.toPage = ""
-		self.toPage += self.toPageBack
-		i = 0
-		for slide in slides:
-			link = slide.getElementsByTagName("category_id")[0]
-			title = slide.getElementsByTagName("category_name")[0]
-			ico = slide.getElementsByTagName("category_icon")[0]
-			amount = slide.getElementsByTagName("amount")[0]
-			print self.getText(ico.childNodes)
-			#f = opener.open(self.getText(ico.childNodes)).read()
-			#data = opener.open(self.getText(ico.childNodes)).read()
-			#stream = cStringIO.StringIO(data)
-			#bmp = wx.BitmapFromImage( wx.ImageFromStream( stream ))
-			tmp = self.getImage(self.getText(ico.childNodes), i)
-			self.toPage += "<a href=%s><img height=90 width=90 border=0 src=\"%s\">%s</a>(%s)\n<br />"%(
-																self.getText(link.childNodes),
-																tmp, 
-																self.getText(title.childNodes),
-																self.getText(amount.childNodes))
-			i+=1
-		return self.toPage
-	
-	def getText(self, nodelist):
-		rc = []
-		for node in nodelist:
-			if node.nodeType == node.TEXT_NODE:
-				rc.append(node.data)
-		return ''.join(rc)
-	
-	
-
-
-class HtmlWindow(wx.html.HtmlWindow):
-	params = {'region_id': 0}
-	#Url = "http://www.mvideo.ru/mobile/?%s"
-	Url = "http://www-test.corp.mvideo.ru/mobile/?%s"
-	xp = xmlParser()
-	
-		
-
-		
-	def OnLinkClicked(self, link):
-		links = '?region_id='+link.GetHref()
-		cat = urlparse.urlparse(links)[4].split("&")
-		print link.GetHref()
-		print cat
-		print "*" *10
-		for i in cat:
-			qwe, param = i.split("=")
-			self.params[qwe] = param
-		
-		#if self.params['region_id'] == 0:
-		#	self.params['region_id'] = links
-		#else:
-		#	self.params['category_id'] = links
-		#print self.params
-		#print links
-		self.getUrl()
-	
-	def getUrl(self):
-		toPage = self.xp.getContent(self.openUrl())
-		self.SetPage(toPage)
-		
-	def openUrl(self):
-		link = urllib.urlencode(self.params)
-		#opener = urllib.FancyURLopener(self.proxies)
-		#proxy_auth_handler = urllib2.ProxyBasicAuthHandler()
-		#proxy_auth_handler.add_password('realm', 'host', 'enesterov', '11223344')
-		
-		#f = urllib.urlopen(self.Url % link)
-		
-		f = opener.open(self.Url % link)
-		print self.Url % link
-		return f.read()
-
-class Form1(wx.Panel):
-	def __init__(self, parent):
-		#self.log = log
-		wx.Panel.__init__(self, parent, -1)
-
-		# Set up some basic element. Placement is a bit crude as this
-		# is really an event handling demo! It would also be a good idea
-		# to define constants for the IDs!
-
-		
-
-
-class MyFrame(wx.Frame):
-	""" We simply derive a new class of Frame. """
-	def __init__(self, parent, title):
-		self.parent = parent
-		self.frame = wx.Frame.__init__(self, parent, title=title, size=(320,480))
-		
-		#self.CreateStatusBar()
-		#self.st = self.SetStatusText
-		#self.st("This is the statusbar")
-		
-		self.control = HtmlWindow(self)
-		
-		
-		menu = wx.Menu()
-		menu.Append(wx.ID_ABOUT, "&About",
-					"More information about this program")
-		menu.AppendSeparator()
-		menu.Append(wx.ID_EXIT, "E&xit", "Terminate the program")
-		menuBar = wx.MenuBar()
-		menuBar.Append(menu, "&File");
-		self.SetMenuBar(menuBar)
-
-		wx.EVT_MENU(self, wx.ID_ABOUT, self.OnAbout)
-		wx.EVT_MENU(self, wx.ID_EXIT,  self.TimeToQuit)
-		
-		
-		
-		
-		#grid = wx.HTMLWindow(self)
-		self.toPage = ""
-		
-		self.Show(True)
-		self.xp = xmlParser()
-		#proxies = {'http': 'http://isa-wan:8080/'}
-		#self.opener = urllib.FancyURLopener(proxies)
-		self.getUrl()
-
-	def OnAbout(self, event):
-		#dlg = wx.MessageDialog(self, "This sample program shows off\n"
-		#					  "frames, menus, statusbars, and this\n"
-		#					  "message dialog.",
-		#					  "About Me", wx.OK | wx.ICON_INFORMATION)
-		#dlg.ShowModal()
-		#dlg.Destroy()
-		Form1(self.frame)
-
-
-	def TimeToQuit(self, event):
-		self.Close(True)
-
-	
-	def getUrl(self, data = ""):
-		
-		res = self.control.openUrl()
-		self.parseXml(res) #.decode( "utf-8" )
-	
-	def parseXml(self, dat):
-		toPage = self.xp.parseRegion(dat)
-		
-		
-		self.control.SetPage(toPage)
-		
-
-
-
-if __name__ == '__main__':
-	app = wx.App(False)  # Create a new app, don't redirect stdout/stderr to a window.
-	frame = MyFrame(None, "M.video mobile app")
-	app.MainLoop()
diff --git a/img/.placeholder b/img/.placeholder
deleted file mode 100644
index e69de29..0000000
diff --git a/lib/ActiveRecord.php b/lib/ActiveRecord.php
index 2de9dba..fb8226a 100644
--- a/lib/ActiveRecord.php
+++ b/lib/ActiveRecord.php
@@ -1,43 +1,51 @@
 <?php
-if (!defined('PHP_VERSION_ID') || PHP_VERSION_ID < 50300)
-	die('PHP ActiveRecord requires PHP 5.3 or higher');
-
-define('PHP_ACTIVERECORD_VERSION_ID','1.0');
-
-require_once 'ar/Singleton.php';
-require_once 'ar/Config.php';
-require_once 'ar/Utils.php';
-require_once 'ar/DateTime.php';
-require_once 'ar/Model.php';
-require_once 'ar/Table.php';
-require_once 'ar/ConnectionManager.php';
-require_once 'ar/Connection.php';
-require_once 'ar/SQLBuilder.php';
-require_once 'ar/Reflections.php';
-require_once 'ar/Inflector.php';
-require_once 'ar/CallBack.php';
-require_once 'ar/Exceptions.php';
-
-spl_autoload_register('activerecord_autoload');
-
-function activerecord_autoload($class_name)
-{
-	$path = ActiveRecord\Config::instance()->get_model_directory();
-	$root = realpath(isset($path) ? $path : '.');
-
-	if (($namespaces = ActiveRecord\get_namespaces($class_name)))
+	if (!defined('PHP_VERSION_ID') || PHP_VERSION_ID < 50300)
+		die('PHP ActiveRecord requires PHP 5.3 or higher');
+	
+	define('PHP_ACTIVERECORD_VERSION_ID','1.0');
+	
+	require_once 'ActiveRecord/Singleton.php';
+	require_once 'ActiveRecord/Config.php';
+	require_once 'ActiveRecord/Utils.php';
+	require_once 'ActiveRecord/DateTime.php';
+	require_once 'ActiveRecord/Model.php';
+	require_once 'ActiveRecord/Table.php';
+	require_once 'ActiveRecord/ConnectionManager.php';
+	require_once 'ActiveRecord/Connection.php';
+	require_once 'ActiveRecord/SQLBuilder.php';
+	require_once 'ActiveRecord/Reflections.php';
+	require_once 'ActiveRecord/Inflector.php';
+	require_once 'ActiveRecord/CallBack.php';
+	require_once 'ActiveRecord/Exceptions.php';
+	
+	spl_autoload_register('activerecord_autoload');
+	
+	function activerecord_autoload($class_name)
 	{
-		$class_name = array_pop($namespaces);
-		$directories = array();
-
-		foreach ($namespaces as $directory)
-			$directories[] = $directory;
-
-		$root .= DIRECTORY_SEPARATOR . implode($directories, DIRECTORY_SEPARATOR);
+		$path = ActiveRecord\Config::instance()->get_model_directory();
+		$root = realpath(isset($path) ? $path : '.');
+		#var_dump($root);
+		$namespaces = get_namespaces($class_name);
+		if ($namespaces)
+		{
+			$class_name = array_pop($namespaces);
+			$directories = array();
+	
+			foreach ($namespaces as $directory)
+				$directories[] = $directory;
+	
+			#$root .= DIRECTORY_SEPARATOR . implode($directories, DIRECTORY_SEPARATOR);
+		}
+	
+		$file = "$root/$class_name.php";
+		#var_dump($file);
+		if (file_exists($file))
+			require_once $file;
 	}
-
-	$file = "$root/$class_name.php";
-
-	if (file_exists($file))
-		require_once $file;
-}
+	
+/**
+ * клас заглушка
+ * @author enesterov
+ *
+ */
+class ActiveRecord{}
diff --git a/lib/ActiveRecord/CallBack.php b/lib/ActiveRecord/CallBack.php
new file mode 100644
index 0000000..034c507
--- /dev/null
+++ b/lib/ActiveRecord/CallBack.php
@@ -0,0 +1,226 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+use Closure;
+
+/**
+ * Callbacks allow the programmer to hook into the life cycle of a {@link Model}.
+ * 
+ * You can control the state of your object by declaring certain methods to be
+ * called before or after methods are invoked on your object inside of ActiveRecord.
+ * 
+ * Valid callbacks are:
+ * <ul>
+ * <li><b>after_construct:</b> called after a model has been constructed</li>
+ * <li><b>before_save:</b> called before a model is saved</li>
+ * <li><b>after_save:</b> called after a model is saved</li>
+ * <li><b>before_create:</b> called before a NEW model is to be inserted into the database</li>
+ * <li><b>after_create:</b> called after a NEW model has been inserted into the database</li>
+ * <li><b>before_update:</b> called before an existing model has been saved</li>
+ * <li><b>after_update:</b> called after an existing model has been saved</li>
+ * <li><b>before_validation:</b> called before running validators</li>
+ * <li><b>after_validation:</b> called after running validators</li>
+ * <li><b>before_validation_on_create:</b> called before validation on a NEW model being inserted</li>
+ * <li><b>after_validation_on_create:</b> called after validation on a NEW model being inserted</li>
+ * <li><b>before_validation_on_update:</b> see above except for an existing model being saved</li>
+ * <li><b>after_validation_on_update:</b> ...</li>
+ * <li><b>before_destroy:</b> called after a model has been deleted</li>
+ * <li><b>after_destroy:</b> called after a model has been deleted</li>
+ * </ul>
+ * 
+ * This class isn't meant to be used directly. Callbacks are defined on your model like the example below:
+ * 
+ * <code>
+ * class Person extends ActiveRecord\Model {
+ *   static $before_save = array('make_name_uppercase');
+ *   static $after_save = array('do_happy_dance');
+ *   
+ *   public function make_name_uppercase() {
+ *     $this->name = strtoupper($this->name);
+ *   }
+ * 
+ *   public function do_happy_dance() {
+ *     happy_dance();
+ *   }
+ * }
+ * </code>
+ *
+ * Available options for callbacks:
+ *
+ * <ul>
+ * <li><b>prepend:</b> puts the callback at the top of the callback chain instead of the bottom</li>
+ * </ul>
+ *
+ * @package ActiveRecord
+ * @link http://www.phpactiverecord.org/guides/callbacks
+ */
+class CallBack
+{
+	/**
+	 * List of available callbacks.
+	 *
+	 * @var array
+	 */
+	static protected $VALID_CALLBACKS = array(
+		'after_construct',
+		'before_save',
+		'after_save',
+		'before_create',
+		'after_create',
+		'before_update',
+		'after_update',
+		'before_validation',
+		'after_validation',
+		'before_validation_on_create',
+		'after_validation_on_create',
+		'before_validation_on_update',
+		'after_validation_on_update',
+		'before_destroy',
+		'after_destroy'
+	);
+
+	/**
+	 * Container for reflection class of given model
+	 * 
+	 * @var object
+	 */
+	private $klass;
+
+	/**
+	 * Holds data for registered callbacks.
+	 *
+	 * @var array
+	 */
+	private $registry = array();
+
+	/**
+	 * Creates a CallBack.
+	 *
+	 * @param string $model_class_name The name of a {@link Model} class
+	 * @return CallBack
+	 */
+	public function __construct($model_class_name)
+	{
+		$this->klass = Reflections::instance()->get($model_class_name);
+
+		foreach (static::$VALID_CALLBACKS as $name)
+		{
+			// look for explicitly defined static callback
+			if (($definition = $this->klass->getStaticPropertyValue($name,null)))
+			{
+				if (!is_array($definition))
+					$definition = array($definition);
+
+				foreach ($definition as $method_name)
+					$this->register($name,$method_name);
+			}
+
+			// implicit callbacks that don't need to have a static definition
+			// simply define a method named the same as something in $VALID_CALLBACKS
+			// and the callback is auto-registered
+			elseif ($this->klass->hasMethod($name))
+				$this->register($name,$name);
+		}
+	}
+
+	/**
+	 * Returns all the callbacks registered for a callback type.
+	 *
+	 * @param $name string Name of a callback (see {@link VALID_CALLBACKS $VALID_CALLBACKS})
+	 * @return array array of callbacks or null if invalid callback name.
+	 */
+	public function get_callbacks($name)
+	{
+		return isset($this->registry[$name]) ? $this->registry[$name] : null;
+	}
+
+	/**
+	 * Invokes a callback.
+	 *
+	 * @internal This is the only piece of the CallBack class that carries its own logic for the
+	 * model object. For (after|before)_(create|update) callbacks, it will merge with
+	 * a generic 'save' callback which is called first for the lease amount of precision.
+	 *
+	 * @param string $model Model to invoke the callback on.
+	 * @param string $name Name of the callback to invoke
+	 * @param boolean $must_exist Set to true to raise an exception if the callback does not exist.
+	 * @return mixed null if $name was not a valid callback type or false if a method was invoked
+	 * that was for a before_* callback and that method returned false. If this happens, execution
+	 * of any other callbacks after the offending callback will not occur.
+	 */
+	public function invoke($model, $name, $must_exist=true)
+	{
+		if ($must_exist && !array_key_exists($name, $this->registry))
+			throw new ActiveRecordException("No callbacks were defined for: $name on " . get_class($model));
+
+		// if it doesn't exist it might be a /(after|before)_(create|update)/ so we still need to run the save
+		// callback
+		if (!array_key_exists($name, $this->registry))
+			$registry = array();
+		else
+			$registry = $this->registry[$name];
+
+		$first = substr($name,0,6);
+
+		// starts with /(after|before)_(create|update)/
+		if (($first == 'after_' || $first == 'before') && (($second = substr($name,7,5)) == 'creat' || $second == 'updat' || $second == 'reate' || $second == 'pdate'))
+		{
+			$temporal_save = str_replace(array('create', 'update'), 'save', $name);
+
+			if (!isset($this->registry[$temporal_save]))
+				$this->registry[$temporal_save] = array();
+
+			$registry = array_merge($this->registry[$temporal_save], $registry ? $registry : array());
+		}
+
+		if ($registry)
+		{
+			foreach ($registry as $method)
+			{
+				$ret = ($method instanceof Closure ? $method($model) : $model->$method());
+
+				if (false === $ret && $first === 'before')
+					return false;
+			}
+		}
+		return true;
+	}
+
+	/**
+	 * Register a new callback.
+	 *
+	 * @param string $name Name of callback type (see {@link VALID_CALLBACKS $VALID_CALLBACKS})
+	 * @param mixed $closure_or_method_name Either a closure or the name of a method on the {@link Model}
+	 * @param array $options Options array
+	 * @return void
+	 * @throws ActiveRecordException if invalid callback type or callback method was not found
+	 */
+	public function register($name, $closure_or_method_name=null, $options=array())
+	{
+		$options = array_merge(array('prepend' => false), $options);
+
+		if (!$closure_or_method_name)
+			$closure_or_method_name = $name;
+
+		if (!in_array($name,self::$VALID_CALLBACKS))
+			throw new ActiveRecordException("Invalid callback: $name");
+
+		if (!($closure_or_method_name instanceof Closure) && !$this->klass->hasMethod($closure_or_method_name))
+		{
+			// i'm a dirty ruby programmer
+			throw new ActiveRecordException("Unknown method for callback: $name" .
+				(is_string($closure_or_method_name) ? ": #$closure_or_method_name" : ""));
+		}
+
+		if (!isset($this->registry[$name]))
+			$this->registry[$name] = array();
+
+		if ($options['prepend'])
+			array_unshift($this->registry[$name], $closure_or_method_name);
+		else
+			$this->registry[$name][] = $closure_or_method_name;
+	}
+}
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Column.php b/lib/ActiveRecord/Column.php
new file mode 100644
index 0000000..d73bd1b
--- /dev/null
+++ b/lib/ActiveRecord/Column.php
@@ -0,0 +1,155 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Class for a table column.
+ *
+ * @package ActiveRecord
+ */
+class Column
+{
+	// types for $type
+	const STRING	= 1;
+	const INTEGER	= 2;
+	const DECIMAL	= 3;
+	const DATETIME	= 4;
+	const DATE		= 5;
+	const TIME		= 6;
+
+	/**
+	 * Map a type to an column type.
+	 * @static
+	 * @var array
+	 */
+	static $TYPE_MAPPING = array(
+		'datetime'	=> self::DATETIME,
+		'timestamp'	=> self::DATETIME,
+		'date'		=> self::DATE,
+		'time'		=> self::TIME,
+
+		'int'		=> self::INTEGER,
+		'tinyint'	=> self::INTEGER,
+		'smallint'	=> self::INTEGER,
+		'mediumint'	=> self::INTEGER,
+		'bigint'	=> self::INTEGER,
+
+		'float'		=> self::DECIMAL,
+		'double'	=> self::DECIMAL,
+		'numeric'	=> self::DECIMAL,
+		'decimal'	=> self::DECIMAL,
+		'dec'		=> self::DECIMAL);
+
+	/**
+	 * The true name of this column.
+	 * @var string
+	 */
+	public $name;
+
+	/**
+	 * The inflected name of this columns .. hyphens/spaces will be => _.
+	 * @var string
+	 */
+	public $inflected_name;
+
+	/**
+	 * The type of this column: STRING, INTEGER, ...
+	 * @var integer
+	 */
+	public $type;
+
+	/**
+	 * The raw database specific type.
+	 * @var string
+	 */
+	public $raw_type;
+
+	/**
+	 * The maximum length of this column.
+	 * @var int
+	 */
+	public $length;
+
+	/**
+	 * True if this column allows null.
+	 * @var boolean
+	 */
+	public $nullable;
+
+	/**
+	 * True if this column is a primary key.
+	 * @var boolean
+	 */
+	public $pk;
+
+	/**
+	 * The default value of the column.
+	 * @var mixed
+	 */
+	public $default;
+
+	/**
+	 * True if this column is set to auto_increment.
+	 * @var boolean
+	 */
+	public $auto_increment;
+
+	/**
+	 * Name of the sequence to use for this column if any.
+	 * @var boolean
+	 */
+	public $sequence;
+
+	/**
+	 * Casts a value to the column's type.
+	 *
+	 * @param mixed $value The value to cast
+	 * @param Connection $connection The Connection this column belongs to
+	 * @return mixed type-casted value
+	 */
+	public function cast($value, $connection)
+	{
+		if ($value === null)
+			return null;
+
+		switch ($this->type)
+		{
+			case self::STRING:	return (string)$value;
+			case self::INTEGER:	return (int)$value;
+			case self::DECIMAL:	return (double)$value;
+			case self::DATETIME:
+			case self::DATE:
+				if (!$value)
+					return null;
+
+				if ($value instanceof DateTime)
+					return $value;
+
+				if ($value instanceof \DateTime)
+					return new DateTime($value->format('Y-m-d H:i:s T'));
+
+				return $connection->string_to_datetime($value);
+		}
+		return $value;
+	}
+
+	/**
+	 * Sets the $type member variable.
+	 * @return mixed
+	 */
+	public function map_raw_type()
+	{
+		if ($this->raw_type == 'integer')
+			$this->raw_type = 'int';
+
+		if (array_key_exists($this->raw_type,self::$TYPE_MAPPING))
+			$this->type = self::$TYPE_MAPPING[$this->raw_type];
+		else
+			$this->type = self::STRING;
+
+		return $this->type;
+	}
+}
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Config.php b/lib/ActiveRecord/Config.php
new file mode 100644
index 0000000..dd0b044
--- /dev/null
+++ b/lib/ActiveRecord/Config.php
@@ -0,0 +1,288 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+use Closure;
+
+/**
+ * Manages configuration options for ActiveRecord.
+ *
+ * <code>
+ * ActiveRecord::initialize(function($cfg) {
+ *   $cfg->set_model_home('models');
+ *   $cfg->set_connections(array(
+ *     'development' => 'mysql://user:pass@development.com/awesome_development',
+ *     'production' => 'mysql://user:pass@production.com/awesome_production'));
+ * });
+ * </code>
+ *
+ * @package ActiveRecord
+ */
+class Config extends Singleton
+{
+	/**
+	 * Name of the connection to use by default.
+	 *
+	 * <code>
+	 * ActiveRecord\Config::initialize(function($cfg) {
+	 *   $cfg->set_model_directory('/your/app/models');
+	 *   $cfg->set_connections(array(
+	 *     'development' => 'mysql://user:pass@development.com/awesome_development',
+	 *     'production' => 'mysql://user:pass@production.com/awesome_production'));
+	 * });
+	 * </code>
+	 *
+	 * This is a singleton class so you can retrieve the {@link Singleton} instance by doing:
+	 *
+	 * <code>
+	 * $config = ActiveRecord\Config::instance();
+	 * </code>
+	 *
+	 * @var string
+	 */
+	private $default_connection = 'development';
+
+	/**
+	 * Contains the list of database connection strings.
+	 *
+	 * @var array
+	 */
+	private $connections = array();
+
+	/**
+	 * Directory for the auto_loading of model classes.
+	 *
+	 * @see activerecord_autoload
+	 * @var string
+	 */
+	private $model_directory;
+
+	/**
+	 * Switch for logging.
+	 *
+	 * @var bool
+	 */
+	private $logging = false;
+
+	/**
+	 * Contains a Logger object that must impelement a log() method.
+	 *
+	 * @var object
+	 */
+	private $logger;
+
+	/**
+	 * The format to serialize DateTime values into.
+	 *
+	 * @var string
+	 */
+	private $date_format = \DateTime::ISO8601;
+
+	/**
+	 * Allows config initialization using a closure.
+	 *
+	 * This method is just syntatic sugar.
+	 *
+	 * <code>
+	 * ActiveRecord\Config::initialize(function($cfg) {
+     *   $cfg->set_model_directory('/path/to/your/model_directory');
+     *   $cfg->set_connections(array(
+     *     'development' => 'mysql://username:password@127.0.0.1/database_name'));
+	 * });
+	 * </code>
+	 *
+	 * You can also initialize by grabbing the singleton object:
+	 *
+	 * <code>
+	 * $cfg = ActiveRecord\Config::instance();
+	 * $cfg->set_model_directory('/path/to/your/model_directory');
+	 * $cfg->set_connections(array('development' =>
+  	 *   'mysql://username:password@localhost/database_name'));
+	 * </code>
+	 *
+	 * @param Closure $initializer A closure
+	 * @return void
+	 */
+	public static function initialize(Closure $initializer)
+	{
+		$initializer(parent::instance());
+	}
+
+	/**
+	 * Sets the list of database connection strings.
+	 *
+	 * <code>
+	 * $config->set_connections(array(
+     *     'development' => 'mysql://username:password@127.0.0.1/database_name'));
+     * </code>
+	 *
+	 * @param array $connections Array of connections
+	 * @param string $default_connection Optionally specify the default_connection
+	 * @return void
+	 * @throws ActiveRecord\ConfigException
+	 */
+	public function set_connections($connections, $default_connection=null)
+	{
+		if (!is_array($connections))
+			throw new ConfigException("Connections must be an array");
+
+		if ($default_connection)
+			$this->set_default_connection($default_connection);
+
+		$this->connections = $connections;
+	}
+
+	/**
+	 * Returns the connection strings array.
+	 *
+	 * @return array
+	 */
+	public function get_connections()
+	{
+		return $this->connections;
+	}
+
+	/**
+	 * Returns a connection string if found otherwise null.
+	 *
+	 * @param string $name Name of connection to retrieve
+	 * @return string connection info for specified connection name
+	 */
+	public function get_connection($name)
+	{
+		if (array_key_exists($name, $this->connections))
+			return $this->connections[$name];
+
+		return null;
+	}
+
+	/**
+	 * Returns the default connection string or null if there is none.
+	 *
+	 * @return string
+	 */
+	public function get_default_connection_string()
+	{
+		return array_key_exists($this->default_connection,$this->connections) ?
+			$this->connections[$this->default_connection] : null;
+	}
+
+	/**
+	 * Returns the name of the default connection.
+	 *
+	 * @return string
+	 */
+	public function get_default_connection()
+	{
+		return $this->default_connection;
+	}
+
+	/**
+	 * Set the name of the default connection.
+	 *
+	 * @param string $name Name of a connection in the connections array
+	 * @return void
+	 */
+	public function set_default_connection($name)
+	{
+		$this->default_connection = $name;
+	}
+
+	/**
+	 * Sets the directory where models are located.
+	 *
+	 * @param string $dir Directory path containing your models
+	 * @return void
+	 * @throws ConfigException if specified directory was not found
+	 */
+	public function set_model_directory($dir)
+	{
+		if (!file_exists($dir))
+			throw new ConfigException("Invalid or non-existent directory: $dir");
+
+		$this->model_directory = $dir;
+	}
+
+	/**
+	 * Returns the model directory.
+	 *
+	 * @return string
+	 */
+	public function get_model_directory()
+	{
+		return $this->model_directory;
+	}
+
+	/**
+	 * Turn on/off logging
+	 *
+	 * @param boolean $bool
+	 * @return void
+	 */
+	public function set_logging($bool)
+	{
+		$this->logging = (bool)$bool;
+	}
+
+	/**
+	 * Sets the logger object for future SQL logging
+	 *
+	 * @param object $logger
+	 * @return void
+	 * @throws ConfigException if Logger objecct does not implement public log()
+	 */
+	public function set_logger($logger)
+	{
+		$klass = Reflections::instance()->add($logger)->get($logger);
+
+		if (!$klass->getMethod('log') || !$klass->getMethod('log')->isPublic())
+			throw new ConfigException("Logger object must implement a public log method");
+
+		$this->logger = $logger;
+	}
+
+	/**
+	 * Return whether or not logging is on
+	 *
+	 * @return boolean
+	 */
+	public function get_logging()
+	{
+		return $this->logging;
+	}
+
+	/**
+	 * Returns the logger
+	 *
+	 * @return object
+	 */
+	public function get_logger()
+	{
+		return $this->logger;
+	}
+
+	/**
+	 * Returns the date format.
+	 *
+	 * @return string
+	 */
+	public function get_date_format()
+	{
+		return $this->date_format;
+	}
+
+	/**
+	 * Sets the date format.
+	 *
+	 * Accepts date formats accepted by PHP's date() function.
+	 *
+	 * @link http://us.php.net/manual/en/function.date.php
+	 * @param string $format
+	 */
+	public function set_date_format($format)
+	{
+		$this->date_format = $format;
+	}
+};
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Connection.php b/lib/ActiveRecord/Connection.php
new file mode 100644
index 0000000..094a09d
--- /dev/null
+++ b/lib/ActiveRecord/Connection.php
@@ -0,0 +1,456 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+require 'Column.php';
+
+use PDO;
+use PDOException;
+use Closure;
+
+/**
+ * The base class for database connection adapters.
+ *
+ * @package ActiveRecord
+ */
+abstract class Connection
+{
+	/**
+	 * The PDO connection object.
+	 * @var mixed
+	 */
+	public $connection;
+
+	/**
+	 * The last query run.
+	 * @var string
+	 */
+	public $last_query;
+
+	/**
+	 * Switch for logging.
+	 *
+	 * @var bool
+	 */
+	 private $logging = false;
+
+	/**
+	 * Contains a Logger object that must impelement a log() method.
+	 *
+	 * @var object
+	 */
+	private $logger;
+
+	/**
+	 * Default PDO options to set for each connection.
+	 * @var array
+	 */
+	static $PDO_OPTIONS = array(
+		PDO::ATTR_CASE				=> PDO::CASE_LOWER,
+		PDO::ATTR_ERRMODE			=> PDO::ERRMODE_EXCEPTION,
+		PDO::ATTR_ORACLE_NULLS		=> PDO::NULL_NATURAL,
+		PDO::ATTR_STRINGIFY_FETCHES	=> false);
+
+	/**
+	 * The quote character for stuff like column and field names.
+	 * @var string
+	 */
+	static $QUOTE_CHARACTER = '`';
+
+	/**
+	 * Default port.
+	 * @var int
+	 */
+	static $DEFAULT_PORT = 0;
+
+	/**
+	 * Retrieve a database connection.
+	 *
+	 * @param string $connection_string_or_connection_name A database connection string (ex. mysql://user:pass@host[:port]/dbname)
+	 *   Everything after the protocol:// part is specific to the connection adapter.
+	 *   OR
+	 *   A connection name that is set in ActiveRecord\Config
+	 *   If null it will use the default connection specified by ActiveRecord\Config->set_default_connection
+	 * @return Connection
+	 * @see parse_connection_url
+	 */
+	public static function instance($connection_string_or_connection_name=null)
+	{
+		$config = Config::instance();
+
+		if (strpos($connection_string_or_connection_name,'://') === false)
+		{
+			$connection_string = $connection_string_or_connection_name ?
+				$config->get_connection($connection_string_or_connection_name) :
+				$config->get_default_connection_string();
+		}
+		else
+			$connection_string = $connection_string_or_connection_name;
+
+		if (!$connection_string)
+			throw new DatabaseException("Empty connection string");
+
+		$info = static::parse_connection_url($connection_string);
+		$fqclass = static::load_adapter_class($info->protocol);
+
+		try {
+			$connection = new $fqclass($info);
+			$connection->protocol = $info->protocol;
+			$connection->logging = $config->get_logging();
+			$connection->logger = $connection->logging ? $config->get_logger() : null;
+		} catch (PDOException $e) {
+			throw new DatabaseException($e);
+		}
+		return $connection;
+	}
+
+	/**
+	 * Loads the specified class for an adapter.
+	 *
+	 * @param string $adapter Name of the adapter.
+	 * @return string The full name of the class including namespace.
+	 */
+	private static function load_adapter_class($adapter)
+	{
+		$class = ucwords($adapter) . 'Adapter';
+		$fqclass = 'ActiveRecord\\' . $class;
+		$source = dirname(__FILE__) . "/adapters/$class.php";
+
+		if (!file_exists($source))
+			throw new DatabaseException("$fqclass not found!");
+
+		require_once($source);
+		return $fqclass;
+	}
+
+	/**
+	 * Use this for any adapters that can take connection info in the form below
+	 * to set the adapters connection info.
+	 *
+	 * <code>
+	 * protocol://username:password@host[:port]/dbname
+	 * protocol://urlencoded%20username:urlencoded%20password@host[:port]/dbname?decode=true
+	 * protocol://username:password@unix(/some/file/path)/dbname
+	 * </code>
+	 *
+	 * @param string $connection_url A connection URL
+	 * @return object the parsed URL as an object.
+	 */
+	public static function parse_connection_url($connection_url)
+	{
+		$url = @parse_url($connection_url);
+
+		if (!isset($url['host']))
+			throw new DatabaseException('Database host must be specified in the connection string.');
+
+		$info = new \stdClass();
+		$info->protocol = $url['scheme'];
+		$info->host		= $url['host'];
+		$info->db		= isset($url['path']) ? substr($url['path'],1) : null;
+		$info->user		= isset($url['user']) ? $url['user'] : null;
+		$info->pass		= isset($url['pass']) ? $url['pass'] : null;
+
+		if ($info->host == 'unix(')
+		{
+			$socket_database = $info->host . '/' . $info->db;
+
+			if (preg_match_all('/^unix\((.+)\)\/(.+)$/', $socket_database, $matches) > 0)
+			{
+				$info->host = $matches[1][0];
+				$info->db = $matches[2][0];
+			}
+		}
+
+		if (isset($url['port']))
+			$info->port = $url['port'];
+
+		if (strpos($connection_url,'decode=true') !== false)
+		{
+			if ($info->user)
+				$info->user = urldecode($info->user);
+
+			if ($info->pass)
+				$info->pass = urldecode($info->pass);
+		}
+
+		return $info;
+	}
+
+	/**
+	 * Class Connection is a singleton. Access it via instance().
+	 *
+	 * @param array $info Array containing URL parts
+	 * @return Connection
+	 */
+	protected function __construct($info)
+	{
+		try
+		{
+			// unix sockets start with a /
+			if ($info->host[0] != '/')
+			{
+				$host = "host=$info->host";
+
+				if (isset($info->port))
+					$host .= ";port=$info->port";
+			}
+			else
+				$host = "unix_socket=$info->host";
+
+			$this->connection = new PDO("$info->protocol:$host;dbname=$info->db",$info->user,$info->pass,static::$PDO_OPTIONS);
+		} catch (PDOException $e) {
+			throw new DatabaseException($e);
+		}
+	}
+
+	/**
+	 * Retrieves column meta data for the specified table.
+	 *
+	 * @param string $table Name of a table
+	 * @return array An array of {@link Column} objects.
+	 */
+	public function columns($table)
+	{
+		$columns = array();
+		$sth = $this->query_column_info($table);
+
+		while (($row = $sth->fetch()))
+		{
+			$c = $this->create_column($row);
+			$columns[$c->name] = $c;
+		}
+		return $columns;
+	}
+
+	/**
+	 * Escapes quotes in a string.
+	 *
+	 * @param string $string The string to be quoted.
+	 * @return string The string with any quotes in it properly escaped.
+	 */
+	public function escape($string)
+	{
+		return $this->connection->quote($string);
+	}
+
+	/**
+	 * Retrieve the insert id of the last model saved.
+	 *
+	 * @param string $sequence Optional name of a sequence to use
+	 * @return int
+	 */
+	public function insert_id($sequence=null)
+	{
+		return $this->connection->lastInsertId($sequence);
+	}
+
+	/**
+	 * Execute a raw SQL query on the database.
+	 *
+	 * @param string $sql Raw SQL string to execute.
+	 * @param array &$values Optional array of bind values
+	 * @return mixed A result set object
+	 */
+	public function query($sql, &$values=array())
+	{
+		if ($this->logging)
+			$this->logger->log($sql);
+
+		$this->last_query = $sql;
+
+		try {
+			if (!($sth = $this->connection->prepare($sql)))
+				throw new DatabaseException($this);
+		} catch (PDOException $e) {
+			throw new DatabaseException($this);
+		}
+
+		$sth->setFetchMode(PDO::FETCH_ASSOC);
+
+		try {
+			if (!$sth->execute($values))
+				throw new DatabaseException($this);
+		} catch (PDOException $e) {
+			throw new DatabaseException($sth);
+		}
+		return $sth;
+	}
+
+	/**
+	 * Execute a query that returns maximum of one row with one field and return it.
+	 *
+	 * @param string $sql Raw SQL string to execute.
+	 * @param array &$values Optional array of values to bind to the query.
+	 * @return string
+	 */
+	public function query_and_fetch_one($sql, &$values=array())
+	{
+		$sth = $this->query($sql,$values);
+		$row = $sth->fetch(PDO::FETCH_NUM);
+		return $row[0];
+	}
+
+	/**
+	 * Execute a raw SQL query and fetch the results.
+	 *
+	 * @param string $sql Raw SQL string to execute.
+	 * @param Closure $handler Closure that will be passed the fetched results.
+	 */
+	public function query_and_fetch($sql, Closure $handler)
+	{
+		$sth = $this->query($sql);
+
+		while (($row = $sth->fetch(PDO::FETCH_ASSOC)))
+			$handler($row);
+	}
+
+	/**
+	 * Returns all tables for the current database.
+	 *
+	 * @return array Array containing table names.
+	 */
+	public function tables()
+	{
+		$tables = array();
+		$sth = $this->query_for_tables();
+
+		while (($row = $sth->fetch(PDO::FETCH_NUM)))
+			$tables[] = $row[0];
+
+		return $tables;
+	}
+
+	/**
+	 * Starts a transaction.
+	 */
+	public function transaction()
+	{
+		if (!$this->connection->beginTransaction())
+			throw new DatabaseException($this);
+	}
+
+	/**
+	 * Commits the current transaction.
+	 */
+	public function commit()
+	{
+		if (!$this->connection->commit())
+			throw new DatabaseException($this);
+	}
+
+	/**
+	 * Rollback a transaction.
+	 */
+	public function rollback()
+	{
+		if (!$this->connection->rollback())
+			throw new DatabaseException($this);
+	}
+
+	/**
+	 * Tells you if this adapter supports sequences or not.
+	 *
+	 * @return boolean
+	 */
+	function supports_sequences() { return false; }
+
+	/**
+	 * Return a default sequence name for the specified table.
+	 *
+	 * @param string $table Name of a table
+	 * @param string $column_name Name of column sequence is for
+	 * @return string sequence name or null if not supported.
+	 */
+	public function get_sequence_name($table, $column_name)
+	{
+		return "{$table}_seq";
+	}
+
+	/**
+	 * Return SQL for getting the next value in a sequence.
+	 *
+	 * @param string $sequence_name Name of the sequence
+	 * @return string
+	 */
+	public function next_sequence_value($sequence_name) { return null; }
+
+	/**
+	 * Quote a name like table names and field names.
+	 *
+	 * @param string $string String to quote.
+	 * @return string
+	 */
+	public function quote_name($string)
+	{
+		return $string[0] === static::$QUOTE_CHARACTER || $string[strlen($string)-1] === static::$QUOTE_CHARACTER ?
+			$string : static::$QUOTE_CHARACTER . $string . static::$QUOTE_CHARACTER;
+	}
+
+	/**
+	 * Return a date time formatted into the database's date format.
+	 *
+	 * @param DateTime $datetime The DateTime object
+	 * @return string
+	 */
+	public function date_to_string($datetime)
+	{
+		return $datetime->format('Y-m-d');
+	}
+
+	/**
+	 * Return a date time formatted into the database's datetime format.
+	 *
+	 * @param DateTime $datetime The DateTime object
+	 * @return string
+	 */
+	public function datetime_to_string($datetime)
+	{
+		return $datetime->format('Y-m-d H:i:s T');
+	}
+
+	/**
+	 * Converts a string representation of a datetime into a DateTime object.
+	 *
+	 * @param string $string A datetime in the form accepted by date_create()
+	 * @return DateTime
+	 */
+	public function string_to_datetime($string)
+	{
+		$date = date_create($string);
+		$errors = \DateTime::getLastErrors();
+
+		if ($errors['warning_count'] > 0 || $errors['error_count'] > 0)
+			return null;
+
+		return new DateTime($date->format('Y-m-d H:i:s T'));
+	}
+
+	/**
+	 * Adds a limit clause to the SQL query.
+	 *
+	 * @param string $sql The SQL statement.
+	 * @param int $offset Row offset to start at.
+	 * @param int $limit Maximum number of rows to return.
+	 * @return string The SQL query that will limit results to specified parameters
+	 */
+	abstract function limit($sql, $offset, $limit);
+
+	/**
+	 * Query for column meta info and return statement handle.
+	 *
+	 * @param string $table Name of a table
+	 * @return PDOStatement
+	 */
+	abstract public function query_column_info($table);
+
+	/**
+	 * Query for all tables in the current database. The result must only
+	 * contain one column which has the name of the table.
+	 *
+	 * @return PDOStatement
+	 */
+	abstract function query_for_tables();
+};
+?>
diff --git a/lib/ActiveRecord/ConnectionManager.php b/lib/ActiveRecord/ConnectionManager.php
new file mode 100644
index 0000000..a421a4b
--- /dev/null
+++ b/lib/ActiveRecord/ConnectionManager.php
@@ -0,0 +1,38 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Singleton to manage any and all database connections.
+ *
+ * @package ActiveRecord
+ */
+class ConnectionManager extends Singleton
+{
+	/**
+	 * Array of {@link Connection} objects.
+	 * @var array
+	 */
+	static private $connections = array();
+
+	/**
+	 * If $name is null then the default connection will be returned.
+	 *
+	 * @see Config
+	 * @param string $name Optional name of a connection
+	 * @return Connection
+	 */
+	public static function get_connection($name=null)
+	{
+		if (!isset(self::$connections[$name]) || !self::$connections[$name]->connection)
+		{
+			$config = Config::instance();
+			$connection_string = $name ? $config->get_connection($name) : $config->get_default_connection();
+			self::$connections[$name] = Connection::instance($connection_string);
+		}
+		return self::$connections[$name];
+	}
+};
+?>
diff --git a/lib/ActiveRecord/DateTime.php b/lib/ActiveRecord/DateTime.php
new file mode 100644
index 0000000..3dbefb1
--- /dev/null
+++ b/lib/ActiveRecord/DateTime.php
@@ -0,0 +1,45 @@
+<?php
+namespace ActiveRecord;
+
+class DateTime extends \DateTime
+{
+	private $model;
+	private $attribute_name;
+
+	public function attribute_of($model, $attribute_name)
+	{
+		$this->model = $model;
+		$this->attribute_name = $attribute_name;
+	}
+
+	private function flag_dirty()
+	{
+		if ($this->model)
+			$this->model->flag_dirty($this->attribute_name);
+	}
+
+	public function setDate($year, $month, $day)
+	{
+		$this->flag_dirty();
+		call_user_func_array(array($this,'parent::setDate'),func_get_args());
+	}
+
+	public function setISODate($year, $week , $day=null)
+	{
+		$this->flag_dirty();
+		call_user_func_array(array($this,'parent::setISODate'),func_get_args());
+	}
+
+	public function setTime($hour, $minute, $second=null)
+	{
+		$this->flag_dirty();
+		call_user_func_array(array($this,'parent::setTime'),func_get_args());
+	}
+
+	public function setTimestamp($unixtimestamp)
+	{
+		$this->flag_dirty();
+		call_user_func_array(array($this,'parent::setTimestamp'),func_get_args());
+	}
+}
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Exceptions.php b/lib/ActiveRecord/Exceptions.php
new file mode 100644
index 0000000..db18165
--- /dev/null
+++ b/lib/ActiveRecord/Exceptions.php
@@ -0,0 +1,137 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Generic base exception for all ActiveRecord specific errors.
+ *
+ * @package ActiveRecord
+ */
+class ActiveRecordException extends \Exception {};
+
+/**
+ * Thrown when a record cannot be found.
+ *
+ * @package ActiveRecord
+ */
+class RecordNotFound extends ActiveRecordException {};
+
+/**
+ * Thrown when there was an error performing a database operation.
+ *
+ * The error will be specific to whatever database you are running.
+ *
+ * @package ActiveRecord
+ */
+class DatabaseException extends ActiveRecordException
+{
+	public function __construct($adapter_or_string_or_mystery)
+	{
+		if ($adapter_or_string_or_mystery instanceof Connection)
+		{
+			parent::__construct(
+				join(", ",$adapter_or_string_or_mystery->connection->errorInfo()),
+				intval($adapter_or_string_or_mystery->connection->errorCode()));
+		}
+		elseif ($adapter_or_string_or_mystery instanceof \PDOStatement)
+		{
+			parent::__construct(
+				join(", ",$adapter_or_string_or_mystery->errorInfo()),
+				intval($adapter_or_string_or_mystery->errorCode()));
+		}
+		else
+			parent::__construct($adapter_or_string_or_mystery);
+	}
+};
+
+/**
+ * Thrown by {@link Model}.
+ *
+ * @package ActiveRecord
+ */
+class ModelException extends ActiveRecordException {};
+
+/**
+ * Thrown by {@link Expressions}.
+ *
+ * @package ActiveRecord
+ */
+class ExpressionsException extends ActiveRecordException {};
+
+/**
+ * Thrown for configuration problems.
+ *
+ * @package ActiveRecord
+ */
+class ConfigException extends ActiveRecordException {};
+
+/**
+ * Thrown when attempting to access an invalid property on a {@link Model}.
+ *
+ * @package ActiveRecord
+ */
+class UndefinedPropertyException extends ModelException
+{
+	/**
+	 * Sets the exception message to show the undefined property's name.
+	 *
+	 * @param str $property_name name of undefined property
+	 * @return void
+	 */
+	public function __construct($class_name, $property_name)
+	{
+		if (is_array($property_name))
+		{
+			$this->message = implode("\r\n", $property_name);
+			return;
+		}
+
+		$this->message = "Undefined property: {$class_name}->{$property_name} in {$this->file} on line {$this->line}";
+		parent::__construct();
+	}
+};
+
+/**
+ * Thrown when attempting to perform a write operation on a {@link Model} that is in read-only mode.
+ *
+ * @package ActiveRecord
+ */
+class ReadOnlyException extends ModelException
+{
+	/**
+	 * Sets the exception message to show the undefined property's name.
+	 *
+	 * @param str $class_name name of the model that is read only
+	 * @param str $method_name name of method which attempted to modify the model
+	 * @return void
+	 */
+	public function __construct($class_name, $method_name)
+	{
+		$this->message = "{$class_name}::{$method_name}() cannot be invoked because this model is set to read only";
+		parent::__construct();
+	}
+};
+
+/**
+ * Thrown for validations exceptions.
+ *
+ * @package ActiveRecord
+ */
+class ValidationsArgumentError extends ActiveRecordException {};
+
+/**
+ * Thrown for relationship exceptions.
+ *
+ * @package ActiveRecord
+ */
+class RelationshipException extends ActiveRecordException {};
+
+/**
+ * Thrown for has many thru exceptions.
+ *
+ * @package ActiveRecord
+ */
+class HasManyThroughAssociationException extends RelationshipException {};
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Expressions.php b/lib/ActiveRecord/Expressions.php
new file mode 100644
index 0000000..ee7509c
--- /dev/null
+++ b/lib/ActiveRecord/Expressions.php
@@ -0,0 +1,183 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Templating like class for building SQL statements.
+ *
+ * Examples:
+ * 'name = :name AND author = :author'
+ * 'id = IN(:ids)'
+ * 'id IN(:subselect)'
+ * 
+ * @package ActiveRecord
+ */
+class Expressions
+{
+	const ParameterMarker = '?';
+
+	private $expressions;
+	private $values = array();
+	private $connection;
+
+	public function __construct($connection, $expressions=null /* [, $values ... ] */)
+	{
+		$values = null;
+		$this->connection = $connection;
+
+		if (is_array($expressions))
+		{
+			$glue = func_num_args() > 2 ? func_get_arg(2) : ' AND ';
+			list($expressions,$values) = $this->build_sql_from_hash($expressions,$glue);
+		}
+
+		if ($expressions != '')
+		{
+			if (!$values)
+				$values = array_slice(func_get_args(),2);
+
+			$this->values = $values;
+			$this->expressions = $expressions;
+		}
+	}
+
+	/**
+	 * Bind a value to the specific one based index. There must be a bind marker
+	 * for each value bound or to_s() will throw an exception.
+	 */
+	public function bind($parameter_number, $value)
+	{
+		if ($parameter_number <= 0)
+			throw new ExpressionsException("Invalid parameter index: $parameter_number");
+
+		$this->values[$parameter_number-1] = $value;
+	}
+
+	public function bind_values($values)
+	{
+		$this->values = $values;
+	}
+
+	/**
+	 * Returns all the values currently bound.
+	 */
+	public function values()
+	{
+		return $this->values;
+	}
+
+	/**
+	 * Returns the connection object.
+	 */
+	public function get_connection()
+	{
+		return $this->connection;
+	}
+
+	/**
+	 * Sets the connection object. It is highly recommended to set this so we can
+	 * use the adapter's native escaping mechanism.
+	 *
+	 * @param string $connection a Connection instance
+	 */
+	public function set_connection($connection)
+	{
+		$this->connection = $connection;
+	}
+
+	public function to_s($substitute=false, &$options=null)
+	{
+		if (!$options) $options = array();
+		
+		$values = array_key_exists('values',$options) ? $options['values'] : $this->values;
+
+		$ret = "";
+		$replace = array();
+		$num_values = count($values);
+		$len = strlen($this->expressions);
+		$quotes = 0;
+
+		for ($i=0,$n=strlen($this->expressions),$j=0; $i<$n; ++$i)
+		{
+			$ch = $this->expressions[$i];
+
+			if ($ch == self::ParameterMarker)
+			{
+				if ($quotes % 2 == 0)
+				{
+					if ($j > $num_values-1)
+						throw new ExpressionsException("No bound parameter for index $j");
+
+					$ch = $this->substitute($values,$substitute,$i,$j++);
+				}
+			}
+			elseif ($ch == '\'' && $i > 0 && $this->expressions[$i-1] != '\\')
+				++$quotes;
+
+			$ret .= $ch;
+		}
+		return $ret;
+	}
+
+	private function build_sql_from_hash(&$hash, $glue)
+	{
+		$sql = $g = "";
+
+		foreach ($hash as $name => $value)
+		{
+			if ($this->connection)
+				$name = $this->connection->quote_name($name);
+
+			if (is_array($value))
+				$sql .= "$g$name IN(?)";
+			else
+				$sql .= "$g$name=?";
+
+			$g = $glue;
+		}
+		return array($sql,array_values($hash));
+	}
+
+	private function substitute(&$values, $substitute, $pos, $parameter_index)
+	{
+		$value = $values[$parameter_index];
+
+		if (is_array($value))
+		{
+			if ($substitute)
+			{
+				$ret = '';
+
+				for ($i=0,$n=count($value); $i<$n; ++$i)
+					$ret .= ($i > 0 ? ',' : '') . $this->stringify_value($value[$i]);
+
+				return $ret;
+			}
+			return join(',',array_fill(0,count($value),self::ParameterMarker));
+		}
+
+		if ($substitute)
+			return $this->stringify_value($value);
+
+		return $this->expressions[$pos];
+	}
+
+	private function stringify_value($value)
+	{
+		if (is_null($value))
+			return "NULL";
+
+		return is_string($value) ? $this->quote_string($value) : $value;
+	}
+
+	private function quote_string($value)
+	{
+		if ($this->connection)
+			return $this->connection->escape($value);
+
+		return "'" . str_replace("'","''",$value) . "'";
+	}
+}
+?>
diff --git a/lib/ActiveRecord/Inflector.php b/lib/ActiveRecord/Inflector.php
new file mode 100644
index 0000000..f084655
--- /dev/null
+++ b/lib/ActiveRecord/Inflector.php
@@ -0,0 +1,115 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * @package ActiveRecord
+ */
+abstract class Inflector
+{
+	/**
+	 * Get an instance of the {@link Inflector} class.
+	 *
+	 * @return object
+	 */
+	public static function instance()
+	{
+		return new StandardInflector();
+	}
+
+	/**
+	 * Turn a string into its camelized version.
+	 *
+	 * @param string $s string to convert
+	 * @return string
+	 */
+	public function camelize($s)
+	{
+		$s = preg_replace('/[_-]+/','_',trim($s));
+		$s = str_replace(' ', '_', $s);
+
+		$camelized = '';
+
+		for ($i=0,$n=strlen($s); $i<$n; ++$i)
+		{
+			if ($s[$i] == '_' && $i+1 < $n)
+				$camelized .= strtoupper($s[++$i]);
+			else
+				$camelized .= $s[$i];
+		}
+
+		$camelized = trim($camelized,' _');
+
+		if (strlen($camelized) > 0)
+			$camelized[0] = strtolower($camelized[0]);
+
+		return $camelized;
+	}
+
+	/**
+	 * Determines if a string contains all uppercase characters.
+	 *
+	 * @param string $s string to check
+	 * @return bool
+	 */
+	public static function is_upper($s)
+	{
+		return (strtoupper($s) === $s);
+	}
+
+	/**
+	 * Determines if a string contains all lowercase characters.
+	 *
+	 * @param string $s string to check
+	 * @return bool
+	 */
+	public static function is_lower($s)
+	{
+		return (strtolower($s) === $s);
+	}
+
+	/**
+	 * Convert a camelized string to a lowercase, underscored string.
+	 *
+	 * @param string $s string to convert
+	 * @return string
+	 */
+	public function uncamelize($s)
+	{
+		$normalized = '';
+
+		for ($i=0,$n=strlen($s); $i<$n; ++$i)
+		{
+			if (ctype_alpha($s[$i]) && self::is_upper($s[$i]))
+				$normalized .= '_' . strtolower($s[$i]);
+			else
+				$normalized .= $s[$i];
+		}
+		return trim($normalized,' _');
+	}
+
+	/**
+	 * Convert a string with space into a underscored equivalent.
+	 *
+	 * @param string $s string to convert
+	 * @return string
+	 */
+	public function underscorify($s)
+	{
+		return preg_replace(array('/[_\- ]+/','/([a-z])([A-Z])/'),array('_','\\1_\\2'),trim($s));
+	}
+
+	abstract function variablize($s);
+}
+
+/**
+ * @package ActiveRecord
+ */
+class StandardInflector extends Inflector
+{
+	public function tableize($s) { return Utils::pluralize(strtolower($this->underscorify($s))); }
+	public function variablize($s) { return str_replace(array('-',' '),array('_','_'),strtolower(trim($s))); }
+}
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Model.php b/lib/ActiveRecord/Model.php
new file mode 100644
index 0000000..669a423
--- /dev/null
+++ b/lib/ActiveRecord/Model.php
@@ -0,0 +1,1673 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * The base class for your models.
+ *
+ * Defining an ActiveRecord model for a table called people and orders:
+ *
+ * <code>
+ * CREATE TABLE people(
+ *   id int primary key auto_increment,
+ *   parent_id int,
+ *   first_name varchar(50),
+ *   last_name varchar(50)
+ * );
+ *
+ * CREATE TABLE orders(
+ *   id int primary key auto_increment,
+ *   person_id int not null,
+ *   cost decimal(10,2),
+ *   total decimal(10,2)
+ * );
+ * </code>
+ *
+ * <code>
+ * class Person extends ActiveRecord\Model {
+ *   static $belongs_to = array(
+ *     array('parent', 'foreign_key' => 'parent_id', 'class_name' => 'Person')
+ *   );
+ *
+ *   static $has_many = array(
+ *     array('children', 'foreign_key' => 'parent_id', 'class_name' => 'Person'),
+ *     array('orders')
+ *   );
+ *
+ *   static $validates_length_of = array(
+ *     array('first_name', 'within' => array(1,50)),
+ *     array('last_name', 'within' => array(1,50))
+ *   );
+ * }
+ *
+ * class Order extends ActiveRecord\Model {
+ *   static $belongs_to = array(
+ *     array('person')
+ *   );
+ *
+ *   static $validates_numericality_of = array(
+ *     array('cost', 'greater_than' => 0),
+ *     array('total', 'greater_than' => 0)
+ *   );
+ *
+ *   static $before_save = array('calculate_total_with_tax');
+ *
+ *   public function calculate_total_with_tax() {
+ *     $this->total = $this->cost * 0.045;
+ *   }
+ * }
+ * </code>
+ *
+ * For a more in-depth look at defining models, relationships, callbacks and many other things
+ * please consult our {@link http://www.phpactiverecord.org/guides Guides}.
+ *
+ * @package ActiveRecord
+ * @see BelongsTo
+ * @see CallBack
+ * @see HasMany
+ * @see HasAndBelongsToMany
+ * @see Serialization
+ * @see Validations
+ */
+class Model
+{
+	/**
+	 * An instance of {@link Errors} and will be instantiated once a write method is called.
+	 *
+	 * @var Errors
+	 */
+	public $errors;
+
+	/**
+	 * Contains model values as column_name => value
+	 *
+	 * @var array
+	 */
+	private $attributes = array();
+
+	/**
+	 * Flag whether or not this model's attributes have been modified since it will either be null or an array of column_names that have been modified
+	 *
+	 * @var array
+	 */
+	private $__dirty = null;
+
+	/**
+	 * Flag that determines of this model can have a writer method invoked such as: save/update/insert/delete
+	 *
+	 * @var boolean
+	 */
+	private $__readonly = false;
+
+	/**
+	 * Array of relationship objects as model_attribute_name => relationship
+	 *
+	 * @var array
+	 */
+	private $__relationships = array();
+
+	/**
+	 * Flag that determines if a call to save() should issue an insert or an update sql statement
+	 *
+	 * @var boolean
+	 */
+	private $__new_record = true;
+
+	/**
+	 * Set to the name of the connection this {@link Model} should use.
+	 *
+	 * @var string
+	 */
+	static $connection;
+
+	/**
+	 * Set to the name of the database this Model's table is in.
+	 *
+	 * @var string
+	 */
+	static $db;
+
+	/**
+	 * Set this to explicitly specify the model's table name if different from inferred name.
+	 *
+	 * If your table doesn't follow our table name convention you can set this to the
+	 * name of your table to explicitly tell ActiveRecord what your table is called.
+	 *
+	 * @var string
+	 */
+	static $table_name; 
+
+	/**
+	 * Set this to override the default primary key name if different from default name of "id".
+	 *
+	 * @var string
+	 */
+	static $primary_key;
+
+	/**
+	 * Set this to explicitly specify the sequence name for the table.
+	 *
+	 * @var string
+	 */
+	static $sequence;
+
+	/**
+	 * Allows you to create aliases for attributes.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $alias_attribute = array(
+	 *     'the_first_name' => 'first_name',
+	 *     'the_last_name' => 'last_name');
+	 * }
+	 *
+	 * $person = Person::first();
+	 * $person->the_first_name = 'Tito';
+	 * echo $person->the_first_name;
+	 * </code>
+	 *
+	 * @var array
+	 */
+	static $alias_attribute = array();
+
+	/**
+	 * Whitelist of attributes that are checked from mass-assignment calls such as constructing a model or using update_attributes.
+	 *
+	 * This is the opposite of {@link attr_protected $attr_protected}.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $attr_accessible = array('first_name','last_name');
+	 * }
+	 *
+	 * $person = new Person(array(
+	 *   'first_name' => 'Tito',
+	 *   'last_name' => 'the Grief',
+	 *   'id' => 11111));
+	 *
+	 * echo $person->id; # => null
+	 * </code>
+	 *
+	 * @var array
+	 */
+	static $attr_accessible = array();
+
+	/**
+	 * Blacklist of attributes that cannot be mass-assigned.
+	 *
+	 * This is the opposite of {@link attr_accessible $attr_accessible} and the format
+	 * for defining these are exactly the same.
+	 *
+	 * @var array
+	 */
+	static $attr_protected = array();
+
+	/**
+	 * Delegates calls to a relationship.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $belongs_to = array(array('venue'),array('host'));
+	 *   static $delegate = array(
+	 *     array('name', 'state', 'to' => 'venue'),
+	 *     array('name', 'to' => 'host', 'prefix' => 'woot'));
+	 * }
+	 * </code>
+	 *
+	 * Can then do:
+	 *
+	 * <code>
+	 * $person->state     # same as calling $person->venue->state
+	 * $person->name      # same as calling $person->venue->name
+	 * $person->woot_name # same as calling $person->host->name
+	 * </code>
+	 *
+	 * @var array
+	 */
+	static $delegate = array();
+
+	/**
+	 * Define customer setters methods for the model.
+	 *
+	 * You can also use this to define custom setters for attributes as well.
+	 *
+	 * <code>
+	 * class User extends ActiveRecord\Model {
+	 *   static $setters = array('password','more','even_more');
+	 *
+	 *   # now to define the setter methods. Note you must
+	 *   # prepend set_ to your method name:
+	 *   function set_password($plaintext) {
+	 *     $this->encrypted_password = md5($plaintext);
+	 *   }
+	 * }
+	 *
+	 * $user = new User();
+	 * $user->password = 'plaintext';  # will call $user->set_password('plaintext')
+	 * </code>
+	 *
+	 * If you define a custom setter with the same name as an attribute then you
+	 * will need to use assign_attribute() to assign the value to the attribute.
+	 * This is necessary due to the way __set() works.
+	 *
+	 * For example, assume 'name' is a field on the table and we're defining a
+	 * custom setter for 'name':
+	 *
+	 * <code>
+	 * class User extends ActiveRecord\Model {
+	 *   static $setters = array('name');
+	 *
+	 *   # INCORRECT way to do it
+	 *   # function set_name($name) {
+	 *   #   $this->name = strtoupper($name);
+	 *   # }
+	 *
+	 *   function set_name($name) {
+	 *     $this->assign_attribute('name',strtoupper($name));
+	 *   }
+	 * }
+	 *
+	 * $user = new User();
+	 * $user->name = 'bob';
+	 * echo $user->name; # => BOB
+	 * </code>
+	 *
+	 * @var array
+	 */
+	static $setters = array();
+
+	/**
+	 * Define customer getter methods for the model.
+	 *
+	 * <code>
+	 * class User extends ActiveRecord\Model {
+	 *   static $getters = array('middle_initial','more','even_more');
+	 *
+	 *   # now to define the getter method. Note you must
+	 *   # prepend get_ to your method name:
+	 *   function get_middle_initial() {
+	 *     return $this->middle_name{0};
+	 *   }
+	 * }
+	 *
+	 * $user = new User();
+	 * echo $user->middle_name;  # will call $user->get_middle_name()
+	 * </code>
+	 *
+	 * If you define a custom getter with the same name as an attribute then you
+	 * will need to use read_attribute() to get the attribute's value.
+	 * This is necessary due to the way __get() works.
+	 *
+	 * For example, assume 'name' is a field on the table and we're defining a
+	 * custom getter for 'name':
+	 *
+	 * <code>
+	 * class User extends ActiveRecord\Model {
+	 *   static $getters = array('name');
+	 *
+	 *   # INCORRECT way to do it
+	 *   # function get_name() {
+	 *   #   return strtoupper($this->name);
+	 *   # }
+	 *
+	 *   function get_name() {
+	 *     return strtoupper($this->read_attribute('name'));
+	 *   }
+	 * }
+	 *
+	 * $user = new User();
+	 * $user->name = 'bob';
+	 * echo $user->name; # => BOB
+	 * </code>
+	 *
+	 * @var array
+	 */
+	static $getters = array();
+
+	/**
+	 * Constructs a model.
+	 *
+	 * When a user instantiates a new object (e.g.: it was not ActiveRecord that instantiated via a find)
+	 * then @var $attributes will be mapped according to the schema's defaults. Otherwise, the given
+	 * $attributes will be mapped via set_attributes_via_mass_assignment.
+	 *
+	 * <code>
+	 * new Person(array('first_name' => 'Tito', 'last_name' => 'the Grief'));
+	 * </code>
+	 *
+	 * @param array $attributes Hash containing names and values to mass assign to the model
+	 * @param boolean $guard_attributes Set to true to guard attributes
+	 * @param boolean $instantiating_via_find Set to true if this model is being created from a find call
+	 * @param boolean $new_record Set to true if this should be considered a new record
+	 * @return Model
+	 */
+	public function __construct(array $attributes=array(), $guard_attributes=true, $instantiating_via_find=false, $new_record=true)
+	{
+		$this->__new_record = $new_record;
+
+		// initialize attributes applying defaults
+		if (!$instantiating_via_find)
+		{
+			foreach (static::table()->columns as $name => $meta)
+				$this->attributes[$meta->inflected_name] = $meta->default;
+		}
+
+		$this->set_attributes_via_mass_assignment($attributes, $guard_attributes);
+
+		// since all attribute assignment now goes thru assign_attributes() we want to reset
+		// dirty if instantiating via find since nothing is really dirty when doing that
+		if ($instantiating_via_find)
+			$this->__dirty = array();
+
+		$this->invoke_callback('after_construct',false);
+	}
+
+	/**
+	 * Magic method which delegates to read_attribute(). This handles firing off getter methods,
+	 * as they are not checked/invoked inside of read_attribute(). This circumvents the problem with
+	 * a getter being accessed with the same name as an actual attribute.
+	 *
+	 * @see read_attribute()
+	 * @param string $name Name of an attribute
+	 * @return mixed The value of the attribute
+	 */
+	public function &__get($name)
+	{
+		// check for getter
+		if (in_array("get_$name",static::$getters))
+		{
+			$name = "get_$name";
+			$value = $this->$name();
+			return $value;
+		}
+
+		return $this->read_attribute($name);
+	}
+
+	/**
+	 * Determines if an attribute exists for this {@link Model}.
+	 *
+	 * @param string $attribute_name
+	 * @return boolean
+	 */
+	public function __isset($attribute_name)
+	{
+		return array_key_exists($attribute_name,$this->attributes) || array_key_exists($attribute_name,static::$alias_attribute);
+	}
+
+	/**
+	 * Magic allows un-defined attributes to set via $attributes
+	 *
+	 * @throws {@link UndefinedPropertyException} if $name does not exist
+	 * @param string $name Name of attribute, relationship or other to set
+	 * @param mixed $value The value
+	 * @return mixed The value
+	 */
+	public function __set($name, $value)
+	{
+		if (array_key_exists($name, static::$alias_attribute))
+			$name = static::$alias_attribute[$name];
+
+		elseif (in_array("set_$name",static::$setters))
+		{
+			$name = "set_$name";
+			return $this->$name($value);
+		}
+
+		if (array_key_exists($name,$this->attributes))
+			return $this->assign_attribute($name,$value);
+
+		foreach (static::$delegate as &$item)
+		{
+			if (($delegated_name = $this->is_delegated($name,$item)))
+				return $this->$item['to']->$delegated_name = $value;
+		}
+
+		throw new UndefinedPropertyException(get_called_class(),$name);
+	}
+
+	public function __wakeup()
+	{
+		// make sure the models Table instance gets initialized when waking up
+		static::table();
+	}
+
+	/**
+	 * Assign a value to an attribute.
+	 *
+	 * @param string $name Name of the attribute
+	 * @param mixed &$value Value of the attribute
+	 * @return mixed the attribute value
+	 */
+	public function assign_attribute($name, $value)
+	{
+		$table = static::table();
+
+		if (array_key_exists($name,$table->columns) && !is_object($value))
+			$value = $table->columns[$name]->cast($value,static::connection());
+
+		// convert php's \DateTime to ours
+		if ($value instanceof \DateTime)
+			$value = new DateTime($value->format('Y-m-d H:i:s T'));
+
+		// make sure DateTime values know what model they belong to so
+		// dirty stuff works when calling set methods on the DateTime object
+		if ($value instanceof DateTime)
+			$value->attribute_of($this,$name);
+
+		$this->attributes[$name] = $value;
+		$this->flag_dirty($name);
+		return $value;
+	}
+
+	/**
+	 * Retrieves an attribute's value or a relationship object based on the name passed. If the attribute
+	 * accessed is 'id' then it will return the model's primary key no matter what the actual attribute name is
+	 * for the primary key.
+	 *
+	 * @param string $name Name of an attribute
+	 * @return mixed The value of the attribute
+	 * @throws {@link UndefinedPropertyException} if name could not be resolved to an attribute, relationship, ...
+	 */
+	public function &read_attribute($name)
+	{
+		// check for aliased attribute
+		if (array_key_exists($name, static::$alias_attribute))
+			$name = static::$alias_attribute[$name];
+
+		// check for attribute
+		if (array_key_exists($name,$this->attributes))
+			return $this->attributes[$name];
+
+		// check relationships if no attribute
+		if (array_key_exists($name,$this->__relationships))
+			return $this->__relationships[$name];
+
+		$table = static::table();
+
+		// this may be first access to the relationship so check Table
+		if (($relationship = $table->get_relationship($name)))
+		{
+			$this->__relationships[$name] = $relationship->load($this);
+			return $this->__relationships[$name];
+		}
+
+		if ($name == 'id')
+		{
+			if (count($this->get_primary_key()) > 1)
+				throw new Exception("TODO composite key support");
+
+			if (isset($this->attributes[$table->pk[0]]))
+				return $this->attributes[$table->pk[0]];
+		}
+
+		//do not remove - have to return null by reference in strict mode
+		$null = null;
+
+		foreach (static::$delegate as &$item)
+		{
+			if (($delegated_name = $this->is_delegated($name,$item)))
+			{
+				$to = $item['to'];
+				if ($this->$to)
+				{
+					$val =& $this->$to->$delegated_name;
+					return $val;
+				}
+				else
+					return $null;
+			}
+		}
+
+		throw new UndefinedPropertyException(get_called_class(),$name);
+	}
+
+	/**
+	 * Flags an attribute as dirty.
+	 *
+	 * @param string $name Attribute name
+	 */
+	public function flag_dirty($name)
+	{
+		if (!$this->__dirty)
+			$this->__dirty = array();
+
+		$this->__dirty[$name] = true;
+	}
+
+	/**
+	 * Returns hash of attributes that have been modified since loading the model.
+	 *
+	 * @return mixed null if no dirty attributes otherwise returns array of dirty attributes.
+	 */
+	public function dirty_attributes()
+	{
+		if (!$this->__dirty)
+			return null;
+
+		$dirty = array_intersect_key($this->attributes,$this->__dirty);
+		return !empty($dirty) ? $dirty : null;
+	}
+
+	/**
+	 * Returns a copy of the model's attributes hash.
+	 *
+	 * @return array A copy of the model's attribute data
+	 */
+	public function attributes()
+	{
+		return $this->attributes;
+	}
+
+	/**
+	 * Retrieve the primary key name.
+	 *
+	 * @return string The primary key for the model
+	 */
+	public function get_primary_key()
+	{
+		return Table::load(get_class($this))->pk;
+	}
+
+	/**
+	 * Returns the actual attribute name if $name is aliased.
+	 *
+	 * @param string $name An attribute name
+	 * @return string
+	 */
+	public function get_real_attribute_name($name)
+	{
+		if (array_key_exists($name,$this->attributes))
+			return $name;
+
+		if (array_key_exists($name,static::$alias_attribute))
+			return static::$alias_attribute[$name];
+
+		return null;
+	}
+
+	/**
+	 * Returns array of validator data for this Model.
+	 *
+	 * Will return an array looking like:
+	 *
+	 * <code>
+	 * array(
+	 *   'name' => array(
+	 *     array('validator' => 'validates_presence_of'),
+	 *     array('validator' => 'validates_inclusion_of', 'in' => array('Bob','Joe','John')),
+	 *   'password' => array(
+	 *     array('validator' => 'validates_length_of', 'minimum' => 6))
+	 *   )
+	 * );
+	 * </code>
+	 *
+	 * @return array An array containing validator data for this model.
+	 */
+	public function get_validation_rules()
+	{
+		require_once 'Validations.php';
+
+		$validator = new Validations($this);
+		return $validator->rules();
+	}
+
+	/**
+	 * Returns an associative array containing values for all the attributes in $attributes
+	 *
+	 * @param array $attributes Array containing attribute names
+	 * @return array A hash containing $name => $value
+	 */
+	public function get_values_for($attributes)
+	{
+		$ret = array();
+
+		foreach ($attributes as $name)
+		{
+			if (array_key_exists($name,$this->attributes))
+				$ret[$name] = $this->attributes[$name];
+		}
+		return $ret;
+	}
+
+	/**
+	 * Retrieves the name of the table for this Model.
+	 *
+	 * @return string
+	 */
+	public static function table_name()
+	{
+		return static::table()->table;
+	}
+
+	/**
+	 * Returns the attribute name on the delegated relationship if $name is
+	 * delegated or null if not delegated.
+	 *
+	 * @param string $name Name of an attribute
+	 * @param array $delegate An array containing delegate data
+	 * @return delegated attribute name or null
+	 */
+	private function is_delegated($name, &$delegate)
+	{
+		if ($delegate['prefix'] != '')
+			$name = substr($name,strlen($delegate['prefix'])+1);
+
+		if (is_array($delegate) && in_array($name,$delegate['delegate']))
+			return $name;
+
+		return null;
+	}
+
+	/**
+	 * Determine if the model is in read-only mode.
+	 *
+	 * @return boolean
+	 */
+	public function is_readonly()
+	{
+		return $this->__readonly;
+	}
+
+	/**
+	 * Determine if the model is a new record.
+	 *
+	 * @return boolean
+	 */
+	public function is_new_record()
+	{
+		return $this->__new_record;
+	}
+
+	/**
+	 * Throws an exception if this model is set to readonly.
+	 *
+	 * @throws ActiveRecord\ReadOnlyException
+	 * @param string $method_name Name of method that was invoked on model for exception message
+	 */
+	private function verify_not_readonly($method_name)
+	{
+		if ($this->is_readonly())
+			throw new ReadOnlyException(get_class($this), $method_name);
+	}
+
+	/**
+	 * Flag model as readonly.
+	 *
+	 * @param boolean $readonly Set to true to put the model into readonly mode
+	 */
+	public function readonly($readonly=true)
+	{
+		$this->__readonly = $readonly;
+	}
+
+	/**
+	 * Retrieve the connection for this model.
+	 *
+	 * @return Connection
+	 */
+	public static function connection()
+	{
+		return static::table()->conn;
+	}
+
+	/**
+	 * Returns the {@link Table} object for this model.
+	 *
+	 * Be sure to call in static scoping: static::table()
+	 *
+	 * @return Table
+	 */
+	public static function table()
+	{
+		return Table::load(get_called_class());
+	}
+
+	/**
+	 * Creates a model and saves it to the database.
+	 *
+	 * @param array $attributes Array of the models attributes
+	 * @param boolean $validate True if the validators should be run
+	 * @return Model
+	 */
+	public static function create($attributes, $validate=true)
+	{
+		$class_name = get_called_class();
+		$model = new $class_name($attributes);
+		$model->save($validate);
+		return $model;
+	}
+
+	/**
+	 * Save the model to the database.
+	 *
+	 * This function will automatically determine if an INSERT or UPDATE needs to occur.
+	 * If a validation or a callback for this model returns false, then the model will
+	 * not be saved and this will return false.
+	 *
+	 * If saving an existing model only data that has changed will be saved.
+	 *
+	 * @param boolean $validate Set to true or false depending on if you want the validators to run or not
+	 * @return boolean True if the model was saved to the database otherwise false
+	 */
+	public function save($validate=true)
+	{
+		$this->verify_not_readonly('save');
+		return $this->is_new_record() ? $this->insert($validate) : $this->update($validate);
+	}
+
+	/**
+	 * Issue an INSERT sql statement for this model's attribute.
+	 *
+	 * @see save
+	 * @param boolean $validate Set to true or false depending on if you want the validators to run or not
+	 * @return boolean True if the model was saved to the database otherwise false
+	 */
+	private function insert($validate=true)
+	{
+		$this->verify_not_readonly('insert');
+
+		if (($validate && !$this->_validate() || !$this->invoke_callback('before_create',false)))
+			return false;
+
+		$table = static::table();
+
+		if (!($attributes = $this->dirty_attributes()))
+			$attributes = $this->attributes;
+
+		$pk = $this->get_primary_key();
+		$use_sequence = false;
+
+		if ($table->sequence && !isset($attributes[$pk[0]]))
+		{
+			if (($conn = static::connection()) instanceof OciAdapter)
+			{
+				// terrible oracle makes us select the nextval first
+				$attributes[$pk[0]] = $conn->get_next_sequence_value($table->sequence);
+				$table->insert($attributes);
+				$this->attributes[$pk[0]] = $attributes[$pk[0]];
+			}
+			else
+			{
+				// unset pk that was set to null
+				if (array_key_exists($pk[0],$attributes))
+					unset($attributes[$pk[0]]);
+
+				$table->insert($attributes,$pk[0],$table->sequence);
+				$use_sequence = true;
+			}
+		}
+		else
+			$table->insert($attributes);
+
+		// if we've got an autoincrementing/sequenced pk set it
+		if (count($pk) == 1)
+		{
+			$column = $table->get_column_by_inflected_name($pk[0]);
+
+			if ($column->auto_increment || $use_sequence)
+				$this->attributes[$pk[0]] = $table->conn->insert_id($table->sequence);
+		}
+
+		$this->invoke_callback('after_create',false);
+		$this->__new_record = false;
+		return true;
+	}
+
+	/**
+	 * Issue an UPDATE sql statement for this model's dirty attributes.
+	 *
+	 * @see save
+	 * @param boolean $validate Set to true or false depending on if you want the validators to run or not
+	 * @return boolean True if the model was saved to the database otherwise false
+	 */
+	private function update($validate=true)
+	{
+		$this->verify_not_readonly('update');
+
+		if ($validate && !$this->_validate())
+			return false;
+
+		if ($this->is_dirty())
+		{
+			$pk = $this->values_for_pk();
+
+			if (empty($pk))
+				throw new ActiveRecordException("Cannot update, no primary key defined for: " . get_called_class());
+
+			if (!$this->invoke_callback('before_update',false))
+				return false;
+
+			$dirty = $this->dirty_attributes();
+			static::table()->update($dirty,$pk);
+			$this->invoke_callback('after_update',false);
+		}
+
+		return true;
+	}
+
+	/**
+	 * Deletes this model from the database and returns true if successful.
+	 *
+	 * @return boolean
+	 */
+	public function delete()
+	{
+		$this->verify_not_readonly('delete');
+
+		$pk = $this->values_for_pk();
+
+		if (empty($pk))
+			throw new ActiveRecordException("Cannot delete, no primary key defined for: " . get_called_class());
+
+		if (!$this->invoke_callback('before_destroy',false))
+			return false;
+
+		static::table()->delete($pk);
+		$this->invoke_callback('after_destroy',false);
+
+		return true;
+	}
+
+	/**
+	 * Helper that creates an array of values for the primary key(s).
+	 *
+	 * @return array An array in the form array(key_name => value, ...)
+	 */
+	public function values_for_pk()
+	{
+		return $this->values_for(static::table()->pk);
+	}
+
+	/**
+	 * Helper to return a hash of values for the specified attributes.
+	 *
+	 * @param array $attribute_names Array of attribute names
+	 * @return array An array in the form array(name => value, ...)
+	 */
+	public function values_for($attribute_names)
+	{
+		$filter = array();
+
+		foreach ($attribute_names as $name)
+			$filter[$name] = $this->$name;
+
+		return $filter;
+	}
+
+	/**
+	 * Validates the model.
+	 *
+	 * @return boolean True if passed validators otherwise false
+	 */
+	private function _validate()
+	{
+		require_once 'Validations.php';
+
+		$validator = new Validations($this);
+		$validation_on = 'validation_on_' . ($this->is_new_record() ? 'create' : 'update');
+
+		foreach (array('before_validation', "before_$validation_on") as $callback)
+		{
+			if (!$this->invoke_callback($callback,false))
+				return false;
+		}
+
+		$this->errors = $validator->validate();
+
+		foreach (array('after_validation', "after_$validation_on") as $callback)
+			$this->invoke_callback($callback,false);
+
+		if (!$this->errors->is_empty())
+			return false;
+
+		return true;
+	}
+
+	/**
+	 * Returns true if the model has been modified.
+	 *
+	 * @return boolean true if modified
+	 */
+	public function is_dirty()
+	{
+		return empty($this->__dirty) ? false : true;
+	}
+
+	/**
+	 * Run validations on model and returns whether or not model passed validation.
+	 *
+	 * @see is_invalid
+	 * @return boolean
+	 */
+	public function is_valid()
+	{
+		return $this->_validate();
+	}
+
+	/**
+	 * Runs validations and returns true if invalid.
+	 *
+	 * @see is_valid
+	 * @return boolean
+	 */
+	public function is_invalid()
+	{
+		return !$this->_validate();
+	}
+
+	/**
+	 * Updates a model's timestamps.
+	 */
+	public function set_timestamps()
+	{
+		$now = date('Y-m-d H:i:s');
+
+		if (isset($this->updated_at))
+			$this->updated_at = $now;
+
+		if (isset($this->created_at) && $this->is_new_record())
+			$this->created_at = $now;
+	}
+
+	/**
+	 * Mass update the model with an array of attribute data and saves to the database.
+	 *
+	 * @param array $attributes An attribute data array in the form array(name => value, ...)
+	 * @return boolean True if successfully updated and saved otherwise false
+	 */
+	public function update_attributes($attributes)
+	{
+		$this->set_attributes($attributes);
+		return $this->save();
+	}
+
+	/**
+	 * Updates a single attribute and saves the record without going through the normal validation procedure.
+	 *
+	 * @param string $name Name of attribute
+	 * @param mixed $value Value of the attribute
+	 * @return boolean True if successful otherwise false
+	 */
+	public function update_attribute($name, $value)
+	{
+		$this->__set($name, $value);
+		return $this->update(false);
+	}
+
+	/**
+	 * Mass update the model with data from an attributes hash.
+	 *
+	 * Unlike update_attributes() this method only updates the model's data
+	 * but DOES NOT save it to the database.
+	 *
+	 * @see update_attributes
+	 * @param array $attributes An array containing data to update in the form array(name => value, ...)
+	 */
+	public function set_attributes(array $attributes)
+	{
+		$this->set_attributes_via_mass_assignment($attributes, true);
+	}
+
+	/**
+	 * Passing $guard_attributes as true will throw an exception if an attribute does not exist.
+	 *
+	 * @throws ActiveRecord\UndefinedPropertyException
+	 * @param array $attributes An array in the form array(name => value, ...)
+	 * @param boolean $guard_attributes Flag of whether or not attributes should be guarded
+	 */
+	private function set_attributes_via_mass_assignment(array &$attributes, $guard_attributes)
+	{
+		//access uninflected columns since that is what we would have in result set
+		$table = static::table();
+		$exceptions = array();
+		$use_attr_accessible = !empty(static::$attr_accessible);
+		$use_attr_protected = !empty(static::$attr_protected);
+		$connection = static::connection();
+
+		foreach ($attributes as $name => $value)
+		{
+			// is a normal field on the table
+			if (array_key_exists($name,$table->columns))
+			{
+				$value = $table->columns[$name]->cast($value,$connection);
+				$name = $table->columns[$name]->inflected_name;
+			}
+
+			if ($guard_attributes)
+			{
+				if ($use_attr_accessible && !in_array($name,static::$attr_accessible))
+					continue;
+
+				if ($use_attr_protected && in_array($name,static::$attr_protected))
+					continue;
+
+				// set valid table data
+				try {
+					$this->$name = $value;
+				} catch (UndefinedPropertyException $e) {
+					$exceptions[] = $e->getMessage();
+				}
+			}
+			else
+			{
+				// ignore OciAdapter's limit() stuff
+				if ($name == 'ar_rnum__')
+					continue;
+
+				// set arbitrary data
+				$this->assign_attribute($name,$value);
+			}
+		}
+
+		if (!empty($exceptions))
+			throw new UndefinedPropertyException(get_called_class(),$exceptions);
+	}
+
+	/**
+	 * Add a model to the given named ($name) relationship.
+	 *
+	 * @internal This should <strong>only</strong> be used by eager load
+	 * @param Model $model
+	 * @param $name of relationship for this table
+	 * @return void
+	 */
+	public function set_relationship_from_eager_load(Model $model=null, $name)
+	{
+		$table = static::table();
+
+		if (($rel = $table->get_relationship($name)))
+		{
+			if ($rel->is_poly())
+			{
+				// if the related model is null and it is a poly then we should have an empty array
+				if (is_null($model))
+					return $this->__relationships[$name] = array();
+				else
+					return $this->__relationships[$name][] = $model;
+			}
+			else
+				return $this->__relationships[$name] = $model;
+		}
+
+		throw new RelationshipException("Relationship named $name has not been declared for class: {$table->class->getName()}");
+	}
+
+	/**
+	 * Reloads the attributes and relationships of this object from the database.
+	 *
+	 * @return Model
+	 */
+	public function reload()
+	{
+		$this->__relationships = array();
+		$pk = array_values($this->get_values_for($this->get_primary_key()));
+
+		$this->set_attributes($this->find($pk)->attributes);
+		$this->reset_dirty();
+
+		return $this;
+	}
+
+	public function __clone()
+	{
+		$this->__relationships = array();
+		$this->reset_dirty();
+		return $this;
+	}
+
+	/**
+	 * Resets the dirty array.
+	 *
+	 * @see dirty_attributes
+	 */
+	public function reset_dirty()
+	{
+		$this->__dirty = null;
+	}
+
+	/**
+	 * A list of valid finder options.
+	 *
+	 * @var array
+	 */
+	static $VALID_OPTIONS = array('conditions', 'limit', 'offset', 'order', 'select', 'joins', 'include', 'readonly', 'group', 'from', 'having');
+
+	/**
+	 * Enables the use of dynamic finders.
+	 *
+	 * Dynamic finders are just an easy way to do queries quickly without having to
+	 * specify an options array with conditions in it.
+	 *
+	 * <code>
+	 * SomeModel::find_by_first_name('Tito');
+	 * SomeModel::find_by_first_name_and_last_name('Tito','the Grief');
+	 * SomeModel::find_by_first_name_or_last_name('Tito','the Grief');
+	 * SomeModel::find_all_by_last_name('Smith');
+	 * SomeModel::count_by_name('Bob')
+	 * SomeModel::count_by_name_or_state('Bob','VA')
+	 * SomeModel::count_by_name_and_state('Bob','VA')
+	 * </code>
+	 *
+	 * You can also create the model if the find call returned no results:
+	 *
+	 * <code>
+	 * Person::find_or_create_by_name('Tito');
+	 *
+	 * # would be the equivalent of
+	 * if (!Person::find_by_name('Tito'))
+	 *   Person::create(array('Tito'));
+	 * </code>
+	 *
+	 * Some other examples of find_or_create_by:
+	 *
+	 * <code>
+	 * Person::find_or_create_by_name_and_id('Tito',1);
+	 * Person::find_or_create_by_name_and_id(array('name' => 'Tito', 'id' => 1));
+	 * </code>
+	 *
+	 * @param string $method Name of method
+	 * @param mixed $args Method args
+	 * @return Model
+	 * @throws {@link ActiveRecordException} if invalid query
+	 * @see find
+	 */
+	public static function __callStatic($method, $args)
+	{
+		$options = static::extract_and_validate_options($args);
+		$create = false;
+
+		if (substr($method,0,17) == 'find_or_create_by')
+		{
+			$attributes = substr($method,17);
+
+			// can't take any finders with OR in it when doing a find_or_create_by
+			if (strpos($attributes,'_or_') !== false)
+				throw new ActiveRecordException("Cannot use OR'd attributes in find_or_create_by");
+
+			$create = true;
+			$method = 'find_by' . substr($method,17);
+		}
+
+		if (substr($method,0,7) === 'find_by')
+		{
+			$attributes = substr($method,8);
+			$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string(static::table()->conn,$attributes,$args,static::$alias_attribute);
+
+			if (!($ret = static::find('first',$options)) && $create)
+				return static::create(SQLBuilder::create_hash_from_underscored_string($attributes,$args,static::$alias_attribute));
+
+			return $ret;
+		}
+		elseif (substr($method,0,11) === 'find_all_by')
+		{
+			$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string(static::table()->conn,substr($method,12),$args,static::$alias_attribute);
+			return static::find('all',$options);
+		}
+		elseif (substr($method,0,8) === 'count_by')
+		{
+			$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string(static::table()->conn,substr($method,9),$args,static::$alias_attribute);
+			return static::count($options);
+		}
+
+		throw new ActiveRecordException("Call to undefined method: $method");
+	}
+
+	/**
+	 * Enables the use of build|create for associations.
+	 *
+	 * @param string $method Name of method
+	 * @param mixed $args Method args
+	 * @return mixed An instance of a given {@link AbstractRelationship}
+	 */
+	public function __call($method, $args)
+	{
+		//check for build|create_association methods
+		if (preg_match('/(build|create)_/', $method))
+		{
+			if (!empty($args))
+				$args = $args[0];
+
+			$association_name = str_replace(array('build_', 'create_'), '', $method);
+
+			if (($association = static::table()->get_relationship($association_name)))
+			{
+				//access association to ensure that the relationship has been loaded
+				//so that we do not double-up on records if we append a newly created
+				$this->$association_name;
+				$method = str_replace($association_name,'association', $method);
+				return $association->$method($this, $args);
+			}
+		}
+
+		throw new ActiveRecordException("Call to undefined method: $method");
+	}
+
+	/**
+	 * Alias for self::find('all').
+	 *
+	 * @see find
+	 * @return array array of records found
+	 */
+	public static function all(/* ... */)
+	{
+		return call_user_func_array('static::find',array_merge(array('all'),func_get_args()));
+	}
+
+	/**
+	 * Get a count of qualifying records.
+	 *
+	 * <code>
+	 * YourModel::count(array('conditions' => 'amount > 3.14159265'));
+	 * </code>
+	 *
+	 * @see find
+	 * @return int Number of records that matched the query
+	 */
+	public static function count(/* ... */)
+	{
+		$args = func_get_args();
+		$options = static::extract_and_validate_options($args);
+		$options['select'] = 'COUNT(*)';
+
+		if (!empty($args))
+		{
+			if (is_hash($args[0]))
+				$options['conditions'] = $args[0];
+			else
+				$options['conditions'] = call_user_func_array('static::pk_conditions',$args);
+		}
+
+		$table = static::table();
+		$sql = $table->options_to_sql($options);
+		$values = $sql->get_where_values();
+		return $table->conn->query_and_fetch_one($sql->to_s(),$values);
+	}
+
+	/**
+	 * Determine if a record exists.
+	 *
+	 * <code>
+	 * SomeModel::exists(123);
+	 * SomeModel::exists(array('conditions' => array('id=? and name=?', 123, 'Tito')));
+	 * SomeModel::exists(array('id' => 123, 'name' => 'Tito'));
+	 * </code>
+	 *
+	 * @see find
+	 * @return boolean
+	 */
+	public static function exists(/* ... */)
+	{
+		return call_user_func_array('static::count',func_get_args()) > 0 ? true : false;
+	}
+
+	/**
+	 * Alias for self::find('first').
+	 *
+	 * @see find
+	 * @return Model The first matched record or null if not found
+	 */
+	public static function first(/* ... */)
+	{
+		return call_user_func_array('static::find',array_merge(array('first'),func_get_args()));
+	}
+
+	/**
+	 * Alias for self::find('last')
+	 *
+	 * @see find
+	 * @return Model The last matched record or null if not found
+	 */
+	public static function last(/* ... */)
+	{
+		return call_user_func_array('static::find',array_merge(array('last'),func_get_args()));
+	}
+
+	/**
+	 * Find records in the database.
+	 *
+	 * Finding by the primary key:
+	 *
+	 * <code>
+	 * # queries for the model with id=123
+	 * YourModel::find(123);
+	 *
+	 * # queries for model with id in(1,2,3)
+	 * YourModel::find(1,2,3);
+	 *
+	 * # finding by pk accepts an options array
+	 * YourModel::find(123,array('order' => 'name desc'));
+	 * </code>
+	 *
+	 * Finding by using a conditions array:
+	 *
+	 * <code>
+	 * YourModel::find('first', array('conditions' => array('name=?','Tito'),
+	 *   'order' => 'name asc'))
+	 * YourModel::find('all', array('conditions' => 'amount > 3.14159265'));
+	 * YourModel::find('all', array('conditions' => array('id in(?)', array(1,2,3))));
+	 * </code>
+	 *
+	 * Finding by using a hash:
+	 *
+	 * <code>
+	 * YourModel::find(array('name' => 'Tito', 'id' => 1));
+	 * YourModel::find('first',array('name' => 'Tito', 'id' => 1));
+	 * YourModel::find('all',array('name' => 'Tito', 'id' => 1));
+	 * </code>
+	 *
+	 * An options array can take the following parameters:
+	 *
+	 * <ul>
+	 * <li><b>select:</b> A SQL fragment for what fields to return such as: '*', 'people.*', 'first_name, last_name, id'</li>
+	 * <li><b>joins:</b> A SQL join fragment such as: 'JOIN roles ON(roles.user_id=user.id)' or a named association on the model</li>
+	 * <li><b>include:</b> to do not implemented yet</li>
+	 * <li><b>conditions:</b> A SQL fragment such as: 'id=1', array('id=1'), array('name=? and id=?','Tito',1), array('name IN(?)', array('Tito','Bob')),
+	 * array('name' => 'Tito', 'id' => 1)</li>
+	 * <li><b>limit:</b> Number of records to limit the query to</li>
+	 * <li><b>offset:</b> The row offset to return results from for the query</li>
+	 * <li><b>order:</b> A SQL fragment for order such as: 'name asc', 'name asc, id desc'</li>
+	 * <li><b>readonly:</b> Return all the models in readonly mode</li>
+	 * <li><b>group:</b> A SQL group by fragment</li>
+	 * </ul>
+	 *
+	 * @throws {@link RecordNotFound} if no options are passed or finding by pk and no records matched
+	 * @return mixed An array of records found if doing a find_all otherwise a
+	 *   single Model object or null if it wasn't found. NULL is only return when
+	 *   doing a first/last find. If doing an all find and no records matched this
+	 *   will return an empty array.
+	 */
+	public static function find(/* $type, $options */)
+	{
+		$class = get_called_class();
+
+		if (func_num_args() <= 0)
+			throw new RecordNotFound("Couldn't find $class without an ID");
+
+		$args = func_get_args();
+		$options = static::extract_and_validate_options($args);
+		$num_args = count($args);
+		$single = true;
+
+		if ($num_args > 0 && ($args[0] === 'all' || $args[0] === 'first' || $args[0] === 'last'))
+		{
+			switch ($args[0])
+			{
+				case 'all':
+					$single = false;
+					break;
+
+			 	case 'last':
+					if (!array_key_exists('order',$options))
+						$options['order'] = join(' DESC, ',static::table()->pk) . ' DESC';
+					else
+						$options['order'] = SQLBuilder::reverse_order($options['order']);
+
+					// fall thru
+
+			 	case 'first':
+			 		$options['limit'] = 1;
+			 		$options['offset'] = 0;
+			 		break;
+			}
+
+			$args = array_slice($args,1);
+			$num_args--;
+		}
+		//find by pk
+		elseif (1 === count($args) && 1 == $num_args)
+			$args = $args[0];
+
+		// anything left in $args is a find by pk
+		if ($num_args > 0 && !isset($options['conditions']))
+			return static::find_by_pk($args, $options);
+
+		$options['mapped_names'] = static::$alias_attribute;
+		$list = static::table()->find($options);
+
+		return $single ? (!empty($list) ? $list[0] : null) : $list;
+	}
+
+	/**
+	 * Finder method which will find by a single or array of primary keys for this model.
+	 *
+	 * @see find
+	 * @param array $values An array containing values for the pk
+	 * @param array $options An options array
+	 * @return Model
+	 * @throws {@link RecordNotFound} if a record could not be found
+	 */
+	public static function find_by_pk($values, $options)
+	{
+		$options['conditions'] = static::pk_conditions($values);
+		$list = static::table()->find($options);
+		$results = count($list);
+
+		if ($results != ($expected = count($values)))
+		{
+			$class = get_called_class();
+
+			if ($expected == 1)
+			{
+				if (!is_array($values))
+					$values = array($values);
+
+				throw new RecordNotFound("Couldn't find $class with ID=" . join(',',$values));
+			}
+
+			$values = join(',',$values);
+			throw new RecordNotFound("Couldn't find all $class with IDs ($values) (found $results, but was looking for $expected)");
+		}
+		return $expected == 1 ? $list[0] : $list;
+	}
+
+	/**
+	 * Find using a raw SELECT query.
+	 *
+	 * <code>
+	 * YourModel::find_by_sql("SELECT * FROM people WHERE name=?",array('Tito'));
+	 * YourModel::find_by_sql("SELECT * FROM people WHERE name='Tito'");
+	 * </code>
+	 *
+	 * @param string $sql The raw SELECT query
+	 * @param array $values An array of values for any parameters that needs to be bound
+	 * @return array An array of models
+	 */
+	public static function find_by_sql($sql, $values=null)
+	{
+		return static::table()->find_by_sql($sql, $values, true);
+	}
+
+	/**
+	 * Determines if the specified array is a valid ActiveRecord options array.
+	 *
+	 * @param array $array An options array
+	 * @param bool $throw True to throw an exception if not valid
+	 * @return boolean True if valid otherwise valse
+	 * @throws {@link ActiveRecordException} if the array contained any invalid options
+	 */
+	public static function is_options_hash($array, $throw=true)
+	{
+		if (is_hash($array))
+		{
+			$keys = array_keys($array);
+			$diff = array_diff($keys,self::$VALID_OPTIONS);
+
+			if (!empty($diff) && $throw)
+				throw new ActiveRecordException("Unknown key(s): " . join(', ',$diff));
+
+			$intersect = array_intersect($keys,self::$VALID_OPTIONS);
+
+			if (!empty($intersect))
+				return true;
+		}
+		return false;
+	}
+
+	/**
+	 * Returns a hash containing the names => values of the primary key.
+	 *
+	 * @internal This needs to eventually support composite keys.
+	 * @param mixed $args Primary key value(s)
+	 * @return array An array in the form array(name => value, ...)
+	 */
+	public static function pk_conditions($args)
+	{
+		$table = static::table();
+		$ret = array($table->pk[0] => $args);
+		return $ret;
+	}
+
+	/**
+	 * Pulls out the options hash from $array if any.
+	 *
+	 * @internal DO NOT remove the reference on $array.
+	 * @param array &$array An array
+	 * @return array A valid options array
+	 */
+	public static function extract_and_validate_options(array &$array)
+	{
+		$options = array();
+
+		if ($array)
+		{
+			$last = &$array[count($array)-1];
+
+			try
+			{
+				if (self::is_options_hash($last))
+				{
+					array_pop($array);
+					$options = $last;
+				}
+			}
+			catch (ActiveRecordException $e)
+			{
+				if (!is_hash($last))
+					throw $e;
+
+				$options = array('conditions' => $last);
+			}
+		}
+		return $options;
+	}
+
+	/**
+	 * Returns a JSON representation of this model.
+	 *
+	 * @see Serialization
+	 * @param array $options An array containing options for json serialization (see {@link Serialization} for valid options)
+	 * @return string JSON representation of the model
+	 */
+	public function to_json(array $options=array())
+	{
+		return $this->serialize('Json', $options);
+	}
+
+	/**
+	 * Returns an XML representation of this model.
+	 *
+	 * @see Serialization
+	 * @param array $options An array containing options for xml serialization (see {@link Serialization} for valid options)
+	 * @return string XML representation of the model
+	 */
+	public function to_xml(array $options=array())
+	{
+		return $this->serialize('Xml', $options);
+	}
+
+	/**
+	 * Creates a serializer based on pre-defined to_serializer()
+	 *
+	 * An options array can take the following parameters:
+	 *
+	 * <ul>
+	 * <li><b>only:</b> a string or array of attributes to be included.</li>
+	 * <li><b>excluded:</b> a string or array of attributes to be excluded.</li>
+	 * <li><b>methods:</b> a string or array of methods to invoke. The method's name will be used as a key for the final attributes array
+	 * along with the method's returned value</li>
+	 * <li><b>include:</b> a string or array of associated models to include in the final serialized product.</li>
+	 * </ul>
+	 *
+	 * @param string $type Either Xml or Json
+	 * @param array $options Options array for the serializer
+	 * @return string Serialized representation of the model
+	 */
+	private function serialize($type, $options)
+	{
+		require_once 'Serialization.php';
+		$class = "ActiveRecord\\{$type}Serializer";
+		$serializer = new $class($this, $options);
+		return $serializer->to_s();
+	}
+
+	/**
+	 * Invokes the specified callback on this model.
+	 *
+	 * @param string $method_name Name of the call back to run.
+	 * @param boolean $must_exist Set to true to raise an exception if the callback does not exist.
+	 * @return boolean True if invoked or null if not
+	 */
+	private function invoke_callback($method_name, $must_exist=true)
+	{
+		return static::table()->callback->invoke($this,$method_name,$must_exist);
+	}
+
+	/**
+	 * Executes a block of code inside a database transaction.
+	 *
+	 * <code>
+	 * YourModel::transaction(function()
+	 * {
+	 *   YourModel::create(array("name" => "blah"));
+	 * });
+	 * </code>
+	 *
+	 * If an exception is thrown inside the closure the transaction will
+	 * automatically be rolled back. You can also return false from your
+	 * closure to cause a rollback:
+	 *
+	 * <code>
+	 * YourModel::transaction(function()
+	 * {
+	 *   YourModel::create(array("name" => "blah"));
+	 *   throw new Exception("rollback!");
+	 * });
+	 *
+	 * YourModel::transaction(function()
+	 * {
+	 *   YourModel::create(array("name" => "blah"));
+	 *   return false; # rollback!
+	 * });
+	 * </code>
+	 *
+	 * @param Closure $closure The closure to execute. To cause a rollback have your closure return false or throw an exception.
+	 * @return boolean True if the transaction was committed, False if rolled back.
+	 */
+	public static function transaction($closure)
+	{
+		$connection = static::connection();
+
+		try
+		{
+			$connection->transaction();
+
+			if ($closure() === false)
+			{
+				$connection->rollback();
+				return false;
+			}
+			else
+				$connection->commit();
+		}
+		catch (\Exception $e)
+		{
+			$connection->rollback();
+			throw $e;
+		}
+		return true;
+	}
+};
+?>
diff --git a/lib/ActiveRecord/Reflections.php b/lib/ActiveRecord/Reflections.php
new file mode 100644
index 0000000..881532f
--- /dev/null
+++ b/lib/ActiveRecord/Reflections.php
@@ -0,0 +1,86 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+use ReflectionClass;
+
+/**
+ * Simple class that caches reflections of classes.
+ *
+ * @package ActiveRecord
+ */
+class Reflections extends Singleton
+{
+	/**
+	 * Current reflections.
+	 *
+	 * @var array
+	 */
+	private $reflections = array();
+
+	/**
+	 * Instantiates a new ReflectionClass for the given class.
+	 *
+	 * @param string $class Name of a class
+	 * @return Reflections $this so you can chain calls like Reflections::instance()->add('class')->get()
+	 */
+	public function add($class=null)
+	{
+		$class = $this->get_class($class);
+
+		if (!isset($this->reflections[$class]))
+			$this->reflections[$class] = new ReflectionClass($class);
+			
+		return $this;
+	}
+
+	/**
+	 * Destroys the cached ReflectionClass.
+	 *
+	 * Put this here mainly for testing purposes.
+	 * 
+	 * @param string $class Name of a class.
+	 * @return void
+	 */
+	public function destroy($class)
+	{
+		if (isset($this->reflections[$class]))
+			$this->reflections[$class] = null;
+	}
+	
+	/**
+	 * Get a cached ReflectionClass.
+	 *
+	 * @param string $class Optional name of a class
+	 * @return mixed null or a ReflectionClass instance
+	 * @throws ActiveRecordException if class was not found
+	 */
+	public function get($class=null)
+	{
+		$class = $this->get_class($class);
+
+		if (isset($this->reflections[$class]))
+			return $this->reflections[$class];
+
+		throw new ActiveRecordException("Class not found: $class");
+	}
+
+	/**
+	 * Retrieve a class name to be reflected.
+	 *
+	 * @param mixed $mixed An object or name of a class
+	 * @return string
+	 */
+	private function get_class($mixed=null)
+	{
+		if (is_object($mixed))
+			return get_class($mixed);
+
+		if (!is_null($mixed))
+			return $mixed;
+
+		return $this->get_called_class();
+	}
+}
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Relationship.php b/lib/ActiveRecord/Relationship.php
new file mode 100644
index 0000000..1e00eb6
--- /dev/null
+++ b/lib/ActiveRecord/Relationship.php
@@ -0,0 +1,636 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Interface for a table relationship.
+ *
+ * @package ActiveRecord
+ */
+interface InterfaceRelationship
+{
+	public function __construct($options=array());
+	public function build_association(Model $model, $attributes=array());
+	public function create_association(Model $model, $attributes=array());
+}
+
+/**
+ * Abstract class that all relationships must extend from.
+ *
+ * @package ActiveRecord
+ * @see http://www.phpactiverecord.org/guides/associations
+ */
+abstract class AbstractRelationship implements InterfaceRelationship
+{
+	/**
+	 * Name to be used that will trigger call to the relationship.
+	 *
+	 * @var string
+	 */
+	public $attribute_name;
+
+	/**
+	 * Class name of the associated model.
+	 *
+	 * @var string
+	 */
+	public $class_name;
+
+	/**
+	 * Name of the foreign key.
+	 *
+	 * @var string
+	 */
+	public $foreign_key = array();
+
+	/**
+	 * Options of the relationship.
+	 *
+	 * @var array
+	 */
+	protected $options = array();
+
+	/**
+	 * Is the relationship single or multi.
+	 *
+	 * @var boolean
+	 */
+	protected $poly_relationship = false;
+
+	/**
+	 * List of valid options for relationships.
+	 *
+	 * @var array
+	 */
+	static protected $valid_association_options = array('class_name', 'class', 'foreign_key', 'conditions', 'select', 'readonly');
+
+	/**
+	 * Constructs a relationship.
+	 *
+	 * @param array $options Options for the relationship (see {@link valid_association_options})
+	 * @return mixed
+	 */
+	public function __construct($options=array())
+	{
+		$this->attribute_name = $options[0];
+		$this->options = $this->merge_association_options($options);
+
+		$relationship = strtolower(denamespace(get_called_class()));
+
+		if ($relationship === 'hasmany' || $relationship === 'hasandbelongstomany')
+			$this->poly_relationship = true;
+
+		if (isset($this->options['conditions']) && !is_array($this->options['conditions']))
+			$this->options['conditions'] = array($this->options['conditions']);
+
+		if (isset($this->options['class']))
+			$this->set_class_name($this->options['class']);
+		elseif (isset($this->options['class_name']))
+			$this->set_class_name($this->options['class_name']);
+
+		$this->attribute_name = strtolower(Inflector::instance()->variablize($this->attribute_name));
+
+		if (!$this->foreign_key && isset($this->options['foreign_key']))
+			$this->foreign_key = is_array($this->options['foreign_key']) ? $this->options['foreign_key'] : array($this->options['foreign_key']);
+	}
+
+	protected function get_table()
+	{
+		return Table::load($this->class_name);
+	}
+
+	/**
+	 * What is this relationship's cardinality?
+	 *
+	 * @return bool
+	 */
+	public function is_poly()
+	{
+		return $this->poly_relationship;
+	}
+
+	/**
+	 * Eagerly loads relationships for $models.
+	 *
+	 * This method takes an array of models, collects PK or FK (whichever is needed for relationship), then queries
+	 * the related table by PK/FK and attaches the array of returned relationships to the appropriately named relationship on
+	 * $models.
+	 *
+	 * @param Table $table
+	 * @param $models array of model objects
+	 * @param $attributes array of attributes from $models
+	 * @param $includes array of eager load directives
+	 * @param $query_keys -> key(s) to be queried for on included/related table
+	 * @param $model_values_keys -> key(s)/value(s) to be used in query from model which is including
+	 * @return void
+	 */
+	protected function query_and_attach_related_models_eagerly(Table $table, $models, $attributes, $includes=array(), $query_keys=array(), $model_values_keys=array())
+	{
+		$values = array();
+		$options = array();
+		$inflector = Inflector::instance();
+		$query_key = $query_keys[0];
+		$model_values_key = $model_values_keys[0];
+
+		foreach ($attributes as $column => $value)
+			$values[] = $value[$inflector->variablize($model_values_key)];
+
+		$values = array($values);
+		$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string($table->conn,$query_key,$values);
+
+		if (!empty($includes))
+			$options['include'] = $includes;
+
+		$class = $this->class_name;
+
+		$related_models = $class::find('all', $options);
+		$used_models = array();
+		$model_values_key = $inflector->variablize($model_values_key);
+		$query_key = $inflector->variablize($query_key);
+
+		foreach ($models as $model)
+		{
+			$matches = 0;
+			$key_to_match = $model->$model_values_key;
+
+			foreach ($related_models as $related)
+			{
+				if ($related->$query_key == $key_to_match)
+				{
+					$hash = spl_object_hash($related);
+
+					if (in_array($hash, $used_models))
+						$model->set_relationship_from_eager_load(clone($related), $this->attribute_name);
+					else
+						$model->set_relationship_from_eager_load($related, $this->attribute_name);
+
+					$used_models[] = $hash;
+					$matches++;
+				}
+			}
+
+			if (0 === $matches)
+				$model->set_relationship_from_eager_load(null, $this->attribute_name);
+		}
+	}
+
+	/**
+	 * Creates a new instance of specified {@link Model} with the attributes pre-loaded.
+	 *
+	 * @param Model $model The model which holds this association
+	 * @param array $attributes Hash containing attributes to initialize the model with
+	 * @return Model
+	 */
+	public function build_association(Model $model, $attributes=array())
+	{
+		$class_name = $this->class_name;
+		return new $class_name($attributes);
+	}
+
+	/**
+	 * Creates a new instance of {@link Model} and invokes save.
+	 *
+	 * @param Model $model The model which holds this association
+	 * @param array $attributes Hash containing attributes to initialize the model with
+	 * @return Model
+	 */
+	public function create_association(Model $model, $attributes=array())
+	{
+		$class_name = $this->class_name;
+		$new_record = $class_name::create($attributes);
+		return $this->append_record_to_associate($model, $new_record);
+	}
+
+	protected function append_record_to_associate(Model $associate, Model $record)
+	{
+		$association =& $associate->{$this->attribute_name};
+
+		if ($this->poly_relationship)
+			$association[] = $record;
+		else
+			$association = $record;
+
+		return $record;
+	}
+
+	protected function merge_association_options($options)
+	{
+		$available_options = array_merge(self::$valid_association_options,static::$valid_association_options);
+		$valid_options = array_intersect_key(array_flip($available_options),$options);
+
+		foreach ($valid_options as $option => $v)
+			$valid_options[$option] = $options[$option];
+
+		return $valid_options;
+	}
+
+	protected function unset_non_finder_options($options)
+	{
+		foreach (array_keys($options) as $option)
+		{
+			if (!in_array($option, Model::$VALID_OPTIONS))
+				unset($options[$option]);
+		}
+		return $options;
+	}
+
+	protected function keyify($class_name)
+	{
+		return strtolower(classify(denamespace($class_name))). '_id';
+	}
+
+	/**
+	 * Infers the $this->class_name based on $this->attribute_name.
+	 *
+	 * Will try to guess the appropriate class by singularizing and uppercasing $this->attribute_name.
+	 *
+	 * @return void
+	 * @see attribute_name
+	 */
+	protected function set_inferred_class_name()
+	{
+		$this->set_class_name(classify($this->attribute_name, true));
+	}
+
+	protected function set_class_name($class_name)
+	{
+		$reflection = Reflections::instance()->add($class_name)->get($class_name);
+
+		if (!$reflection->isSubClassOf('ActiveRecord\\Model'))
+			throw new RelationshipException("'$class_name' must extend from ActiveRecord\\Model");
+
+		$this->class_name = $class_name;
+	}
+
+	protected function create_conditions_from_keys(Model $model, $condition_keys=array(), $value_keys=array())
+	{
+		$condition_string = implode('_and_', $condition_keys);
+		$condition_values = array_values($model->get_values_for($value_keys));
+
+		// return null if all the foreign key values are null so that we don't try to do a query like "id is null"
+		if (all(null,$condition_values))
+			return null;
+
+		$conditions = SQLBuilder::create_conditions_from_underscored_string(Table::load(get_class($model))->conn,$condition_string,$condition_values);
+
+		# DO NOT CHANGE THE NEXT TWO LINES. add_condition operates on a reference and will screw options array up
+		if (isset($this->options['conditions']))
+			$options_conditions = $this->options['conditions'];
+		else
+			$options_conditions = array();
+
+		return Utils::add_condition($options_conditions, $conditions);
+	}
+
+	/**
+	 * Creates INNER JOIN SQL for associations.
+	 *
+	 * @param Table $from_table the table used for the FROM SQL statement
+	 * @param bool $using_through is this a THROUGH relationship?
+	 * @param string $alias a table alias for when a table is being joined twice
+	 * @return string SQL INNER JOIN fragment
+	 */
+	public function construct_inner_join_sql(Table $from_table, $using_through=false, $alias=null)
+	{
+		if ($using_through)
+		{
+			$join_table = $from_table;
+			$join_table_name = $from_table->get_fully_qualified_table_name();
+			$from_table_name = Table::load($this->class_name)->get_fully_qualified_table_name();
+ 		}
+		else
+		{
+			$join_table = Table::load($this->class_name);
+			$join_table_name = $join_table->get_fully_qualified_table_name();
+			$from_table_name = $from_table->get_fully_qualified_table_name();
+		}
+
+		// need to flip the logic when the key is on the other table
+		if ($this instanceof HasMany || $this instanceof HasOne)
+		{
+			$this->set_keys($from_table->class->getName());
+
+			if ($using_through)
+			{
+				$foreign_key = $this->primary_key[0];
+				$join_primary_key = $this->foreign_key[0];
+			}
+			else
+			{
+				$join_primary_key = $this->foreign_key[0];
+				$foreign_key = $this->primary_key[0];
+			}
+		}
+		else
+		{
+			$foreign_key = $this->foreign_key[0];
+			$join_primary_key = $this->primary_key[0];
+		}
+
+		if (!is_null($alias))
+		{
+			$aliased_join_table_name = $alias = $this->get_table()->conn->quote_name($alias);
+			$alias .= ' ';
+		}
+		else
+			$aliased_join_table_name = $join_table_name;
+
+		return "INNER JOIN $join_table_name {$alias}ON($from_table_name.$foreign_key = $aliased_join_table_name.$join_primary_key)";
+	}
+
+	/**
+	 * This will load the related model data.
+	 *
+	 * @param Model $model The model this relationship belongs to
+	 */
+	abstract function load(Model $model);
+};
+
+/**
+ * One-to-many relationship.
+ *
+ * <code>
+ * # Table: people
+ * # Primary key: id
+ * # Foreign key: school_id
+ * class Person extends ActiveRecord\Model {}
+ *
+ * # Table: schools
+ * # Primary key: id
+ * class School extends ActiveRecord\Model {
+ *   static $has_many = array(
+ *     array('people')
+ *   );
+ * });
+ * </code>
+ *
+ * Example using options:
+ *
+ * <code>
+ * class Payment extends ActiveRecord\Model {
+ *   static $belongs_to = array(
+ *     array('person'),
+ *     array('order')
+ *   );
+ * }
+ *
+ * class Order extends ActiveRecord\Model {
+ *   static $has_many = array(
+ *     array('people',
+ *           'through'    => 'payments',
+ *           'select'     => 'people.*, payments.amount',
+ *           'conditions' => 'payments.amount < 200')
+ *     );
+ * }
+ * </code>
+ *
+ * @package ActiveRecord
+ * @see http://www.phpactiverecord.org/guides/associations
+ * @see valid_association_options
+ */
+class HasMany extends AbstractRelationship
+{
+	/**
+	 * Valid options to use for a {@link HasMany} relationship.
+	 *
+	 * <ul>
+	 * <li><b>limit/offset:</b> limit the number of records</li>
+     * <li><b>primary_key:</b> name of the primary_key of the association (defaults to "id")</li>
+     * <li><b>group:</b> GROUP BY clause</li>
+     * <li><b>order:</b> ORDER BY clause</li>
+     * <li><b>through:</b> name of a model</li>
+     * </ul>
+	 *
+	 * @var array
+	 */
+	static protected $valid_association_options = array('primary_key', 'order', 'group', 'having', 'limit', 'offset', 'through', 'source');
+
+	protected $primary_key;
+
+	private $has_one = false;
+	private $through;
+
+	/**
+	 * Constructs a {@link HasMany} relationship.
+	 *
+	 * @param array $options Options for the association
+	 * @return HasMany
+	 */
+	public function __construct($options=array())
+	{
+		parent::__construct($options);
+
+		if (isset($this->options['through']))
+		{
+			$this->through = $this->options['through'];
+
+			if (isset($this->options['source']))
+				$this->set_class_name($this->options['source']);
+		}
+
+		if (!$this->primary_key && isset($this->options['primary_key']))
+			$this->primary_key = is_array($this->options['primary_key']) ? $this->options['primary_key'] : array($this->options['primary_key']);
+
+		if (!$this->class_name)
+			$this->set_inferred_class_name();
+	}
+
+	protected function set_keys($model_class_name, $override=false)
+	{
+		//infer from class_name
+		if (!$this->foreign_key || $override)
+			$this->foreign_key = array($this->keyify($model_class_name));
+
+		if (!$this->primary_key || $override)
+			$this->primary_key = Table::load($model_class_name)->pk;
+	}
+
+	public function load(Model $model)
+	{
+		$class_name = $this->class_name;
+		$this->set_keys(get_class($model));
+
+		// since through relationships depend on other relationships we can't do
+		// this initiailization in the constructor since the other relationship
+		// may not have been created yet and we only want this to run once
+		if (!isset($this->initialized))
+		{
+			if ($this->through)
+			{
+				// verify through is a belongs_to or has_many for access of keys
+				if (!($through_relationship = $this->get_table()->get_relationship($this->through)))
+					throw new HasManyThroughAssociationException("Could not find the association $this->through in model " . get_class($model));
+
+				if (!($through_relationship instanceof HasMany) && !($through_relationship instanceof BelongsTo))
+					throw new HasManyThroughAssociationException('has_many through can only use a belongs_to or has_many association');
+
+				// save old keys as we will be reseting them below for inner join convenience
+				$pk = $this->primary_key;
+				$fk = $this->foreign_key;
+
+				$this->set_keys($this->get_table()->class->getName(), true);
+
+				$through_table = Table::load(classify($this->through, true));
+				$this->options['joins'] = $this->construct_inner_join_sql($through_table, true);
+
+				// reset keys
+				$this->primary_key = $pk;
+				$this->foreign_key = $fk;
+			}
+
+			$this->initialized = true;
+		}
+
+		if (!($conditions = $this->create_conditions_from_keys($model, $this->foreign_key, $this->primary_key)))
+			return null;
+
+		$options = $this->unset_non_finder_options($this->options);
+		$options['conditions'] = $conditions;
+		return $class_name::find($this->poly_relationship ? 'all' : 'first',$options);
+	}
+
+	private function inject_foreign_key_for_new_association(Model $model, &$attributes)
+	{
+		$this->set_keys($model);
+		$primary_key = Inflector::instance()->variablize($this->foreign_key[0]);
+
+		if (!isset($attributes[$primary_key]))
+			$attributes[$primary_key] = $model->id;
+
+		return $attributes;
+	}
+
+	public function build_association(Model $model, $attributes=array())
+	{
+		$attributes = $this->inject_foreign_key_for_new_association($model, $attributes);
+		return parent::build_association($model, $attributes);
+	}
+
+	public function create_association(Model $model, $attributes=array())
+	{
+		$attributes = $this->inject_foreign_key_for_new_association($model, $attributes);
+		return parent::create_association($model, $attributes);
+	}
+
+	public function load_eagerly($models=array(), $attributes=array(), $includes, Table $table)
+	{
+		$this->set_keys($table->class->name);
+		$this->query_and_attach_related_models_eagerly($table,$models,$attributes,$includes,$this->foreign_key, $table->pk);
+	}
+};
+
+/**
+ * One-to-one relationship.
+ *
+ * <code>
+ * # Table name: states
+ * # Primary key: id
+ * class State extends ActiveRecord\Model {}
+ *
+ * # Table name: people
+ * # Foreign key: state_id
+ * class Person extends ActiveRecord\Model {
+ *   static $has_one = array(array('state'));
+ * }
+ * </code>
+ *
+ * @package ActiveRecord
+ * @see http://www.phpactiverecord.org/guides/associations
+ */
+class HasOne extends HasMany
+{
+};
+
+/**
+ * @package ActiveRecord
+ * @see http://www.phpactiverecord.org/guides/associations
+ */
+class HasAndBelongsToMany extends AbstractRelationship
+{
+	public function __construct($options=array())
+	{
+		/* options =>
+		 *   join_table - name of the join table if not in lexical order
+		 *   foreign_key -
+		 *   association_foreign_key - default is {assoc_class}_id
+		 *   uniq - if true duplicate assoc objects will be ignored
+		 *   validate
+		 */
+	}
+
+	public function load(Model $model)
+	{
+
+	}
+};
+
+/**
+ * Belongs to relationship.
+ *
+ * <code>
+ * class School extends ActiveRecord\Model {}
+ *
+ * class Person extends ActiveRecord\Model {
+ *   static $belongs_to = array(
+ *     array('school')
+ *   );
+ * }
+ * </code>
+ *
+ * Example using options:
+ *
+ * <code>
+ * class School extends ActiveRecord\Model {}
+ *
+ * class Person extends ActiveRecord\Model {
+ *   static $belongs_to = array(
+ *     array('school', 'primary_key' => 'school_id')
+ *   );
+ * }
+ * </code>
+ *
+ * @package ActiveRecord
+ * @see valid_association_options
+ * @see http://www.phpactiverecord.org/guides/associations
+ */
+class BelongsTo extends AbstractRelationship
+{
+	public function __construct($options=array())
+	{
+		parent::__construct($options);
+
+		if (!$this->class_name)
+			$this->set_inferred_class_name();
+
+		//infer from class_name
+		if (!$this->foreign_key)
+			$this->foreign_key = array($this->keyify($this->class_name));
+
+		$this->primary_key = array(Table::load($this->class_name)->pk[0]);
+	}
+
+	public function load(Model $model)
+	{
+		$keys = array();
+		$inflector = Inflector::instance();
+
+		foreach ($this->foreign_key as $key)
+			$keys[] = $inflector->variablize($key);
+
+		if (!($conditions = $this->create_conditions_from_keys($model, $this->primary_key, $keys)))
+			return null;
+
+		$options = $this->unset_non_finder_options($this->options);
+		$options['conditions'] = $conditions;
+		$class = $this->class_name;
+		return $class::first($options);
+	}
+
+	public function load_eagerly($models=array(), $attributes, $includes, Table $table)
+	{
+		$this->query_and_attach_related_models_eagerly($table,$models,$attributes,$includes, $this->primary_key,$this->foreign_key);
+	}
+};
+?>
diff --git a/lib/ActiveRecord/SQLBuilder.php b/lib/ActiveRecord/SQLBuilder.php
new file mode 100644
index 0000000..74872b6
--- /dev/null
+++ b/lib/ActiveRecord/SQLBuilder.php
@@ -0,0 +1,396 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Helper class for building sql statements progmatically.
+ *
+ * @package ActiveRecord
+ */
+class SQLBuilder
+{
+	private $connection;
+	private $operation = 'SELECT';
+	private $table;
+	private $select = '*';
+	private $joins;
+	private $order;
+	private $limit;
+	private $offset;
+	private $group;
+	private $having;
+
+	// for where
+	private $where;
+	private $where_values = array();
+
+	// for insert/update
+	private $data;
+	private $sequence;
+
+	/**
+	 * Constructor.
+	 *
+	 * @param Connection $connection A database connection object
+	 * @param string $table Name of a table
+	 * @return SQLBuilder
+	 * @throws ActiveRecordException if connection was invalid
+	 */
+	public function __construct($connection, $table)
+	{
+		if (!$connection)
+			throw new ActiveRecordException('A valid database connection is required.');
+
+		$this->connection	= $connection;
+		$this->table		= $table;
+	}
+
+	/**
+	 * Returns the SQL string.
+	 *
+	 * @return string
+	 */
+	public function __toString()
+	{
+		return $this->to_s();
+	}
+
+	/**
+	 * Returns the SQL string.
+	 *
+	 * @see __toString
+	 * @return string
+	 */
+	public function to_s()
+	{
+		$func = 'build_' . strtolower($this->operation);
+		return $this->$func();
+	}
+
+	/**
+	 * Returns the bind values.
+	 *
+	 * @return array
+	 */
+	public function bind_values()
+	{
+		$ret = array();
+
+		if ($this->data)
+			$ret = array_values($this->data);
+
+		if ($this->get_where_values())
+			$ret = array_merge($ret,$this->get_where_values());
+
+		return array_flatten($ret);
+	}
+
+	public function get_where_values()
+	{
+		return $this->where_values;
+	}
+
+	public function where(/* (conditions, values) || (hash) */)
+	{
+		$this->apply_where_conditions(func_get_args());
+		return $this;
+	}
+
+	public function order($order)
+	{
+		$this->order = $order;
+		return $this;
+	}
+
+	public function group($group)
+	{
+		$this->group = $group;
+		return $this;
+	}
+
+	public function having($having)
+	{
+		$this->having = $having;
+		return $this;
+	}
+
+	public function limit($limit)
+	{
+		$this->limit = intval($limit);
+		return $this;
+	}
+
+	public function offset($offset)
+	{
+		$this->offset = intval($offset);
+		return $this;
+	}
+
+	public function select($select)
+	{
+		$this->operation = 'SELECT';
+		$this->select = $select;
+		return $this;
+	}
+
+	public function joins($joins)
+	{
+		$this->joins = $joins;
+		return $this;
+	}
+
+	public function insert($hash, $pk=null, $sequence_name=null)
+	{
+		if (!is_hash($hash))
+			throw new ActiveRecordException('Inserting requires a hash.');
+
+		$this->operation = 'INSERT';
+		$this->data = $hash;
+
+		if ($pk && $sequence_name)
+			$this->sequence = array($pk,$sequence_name);
+
+		return $this;
+	}
+
+	public function update($hash)
+	{
+		if (!is_hash($hash))
+			throw new ActiveRecordException('Updating requires a hash.');
+
+		$this->operation = 'UPDATE';
+		$this->data = $hash;
+		return $this;
+	}
+
+	public function delete()
+	{
+		$this->operation = 'DELETE';
+		$this->apply_where_conditions(func_get_args());
+		return $this;
+	}
+
+	/**
+	 * Reverses an order clause.
+	 */
+	public static function reverse_order($order)
+	{
+		if (!trim($order))
+			return $order;
+
+		$parts = explode(',',$order);
+
+		for ($i=0,$n=count($parts); $i<$n; ++$i)
+		{
+			$v = strtolower($parts[$i]);
+
+			if (strpos($v,' asc') !== false)
+				$parts[$i] = preg_replace('/asc/i','DESC',$parts[$i]);
+			elseif (strpos($v,' desc') !== false)
+				$parts[$i] = preg_replace('/desc/i','ASC',$parts[$i]);
+			else
+				$parts[$i] .= ' DESC';
+		}
+		return join(',',$parts);
+	}
+
+	/**
+	 * Converts a string like "id_and_name_or_z" into a conditions value like array("id=? AND name=? OR z=?", values, ...).
+	 *
+	 * @param Connection $connection
+	 * @param $name Underscored string
+	 * @param $values Array of values for the field names. This is used
+	 *   to determine what kind of bind marker to use: =?, IN(?), IS NULL
+	 * @param $map A hash of "mapped_column_name" => "real_column_name"
+	 * @return A conditions array in the form array(sql_string, value1, value2,...)
+	 */
+	public static function create_conditions_from_underscored_string(Connection $connection, $name, &$values=array(), &$map=null)
+	{
+		if (!$name)
+			return null;
+
+		$parts = preg_split('/(_and_|_or_)/i',$name,-1,PREG_SPLIT_DELIM_CAPTURE);
+		$num_values = count($values);
+		$conditions = array('');
+
+		for ($i=0,$j=0,$n=count($parts); $i<$n; $i+=2,++$j)
+		{
+			if ($i >= 2)
+				$conditions[0] .= preg_replace(array('/_and_/i','/_or_/i'),array(' AND ',' OR '),$parts[$i-1]);
+
+			if ($j < $num_values)
+			{
+				if (!is_null($values[$j]))
+				{
+					$bind = is_array($values[$j]) ? ' IN(?)' : '=?';
+					$conditions[] = $values[$j];
+				}
+				else
+					$bind = ' IS NULL';
+			}
+			else
+				$bind = ' IS NULL';
+
+			// map to correct name if $map was supplied
+			$name = $map && isset($map[$parts[$i]]) ? $map[$parts[$i]] : $parts[$i];
+
+			$conditions[0] .= $connection->quote_name($name) . $bind;
+		}
+		return $conditions;
+	}
+
+	/**
+	 * Like create_conditions_from_underscored_string but returns a hash of name => value array instead.
+	 *
+	 * @param string $name A string containing attribute names connected with _and_ or _or_
+	 * @param $args Array of values for each attribute in $name
+	 * @param $map A hash of "mapped_column_name" => "real_column_name"
+	 * @return array A hash of array(name => value, ...)
+	 */
+	public static function create_hash_from_underscored_string($name, &$values=array(), &$map=null)
+	{
+		$parts = preg_split('/(_and_|_or_)/i',$name);
+		$hash = array();
+
+		for ($i=0,$n=count($parts); $i<$n; ++$i)
+		{
+			// map to correct name if $map was supplied
+			$name = $map && isset($map[$parts[$i]]) ? $map[$parts[$i]] : $parts[$i];
+			$hash[$name] = $values[$i];
+		}
+		return $hash;
+	}
+
+	/**
+	 * prepends table name to hash of field names to get around ambiguous fields when SQL builder
+	 * has joins
+	 *
+	 * @param array $hash
+	 * @return array $new
+	 */
+	private function prepend_table_name_to_fields($hash=array())
+	{
+		$new = array();
+		$table = $this->connection->quote_name($this->table);
+
+		foreach ($hash as $key => $value)
+		{
+			$k = $this->connection->quote_name($key);
+			$new[$table.'.'.$k] = $value;
+		}
+
+		return $new;
+	}
+
+	private function apply_where_conditions($args)
+	{
+		require_once 'Expressions.php';
+		$num_args = count($args);
+
+		if ($num_args == 1 && is_hash($args[0]))
+		{
+			$hash = is_null($this->joins) ? $args[0] : $this->prepend_table_name_to_fields($args[0]);
+			$e = new Expressions($this->connection,$hash);
+			$this->where = $e->to_s();
+			$this->where_values = array_flatten($e->values());
+		}
+		elseif ($num_args > 0)
+		{
+			// if the values has a nested array then we'll need to use Expressions to expand the bind marker for us
+			$values = array_slice($args,1);
+
+			foreach ($values as $name => &$value)
+			{
+				if (is_array($value))
+				{
+					$e = new Expressions($this->connection,$args[0]);
+					$e->bind_values($values);
+					$this->where = $e->to_s();
+					$this->where_values = array_flatten($e->values());
+					return;
+				}
+			}
+
+			// no nested array so nothing special to do
+			$this->where = $args[0];
+			$this->where_values = &$values;
+		}
+	}
+
+	private function build_delete()
+	{
+		$sql = "DELETE FROM $this->table";
+
+		if ($this->where)
+			$sql .= " WHERE $this->where";
+
+		return $sql;
+	}
+
+	private function build_insert()
+	{
+		require_once 'Expressions.php';
+		$keys = join(',',$this->quoted_key_names());
+
+		if ($this->sequence)
+		{
+			$sql =
+				"INSERT INTO $this->table($keys," . $this->connection->quote_name($this->sequence[0]) .
+				") VALUES(?," . $this->connection->next_sequence_value($this->sequence[1]) . ")";
+		}
+		else
+			$sql = "INSERT INTO $this->table($keys) VALUES(?)";
+
+		$e = new Expressions($this->connection,$sql,array_values($this->data));
+		return $e->to_s();
+	}
+
+	private function build_select()
+	{
+		$sql = "SELECT $this->select FROM $this->table";
+
+		if ($this->joins)
+			$sql .= ' ' . $this->joins;
+
+		if ($this->where)
+			$sql .= " WHERE $this->where";
+
+		if ($this->group)
+			$sql .= " GROUP BY $this->group";
+
+		if ($this->having)
+			$sql .= " HAVING $this->having";
+
+		if ($this->order)
+			$sql .= " ORDER BY $this->order";
+
+		if ($this->limit || $this->offset)
+			$sql = $this->connection->limit($sql,$this->offset,$this->limit);
+
+		return $sql;
+	}
+
+	private function build_update()
+	{
+		$fields = $this->quoted_key_names();
+		$sql = "UPDATE $this->table SET " . join('=?, ',$fields) . '=?';
+
+		if ($this->where)
+			$sql .= " WHERE $this->where";
+
+		return $sql;
+	}
+
+	private function quoted_key_names()
+	{
+		$keys = array();
+
+		foreach ($this->data as $key => $value)
+			$keys[] = $this->connection->quote_name($key);
+
+		return $keys;
+	}
+}
+?>
diff --git a/lib/ActiveRecord/Serialization.php b/lib/ActiveRecord/Serialization.php
new file mode 100644
index 0000000..03aa271
--- /dev/null
+++ b/lib/ActiveRecord/Serialization.php
@@ -0,0 +1,302 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+use XmlWriter;
+
+/**
+ * Base class for Model serializers.
+ *
+ * All serializers support the following options:
+ *
+ * <ul>
+ * <li><b>only:</b> a string or array of attributes to be included.</li>
+ * <li><b>exclude:</b> a string or array of attributes to be excluded.</li>
+ * <li><b>methods:</b> a string or array of methods to invoke. The method's name will be used as a key for the final attributes array
+ * along with the method's returned value</li>
+ * <li><b>include:</b> a string or array of associated models to include in the final serialized product.</li>
+ * <li><b>skip_instruct:</b> set to true to skip the <?xml ...?> declaration.</li>
+ * </ul>
+ *
+ * Example usage:
+ *
+ * <code>
+ * # include the attributes id and name
+ * # run $model->encoded_description() and include its return value
+ * # include the comments association
+ * # include posts association with its own options (nested)
+ * $model->to_json(array(
+ *   'only' => array('id','name', 'encoded_description'),
+ *   'methods' => array('encoded_description'),
+ *   'include' => array('comments', 'posts' => array('only' => 'id'))
+ * ));
+ *
+ * # exclude the password field from being included
+ * $model->to_xml(array('exclude' => 'password')));
+ * </code>
+ *
+ * @package ActiveRecord
+ * @link http://www.phpactiverecord.org/guides/utilities#topic-serialization
+ */
+abstract class Serialization
+{
+	protected $model;
+	protected $options;
+	protected $attributes;
+
+	/**
+	 * Set this to true if the serializer needs to create a nested array keyed
+	 * on the name of the included classes such as for xml serialization.
+	 *
+	 * Setting this to true will produce the following attributes array when
+	 * the include option was used:
+	 *
+	 * <code>
+	 * $user = array('id' => 1, 'name' => 'Tito',
+	 *   'permissions' => array(
+	 *     'permission' => array(
+	 *       array('id' => 100, 'name' => 'admin'),
+	 *       array('id' => 101, 'name' => 'normal')
+	 *     )
+	 *   )
+	 * );
+	 * </code>
+	 *
+	 * Setting to false will produce this:
+	 *
+	 * <code>
+	 * $user = array('id' => 1, 'name' => 'Tito',
+	 *   'permissions' => array(
+	 *     array('id' => 100, 'name' => 'admin'),
+	 *     array('id' => 101, 'name' => 'normal')
+	 *   )
+	 * );
+	 * </code>
+	 *
+	 * @var boolean
+	 */
+	protected $includes_with_class_name_element = false;
+
+	/**
+	 * Constructs a {@link Serialization} object.
+	 *
+	 * @param Model $model The model to serialize
+	 * @param array &$options Options for serialization
+	 * @return Serialization
+	 */
+	public function __construct(Model $model, &$options)
+	{
+		$this->model = $model;
+		$this->options = $options;
+		$this->attributes = $model->attributes();
+		$this->parse_options();
+	}
+
+	private function parse_options()
+	{
+		$this->check_only();
+		$this->check_except();
+		$this->check_methods();
+		$this->check_include();
+	}
+
+	private function check_only()
+	{
+		if (isset($this->options['only']))
+		{
+			$this->options_to_a('only');
+
+			$exclude = array_diff(array_keys($this->attributes),$this->options['only']);
+			$this->attributes = array_diff_key($this->attributes,array_flip($exclude));
+		}
+	}
+
+	private function check_except()
+	{
+		if (isset($this->options['except']) && !isset($this->options['only']))
+		{
+			$this->options_to_a('except');
+			$this->attributes = array_diff_key($this->attributes,array_flip($this->options['except']));
+		}
+	}
+
+	private function check_methods()
+	{
+		if (isset($this->options['methods']))
+		{
+			$this->options_to_a('methods');
+
+			foreach ($this->options['methods'] as $method)
+			{
+				if (method_exists($this->model, $method))
+					$this->attributes[$method] = $this->model->$method();
+			}
+		}
+	}
+
+	private function check_include()
+	{
+		if (isset($this->options['include']))
+		{
+			$this->options_to_a('include');
+
+			$serializer_class = get_class($this);
+
+			foreach ($this->options['include'] as $association => $options)
+			{
+				if (!is_array($options))
+				{
+					$association = $options;
+					$options = array();
+				}
+
+				try {
+					$assoc = $this->model->$association;
+
+					if (!is_array($assoc))
+					{
+						$serialized = new $serializer_class($assoc, $options);
+						$this->attributes[$association] = $serialized->to_a();;
+					}
+					else
+					{
+						$includes = array();
+
+						foreach ($assoc as $a)
+						{
+							$serialized = new $serializer_class($a, $options);
+
+							if ($this->includes_with_class_name_element)
+								$includes[strtolower(get_class($a))][] = $serialized->to_a();
+							else
+								$includes[] = $serialized->to_a();
+						}
+
+						$this->attributes[$association] = $includes;
+					}
+
+				} catch (UndefinedPropertyException $e) {
+					;//move along
+				}
+			}
+		}
+	}
+
+	final protected function options_to_a($key)
+	{
+		if (!is_array($this->options[$key]))
+			$this->options[$key] = array($this->options[$key]);
+	}
+
+	/**
+	 * Returns the attributes array.
+	 * @return array
+	 */
+	final public function to_a()
+	{
+		$date_format = Config::instance()->get_date_format();
+
+		foreach ($this->attributes as &$value)
+		{
+			if ($value instanceof \DateTime)
+				$value = $value->format($date_format);
+		}
+		return $this->attributes;
+	}
+
+	/**
+	 * Returns the serialized object as a string.
+	 * @see to_s
+	 * @return string
+	 */
+	final public function __toString()
+	{
+		return $this->to_s();
+	}
+
+	/**
+	 * Performs the serialization.
+	 * @return string
+	 */
+	abstract public function to_s();
+};
+
+/**
+ * JSON serializer.
+ *
+ * @package ActiveRecord
+ */
+class JsonSerializer extends Serialization
+{
+	public static $include_root = false;
+
+	public function to_s()
+	{
+		return json_encode(self::$include_root ? array(strtolower(get_class($this->model)) => $this->to_a()) : $this->to_a());
+	}
+}
+
+/**
+ * XML serializer.
+ *
+ * @package ActiveRecord
+ */
+class XmlSerializer extends Serialization
+{
+	private $writer;
+
+	public function __construct(Model $model, &$options)
+	{
+		$this->includes_with_class_name_element = true;
+		parent::__construct($model,$options);
+	}
+
+	public function to_s()
+	{
+		return $this->xml_encode();
+	}
+
+	private function xml_encode()
+	{
+		$this->writer = new XmlWriter();
+		$this->writer->openMemory();
+		$this->writer->startDocument('1.0', 'UTF-8');
+		$this->writer->startElement(strtolower(denamespace(($this->model))));
+		$this->write($this->to_a());
+		$this->writer->endElement();
+		$this->writer->endDocument();
+		$xml = $this->writer->outputMemory(true);
+
+		if (@$this->options['skip_instruct'] == true)
+			$xml = preg_replace('/<\?xml version.*?\?>/','',$xml);
+
+		return $xml;
+	}
+
+	private function write($data, $tag=null)
+	{
+		foreach ($data as $attr => $value)
+		{
+			if ($tag != null)
+				$attr = $tag;
+
+			if (is_array($value) || is_object($value))
+			{
+				if (!is_int(key($value)))
+				{
+					$this->writer->startElement($attr);
+					$this->write($value);
+					$this->writer->endElement();
+				}
+				else
+					$this->write($value, $attr);
+
+				continue;
+			}
+
+			$this->writer->writeElement($attr, $value);
+		}
+	}
+}
+?>
diff --git a/lib/ActiveRecord/Singleton.php b/lib/ActiveRecord/Singleton.php
new file mode 100644
index 0000000..c652927
--- /dev/null
+++ b/lib/ActiveRecord/Singleton.php
@@ -0,0 +1,57 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * This implementation of the singleton pattern does not conform to the strong definition
+ * given by the "Gang of Four." The __construct() method has not be privatized so that
+ * a singleton pattern is capable of being achieved; however, multiple instantiations are also
+ * possible. This allows the user more freedom with this pattern.
+ *
+ * @package ActiveRecord
+ */
+abstract class Singleton
+{
+	/**
+	 * Array of cached singleton objects.
+	 *
+	 * @var array
+	 */
+	private static $instances = array();
+
+	/**
+	 * Static method for instantiating a singleton object.
+	 *
+	 * @return object
+	 */
+	final public static function instance()
+	{
+		$class_name = get_called_class();
+
+		if (!isset(self::$instances[$class_name]))
+			self::$instances[$class_name] = new $class_name;
+
+		return self::$instances[$class_name];
+	}
+
+	/**
+	 * Singleton objects should not be cloned.
+	 *
+	 * @return void
+	 */
+	final private function __clone() {}
+
+	/**
+	 * Similar to a get_called_class() for a child class to invoke.
+	 *
+	 * @return string
+	 */
+	final protected function get_called_class()
+	{
+		$backtrace = debug_backtrace();
+    	return get_class($backtrace[2]['object']);
+	}
+}
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Table.php b/lib/ActiveRecord/Table.php
new file mode 100644
index 0000000..30c78a4
--- /dev/null
+++ b/lib/ActiveRecord/Table.php
@@ -0,0 +1,547 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Manages reading and writing to a database table.
+ *
+ * This class manages a database table and is used by the Model class for
+ * reading and writing to its database table. There is one instance of Table
+ * for every table you have a model for.
+ *
+ * @package ActiveRecord
+ */
+class Table
+{
+	private static $cache = array();
+
+	public $class;
+	public $conn;
+	public $pk;
+	public $last_sql;
+
+	// Name/value pairs of columns in this table
+	public $columns = array();
+
+	/**
+	 * Name of the table.
+	 */
+	public $table;
+
+	/**
+	 * Name of the database (optional)
+	 */
+	public $db_name;
+
+	/**
+	 * Name of the sequence for this table (optional). Defaults to {$table}_seq
+	 */
+	public $sequence;
+
+	/**
+	 * A instance of CallBack for this model/table
+	 * @static
+	 * @var object ActiveRecord\CallBack
+	 */
+	public $callback;
+
+	/**
+	 * List of relationships for this table.
+	 */
+	private $relationships = array();
+
+	public static function load($model_class_name)
+	{
+		if (!isset(self::$cache[$model_class_name]))
+		{
+			/* do not place set_assoc in constructor..it will lead to infinite loop due to
+			   relationships requesting the model's table, but the cache hasn't been set yet */
+			self::$cache[$model_class_name] = new Table($model_class_name);
+			self::$cache[$model_class_name]->set_associations();
+		}
+
+		return self::$cache[$model_class_name];
+	}
+
+	public static function clear_cache($model_class_name=null)
+	{
+		if ($model_class_name && array_key_exists($model_class_name,self::$cache))
+			unset(self::$cache[$model_class_name]);
+		else
+			self::$cache = array();
+	}
+
+	public function __construct($class_name)
+	{
+		$this->class = Reflections::instance()->add($class_name)->get($class_name);
+
+		// if connection name property is null the connection manager will use the default connection
+		$connection = $this->class->getStaticPropertyValue('connection',null);
+
+		$this->conn = ConnectionManager::get_connection($connection);
+		$this->set_table_name();
+		$this->get_meta_data();
+		$this->set_primary_key();
+		$this->set_sequence_name();
+		$this->set_delegates();
+		$this->set_setters_and_getters();
+
+		$this->callback = new CallBack($class_name);
+		$this->callback->register('before_save', function(Model $model) { $model->set_timestamps(); }, array('prepend' => true));
+		$this->callback->register('after_save', function(Model $model) { $model->reset_dirty(); }, array('prepend' => true));
+	}
+
+	public function create_joins($joins)
+	{
+		if (!is_array($joins))
+			return $joins;
+
+		$self = $this->table;
+		$ret = $space = '';
+
+		$existing_tables = array();
+		foreach ($joins as $value)
+		{
+			$ret .= $space;
+
+			if (stripos($value,'JOIN ') === false)
+			{
+				if (array_key_exists($value, $this->relationships))
+				{
+					$rel = $this->get_relationship($value);
+
+					// if there is more than 1 join for a given table we need to alias the table names
+					if (array_key_exists($rel->class_name, $existing_tables))
+					{
+						$alias = $value;
+						$existing_tables[$rel->class_name]++;
+					}
+					else
+					{
+						$existing_tables[$rel->class_name] = true;
+						$alias = null;
+					}
+
+					$ret .= $rel->construct_inner_join_sql($this, false, $alias);
+				}
+				else
+					throw new RelationshipException("Relationship named $value has not been declared for class: {$this->class->getName()}");
+			}
+			else
+				$ret .= $value;
+
+			$space = ' ';
+		}
+		return $ret;
+	}
+
+	public function options_to_sql($options)
+	{
+		$table = array_key_exists('from', $options) ? $options['from'] : $this->get_fully_qualified_table_name();
+		$sql = new SQLBuilder($this->conn, $table);
+
+		if (array_key_exists('joins',$options))
+		{
+			$sql->joins($this->create_joins($options['joins']));
+
+			// by default, an inner join will not fetch the fields from the joined table
+			if (!array_key_exists('select', $options))
+				$options['select'] = $this->get_fully_qualified_table_name() . '.*';
+		}
+
+		if (array_key_exists('select',$options))
+			$sql->select($options['select']);
+
+		if (array_key_exists('conditions',$options))
+		{
+			if (!is_hash($options['conditions']))
+			{
+				if (is_string($options['conditions']))
+					$options['conditions'] = array($options['conditions']);
+
+				call_user_func_array(array($sql,'where'),$options['conditions']);
+			}
+			else
+			{
+				if (!empty($options['mapped_names']))
+					$options['conditions'] = $this->map_names($options['conditions'],$options['mapped_names']);
+
+				$sql->where($options['conditions']);
+			}
+		}
+
+		if (array_key_exists('order',$options))
+			$sql->order($options['order']);
+
+		if (array_key_exists('limit',$options))
+			$sql->limit($options['limit']);
+
+		if (array_key_exists('offset',$options))
+			$sql->offset($options['offset']);
+
+		if (array_key_exists('group',$options))
+			$sql->group($options['group']);
+
+		if (array_key_exists('having',$options))
+			$sql->having($options['having']);
+
+		return $sql;
+	}
+
+	public function find($options)
+	{
+		$sql = $this->options_to_sql($options);
+		$readonly = (array_key_exists('readonly',$options) && $options['readonly']) ? true : false;
+		$eager_load = array_key_exists('include',$options) ? $options['include'] : null;
+
+		return $this->find_by_sql($sql->to_s(),$sql->get_where_values(), $readonly, $eager_load);
+	}
+
+	public function find_by_sql($sql, $values=null, $readonly=false, $includes=null)
+	{
+		$this->last_sql = $sql;
+
+		$collect_attrs_for_includes = is_null($includes) ? false : true;
+		$list = $attrs = array();
+		$sth = $this->conn->query($sql,$this->process_data($values));
+
+		while (($row = $sth->fetch()))
+		{
+			$model = new $this->class->name($row,false,true,false);
+
+			if ($readonly)
+				$model->readonly();
+
+			if ($collect_attrs_for_includes)
+				$attrs[] = $model->attributes();
+
+			$list[] = $model;
+		}
+
+		if ($collect_attrs_for_includes && !empty($list))
+			$this->execute_eager_load($list, $attrs, $includes);
+
+		return $list;
+	}
+
+	/**
+	 * Executes an eager load of a given named relationship for this table.
+	 *
+	 * @param $models array found modesl for this table
+	 * @param $attrs array of attrs from $models
+	 * @param $includes array eager load directives
+	 * @return void
+	 */
+	private function execute_eager_load($models=array(), $attrs=array(), $includes=array())
+	{
+		if (!is_array($includes))
+			$includes = array($includes);
+
+		foreach ($includes as $index => $name)
+		{
+			// nested include
+			if (is_array($name))
+			{
+				$nested_includes = count($name) > 1 ? $name : $name[0];
+				$name = $index;
+			}
+			else
+				$nested_includes = array();
+
+			$rel = $this->get_relationship($name, true);
+			$rel->load_eagerly($models, $attrs, $nested_includes, $this);
+		}
+	}
+
+	public function get_column_by_inflected_name($inflected_name)
+	{
+		foreach ($this->columns as $raw_name => $column)
+		{
+			if ($column->inflected_name == $inflected_name)
+				return $column;
+		}
+		return null;
+	}
+
+	public function get_fully_qualified_table_name($quote_name=true)
+	{
+		$table = $quote_name ? $this->conn->quote_name($this->table) : $this->table;
+
+		if ($this->db_name)
+			$table = $this->conn->quote_name($this->db_name) . ".$table";
+
+		return $table;
+	}
+
+	/**
+	 * Retrieve a relationship object for this table. Strict as true will throw an error
+	 * if the relationship name does not exist.
+	 *
+	 * @param $name string name of Relationship
+	 * @param $strict bool
+	 * @throws RelationshipException
+	 * @return Relationship or null
+	 */
+	public function get_relationship($name, $strict=false)
+	{
+		if ($this->has_relationship($name))
+			return $this->relationships[$name];
+
+		if ($strict)
+			throw new RelationshipException("Relationship named $name has not been declared for class: {$this->class->getName()}");
+
+		return null;
+	}
+
+	/**
+	 * Does a given relationship exist?
+	 *
+	 * @param $name string name of Relationship
+	 * @return bool
+	 */
+	public function has_relationship($name)
+	{
+		return array_key_exists($name, $this->relationships);
+	}
+
+	public function insert(&$data, $pk=null, $sequence_name=null)
+	{
+		$data = $this->process_data($data);
+
+		$sql = new SQLBuilder($this->conn,$this->get_fully_qualified_table_name());
+		$sql->insert($data,$pk,$sequence_name);
+
+		$values = array_values($data);
+		return $this->conn->query(($this->last_sql = $sql->to_s()),$values);
+	}
+
+	public function update(&$data, $where)
+	{
+		$data = $this->process_data($data);
+
+		$sql = new SQLBuilder($this->conn,$this->get_fully_qualified_table_name());
+		$sql->update($data)->where($where);
+
+		$values = $sql->bind_values();
+		return $this->conn->query(($this->last_sql = $sql->to_s()),$values);
+	}
+
+	public function delete($data)
+	{
+		$data = $this->process_data($data);
+
+		$sql = new SQLBuilder($this->conn,$this->get_fully_qualified_table_name());
+		$sql->delete($data);
+
+		$values = $sql->bind_values();
+		return $this->conn->query(($this->last_sql = $sql->to_s()),$values);
+	}
+
+	/**
+	 * Add a relationship.
+	 *
+	 * @param Relationship $relationship a Relationship object
+	 */
+	private function add_relationship($relationship)
+	{
+		$this->relationships[$relationship->attribute_name] = $relationship;
+	}
+
+	private function get_meta_data()
+	{
+		// as more adapters are added probably want to do this a better way
+		// than using instanceof but gud enuff for now
+		$quote_name = !($this->conn instanceof PgsqlAdapter);
+
+		$this->columns = $this->conn->columns($this->get_fully_qualified_table_name($quote_name));
+	}
+
+	/**
+	 * Replaces any aliases used in a hash based condition.
+	 *
+	 * @param $hash array A hash
+	 * @param $map array Hash of used_name => real_name
+	 * @return array Array with any aliases replaced with their read field name
+	 */
+	private function map_names(&$hash, &$map)
+	{
+		$ret = array();
+
+		foreach ($hash as $name => &$value)
+		{
+			if (array_key_exists($name,$map))
+				$name = $map[$name];
+
+			$ret[$name] = $value;
+		}
+		return $ret;
+	}
+
+	private function &process_data($hash)
+	{
+		if (!$hash)
+			return $hash;
+
+		foreach ($hash as $name => &$value)
+		{
+			if ($value instanceof \DateTime)
+			{
+				if (isset($this->columns[$name]) && $this->columns[$name]->type == Column::DATE)
+					$hash[$name] = $this->conn->date_to_string($value);
+				else
+					$hash[$name] = $this->conn->datetime_to_string($value);
+			}
+			else
+				$hash[$name] = $value;
+		}
+		return $hash;
+	}
+
+	private function set_primary_key()
+	{
+		if (($pk = $this->class->getStaticPropertyValue('pk',null)) || ($pk = $this->class->getStaticPropertyValue('primary_key',null)))
+			$this->pk = is_array($pk) ? $pk : array($pk);
+		else
+		{
+			$this->pk = array();
+
+			foreach ($this->columns as $c)
+			{
+				if ($c->pk)
+					$this->pk[] = $c->inflected_name;
+			}
+		}
+	}
+
+	private function set_table_name()
+	{
+		if (($table = $this->class->getStaticPropertyValue('table',null)) || ($table = $this->class->getStaticPropertyValue('table_name',null)))
+			$this->table = $table;
+		else
+		{
+			// infer table name from the class name
+			$this->table = Inflector::instance()->tableize($this->class->getName());
+
+			// strip namespaces from the table name if any
+			$parts = explode('\\',$this->table);
+			$this->table = $parts[count($parts)-1];
+		}
+
+		if(($db = $this->class->getStaticPropertyValue('db',null)) || ($db = $this->class->getStaticPropertyValue('db_name',null)))
+			$this->db_name = $db;
+	}
+
+	private function set_sequence_name()
+	{
+		if (!$this->conn->supports_sequences())
+			return;
+
+		if (!($this->sequence = $this->class->getStaticPropertyValue('sequence')))
+			$this->sequence = $this->conn->get_sequence_name($this->table,$this->pk[0]);
+	}
+
+	private function set_associations()
+	{
+		require_once 'Relationship.php';
+
+		foreach ($this->class->getStaticProperties() as $name => $definitions)
+		{
+			if (!$definitions || !is_array($definitions))
+				continue;
+
+			foreach ($definitions as $definition)
+			{
+				$relationship = null;
+
+				switch ($name)
+				{
+					case 'has_many':
+						$relationship = new HasMany($definition);
+						break;
+
+					case 'has_one':
+						$relationship = new HasOne($definition);
+						break;
+
+					case 'belongs_to':
+						$relationship = new BelongsTo($definition);
+						break;
+
+					case 'has_and_belongs_to_many':
+						$relationship = new HasAndBelongsToMany($definition);
+						break;
+				}
+
+				if ($relationship)
+					$this->add_relationship($relationship);
+			}
+		}
+	}
+
+	/**
+	 * Rebuild the delegates array into format that we can more easily work with in Model.
+	 * Will end up consisting of array of:
+	 *
+	 * array('delegate' => array('field1','field2',...),
+	 *       'to'       => 'delegate_to_relationship',
+	 *       'prefix'	=> 'prefix')
+	 */
+	private function set_delegates()
+	{
+		$delegates = $this->class->getStaticPropertyValue('delegate',array());
+		$new = array();
+
+		if (!array_key_exists('processed', $delegates))
+			$delegates['processed'] = false;
+
+		if (!empty($delegates) && !$delegates['processed'])
+		{
+			foreach ($delegates as &$delegate)
+			{
+				if (!is_array($delegate) || !isset($delegate['to']))
+					continue;
+
+				if (!isset($delegate['prefix']))
+					$delegate['prefix'] = null;
+
+				$new_delegate = array(
+					'to'		=> $delegate['to'],
+					'prefix'	=> $delegate['prefix'],
+					'delegate'	=> array());
+
+				foreach ($delegate as $name => $value)
+				{
+					if (is_numeric($name))
+						$new_delegate['delegate'][] = $value;
+				}
+
+				$new[] = $new_delegate;
+			}
+
+			$new['processed'] = true;
+			$this->class->setStaticPropertyValue('delegate',$new);
+		}
+	}
+
+	/**
+	 * Builds the getters/setters array by prepending get_/set_ to the method names.
+	 */
+	private function set_setters_and_getters()
+	{
+		$build = array('setters', 'getters');
+
+		foreach ($build as $type)
+		{
+			$methods = array();
+			$prefix = substr($type,0,3) . "_";
+
+			foreach ($this->class->getStaticPropertyValue($type,array()) as $method)
+				$methods[] = (substr($method,0,4) != $prefix ? "{$prefix}$method" : $method);
+
+			$this->class->setStaticPropertyValue($type,$methods);
+		}
+	}
+};
+?>
diff --git a/lib/ActiveRecord/Utils.php b/lib/ActiveRecord/Utils.php
new file mode 100644
index 0000000..82a928a
--- /dev/null
+++ b/lib/ActiveRecord/Utils.php
@@ -0,0 +1,351 @@
+<?php
+/**
+ *
+ * @package ActiveRecord
+ */
+
+/*
+ * Thanks to http://www.eval.ca/articles/php-pluralize (MIT license)
+ *           http://dev.rubyonrails.org/browser/trunk/activesupport/lib/active_support/inflections.rb (MIT license)
+ *           http://www.fortunecity.com/bally/durrus/153/gramch13.html
+ *           http://www2.gsu.edu/~wwwesl/egw/crump.htm
+ *
+ * Changes (12/17/07)
+ *   Major changes
+ *   --
+ *   Fixed irregular noun algorithm to use regular expressions just like the original Ruby source.
+ *       (this allows for things like fireman -> firemen
+ *   Fixed the order of the singular array, which was backwards.
+ *
+ *   Minor changes
+ *   --
+ *   Removed incorrect pluralization rule for /([^aeiouy]|qu)ies$/ => $1y
+ *   Expanded on the list of exceptions for *o -> *oes, and removed rule for buffalo -> buffaloes
+ *   Removed dangerous singularization rule for /([^f])ves$/ => $1fe
+ *   Added more specific rules for singularizing lives, wives, knives, sheaves, loaves, and leaves and thieves
+ *   Added exception to /(us)es$/ => $1 rule for houses => house and blouses => blouse
+ *   Added excpetions for feet, geese and teeth
+ *   Added rule for deer -> deer
+ *
+ * Changes:
+ *   Removed rule for virus -> viri
+ *   Added rule for potato -> potatoes
+ *   Added rule for *us -> *uses
+ */
+namespace ActiveRecord;
+
+use \Closure;
+
+function classify($class_name, $singularize=false)
+{
+	if ($singularize)
+	{
+		$parts = explode('_',  Inflector::instance()->uncamelize($class_name));
+		$class_name = '';
+		foreach ($parts as $name)
+			$class_name .= '_' . Utils::singularize($name);
+
+		$class_name = ltrim($class_name, '_');
+	}
+
+	$class_name = Inflector::instance()->camelize($class_name);
+
+	return ucfirst($class_name);
+}
+
+// http://snippets.dzone.com/posts/show/4660
+function array_flatten(array $array)
+{
+	$i = 0;
+	$n = count($array);
+
+	while ($i < $n)
+	{
+		if (is_array($array[$i]))
+			array_splice($array,$i,1,$array[$i]);
+        else
+			++$i;
+
+		$n = count($array);
+    }
+    return $array;
+}
+
+/**
+ * Somewhat naive way to determine if an array is a hash.
+ */
+function is_hash(&$array)
+{
+	if (!is_array($array))
+		return false;
+
+	$keys = array_keys($array);
+	return @is_string($keys[0]) ? true : false;
+}
+
+/**
+ * Strips a class name of any namespaces and namespace operator.
+ *
+ * @param string $class
+ * @return string stripped class name
+ * @access public
+ */
+function denamespace($class_name)
+{
+	if (is_object($class_name))
+		$class_name = get_class($class_name);
+
+	if (has_namespace($class_name))
+	{
+		$parts = explode('\\', $class_name);
+		return end($parts);
+	}
+	return $class_name;
+}
+
+function get_namespaces($class_name)
+{
+	if (has_namespace($class_name))
+		return explode('\\', $class_name);
+	return null;
+}
+
+function has_namespace($class_name)
+{
+	if (strpos($class_name, '\\') !== false)
+		return true;
+	return false;
+}
+
+/**
+ * Returns true if all values in $haystack === $needle
+ * @param $needle
+ * @param $haystack
+ * @return unknown_type
+ */
+function all($needle, array $haystack)
+{
+	foreach ($haystack as $value)
+	{
+		if ($value !== $needle)
+			return false;
+	}
+	return true;
+}
+
+function collect(&$enumerable, $name_or_closure)
+{
+	$ret = array();
+
+	foreach ($enumerable as $value)
+	{
+		if (is_string($name_or_closure))
+			$ret[] = is_array($value) ? $value[$name_or_closure] : $value->$name_or_closure;
+		elseif ($name_or_closure instanceof Closure)
+			$ret[] = $name_or_closure($value);
+	}
+	return $ret;
+}
+
+/**
+ * Some internal utility functions.
+ *
+ * @package ActiveRecord
+ */
+class Utils
+{
+	public static function extract_options($options)
+	{
+		return is_array(end($options)) ? end($options) : array();
+	}
+
+	public static function add_condition(&$conditions=array(), $condition, $conjuction='AND')
+	{
+		if (is_array($condition))
+		{
+			if (empty($conditions))
+				$conditions = array_flatten($condition);
+			else
+			{
+				$conditions[0] .= " $conjuction " . array_shift($condition);
+				$conditions[] = array_flatten($condition);
+			}
+		}
+		elseif (is_string($condition))
+			$conditions[0] .= " $conjuction $condition";
+
+		return $conditions;
+	}
+
+	public static function human_attribute($attr)
+	{
+		$inflector = Inflector::instance();
+		$inflected = $inflector->variablize($attr);
+		$normal = $inflector->uncamelize($inflected);
+
+		return ucfirst(str_replace('_', ' ', $normal));
+	}
+
+	public static function is_odd($number)
+	{
+		return $number & 1;
+	}
+
+	public static function is_a($type, $var)
+	{
+		switch($type)
+		{
+			case 'range':
+				if (is_array($var) && (int)$var[0] < (int)$var[1])
+					return true;
+
+		}
+
+		return false;
+	}
+
+	public static function is_blank($var)
+	{
+		return 0 === strlen($var);
+	}
+
+	private static $plural = array(
+        '/(quiz)$/i'               => "$1zes",
+        '/^(ox)$/i'                => "$1en",
+        '/([m|l])ouse$/i'          => "$1ice",
+        '/(matr|vert|ind)ix|ex$/i' => "$1ices",
+        '/(x|ch|ss|sh)$/i'         => "$1es",
+        '/([^aeiouy]|qu)y$/i'      => "$1ies",
+        '/(hive)$/i'               => "$1s",
+        '/(?:([^f])fe|([lr])f)$/i' => "$1$2ves",
+        '/(shea|lea|loa|thie)f$/i' => "$1ves",
+        '/sis$/i'                  => "ses",
+        '/([ti])um$/i'             => "$1a",
+        '/(tomat|potat|ech|her|vet)o$/i'=> "$1oes",
+        '/(bu)s$/i'                => "$1ses",
+        '/(alias)$/i'              => "$1es",
+        '/(octop)us$/i'            => "$1i",
+        '/(ax|test)is$/i'          => "$1es",
+        '/(us)$/i'                 => "$1es",
+        '/s$/i'                    => "s",
+        '/$/'                      => "s"
+    );
+
+    private static $singular = array(
+        '/(quiz)zes$/i'             => "$1",
+        '/(matr)ices$/i'            => "$1ix",
+        '/(vert|ind)ices$/i'        => "$1ex",
+        '/^(ox)en$/i'               => "$1",
+        '/(alias)es$/i'             => "$1",
+        '/(octop|vir)i$/i'          => "$1us",
+        '/(cris|ax|test)es$/i'      => "$1is",
+        '/(shoe)s$/i'               => "$1",
+        '/(o)es$/i'                 => "$1",
+        '/(bus)es$/i'               => "$1",
+        '/([m|l])ice$/i'            => "$1ouse",
+        '/(x|ch|ss|sh)es$/i'        => "$1",
+        '/(m)ovies$/i'              => "$1ovie",
+        '/(s)eries$/i'              => "$1eries",
+        '/([^aeiouy]|qu)ies$/i'     => "$1y",
+        '/([lr])ves$/i'             => "$1f",
+        '/(tive)s$/i'               => "$1",
+        '/(hive)s$/i'               => "$1",
+        '/(li|wi|kni)ves$/i'        => "$1fe",
+        '/(shea|loa|lea|thie)ves$/i'=> "$1f",
+        '/(^analy)ses$/i'           => "$1sis",
+        '/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i'  => "$1$2sis",
+        '/([ti])a$/i'               => "$1um",
+        '/(n)ews$/i'                => "$1ews",
+        '/(h|bl)ouses$/i'           => "$1ouse",
+        '/(corpse)s$/i'             => "$1",
+        '/(us)es$/i'                => "$1",
+        '/s$/i'                     => ""
+    );
+
+    private static $irregular = array(
+        'move'   => 'moves',
+        'foot'   => 'feet',
+        'goose'  => 'geese',
+        'sex'    => 'sexes',
+        'child'  => 'children',
+        'man'    => 'men',
+        'tooth'  => 'teeth',
+        'person' => 'people'
+    );
+
+    private static $uncountable = array(
+        'sheep',
+        'fish',
+        'deer',
+        'series',
+        'species',
+        'money',
+        'rice',
+        'information',
+        'equipment'
+    );
+
+    public static function pluralize( $string )
+    {
+        // save some time in the case that singular and plural are the same
+        if ( in_array( strtolower( $string ), self::$uncountable ) )
+            return $string;
+
+        // check for irregular singular forms
+        foreach ( self::$irregular as $pattern => $result )
+        {
+            $pattern = '/' . $pattern . '$/i';
+
+            if ( preg_match( $pattern, $string ) )
+                return preg_replace( $pattern, $result, $string);
+        }
+
+        // check for matches using regular expressions
+        foreach ( self::$plural as $pattern => $result )
+        {
+            if ( preg_match( $pattern, $string ) )
+                return preg_replace( $pattern, $result, $string );
+        }
+
+        return $string;
+    }
+
+    public static function singularize( $string )
+    {
+        // save some time in the case that singular and plural are the same
+        if ( in_array( strtolower( $string ), self::$uncountable ) )
+            return $string;
+
+        // check for irregular plural forms
+        foreach ( self::$irregular as $result => $pattern )
+        {
+            $pattern = '/' . $pattern . '$/i';
+
+            if ( preg_match( $pattern, $string ) )
+                return preg_replace( $pattern, $result, $string);
+        }
+
+        // check for matches using regular expressions
+        foreach ( self::$singular as $pattern => $result )
+        {
+            if ( preg_match( $pattern, $string ) )
+                return preg_replace( $pattern, $result, $string );
+        }
+
+        return $string;
+    }
+
+    public static function pluralize_if($count, $string)
+    {
+        if ($count == 1)
+            return $string;
+        else
+            return self::pluralize($string);
+    }
+
+	public static function squeeze($char, $string)
+	{
+		return preg_replace("/$char+/",$char,$string);
+	}
+};
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/Validations.php b/lib/ActiveRecord/Validations.php
new file mode 100644
index 0000000..7ddb81c
--- /dev/null
+++ b/lib/ActiveRecord/Validations.php
@@ -0,0 +1,833 @@
+<?php
+/**
+ * These two classes have been <i>heavily borrowed</i> from Ruby on Rails' ActiveRecord so much that
+ * this piece can be considered a straight port. The reason for this is that the vaildation process is
+ * tricky due to order of operations/events. The former combined with PHP's odd typecasting means
+ * that it was easier to formulate this piece base on the rails code.
+ *
+ * @package ActiveRecord
+ */
+
+namespace ActiveRecord;
+use ActiveRecord\Model;
+use IteratorAggregate;
+use ArrayIterator;
+
+/**
+ * Manages validations for a {@link Model}.
+ *
+ * This class isn't meant to be directly used. Instead you define
+ * validators thru static variables in your {@link Model}. Example:
+ *
+ * <code>
+ * class Person extends ActiveRecord\Model {
+ *   static $validates_length_of = array(
+ *     array('name', 'within' => array(30,100),
+ *     array('state', 'is' => 2)
+ *   );
+ * }
+ *
+ * $person = new Person();
+ * $person->name = 'Tito';
+ * $person->state = 'this is not two characters';
+ *
+ * if (!$person->is_valid())
+ *   print_r($person->errors);
+ * </code>
+ *
+ * @package ActiveRecord
+ * @see Errors
+ * @link http://www.phpactiverecord.org/guides/validations
+ */
+class Validations
+{
+	private $model;
+	private $options = array();
+	private $validators = array();
+	private $record;
+
+	private static $VALIDATION_FUNCTIONS = array(
+		'validates_presence_of',
+		'validates_size_of',
+		'validates_length_of',
+		'validates_inclusion_of',
+		'validates_exclusion_of',
+		'validates_format_of',
+		'validates_numericality_of',
+		'validates_uniqueness_of'
+	);
+
+	private static $DEFAULT_VALIDATION_OPTIONS = array(
+		'on' => 'save',
+		'allow_null' => false,
+		'allow_blank' => false,
+		'message' => null,
+	);
+
+	private static  $ALL_RANGE_OPTIONS = array(
+		'is' => null,
+		'within' => null,
+		'in' => null,
+		'minimum' => null,
+		'maximum' => null,
+	);
+
+	private static $ALL_NUMERICALITY_CHECKS = array(
+		'greater_than' => null,
+		'greater_than_or_equal_to'  => null,
+		'equal_to' => null,
+		'less_than' => null,
+		'less_than_or_equal_to' => null,
+		'odd' => null,
+		'even' => null
+	);
+
+	/**
+	 * Constructs a {@link Validations} object.
+	 *
+	 * @param Model $model The model to validate
+	 * @return Validations
+	 */
+	public function __construct(Model $model)
+	{
+		$this->model = $model;
+		$this->record = new Errors($this->model);
+		$this->validators = array_intersect(array_keys(Reflections::instance()->get(get_class($this->model))->getStaticProperties()), self::$VALIDATION_FUNCTIONS);
+	}
+
+	/**
+	 * Returns validator data.
+	 *
+	 * @return array
+	 */
+	public function rules()
+	{
+		$data = array();
+		$reflection = Reflections::instance()->get(get_class($this->model));
+
+		foreach ($this->validators as $validate)
+		{
+			$attrs = $reflection->getStaticPropertyValue($validate);
+
+			foreach ($attrs as $attr)
+			{
+				$field = $attr[0];
+
+				if (!isset($data[$field]) || !is_array($data[$field]))
+					$data[$field] = array();
+
+				$attr['validator'] = $validate;
+				unset($attr[0]);
+				array_push($data[$field],$attr);
+			}
+		}
+		return $data;
+	}
+
+	/**
+	 * Runs the validators.
+	 *
+	 * @return Errors the validation errors if any
+	 */
+	public function validate()
+	{
+		$reflection = Reflections::instance()->get(get_class($this->model));
+
+		foreach ($this->validators as $validate)
+			$this->$validate($reflection->getStaticPropertyValue($validate));
+
+		$this->record->clear_model();
+		return $this->record;
+	}
+
+	/**
+	 * Validates a field is not null and not blank.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $validates_presence_of = array(
+	 *     array('first_name'),
+	 *     array('last_name')
+	 *   );
+	 * }
+	 * </code>
+	 *
+	 * Available options:
+	 *
+	 * <ul>
+	 * <li><b>message:</b> custom error message</li>
+	 * </ul>
+	 *
+	 * @param array $attrs Validation definition
+	 */
+	public function validates_presence_of($attrs)
+	{
+		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('message' => Errors::$DEFAULT_ERROR_MESSAGES['blank'], 'on' => 'save'));
+
+		foreach ($attrs as $attr)
+		{
+			$options = array_merge($configuration, $attr);
+			$this->record->add_on_blank($options[0], $options['message']);
+		}
+	}
+
+	/**
+	 * Validates that a value is included the specified array.
+	 *
+	 * <code>
+	 * class Car extends ActiveRecord\Model {
+	 *   static $validates_inclusion_of = array(
+	 *     array('fuel_type', 'in' => array('hyrdogen', 'petroleum', 'electric')),
+	 *   );
+	 * }
+	 * </code>
+	 *
+	 * Available options:
+	 *
+	 * <ul>
+	 * <li><b>in/within:</b> attribute should/shouldn't be a value within an array</li>
+	 * <li><b>message:</b> custome error message</li>
+	 * </ul>
+	 *
+	 * @param array $attrs Validation definition
+	 */
+	public function validates_inclusion_of($attrs)
+	{
+		$this->validates_inclusion_or_exclusion_of('inclusion', $attrs);
+	}
+
+	/**
+	 * This is the opposite of {@link validates_include_of}.
+	 *
+	 * @param array $attrs Validation definition
+	 * @see validates_inclusion_of
+	 */
+	public function validates_exclusion_of($attrs)
+	{
+		$this->validates_inclusion_or_exclusion_of('exclusion', $attrs);
+	}
+
+	/**
+	 * Validates that a value is in or out of a specified list of values.
+	 *
+	 * @see validates_inclusion_of
+	 * @see validates_exclusion_of
+	 * @param string $type Either inclusion or exclusion
+	 * @param $attrs Validation definition
+	 */
+	public function validates_inclusion_or_exclusion_of($type, $attrs)
+	{
+		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('message' => Errors::$DEFAULT_ERROR_MESSAGES[$type], 'on' => 'save'));
+
+		foreach ($attrs as $attr)
+		{
+			$options = array_merge($configuration, $attr);
+			$attribute = $options[0];
+			$var = $this->model->$attribute;
+
+			if (isset($options['in']))
+				$enum = $options['in'];
+			elseif (isset($options['within']))
+				$enum = $options['within'];
+
+			if (!is_array($enum))
+				array($enum);
+
+			$message = str_replace('%s', $var, $options['message']);
+
+			if ($this->is_null_with_option($var, $options) || $this->is_blank_with_option($var, $options))
+				continue;
+
+			if (('inclusion' == $type && !in_array($var, $enum)) || ('exclusion' == $type && in_array($var, $enum)))
+				$this->record->add($attribute, $message);
+		}
+	}
+
+	/**
+	 * Validates that a value is numeric.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $validates_numericality_of = array(
+	 *     array('salary', 'greater_than' => 19.99, 'less_than' => 99.99)
+	 *   );
+	 * }
+	 * </code>
+	 *
+	 * Available options:
+	 *
+	 * <ul>
+	 * <li><b>only_integer:</b> value must be an integer (e.g. not a float)</li>
+	 * <li><b>even:</b> must be even</li>
+	 * <li><b>odd:</b> must be odd"</li>
+	 * <li><b>greater_than:</b> must be greater than specified number</li>
+	 * <li><b>greater_than_or_equal_to:</b> must be greater than or equal to specified number</li>
+	 * <li><b>equal_to:</b> ...</li>
+	 * <li><b>less_than:</b> ...</li>
+	 * <li><b>less_than_or_equal_to:</b> ...</li>
+	 * </ul>
+	 *
+	 * @param array $attrs Validation definition
+	 */
+	public function validates_numericality_of($attrs)
+	{
+		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('only_integer' => false));
+
+		// Notice that for fixnum and float columns empty strings are converted to nil.
+		// Validates whether the value of the specified attribute is numeric by trying to convert it to a float with Kernel.Float
+		// (if only_integer is false) or applying it to the regular expression /\A[+\-]?\d+\Z/ (if only_integer is set to true).
+		foreach ($attrs as $attr)
+		{
+			$options = array_merge($configuration, $attr);
+			$attribute = $options[0];
+			$var = $this->model->$attribute;
+
+			$numericalityOptions = array_intersect_key(self::$ALL_NUMERICALITY_CHECKS, $options);
+
+			if ($this->is_null_with_option($var, $options))
+				continue;
+
+			if (true === $options['only_integer'] && !is_integer($var))
+			{
+				if (!preg_match('/\A[+-]?\d+\Z/', (string)($var)))
+				{
+					if (isset($options['message']))
+						$message = $options['message'];
+					else
+						$message = Errors::$DEFAULT_ERROR_MESSAGES['not_a_number'];
+
+					$this->record->add($attribute, $message);
+					continue;
+				}
+			}
+			else
+			{
+				if (!is_numeric($var))
+				{
+					$this->record->add($attribute, Errors::$DEFAULT_ERROR_MESSAGES['not_a_number']);
+					continue;
+				}
+
+				$var = (float)$var;
+			}
+
+			foreach ($numericalityOptions as $option => $check)
+			{
+				$option_value = $options[$option];
+
+				if ('odd' != $option && 'even' != $option)
+				{
+					$option_value = (float)$options[$option];
+
+					if (!is_numeric($option_value))
+						throw new  ValidationsArgumentError("$option must be a number");
+
+					if (isset($options['message']))
+						$message = $options['message'];
+					else
+						$message = Errors::$DEFAULT_ERROR_MESSAGES[$option];
+
+					$message = str_replace('%d', $option_value, $message);
+
+					if ('greater_than' == $option && !($var > $option_value))
+						$this->record->add($attribute, $message);
+
+					elseif ('greater_than_or_equal_to' == $option && !($var >= $option_value))
+						$this->record->add($attribute, $message);
+
+					elseif ('equal_to' == $option && !($var == $option_value))
+						$this->record->add($attribute, $message);
+
+					elseif ('less_than' == $option && !($var < $option_value))
+						$this->record->add($attribute, $message);
+
+					elseif ('less_than_or_equal_to' == $option && !($var <= $option_value))
+						$this->record->add($attribute, $message);
+				}
+				else
+				{
+					if (isset($options['message']))
+						$message = $options['message'];
+					else
+						$message = Errors::$DEFAULT_ERROR_MESSAGES[$option];
+
+					if ( ('odd' == $option && !( Utils::is_odd($var))) || ('even' == $option && ( Utils::is_odd($var))))
+						$this->record->add($attribute, $message);
+				}
+			}
+		}
+	}
+
+	/**
+	 * Alias of {@link validates_length_of}
+	 *
+	 * @param array $attrs Validation definition
+	 */
+	public function validates_size_of($attrs)
+	{
+		$this->validates_length_of($attrs);
+	}
+
+	/**
+	 * Validates that a value is matches a regex.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $validates_format_of = array(
+	 *     array('email', 'with' => '/^.*?@.*$/')
+	 *   );
+	 * }
+	 * </code>
+	 *
+	 * Available options:
+	 *
+	 * <ul>
+	 * <li><b>with:</b> a regular expression</li>
+	 * <li><b>message:</b> custom error message</li>
+	 * </ul>
+	 *
+	 * @param array $attrs Validation definition
+	 */
+	public function validates_format_of($attrs)
+	{
+		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('message' => Errors::$DEFAULT_ERROR_MESSAGES['invalid'], 'on' => 'save', 'with' => null));
+
+		foreach ($attrs as $attr)
+		{
+			$options = array_merge($configuration, $attr);
+			$attribute = $options[0];
+			$var = $this->model->$attribute;
+
+			if (is_null($options['with']) || !is_string($options['with']) || !is_string($options['with']))
+				throw new ValidationsArgumentError('A regular expression must be supplied as the [with] option of the configuration array.');
+			else
+				$expression = $options['with'];
+
+			if ($this->is_null_with_option($var, $options) || $this->is_blank_with_option($var, $options))
+				continue;
+
+			if (!@preg_match($expression, $var))
+			$this->record->add($attribute, $options['message']);
+		}
+	}
+
+	/**
+	 * Validates the length of a value.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $validates_length_of = array(
+	 *     array('name', 'within' => array(1,50))
+	 *   );
+	 * }
+	 * </code>
+	 *
+	 * Available options:
+	 *
+	 * <ul>
+	 * <li><b>is:</b> attribute should be exactly n characters long</li>
+	 * <li><b>in/within:</b> attribute should be within an range array(min,max)</li>
+	 * <li><b>maximum/minimum:</b> attribute should not be above/below respectively</li>
+	 * </ul>
+	 *
+	 * @param array $attrs Validation definition
+	 */
+	public function validates_length_of($attrs)
+	{
+		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array(
+			'too_long'     => Errors::$DEFAULT_ERROR_MESSAGES['too_long'],
+			'too_short'    => Errors::$DEFAULT_ERROR_MESSAGES['too_short'],
+			'wrong_length' => Errors::$DEFAULT_ERROR_MESSAGES['wrong_length']
+		));
+
+		foreach ($attrs as $attr)
+		{
+			$options = array_merge($configuration, $attr);
+			$range_options = array_intersect(array_keys(self::$ALL_RANGE_OPTIONS), array_keys($attr));
+			sort($range_options);
+
+			switch (sizeof($range_options))
+			{
+				case 0:
+					throw new  ValidationsArgumentError('Range unspecified.  Specify the [within], [maximum], or [is] option.');
+
+				case 1:
+					break;
+
+				default:
+					throw new  ValidationsArgumentError('Too many range options specified.  Choose only one.');
+			}
+
+			$attribute = $options[0];
+			$var = $this->model->$attribute;
+			$range_option = $range_options[0];
+
+			if ($this->is_null_with_option($var, $options) || $this->is_blank_with_option($var, $options))
+				continue;
+
+			if ('within' == $range_option || 'in' == $range_option)
+			{
+				$range = $options[$range_options[0]];
+
+				if (!(Utils::is_a('range', $range)))
+					throw new  ValidationsArgumentError("$range_option must be an array composing a range of numbers with key [0] being less than key [1]");
+
+				if (is_float($range[0]) || is_float($range[1]))
+					throw new  ValidationsArgumentError("Range values cannot use floats for length.");
+
+				if ((int)$range[0] <= 0 || (int)$range[1] <= 0)
+					throw new  ValidationsArgumentError("Range values cannot use signed integers.");
+
+				$too_short = isset($options['message']) ? $options['message'] : $options['too_short'];
+				$too_long =  isset($options['message']) ? $options['message'] : $options['too_long'];
+
+				$too_short = str_replace('%d', $range[0], $too_short);
+				$too_long = str_replace('%d', $range[1], $too_long);
+
+				if (strlen($this->model->$attribute) < (int)$range[0])
+					$this->record->add($attribute, $too_short);
+				elseif (strlen($this->model->$attribute) > (int)$range[1])
+					$this->record->add($attribute, $too_long);
+			}
+
+			elseif ('is' == $range_option || 'minimum' == $range_option || 'maximum' == $range_option)
+			{
+				$option = $options[$range_option];
+
+				if ((int)$option <= 0)
+					throw new  ValidationsArgumentError("$range_option value cannot use a signed integer.");
+
+				if (is_float($option))
+					throw new  ValidationsArgumentError("$range_option value cannot use a float for length.");
+
+				if (!is_null($this->model->$attribute))
+				{
+					$messageOptions = array('is' => 'wrong_length', 'minimum' => 'too_short', 'maximum' => 'too_long');
+
+					if (isset($options[$messageOptions[$range_option]]))
+						$message = $options[$messageOptions[$range_option]];
+					else
+						$message = $options['message'];
+
+					$message = str_replace('%d', $option, $message);
+					$attribute_value = $this->model->$attribute;
+					$len = strlen($attribute_value);
+					$value = (int)$attr[$range_option];
+
+					if ('maximum' == $range_option && $len > $value)
+						$this->record->add($attribute, $message);
+
+					if ('minimum' == $range_option && $len < $value)
+						$this->record->add($attribute, $message);
+
+					if ('is' == $range_option && $len !== $value)
+						$this->record->add($attribute, $message);
+				}
+			}
+		}
+	}
+
+	/**
+	 * Validates the uniqueness of a value.
+	 *
+	 * <code>
+	 * class Person extends ActiveRecord\Model {
+	 *   static $validates_uniqueness_of = array(
+	 *     array('name'),
+	 *     array(array('blah','bleh'), 'message' => 'blech')
+	 *   );
+	 * }
+	 * </code>
+	 *
+	 * @param array $attrs Validation definition
+	 */
+	public function validates_uniqueness_of($attrs)
+	{
+		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array(
+			'message' => Errors::$DEFAULT_ERROR_MESSAGES['unique']
+		));
+
+		foreach ($attrs as $attr)
+		{
+			$options = array_merge($configuration, $attr);
+			$pk = $this->model->get_primary_key();
+			$pk_value = $this->model->$pk[0];
+
+			if (is_array($options[0]))
+			{
+				$add_record = join("_and_", $options[0]);
+				$fields = $options[0];
+			}
+			else
+			{
+				$add_record = $options[0];
+				$fields = array($options[0]);
+			}
+
+			$sql = "";
+			$conditions = array("");
+
+			if ($pk_value === null)
+				$sql = "{$pk[0]} is not null";
+			else
+			{
+				$sql = "{$pk[0]}!=?";
+				array_push($conditions,$pk_value);
+			}
+
+			foreach ($fields as $field)
+			{
+				$field = $this->model->get_real_attribute_name($field);
+				$sql .= " and {$field}=?";
+				array_push($conditions,$this->model->$field);
+			}
+
+			$conditions[0] = $sql;
+
+			if ($this->model->exists(array('conditions' => $conditions)))
+				$this->record->add($add_record, $options['message']);
+		}
+	}
+
+	private function is_null_with_option($var, &$options)
+	{
+		return (is_null($var) && (isset($options['allow_null']) && $options['allow_null']));
+	}
+
+	private function is_blank_with_option($var, &$options)
+	{
+		return (Utils::is_blank($var) && (isset($options['allow_blank']) && $options['allow_blank']));
+	}
+}
+
+/**
+ * Class that holds {@link Validations} errors.
+ *
+ * @package ActiveRecord
+ */
+class Errors implements IteratorAggregate
+{
+	private $model;
+	private $errors;
+
+	public static $DEFAULT_ERROR_MESSAGES = array(
+   		'inclusion'		=> "is not included in the list",
+     	'exclusion'		=> "is reserved",
+      	'invalid'		=> "is invalid",
+      	'confirmation'	=> "doesn't match confirmation",
+      	'accepted'		=> "must be accepted",
+      	'empty'			=> "can't be empty",
+      	'blank'			=> "can't be blank",
+      	'too_long'		=> "is too long (maximum is %d characters)",
+      	'too_short'		=> "is too short (minimum is %d characters)",
+      	'wrong_length'	=> "is the wrong length (should be %d characters)",
+      	'taken'			=> "has already been taken",
+      	'not_a_number'	=> "is not a number",
+      	'greater_than'	=> "must be greater than %d",
+      	'equal_to'		=> "must be equal to %d",
+      	'less_than'		=> "must be less than %d",
+      	'odd'			=> "must be odd",
+      	'even'			=> "must be even",
+		'unique'		=> "must be unique",
+      	'less_than_or_equal_to' => "must be less than or equal to %d",
+      	'greater_than_or_equal_to' => "must be greater than or equal to %d"
+   	);
+
+   	/**
+	 * Constructs an {@link Errors} object.
+	 *
+	 * @param Model $model The model the error is for
+	 * @return Errors
+   	 */
+	public function __construct(Model $model)
+	{
+		$this->model = $model;
+	}
+
+	/**
+	 * Nulls $model so we don't get pesky circular references. $model is only needed during the
+	 * validation process and so can be safely cleared once that is done.
+	 */
+	public function clear_model()
+	{
+		$this->model = null;
+	}
+
+	/**
+	 * Add an error message.
+	 *
+	 * @param string $attribute Name of an attribute on the model
+	 * @param string $msg The error message
+	 */
+	public function add($attribute, $msg)
+	{
+		if (is_null($msg))
+			$msg = self :: $DEFAULT_ERROR_MESSAGES['invalid'];
+
+		if (!isset($this->errors[$attribute]))
+			$this->errors[$attribute] = array($msg);
+		else
+			$this->errors[$attribute][] = $msg;
+	}
+
+	/**
+	 * Adds an error message only if the attribute value is {@link http://www.php.net/empty empty}.
+	 *
+	 * @param string $attribute Name of an attribute on the model
+	 * @param string $msg The error message
+	 */
+	public function add_on_empty($attribute, $msg)
+	{
+		if (empty($msg))
+			$msg = self::$DEFAULT_ERROR_MESSAGES['empty'];
+
+		if (empty($this->model->$attribute))
+			$this->add($attribute, $msg);
+	}
+
+	/**
+	 * Retrieve error message for an attribute.
+	 *
+	 * @param string $attribute Name of an attribute on the model
+	 * @return string
+	 */
+	public function __get($attribute)
+	{
+		if (!isset($this->errors[$attribute]))
+			return null;
+
+		return $this->errors[$attribute];
+	}
+
+	/**
+	 * Adds the error message only if the attribute value was null or an empty string.
+	 *
+	 * @param string $attribute Name of an attribute on the model
+	 * @param string $msg The error message
+	 */
+	public function add_on_blank($attribute, $msg)
+	{
+		if (!$msg)
+			$msg = self::$DEFAULT_ERROR_MESSAGES['blank'];
+
+		if (($value = $this->model->$attribute) === '' || $value === null)
+			$this->add($attribute, $msg);
+	}
+
+	/**
+	 * Returns true if the specified attribute had any error messages.
+	 *
+	 * @param string $attribute Name of an attribute on the model
+	 * @return boolean
+	 */
+	public function is_invalid($attribute)
+	{
+		return isset($this->errors[$attribute]);
+	}
+
+	/**
+	 * Returns the error message for the specified attribute or null if none.
+	 *
+	 * @param string $attribute Name of an attribute on the model
+	 * @return string
+	 */
+	public function on($attribute)
+	{
+		if (!isset($this->errors[$attribute]))
+			return null;
+
+		$errors = $this->errors[$attribute];
+
+		if (null === $errors)
+			return null;
+		else
+			return count($errors) == 1 ? $errors[0] : $errors;
+	}
+
+	/**
+	 * Returns all the error messages as an array.
+	 *
+	 * <code>
+	 * $model->errors->full_messages();
+	 *
+	 * # array(
+	 * #  "Name can't be blank",
+	 * #  "State is the wrong length (should be 2 chars)"
+	 * # )
+	 * </code>
+	 *
+	 * @param array $options Options for messages
+	 * @return array
+	 */
+	public function full_messages()
+	{
+		$full_messages = array();
+
+		if ($this->errors)
+		{
+			foreach ($this->errors as $attribute => $messages)
+			{
+				foreach ($messages as $msg)
+				{
+					if (is_null($msg))
+						continue;
+
+					$full_messages[] = Utils::human_attribute($attribute) . ' ' . $msg;
+				}
+			}
+		}
+		return $full_messages;
+	}
+
+	/**
+	 * Returns true if there are no error messages.
+	 * @return boolean
+	 */
+	public function is_empty()
+	{
+		return empty($this->errors);
+	}
+
+	/**
+	 * Clears out all error messages.
+	 */
+	public function clear()
+	{
+		$this->errors = array();
+	}
+
+	/**
+	 * Returns the number of error messages there are.
+	 * @return int
+	 */
+	public function size()
+	{
+		if ($this->is_empty())
+			return 0;
+
+		$count = 0;
+
+		foreach ($this->errors as $attribute => $error)
+			$count += count($error);
+
+		return $count;
+	}
+
+	/**
+	 * Returns an iterator to the error messages.
+	 *
+	 * This will allow you to iterate over the {@link Errors} object using foreach.
+	 *
+	 * <code>
+	 * foreach ($model->errors as $msg)
+	 *   echo "$msg\n";
+	 * </code>
+	 *
+	 * @return ArrayIterator
+	 */
+	public function getIterator()
+	{
+		return new ArrayIterator($this->full_messages());
+	}
+};
+?>
diff --git a/lib/ActiveRecord/adapters/MysqlAdapter.php b/lib/ActiveRecord/adapters/MysqlAdapter.php
new file mode 100644
index 0000000..c04187c
--- /dev/null
+++ b/lib/ActiveRecord/adapters/MysqlAdapter.php
@@ -0,0 +1,73 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Adapter for MySQL.
+ *
+ * @package ActiveRecord
+ */
+class MysqlAdapter extends Connection
+{
+	static $DEFAULT_PORT = 3306;
+
+	public function limit($sql, $offset, $limit)
+	{
+		$offset = intval($offset);
+		$limit = intval($limit);
+		return "$sql LIMIT $offset,$limit";
+	}
+
+	public function query_column_info($table)
+	{
+		return $this->query("SHOW COLUMNS FROM $table");
+	}
+
+	public function query_for_tables()
+	{
+		return $this->query('SHOW TABLES');
+	}
+
+	public function create_column(&$column)
+	{
+		$c = new Column();
+		$c->inflected_name	= Inflector::instance()->variablize($column['field']);
+		$c->name			= $column['field'];
+		$c->nullable		= ($column['null'] === 'YES' ? true : false);
+		$c->pk				= ($column['key'] === 'PRI' ? true : false);
+		$c->auto_increment	= ($column['extra'] === 'auto_increment' ? true : false);
+
+		if ($column['type'] == 'timestamp' || $column['type'] == 'datetime')
+		{
+			$c->raw_type = 'datetime';
+			$c->length = 19;
+		}
+		elseif ($column['type'] == 'date')
+		{
+			$c->raw_type = 'date';
+			$c->length = 10;
+		}
+		elseif ($column['type'] == 'time')
+		{
+			$c->raw_type = 'time';
+			$c->length = 8;
+		}
+		else
+		{
+			preg_match('/^([A-Za-z0-9_]+)(\(([0-9]+(,[0-9]+)?)\))?/',$column['type'],$matches);
+
+			$c->raw_type = (count($matches) > 0 ? $matches[1] : $column['type']);
+
+			if (count($matches) >= 4)
+				$c->length = intval($matches[3]);
+		}
+
+		$c->map_raw_type();
+		$c->default = $c->cast($column['default'],$this);
+
+		return $c;
+	}
+}
+?>
diff --git a/lib/ActiveRecord/adapters/OciAdapter.php b/lib/ActiveRecord/adapters/OciAdapter.php
new file mode 100644
index 0000000..3e2a0f2
--- /dev/null
+++ b/lib/ActiveRecord/adapters/OciAdapter.php
@@ -0,0 +1,121 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+use PDO;
+
+/**
+ * Adapter for OCI (not completed yet).
+ * 
+ * @package ActiveRecord
+ */
+class OciAdapter extends Connection
+{
+	static $QUOTE_CHARACTER = '';
+	static $DEFAULT_PORT = 1521;
+
+	protected function __construct($info)
+	{
+		try {
+			$this->connection = new PDO("oci:dbname=//$info->host/$info->db",$info->user,$info->pass,static::$PDO_OPTIONS);
+		} catch (PDOException $e) {
+			throw new DatabaseException($e);
+		}
+	}
+
+	public function supports_sequences() { return true; }
+	
+	public function get_next_sequence_value($sequence_name)
+	{
+		return $this->query_and_fetch_one('SELECT ' . $this->next_sequence_value($sequence_name) . ' FROM dual');
+	}
+
+	public function next_sequence_value($sequence_name)
+	{
+		return "$sequence_name.nextval";
+	}
+
+	public function date_to_string($datetime)
+	{
+		return $datetime->format('d-M-Y');
+	}
+
+	public function datetime_to_string($datetime)
+	{
+		return $datetime->format('d-M-Y h:i:s A');
+	}
+
+	// $string = DD-MON-YYYY HH12:MI:SS(\.[0-9]+) AM
+	public function string_to_datetime($string)
+	{
+		return parent::string_to_datetime(str_replace('.000000','',$string));
+	}
+
+	public function limit($sql, $offset, $limit)
+	{
+		$offset = intval($offset);
+		$stop = $offset + intval($limit);
+		return 
+			"SELECT * FROM (SELECT a.*, rownum ar_rnum__ FROM ($sql) a " .
+			"WHERE rownum <= $stop) WHERE ar_rnum__ > $offset";
+	}
+
+	public function query_column_info($table)
+	{
+		$sql = 
+			"SELECT c.column_name, c.data_type, c.data_length, c.data_scale, c.data_default, c.nullable, " .
+				"(SELECT a.constraint_type " .
+				"FROM all_constraints a, all_cons_columns b " .
+				"WHERE a.constraint_type='P' " .
+				"AND a.constraint_name=b.constraint_name " .
+				"AND a.table_name = t.table_name AND b.column_name=c.column_name) AS pk " .
+			"FROM user_tables t " .
+			"INNER JOIN user_tab_columns c on(t.table_name=c.table_name) " .
+			"WHERE t.table_name=?";
+
+		$values = array(strtoupper($table));
+		return $this->query($sql,$values);
+	}
+
+	public function query_for_tables()
+	{
+		return $this->query("SELECT table_name FROM user_tables");
+	}
+
+	public function create_column(&$column)
+	{
+		$column['column_name'] = strtolower($column['column_name']);
+		$column['data_type'] = strtolower(preg_replace('/\(.*?\)/','',$column['data_type']));
+
+		if ($column['data_default'] !== null)
+			$column['data_default'] = trim($column['data_default'],"' ");
+
+		if ($column['data_type'] == 'number')
+		{
+			if ($column['data_scale'] > 0)
+				$column['data_type'] = 'decimal';
+			elseif ($column['data_scale'] == 0)
+				$column['data_type'] = 'int';
+		}
+
+		$c = new Column();
+		$c->inflected_name	= Inflector::instance()->variablize($column['column_name']);
+		$c->name			= $column['column_name'];
+		$c->nullable		= $column['nullable'] == 'Y' ? true : false;
+		$c->pk				= $column['pk'] == 'P' ? true : false;
+		$c->length			= $column['data_length'];
+	
+		if ($column['data_type'] == 'timestamp')
+			$c->raw_type = 'datetime';
+		else
+			$c->raw_type = $column['data_type'];
+
+		$c->map_raw_type();
+		$c->default	= $c->cast($column['data_default'],$this);
+
+		return $c;
+	}
+};
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/adapters/PgsqlAdapter.php b/lib/ActiveRecord/adapters/PgsqlAdapter.php
new file mode 100644
index 0000000..53e01bc
--- /dev/null
+++ b/lib/ActiveRecord/adapters/PgsqlAdapter.php
@@ -0,0 +1,104 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+/**
+ * Adapter for Postgres (not completed yet)
+ * 
+ * @package ActiveRecord
+ */
+class PgsqlAdapter extends Connection
+{
+	static $QUOTE_CHARACTER	= '"';
+	static $DEFAULT_PORT	= 5432;
+
+	public function supports_sequences() { return true; }
+
+	public function get_sequence_name($table, $column_name)
+	{
+		return "{$table}_{$column_name}_seq";
+	}
+
+	public function next_sequence_value($sequence_name)
+	{
+		return "nextval('" . str_replace("'","\\'",$sequence_name) . "')";
+	}
+
+	public function limit($sql, $offset, $limit)
+	{
+		return $sql . ' LIMIT ' . intval($limit) . ' OFFSET ' . intval($offset);
+	}
+
+	public function query_column_info($table)
+	{
+		$sql = <<<SQL
+SELECT a.attname AS field, a.attlen,
+REPLACE(pg_catalog.format_type(a.atttypid, a.atttypmod),'character varying','varchar') AS type,
+a.attnotnull AS not_nullable, 
+i.indisprimary as pk,
+REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(s.column_default,'::[a-z_ ]+',''),'\'$',''),'^\'','') AS default
+FROM pg_catalog.pg_attribute a
+LEFT JOIN pg_catalog.pg_class c ON(a.attrelid=c.oid)
+LEFT JOIN pg_catalog.pg_index i ON(c.oid=i.indrelid AND a.attnum=any(i.indkey))
+LEFT JOIN information_schema.columns s ON(s.table_name=? AND a.attname=s.column_name)
+WHERE a.attrelid = (select c.oid from pg_catalog.pg_class c inner join pg_catalog.pg_namespace n on(n.oid=c.relnamespace) where c.relname=? and pg_catalog.pg_table_is_visible(c.oid))
+AND a.attnum > 0
+AND NOT a.attisdropped
+ORDER BY a.attnum
+SQL;
+		$values = array($table,$table);
+		return $this->query($sql,$values);
+	}
+
+	public function query_for_tables()
+	{
+		return $this->query("SELECT tablename FROM pg_tables WHERE schemaname NOT IN('information_schema','pg_catalog')");
+	}
+
+	public function create_column(&$column)
+	{
+		$c = new Column();
+		$c->inflected_name	= Inflector::instance()->variablize($column['field']);
+		$c->name			= $column['field'];
+		$c->nullable		= ($column['not_nullable'] ? false : true);
+		$c->pk				= ($column['pk'] ? true : false);
+		$c->auto_increment	= false;
+
+		if (substr($column['type'],0,9) == 'timestamp')
+		{
+			$c->raw_type = 'datetime';
+			$c->length = 19;
+		}
+		elseif ($column['type'] == 'date')
+		{
+			$c->raw_type = 'date';
+			$c->length = 10;
+		}
+		else
+		{
+			preg_match('/^([A-Za-z0-9_]+)(\(([0-9]+(,[0-9]+)?)\))?/',$column['type'],$matches);
+
+			$c->raw_type = (count($matches) > 0 ? $matches[1] : $column['type']);
+			$c->length = count($matches) >= 4 ? intval($matches[3]) : intval($column['attlen']);
+
+			if ($c->length < 0)
+				$c->length = null;
+		}
+
+		$c->map_raw_type();
+
+		if ($column['default'])
+		{
+			preg_match("/^nextval\('(.*)'\)$/",$column['default'],$matches);
+
+			if (count($matches) == 2)
+				$c->sequence = $matches[1];
+			else
+				$c->default = $c->cast($column['default'],$this);
+		}
+		return $c;
+	}
+};
+?>
\ No newline at end of file
diff --git a/lib/ActiveRecord/adapters/SqliteAdapter.php b/lib/ActiveRecord/adapters/SqliteAdapter.php
new file mode 100644
index 0000000..81daeab
--- /dev/null
+++ b/lib/ActiveRecord/adapters/SqliteAdapter.php
@@ -0,0 +1,81 @@
+<?php
+/**
+ * @package ActiveRecord
+ */
+namespace ActiveRecord;
+
+use PDO;
+
+/**
+ * Adapter for SQLite.
+ *
+ * @package ActiveRecord
+ */
+class SqliteAdapter extends Connection
+{
+	protected function __construct($info)
+	{
+		if (!file_exists($info->host))
+			throw new DatabaseException("Could not find sqlite db: $info->host");
+
+		$this->connection = new PDO("sqlite:$info->host",null,null,static::$PDO_OPTIONS);
+	}
+
+	public function limit($sql, $offset, $limit)
+	{
+		$offset = intval($offset);
+		$limit = intval($limit);
+		return "$sql LIMIT $offset,$limit";
+	}
+
+	public function query_column_info($table)
+	{
+		return $this->query("pragma table_info($table)");
+	}
+
+	public function query_for_tables()
+	{
+		return $this->query("SELECT name FROM sqlite_master");
+	}
+
+	public function create_column($column)
+	{
+		$c = new Column();
+		$c->inflected_name	= Inflector::instance()->variablize($column['name']);
+		$c->name			= $column['name'];
+		$c->nullable		= $column['notnull'] ? false : true;
+		$c->pk				= $column['pk'] ? true : false;
+		$c->auto_increment	= $column['type'] == 'INTEGER' && $c->pk;
+
+		$column['type'] = preg_replace('/ +/',' ',$column['type']);
+		$column['type'] = str_replace(array('(',')'),' ',$column['type']);
+		$column['type'] = Utils::squeeze(' ',$column['type']);
+		$matches = explode(' ',$column['type']);
+
+		if (!empty($matches))
+		{
+			$c->raw_type = strtolower($matches[0]);
+
+			if (count($matches) > 1)
+				$c->length = intval($matches[1]);
+		}
+
+		$c->map_raw_type();
+
+		if ($c->type == Column::DATETIME)
+			$c->length = 19;
+		elseif ($c->type == Column::DATE)
+			$c->length = 10;
+
+		// From SQLite3 docs: The value is a signed integer, stored in 1, 2, 3, 4, 6,
+		// or 8 bytes depending on the magnitude of the value.
+		// so is it ok to assume it's possible an int can always go up to 8 bytes?
+		if ($c->type == Column::INTEGER && !$c->length)
+			$c->length = 8;
+
+		$c->default = $c->cast($column['dflt_value'],$this);
+
+		return $c;
+	}
+};
+?>
\ No newline at end of file
diff --git a/lib/Exception.php b/lib/Exception.php
index 0e1cb62..636319d 100644
--- a/lib/Exception.php
+++ b/lib/Exception.php
@@ -68,7 +68,7 @@ class Singleton {
 	
 }
 	
-	
+/*	
 class MyDomException extends Exception{
 	public function __construct($e)
 	{
@@ -122,10 +122,14 @@ class MyDomException extends Exception{
 		
 	}
 }
+*/
 
-
-class MyException extends Exception {
-	public function __construct($errno, $errstr, $errfile, $errline) {
+class MyException extends Exception{
+	public function __construct($errno, $errstr, $errfile, $errline)
+	{
+		global $except;
+		
+		$except = true;
 		parent::__construct($errstr, $errno);
 		//print $this->getMessage();
 		//print_r($this->getTrace());
@@ -149,13 +153,17 @@ class MyException extends Exception {
 		foreach ($this->getTrace() as $key => $val)
 		{
 			$args = "";
-			foreach ($val['args'] as $vals)
+			//var_dump($val);
+			if(in_array('args', $val))
 			{
-				//var_dump($vals);
-				if($vals=="" or $vals===false) 
-					$vals="false";
-				if (is_string ($vals))
-					$args .=" ".$vals;
+				foreach ($val['args'] as $vals)
+				{
+					//var_dump($vals);
+					if($vals=="" or $vals===false) 
+						$vals="false";
+					if (is_string ($vals))
+						$args .=" ".$vals;
+				}
 			}
 			$file = (array_key_exists("file", $val))?$val['file']:__FILE__;
 			$stack = $stacks->addChild("stack", $file);
diff --git a/lib/Routing.php b/lib/Routing.php
deleted file mode 100644
index 1f05950..0000000
--- a/lib/Routing.php
+++ /dev/null
@@ -1,42 +0,0 @@
-<?php
-/**  
- * библиотека отвечающая за роутинг
- * 
- * @package    lib
- * @since      08.10.2010 14:00:27
- * @author     enesterov
- */
-
-if (!defined('PHP_VERSION_ID') || PHP_VERSION_ID < 50300)
-	die('PHP Routing requires PHP 5.3 or higher');
-
-	require_once 'ar/Singleton.php';
-	require_once 'routing/Config.php';
-	require_once 'routing/Connection.php';
-
-
-spl_autoload_register('routing_autoload');
-
-function routing_autoload($class_name)
-{
-	
-	$path = Routing\Config::instance()->get_controller_directory();
-	$root = realpath(isset($path) ? $path : '.');
-
-	if (($namespaces = ActiveRecord\get_namespaces($class_name)))
-	{
-		//print_r($namespaces);
-		$class_name = array_pop($namespaces);
-		$directories = array();
-
-		foreach ($namespaces as $directory)
-			$directories[] = $directory;
-
-		$root .= DIRECTORY_SEPARATOR . implode($directories, DIRECTORY_SEPARATOR);
-	}
-
-	$file = "$root/$class_name.php";
-
-	if (file_exists($file))
-		require_once $file;
-}
diff --git a/lib/Routing/Config.php b/lib/Routing/Config.php
new file mode 100755
index 0000000..79dbcc2
--- /dev/null
+++ b/lib/Routing/Config.php
@@ -0,0 +1,69 @@
+<?php
+/**  
+ * библиотека отвечающая за роутинг
+ * 
+ * @package    lib
+ * @subpackage routing
+ * @since      07.10.2010 10:12:00
+ * @author     enesterov
+ * @category   none
+ */
+
+namespace Routing;
+use ActiveRecord;
+use Controllers;
+use Closure;
+
+
+class Config extends ActiveRecord\Singleton
+{
+	
+	public static $route = array();
+	public $key;
+	private $controller_directory;
+	private $mapper;
+
+	public static function initialize(Closure $initializer)
+	{
+		$initializer(parent::instance());
+	}
+	
+	public function MapSet($addr)
+	{
+		
+	}
+	public function Map($addr, $controler, $action, $argv=array())
+	{
+		if (!$addr || !$controler || !$action)
+			throw new ActiveRecord\ConfigException("Build routing map faild");
+			
+		$file = ROOT_PATH . "/controllers/$controler.php";
+		if (file_exists($file))
+		{
+			require_once $file;
+		}
+		
+		self::$route[$addr] =  array('Controllers\Controller' . $controler, $action, $argv);
+	}
+	
+	public function set_controller_directory($dir)
+	{
+		if (!file_exists($dir))
+			throw new ActiveRecord\ConfigException("Invalid or non-existent directory: $dir");
+
+		$this->controller_directory = $dir;
+	}
+
+	/**
+	 * Returns the controller directory.
+	 *
+	 * @return string
+	 */
+	public function get_controller_directory()
+	{
+		return $this->controller_directory;
+	}
+	private function Set(){}
+	private static function init(){}
+};
+?>
\ No newline at end of file
diff --git a/lib/Routing/Connection.php b/lib/Routing/Connection.php
new file mode 100644
index 0000000..5b84b91
--- /dev/null
+++ b/lib/Routing/Connection.php
@@ -0,0 +1,57 @@
+<?php
+
+namespace Routing;
+use ActiveRecord;
+
+class Routing extends Config{
+	
+	public function __construct()
+	{
+		//$this->Set();
+		$this->init();
+	}
+//	private function Set()
+//	{
+//		preg_match("/\/(?P<controller>\w+)\/(?P<action>\w+)\/?/i", $_SERVER['REQUEST_URI'], $matches);
+//		
+//		if(array_key_exists("controller", $matches) && array_key_exists("action", $matches)) {
+//			$this->key = "/%s/%s/" % array($matches["controller"], $matches["action"]);
+//			Routing::Map(  $this->key , $matches["controller"], $matches["action"] );
+//		} else
+//		{
+//			//throw new ActiveRecord\ConfigException("no exist controller or action");
+//		}
+//	}
+	private static function yeld($item2, $key)
+	{
+		preg_match("@" . $key . "@i", $_SERVER['REQUEST_URI'], $matches);
+		print_r($matches);
+		if ($matches)
+			$this->m = $matches[0];
+			
+		return $this->m;
+	}
+	private static function init() 
+	{
+		$item = false;
+		$arrKey;
+		while (list($key, $value) = each(self::$route)) {
+			preg_match("@" . $key . "@i", $_SERVER['REQUEST_URI'], $matches);
+			if ($matches)
+			{
+				$item = True;
+				$arrKey = $key;
+				break;
+			}
+		}
+		if(array_key_exists($arrKey, self::$route)) {
+			//print_r(self::$route);
+			$ins = new self::$route[$arrKey][0];
+			$fnc = self::$route[$arrKey][1];
+			$argv = self::$route[$arrKey][2];
+			$ins->$fnc($argv);
+		} else {
+			throw new ActiveRecord\ConfigException("Key not exist: $arrKey");
+		}
+	}
+}
\ No newline at end of file
diff --git a/lib/Routing/Routing.php b/lib/Routing/Routing.php
new file mode 100755
index 0000000..06c2bb0
--- /dev/null
+++ b/lib/Routing/Routing.php
@@ -0,0 +1,58 @@
+<?php
+
+namespace Routing;
+use ActiveRecord;
+
+class Routing extends Config{
+	
+	public function __construct()
+	{
+		//$this->Set();
+		$this->init();
+	}
+//	private function Set()
+//	{
+//		preg_match("/\/(?P<controller>\w+)\/(?P<action>\w+)\/?/i", $_SERVER['REQUEST_URI'], $matches);
+//		
+//		if(array_key_exists("controller", $matches) && array_key_exists("action", $matches)) {
+//			$this->key = "/%s/%s/" % array($matches["controller"], $matches["action"]);
+//			Routing::Map(  $this->key , $matches["controller"], $matches["action"] );
+//		} else
+//		{
+//			//throw new ActiveRecord\ConfigException("no exist controller or action");
+//		}
+//	}
+	private static function yeld($item2, $key)
+	{
+		preg_match("@" . $key . "@i", $_SERVER['REQUEST_URI'], $matches);
+		print_r($matches);
+		if ($matches)
+			$this->m = $matches[0];
+			
+		return $this->m;
+	}
+	private static function init() 
+	{
+		$item = false;
+		$arrKey = "";
+		while (list($key, $value) = each(self::$route)) {
+			preg_match("@" . $key . "@i", $_SERVER['REQUEST_URI'], $matches);
+			if ($matches)
+			{
+				$item = True;
+				$arrKey = $key;
+				break;
+			}
+		}
+		
+		if(array_key_exists($arrKey, self::$route)) {
+			//print_r(self::$route);
+			$ins = new self::$route[$arrKey][0];
+			$fnc = self::$route[$arrKey][1];
+			$argv = self::$route[$arrKey][2];
+			$ins->$fnc($argv);
+		} else {
+			throw new ActiveRecord\ConfigException("Key not exist: $arrKey");
+		}
+	}
+}
\ No newline at end of file
diff --git a/lib/Template.php b/lib/Template.php
deleted file mode 100644
index c236391..0000000
--- a/lib/Template.php
+++ /dev/null
@@ -1,101 +0,0 @@
-<?php
-/**  
- * 
- * 
- * @package    library
- * @subpackage Template
- * @since      18.10.2010 16:14:54
- * @author     enesterov
- * @category   none
- */
-
-	namespace Template;
-	
-class MyDOMDocument {
-		private $_delegate;
-		private $_validationErrors;
-
-		public function __construct (\DOMDocument $pDocument) {
-			$this->_delegate = $pDocument;
-			$this->_validationErrors = array();
-		}
-
-		public function __call ($pMethodName, $pArgs) {
-			if ($pMethodName == "validate") {
-				$eh = set_error_handler(array($this, "onValidateError"));
-				$rv = $this->_delegate->validate();
-				if ($eh) {
-					set_error_handler($eh);
-				}
-				return $rv;
-			}
-			else {
-				return call_user_func_array(array($this->_delegate, $pMethodName), $pArgs);
-			}
-		}
-		public function __get ($pMemberName) {
-			if ($pMemberName == "errors") {
-				return $this->_validationErrors;
-			}
-			else {
-				return $this->_delegate->$pMemberName;
-			}
-		}
-		public function __set ($pMemberName, $pValue) {
-			$this->_delegate->$pMemberName = $pValue;
-		}
-		public function onValidateError ($pNo, $pString, $pFile = null, $pLine = null, $pContext = null) {
-			$this->_validationErrors[] = preg_replace("/^.+: */", "", $pString);
-		}
-	}
-
-abstract class Template {
-	public $xml;
-	
-	function __set($name="", $value = "")
-	{
-		//print $value;
-		return $this->$name = $this->xml->addChild( $name, $value );
-	}
-	
-	public function __construct($data = "")
-	{
-		$child = get_called_class();
-		
-		$dtd = preg_replace("/Controllers\\C/", "", $child);
-		$dtd = preg_replace("/Controller/", "", $dtd);
-		$dtd = strtolower($dtd);
-		
-		$xmlstr = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mvideo_xml SYSTEM \"http://".$_SERVER['HTTP_HOST']."/mobile/public/$dtd.dtd\">\n<mvideo_xml date=\"" . date("Y-m-d H:i:s") . "\">\n</mvideo_xml>";
-		
-		$this->xml = new \SimpleXMLElement($xmlstr);
-		
-	}
-	
-	public function __destruct()
-	{
-		$doc=$this->xml->asXML();
-		
-		
-		//print preg_replace("/></", ">\n<", $doc);
-		//try
-		//{
-			$dom = new \DOMDocument;
-			$dom->loadXML($doc, LIBXML_DTDLOAD|LIBXML_DTDATTR);
-			$myDoc = new MyDOMDocument($dom);
-			$isValid = $myDoc->validate();
-			/*if (!$isValid) 
-			{
-				throw new \MyDomException($myDoc->errors);
-			}*/
-			header('Content-type: text/xml; charset=utf-8');
-			echo preg_replace("/></", ">\n<", $doc);
-		/*}
-		catch(\MyException $e)
-		{
-			echo $e;
-		}*/
-	}
-	
-
-}
\ No newline at end of file
diff --git a/lib/Template/MyDOMDocument.php b/lib/Template/MyDOMDocument.php
new file mode 100755
index 0000000..f24c34e
--- /dev/null
+++ b/lib/Template/MyDOMDocument.php
@@ -0,0 +1,55 @@
+<?php
+/**
+  * 
+  * 
+  * @package    MyDOMDocument
+  * @subpackage template
+  * @since      13.04.2011 12:53:46
+  * @author     enesterov
+  * @category   controller
+  * 
+  * @global MyDOMDocument
+  * @method onValidateError - собирает массив ошибок
+  */
+
+	namespace Template;
+	
+class MyDOMDocument {
+	
+	private $_delegate;
+	
+	private $_validationErrors;
+
+	public function __construct (\DOMDocument $pDocument) {
+		$this->_delegate = $pDocument;
+		$this->_validationErrors = array();
+	}
+
+	public function __call ($pMethodName, $pArgs) {
+		if ($pMethodName == "validate") {
+			$eh = set_error_handler(array($this, "onValidateError"));
+			$rv = $this->_delegate->validate();
+			if ($eh) {
+				set_error_handler($eh);
+			}
+			return $rv;
+		}
+		else {
+			return call_user_func_array(array($this->_delegate, $pMethodName), $pArgs);
+		}
+	}
+	public function __get ($pMemberName) {
+		if ($pMemberName == "errors") {
+			return $this->_validationErrors;
+		}
+		else {
+			return $this->_delegate->$pMemberName;
+		}
+	}
+	public function __set ($pMemberName, $pValue) {
+		$this->_delegate->$pMemberName = $pValue;
+	}
+	public function onValidateError ($pNo, $pString, $pFile = null, $pLine = null, $pContext = null) {
+		$this->_validationErrors[] = preg_replace("/^.+: */", "", $pString);
+	}
+}
\ No newline at end of file
diff --git a/lib/Template/Template.php b/lib/Template/Template.php
new file mode 100644
index 0000000..f40562c
--- /dev/null
+++ b/lib/Template/Template.php
@@ -0,0 +1,88 @@
+<?php
+/**  
+ * шаблонизатор для вывода ml файлов
+ * 
+ * @package    library
+ * @subpackage Template
+ * @since      18.10.2010 16:14:54
+ * @author     enesterov
+ * @category   none
+ * 
+ * @global Template - клас шаблонов
+ * 
+ */
+
+	namespace Template;
+	
+abstract class Template {
+	
+	/**
+	 * DOM объекты
+	 * @var object
+	 */
+	public $xml;
+	
+	/**
+	 * переназначаем сетер для создания ноды xml 
+	 * @param string $name
+	 * @param string $value
+	 */
+	function __set($name="", $value = "")
+	{
+		//print $value;
+		return $this->$name = $this->xml->addChild( $name, $value );
+	}
+	
+	/**
+	 * конструктор создает заголовок xml файла 
+	 * в зависимости от того, из какого класа он вызван 
+	 * @param string $data
+	 */
+	public function __construct($data = "")
+	{
+		$child = get_called_class();
+		
+		$dtd = preg_replace("/Controllers\\C/", "", $child);
+		$dtd = preg_replace("/Controller/", "", $dtd);
+		$dtd = strtolower($dtd);
+		
+		$xmlstr = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mvideo_xml SYSTEM \"http://".$_SERVER['HTTP_HOST']."/mobile/public/$dtd.dtd\">\n<mvideo_xml date=\"" . date("Y-m-d H:i:s") . "\">\n</mvideo_xml>";
+		
+		$this->xml = new \SimpleXMLElement($xmlstr);
+		
+	}
+	
+	/**
+	 * выводит собраный документ на страницу
+	 */
+	public function __destruct()
+	{
+		global $except;
+		$doc=$this->xml->asXML();
+		
+		
+		//print preg_replace("/></", ">\n<", $doc);
+		if(!$except)
+		{
+			//try
+			//{
+				$dom = new \DOMDocument;
+				$dom->loadXML($doc, LIBXML_DTDLOAD|LIBXML_DTDATTR);
+				$myDoc = new MyDOMDocument($dom);
+				$isValid = $myDoc->validate();
+				/*if (!$isValid) 
+				{
+					throw new \MyDomException($myDoc->errors);
+				}*/
+				header('Content-type: text/xml; charset=utf-8');
+				echo preg_replace("/></", ">\n<", $doc);
+			/*}
+			catch(\MyException $e)
+			{
+				echo $e;
+			}*/
+		}
+	}
+	
+
+}
\ No newline at end of file
diff --git a/lib/Utils.php b/lib/Utils.php
index 9ce0b2a..47f4ecc 100644
--- a/lib/Utils.php
+++ b/lib/Utils.php
@@ -3,11 +3,94 @@
 	define ( 'LOWERCASE', 3 );
 	define ( 'UPPERCASE', 1 );
 	
+	spl_autoload_register('lib_autoload');
+	
+	/**
+	 * автолоад для библиотек
+	 * @param string $class_name
+	 */
+	function lib_autoload($class_name)
+	{
+		$path = LIB_PATH;
+		$root = realpath(isset($path) ? $path : '.');
+		$namespaces = get_namespaces($class_name);
+		if ($namespaces)
+		{
+			$class_name = array_pop($namespaces);
+			$directories = array();
+	
+			foreach ($namespaces as $directory)
+			{
+				$directories[] = $directory;
+			}
+			
+			$root .= "/" . implode( $directories, "/" );
+		}
+		
+		
+		$file = "$root/$class_name.php";
+		
+		//var_dump($file);
+		if (file_exists($file))
+			require_once $file;
+	}
+	
+	
+	function makeUrl($url)
+	{
+		return implode($url, "/");
+	}
+	
+	/**
+	 * возвращает значение глобальной переменной $_GET или значение $returns 
+	 * @param string $key
+	 * @param (string|bool) $returns
+	 */
+	function get_key($key, $returns = false)
+	{
+		return (!array_key_exists($key, $_GET))?$returns:$_GET[$key];
+	}
+	
+	/**
+	 * возвращает массив из класса и namespace
+	 * 
+	 * @param string $class_name
+	 * @return multitype:|NULL
+	 * @access public
+	 */
+	function get_namespaces($class_name)
+	{
+		
+		if (has_namespace($class_name))
+			return explode('\\', $class_name);
+		return null;
+	}
+	
+	/**
+	 * проверяет наличие namespace в названии класса
+	 * @param string $class_name
+	 * @return bool
+	 */
+	function has_namespace($class_name)
+	{
+		if (strpos($class_name, '\\') !== false)
+			return true;
+		return false;
+	}
+	
+	/**
+	 * переводит строку из cp1251 в utf-8
+	 * @param string $string
+	 */
 	function ToUTF($string) {
 		//$encode =  detect_cyr_charset($string);
 		return iconv ( 'CP1251', "UTF-8", $string );
 	}
 	
+	/**
+	 * переводит строку и срезает лишние теги
+	 * @param unknown_type $string
+	 */
 	function StripTags($string) {
 		$patterns = array ("/<br\s*?\/?>/", "/&nbsp;/", "/(&laquo;|&raquo;)/", "/&/", "/(<|>)/" );
 		$replacements = array ("\n", " ", '"', " and ", "" );
@@ -19,81 +102,4 @@
 	}
 	
 	
-	function detect_cyr_charset($str) {
-		
-		$charsets = Array (
-	
-		'KOI8-R' => 0, 
-	
-		'CP1251' => 0, 
-	
-		'CP866' => 0, 
-	
-		'UTF-8' => 0, 
-	
-		'mac-cyrillic-2000' => 0 )
-	
-		;
-		
-		for($i = 0, $length = strlen ( $str ); $i < $length; $i ++) {
-			
-			$char = ord ( $str [$i] );
-			
-			//non-russian characters
-			
-	
-			if ($char < 128 || $char > 256)
-				continue;
-			
-			//CP866
-			
-	
-			if (($char > 159 && $char < 176) || ($char > 223 && $char < 242))
-				
-				$charsets ['CP866'] += LOWERCASE;
-			
-			if (($char > 127 && $char < 160))
-				$charsets ['CP866'] += UPPERCASE;
-			
-			//KOI8-R
-			
-	
-			if (($char > 191 && $char < 223))
-				$charsets ['KOI8-R'] += LOWERCASE;
-			
-			if (($char > 222 && $char < 256))
-				$charsets ['KOI8-R'] += UPPERCASE;
-			
-			//CP1251
-			
-	
-			if ($char > 223 && $char < 256)
-				$charsets ['CP1251'] += LOWERCASE;
-			
-			if ($char > 191 && $char < 224)
-				$charsets ['CP1251'] += UPPERCASE;
-			
-			//MAC
-			
-//	
-//			if ($char > 221 && $char < 255)
-//				$charsets ['mac-cyrillic-2000'] += LOWERCASE;
-//			
-//			if ($char > 127 && $char < 160)
-//				$charsets ['mac-cyrillic-2000'] += UPPERCASE;
-//			
-			//ISO-8859-5
-			
-	
-			if ($char > 207 && $char < 240)
-				$charsets ['UTF-8'] += LOWERCASE;
-			
-			if ($char > 175 && $char < 208)
-				$charsets ['UTF-8'] += UPPERCASE;
-		
-		}
-		
-		arsort ( $charsets );
-		
-		return key ( $charsets );
-	}
\ No newline at end of file
+	
\ No newline at end of file
diff --git a/lib/ar/CallBack.php b/lib/ar/CallBack.php
deleted file mode 100644
index 034c507..0000000
--- a/lib/ar/CallBack.php
+++ /dev/null
@@ -1,226 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-use Closure;
-
-/**
- * Callbacks allow the programmer to hook into the life cycle of a {@link Model}.
- * 
- * You can control the state of your object by declaring certain methods to be
- * called before or after methods are invoked on your object inside of ActiveRecord.
- * 
- * Valid callbacks are:
- * <ul>
- * <li><b>after_construct:</b> called after a model has been constructed</li>
- * <li><b>before_save:</b> called before a model is saved</li>
- * <li><b>after_save:</b> called after a model is saved</li>
- * <li><b>before_create:</b> called before a NEW model is to be inserted into the database</li>
- * <li><b>after_create:</b> called after a NEW model has been inserted into the database</li>
- * <li><b>before_update:</b> called before an existing model has been saved</li>
- * <li><b>after_update:</b> called after an existing model has been saved</li>
- * <li><b>before_validation:</b> called before running validators</li>
- * <li><b>after_validation:</b> called after running validators</li>
- * <li><b>before_validation_on_create:</b> called before validation on a NEW model being inserted</li>
- * <li><b>after_validation_on_create:</b> called after validation on a NEW model being inserted</li>
- * <li><b>before_validation_on_update:</b> see above except for an existing model being saved</li>
- * <li><b>after_validation_on_update:</b> ...</li>
- * <li><b>before_destroy:</b> called after a model has been deleted</li>
- * <li><b>after_destroy:</b> called after a model has been deleted</li>
- * </ul>
- * 
- * This class isn't meant to be used directly. Callbacks are defined on your model like the example below:
- * 
- * <code>
- * class Person extends ActiveRecord\Model {
- *   static $before_save = array('make_name_uppercase');
- *   static $after_save = array('do_happy_dance');
- *   
- *   public function make_name_uppercase() {
- *     $this->name = strtoupper($this->name);
- *   }
- * 
- *   public function do_happy_dance() {
- *     happy_dance();
- *   }
- * }
- * </code>
- *
- * Available options for callbacks:
- *
- * <ul>
- * <li><b>prepend:</b> puts the callback at the top of the callback chain instead of the bottom</li>
- * </ul>
- *
- * @package ActiveRecord
- * @link http://www.phpactiverecord.org/guides/callbacks
- */
-class CallBack
-{
-	/**
-	 * List of available callbacks.
-	 *
-	 * @var array
-	 */
-	static protected $VALID_CALLBACKS = array(
-		'after_construct',
-		'before_save',
-		'after_save',
-		'before_create',
-		'after_create',
-		'before_update',
-		'after_update',
-		'before_validation',
-		'after_validation',
-		'before_validation_on_create',
-		'after_validation_on_create',
-		'before_validation_on_update',
-		'after_validation_on_update',
-		'before_destroy',
-		'after_destroy'
-	);
-
-	/**
-	 * Container for reflection class of given model
-	 * 
-	 * @var object
-	 */
-	private $klass;
-
-	/**
-	 * Holds data for registered callbacks.
-	 *
-	 * @var array
-	 */
-	private $registry = array();
-
-	/**
-	 * Creates a CallBack.
-	 *
-	 * @param string $model_class_name The name of a {@link Model} class
-	 * @return CallBack
-	 */
-	public function __construct($model_class_name)
-	{
-		$this->klass = Reflections::instance()->get($model_class_name);
-
-		foreach (static::$VALID_CALLBACKS as $name)
-		{
-			// look for explicitly defined static callback
-			if (($definition = $this->klass->getStaticPropertyValue($name,null)))
-			{
-				if (!is_array($definition))
-					$definition = array($definition);
-
-				foreach ($definition as $method_name)
-					$this->register($name,$method_name);
-			}
-
-			// implicit callbacks that don't need to have a static definition
-			// simply define a method named the same as something in $VALID_CALLBACKS
-			// and the callback is auto-registered
-			elseif ($this->klass->hasMethod($name))
-				$this->register($name,$name);
-		}
-	}
-
-	/**
-	 * Returns all the callbacks registered for a callback type.
-	 *
-	 * @param $name string Name of a callback (see {@link VALID_CALLBACKS $VALID_CALLBACKS})
-	 * @return array array of callbacks or null if invalid callback name.
-	 */
-	public function get_callbacks($name)
-	{
-		return isset($this->registry[$name]) ? $this->registry[$name] : null;
-	}
-
-	/**
-	 * Invokes a callback.
-	 *
-	 * @internal This is the only piece of the CallBack class that carries its own logic for the
-	 * model object. For (after|before)_(create|update) callbacks, it will merge with
-	 * a generic 'save' callback which is called first for the lease amount of precision.
-	 *
-	 * @param string $model Model to invoke the callback on.
-	 * @param string $name Name of the callback to invoke
-	 * @param boolean $must_exist Set to true to raise an exception if the callback does not exist.
-	 * @return mixed null if $name was not a valid callback type or false if a method was invoked
-	 * that was for a before_* callback and that method returned false. If this happens, execution
-	 * of any other callbacks after the offending callback will not occur.
-	 */
-	public function invoke($model, $name, $must_exist=true)
-	{
-		if ($must_exist && !array_key_exists($name, $this->registry))
-			throw new ActiveRecordException("No callbacks were defined for: $name on " . get_class($model));
-
-		// if it doesn't exist it might be a /(after|before)_(create|update)/ so we still need to run the save
-		// callback
-		if (!array_key_exists($name, $this->registry))
-			$registry = array();
-		else
-			$registry = $this->registry[$name];
-
-		$first = substr($name,0,6);
-
-		// starts with /(after|before)_(create|update)/
-		if (($first == 'after_' || $first == 'before') && (($second = substr($name,7,5)) == 'creat' || $second == 'updat' || $second == 'reate' || $second == 'pdate'))
-		{
-			$temporal_save = str_replace(array('create', 'update'), 'save', $name);
-
-			if (!isset($this->registry[$temporal_save]))
-				$this->registry[$temporal_save] = array();
-
-			$registry = array_merge($this->registry[$temporal_save], $registry ? $registry : array());
-		}
-
-		if ($registry)
-		{
-			foreach ($registry as $method)
-			{
-				$ret = ($method instanceof Closure ? $method($model) : $model->$method());
-
-				if (false === $ret && $first === 'before')
-					return false;
-			}
-		}
-		return true;
-	}
-
-	/**
-	 * Register a new callback.
-	 *
-	 * @param string $name Name of callback type (see {@link VALID_CALLBACKS $VALID_CALLBACKS})
-	 * @param mixed $closure_or_method_name Either a closure or the name of a method on the {@link Model}
-	 * @param array $options Options array
-	 * @return void
-	 * @throws ActiveRecordException if invalid callback type or callback method was not found
-	 */
-	public function register($name, $closure_or_method_name=null, $options=array())
-	{
-		$options = array_merge(array('prepend' => false), $options);
-
-		if (!$closure_or_method_name)
-			$closure_or_method_name = $name;
-
-		if (!in_array($name,self::$VALID_CALLBACKS))
-			throw new ActiveRecordException("Invalid callback: $name");
-
-		if (!($closure_or_method_name instanceof Closure) && !$this->klass->hasMethod($closure_or_method_name))
-		{
-			// i'm a dirty ruby programmer
-			throw new ActiveRecordException("Unknown method for callback: $name" .
-				(is_string($closure_or_method_name) ? ": #$closure_or_method_name" : ""));
-		}
-
-		if (!isset($this->registry[$name]))
-			$this->registry[$name] = array();
-
-		if ($options['prepend'])
-			array_unshift($this->registry[$name], $closure_or_method_name);
-		else
-			$this->registry[$name][] = $closure_or_method_name;
-	}
-}
-?>
\ No newline at end of file
diff --git a/lib/ar/Column.php b/lib/ar/Column.php
deleted file mode 100644
index d73bd1b..0000000
--- a/lib/ar/Column.php
+++ /dev/null
@@ -1,155 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Class for a table column.
- *
- * @package ActiveRecord
- */
-class Column
-{
-	// types for $type
-	const STRING	= 1;
-	const INTEGER	= 2;
-	const DECIMAL	= 3;
-	const DATETIME	= 4;
-	const DATE		= 5;
-	const TIME		= 6;
-
-	/**
-	 * Map a type to an column type.
-	 * @static
-	 * @var array
-	 */
-	static $TYPE_MAPPING = array(
-		'datetime'	=> self::DATETIME,
-		'timestamp'	=> self::DATETIME,
-		'date'		=> self::DATE,
-		'time'		=> self::TIME,
-
-		'int'		=> self::INTEGER,
-		'tinyint'	=> self::INTEGER,
-		'smallint'	=> self::INTEGER,
-		'mediumint'	=> self::INTEGER,
-		'bigint'	=> self::INTEGER,
-
-		'float'		=> self::DECIMAL,
-		'double'	=> self::DECIMAL,
-		'numeric'	=> self::DECIMAL,
-		'decimal'	=> self::DECIMAL,
-		'dec'		=> self::DECIMAL);
-
-	/**
-	 * The true name of this column.
-	 * @var string
-	 */
-	public $name;
-
-	/**
-	 * The inflected name of this columns .. hyphens/spaces will be => _.
-	 * @var string
-	 */
-	public $inflected_name;
-
-	/**
-	 * The type of this column: STRING, INTEGER, ...
-	 * @var integer
-	 */
-	public $type;
-
-	/**
-	 * The raw database specific type.
-	 * @var string
-	 */
-	public $raw_type;
-
-	/**
-	 * The maximum length of this column.
-	 * @var int
-	 */
-	public $length;
-
-	/**
-	 * True if this column allows null.
-	 * @var boolean
-	 */
-	public $nullable;
-
-	/**
-	 * True if this column is a primary key.
-	 * @var boolean
-	 */
-	public $pk;
-
-	/**
-	 * The default value of the column.
-	 * @var mixed
-	 */
-	public $default;
-
-	/**
-	 * True if this column is set to auto_increment.
-	 * @var boolean
-	 */
-	public $auto_increment;
-
-	/**
-	 * Name of the sequence to use for this column if any.
-	 * @var boolean
-	 */
-	public $sequence;
-
-	/**
-	 * Casts a value to the column's type.
-	 *
-	 * @param mixed $value The value to cast
-	 * @param Connection $connection The Connection this column belongs to
-	 * @return mixed type-casted value
-	 */
-	public function cast($value, $connection)
-	{
-		if ($value === null)
-			return null;
-
-		switch ($this->type)
-		{
-			case self::STRING:	return (string)$value;
-			case self::INTEGER:	return (int)$value;
-			case self::DECIMAL:	return (double)$value;
-			case self::DATETIME:
-			case self::DATE:
-				if (!$value)
-					return null;
-
-				if ($value instanceof DateTime)
-					return $value;
-
-				if ($value instanceof \DateTime)
-					return new DateTime($value->format('Y-m-d H:i:s T'));
-
-				return $connection->string_to_datetime($value);
-		}
-		return $value;
-	}
-
-	/**
-	 * Sets the $type member variable.
-	 * @return mixed
-	 */
-	public function map_raw_type()
-	{
-		if ($this->raw_type == 'integer')
-			$this->raw_type = 'int';
-
-		if (array_key_exists($this->raw_type,self::$TYPE_MAPPING))
-			$this->type = self::$TYPE_MAPPING[$this->raw_type];
-		else
-			$this->type = self::STRING;
-
-		return $this->type;
-	}
-}
-?>
\ No newline at end of file
diff --git a/lib/ar/Config.php b/lib/ar/Config.php
deleted file mode 100644
index dd0b044..0000000
--- a/lib/ar/Config.php
+++ /dev/null
@@ -1,288 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-use Closure;
-
-/**
- * Manages configuration options for ActiveRecord.
- *
- * <code>
- * ActiveRecord::initialize(function($cfg) {
- *   $cfg->set_model_home('models');
- *   $cfg->set_connections(array(
- *     'development' => 'mysql://user:pass@development.com/awesome_development',
- *     'production' => 'mysql://user:pass@production.com/awesome_production'));
- * });
- * </code>
- *
- * @package ActiveRecord
- */
-class Config extends Singleton
-{
-	/**
-	 * Name of the connection to use by default.
-	 *
-	 * <code>
-	 * ActiveRecord\Config::initialize(function($cfg) {
-	 *   $cfg->set_model_directory('/your/app/models');
-	 *   $cfg->set_connections(array(
-	 *     'development' => 'mysql://user:pass@development.com/awesome_development',
-	 *     'production' => 'mysql://user:pass@production.com/awesome_production'));
-	 * });
-	 * </code>
-	 *
-	 * This is a singleton class so you can retrieve the {@link Singleton} instance by doing:
-	 *
-	 * <code>
-	 * $config = ActiveRecord\Config::instance();
-	 * </code>
-	 *
-	 * @var string
-	 */
-	private $default_connection = 'development';
-
-	/**
-	 * Contains the list of database connection strings.
-	 *
-	 * @var array
-	 */
-	private $connections = array();
-
-	/**
-	 * Directory for the auto_loading of model classes.
-	 *
-	 * @see activerecord_autoload
-	 * @var string
-	 */
-	private $model_directory;
-
-	/**
-	 * Switch for logging.
-	 *
-	 * @var bool
-	 */
-	private $logging = false;
-
-	/**
-	 * Contains a Logger object that must impelement a log() method.
-	 *
-	 * @var object
-	 */
-	private $logger;
-
-	/**
-	 * The format to serialize DateTime values into.
-	 *
-	 * @var string
-	 */
-	private $date_format = \DateTime::ISO8601;
-
-	/**
-	 * Allows config initialization using a closure.
-	 *
-	 * This method is just syntatic sugar.
-	 *
-	 * <code>
-	 * ActiveRecord\Config::initialize(function($cfg) {
-     *   $cfg->set_model_directory('/path/to/your/model_directory');
-     *   $cfg->set_connections(array(
-     *     'development' => 'mysql://username:password@127.0.0.1/database_name'));
-	 * });
-	 * </code>
-	 *
-	 * You can also initialize by grabbing the singleton object:
-	 *
-	 * <code>
-	 * $cfg = ActiveRecord\Config::instance();
-	 * $cfg->set_model_directory('/path/to/your/model_directory');
-	 * $cfg->set_connections(array('development' =>
-  	 *   'mysql://username:password@localhost/database_name'));
-	 * </code>
-	 *
-	 * @param Closure $initializer A closure
-	 * @return void
-	 */
-	public static function initialize(Closure $initializer)
-	{
-		$initializer(parent::instance());
-	}
-
-	/**
-	 * Sets the list of database connection strings.
-	 *
-	 * <code>
-	 * $config->set_connections(array(
-     *     'development' => 'mysql://username:password@127.0.0.1/database_name'));
-     * </code>
-	 *
-	 * @param array $connections Array of connections
-	 * @param string $default_connection Optionally specify the default_connection
-	 * @return void
-	 * @throws ActiveRecord\ConfigException
-	 */
-	public function set_connections($connections, $default_connection=null)
-	{
-		if (!is_array($connections))
-			throw new ConfigException("Connections must be an array");
-
-		if ($default_connection)
-			$this->set_default_connection($default_connection);
-
-		$this->connections = $connections;
-	}
-
-	/**
-	 * Returns the connection strings array.
-	 *
-	 * @return array
-	 */
-	public function get_connections()
-	{
-		return $this->connections;
-	}
-
-	/**
-	 * Returns a connection string if found otherwise null.
-	 *
-	 * @param string $name Name of connection to retrieve
-	 * @return string connection info for specified connection name
-	 */
-	public function get_connection($name)
-	{
-		if (array_key_exists($name, $this->connections))
-			return $this->connections[$name];
-
-		return null;
-	}
-
-	/**
-	 * Returns the default connection string or null if there is none.
-	 *
-	 * @return string
-	 */
-	public function get_default_connection_string()
-	{
-		return array_key_exists($this->default_connection,$this->connections) ?
-			$this->connections[$this->default_connection] : null;
-	}
-
-	/**
-	 * Returns the name of the default connection.
-	 *
-	 * @return string
-	 */
-	public function get_default_connection()
-	{
-		return $this->default_connection;
-	}
-
-	/**
-	 * Set the name of the default connection.
-	 *
-	 * @param string $name Name of a connection in the connections array
-	 * @return void
-	 */
-	public function set_default_connection($name)
-	{
-		$this->default_connection = $name;
-	}
-
-	/**
-	 * Sets the directory where models are located.
-	 *
-	 * @param string $dir Directory path containing your models
-	 * @return void
-	 * @throws ConfigException if specified directory was not found
-	 */
-	public function set_model_directory($dir)
-	{
-		if (!file_exists($dir))
-			throw new ConfigException("Invalid or non-existent directory: $dir");
-
-		$this->model_directory = $dir;
-	}
-
-	/**
-	 * Returns the model directory.
-	 *
-	 * @return string
-	 */
-	public function get_model_directory()
-	{
-		return $this->model_directory;
-	}
-
-	/**
-	 * Turn on/off logging
-	 *
-	 * @param boolean $bool
-	 * @return void
-	 */
-	public function set_logging($bool)
-	{
-		$this->logging = (bool)$bool;
-	}
-
-	/**
-	 * Sets the logger object for future SQL logging
-	 *
-	 * @param object $logger
-	 * @return void
-	 * @throws ConfigException if Logger objecct does not implement public log()
-	 */
-	public function set_logger($logger)
-	{
-		$klass = Reflections::instance()->add($logger)->get($logger);
-
-		if (!$klass->getMethod('log') || !$klass->getMethod('log')->isPublic())
-			throw new ConfigException("Logger object must implement a public log method");
-
-		$this->logger = $logger;
-	}
-
-	/**
-	 * Return whether or not logging is on
-	 *
-	 * @return boolean
-	 */
-	public function get_logging()
-	{
-		return $this->logging;
-	}
-
-	/**
-	 * Returns the logger
-	 *
-	 * @return object
-	 */
-	public function get_logger()
-	{
-		return $this->logger;
-	}
-
-	/**
-	 * Returns the date format.
-	 *
-	 * @return string
-	 */
-	public function get_date_format()
-	{
-		return $this->date_format;
-	}
-
-	/**
-	 * Sets the date format.
-	 *
-	 * Accepts date formats accepted by PHP's date() function.
-	 *
-	 * @link http://us.php.net/manual/en/function.date.php
-	 * @param string $format
-	 */
-	public function set_date_format($format)
-	{
-		$this->date_format = $format;
-	}
-};
-?>
\ No newline at end of file
diff --git a/lib/ar/Connection.php b/lib/ar/Connection.php
deleted file mode 100644
index 094a09d..0000000
--- a/lib/ar/Connection.php
+++ /dev/null
@@ -1,456 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-require 'Column.php';
-
-use PDO;
-use PDOException;
-use Closure;
-
-/**
- * The base class for database connection adapters.
- *
- * @package ActiveRecord
- */
-abstract class Connection
-{
-	/**
-	 * The PDO connection object.
-	 * @var mixed
-	 */
-	public $connection;
-
-	/**
-	 * The last query run.
-	 * @var string
-	 */
-	public $last_query;
-
-	/**
-	 * Switch for logging.
-	 *
-	 * @var bool
-	 */
-	 private $logging = false;
-
-	/**
-	 * Contains a Logger object that must impelement a log() method.
-	 *
-	 * @var object
-	 */
-	private $logger;
-
-	/**
-	 * Default PDO options to set for each connection.
-	 * @var array
-	 */
-	static $PDO_OPTIONS = array(
-		PDO::ATTR_CASE				=> PDO::CASE_LOWER,
-		PDO::ATTR_ERRMODE			=> PDO::ERRMODE_EXCEPTION,
-		PDO::ATTR_ORACLE_NULLS		=> PDO::NULL_NATURAL,
-		PDO::ATTR_STRINGIFY_FETCHES	=> false);
-
-	/**
-	 * The quote character for stuff like column and field names.
-	 * @var string
-	 */
-	static $QUOTE_CHARACTER = '`';
-
-	/**
-	 * Default port.
-	 * @var int
-	 */
-	static $DEFAULT_PORT = 0;
-
-	/**
-	 * Retrieve a database connection.
-	 *
-	 * @param string $connection_string_or_connection_name A database connection string (ex. mysql://user:pass@host[:port]/dbname)
-	 *   Everything after the protocol:// part is specific to the connection adapter.
-	 *   OR
-	 *   A connection name that is set in ActiveRecord\Config
-	 *   If null it will use the default connection specified by ActiveRecord\Config->set_default_connection
-	 * @return Connection
-	 * @see parse_connection_url
-	 */
-	public static function instance($connection_string_or_connection_name=null)
-	{
-		$config = Config::instance();
-
-		if (strpos($connection_string_or_connection_name,'://') === false)
-		{
-			$connection_string = $connection_string_or_connection_name ?
-				$config->get_connection($connection_string_or_connection_name) :
-				$config->get_default_connection_string();
-		}
-		else
-			$connection_string = $connection_string_or_connection_name;
-
-		if (!$connection_string)
-			throw new DatabaseException("Empty connection string");
-
-		$info = static::parse_connection_url($connection_string);
-		$fqclass = static::load_adapter_class($info->protocol);
-
-		try {
-			$connection = new $fqclass($info);
-			$connection->protocol = $info->protocol;
-			$connection->logging = $config->get_logging();
-			$connection->logger = $connection->logging ? $config->get_logger() : null;
-		} catch (PDOException $e) {
-			throw new DatabaseException($e);
-		}
-		return $connection;
-	}
-
-	/**
-	 * Loads the specified class for an adapter.
-	 *
-	 * @param string $adapter Name of the adapter.
-	 * @return string The full name of the class including namespace.
-	 */
-	private static function load_adapter_class($adapter)
-	{
-		$class = ucwords($adapter) . 'Adapter';
-		$fqclass = 'ActiveRecord\\' . $class;
-		$source = dirname(__FILE__) . "/adapters/$class.php";
-
-		if (!file_exists($source))
-			throw new DatabaseException("$fqclass not found!");
-
-		require_once($source);
-		return $fqclass;
-	}
-
-	/**
-	 * Use this for any adapters that can take connection info in the form below
-	 * to set the adapters connection info.
-	 *
-	 * <code>
-	 * protocol://username:password@host[:port]/dbname
-	 * protocol://urlencoded%20username:urlencoded%20password@host[:port]/dbname?decode=true
-	 * protocol://username:password@unix(/some/file/path)/dbname
-	 * </code>
-	 *
-	 * @param string $connection_url A connection URL
-	 * @return object the parsed URL as an object.
-	 */
-	public static function parse_connection_url($connection_url)
-	{
-		$url = @parse_url($connection_url);
-
-		if (!isset($url['host']))
-			throw new DatabaseException('Database host must be specified in the connection string.');
-
-		$info = new \stdClass();
-		$info->protocol = $url['scheme'];
-		$info->host		= $url['host'];
-		$info->db		= isset($url['path']) ? substr($url['path'],1) : null;
-		$info->user		= isset($url['user']) ? $url['user'] : null;
-		$info->pass		= isset($url['pass']) ? $url['pass'] : null;
-
-		if ($info->host == 'unix(')
-		{
-			$socket_database = $info->host . '/' . $info->db;
-
-			if (preg_match_all('/^unix\((.+)\)\/(.+)$/', $socket_database, $matches) > 0)
-			{
-				$info->host = $matches[1][0];
-				$info->db = $matches[2][0];
-			}
-		}
-
-		if (isset($url['port']))
-			$info->port = $url['port'];
-
-		if (strpos($connection_url,'decode=true') !== false)
-		{
-			if ($info->user)
-				$info->user = urldecode($info->user);
-
-			if ($info->pass)
-				$info->pass = urldecode($info->pass);
-		}
-
-		return $info;
-	}
-
-	/**
-	 * Class Connection is a singleton. Access it via instance().
-	 *
-	 * @param array $info Array containing URL parts
-	 * @return Connection
-	 */
-	protected function __construct($info)
-	{
-		try
-		{
-			// unix sockets start with a /
-			if ($info->host[0] != '/')
-			{
-				$host = "host=$info->host";
-
-				if (isset($info->port))
-					$host .= ";port=$info->port";
-			}
-			else
-				$host = "unix_socket=$info->host";
-
-			$this->connection = new PDO("$info->protocol:$host;dbname=$info->db",$info->user,$info->pass,static::$PDO_OPTIONS);
-		} catch (PDOException $e) {
-			throw new DatabaseException($e);
-		}
-	}
-
-	/**
-	 * Retrieves column meta data for the specified table.
-	 *
-	 * @param string $table Name of a table
-	 * @return array An array of {@link Column} objects.
-	 */
-	public function columns($table)
-	{
-		$columns = array();
-		$sth = $this->query_column_info($table);
-
-		while (($row = $sth->fetch()))
-		{
-			$c = $this->create_column($row);
-			$columns[$c->name] = $c;
-		}
-		return $columns;
-	}
-
-	/**
-	 * Escapes quotes in a string.
-	 *
-	 * @param string $string The string to be quoted.
-	 * @return string The string with any quotes in it properly escaped.
-	 */
-	public function escape($string)
-	{
-		return $this->connection->quote($string);
-	}
-
-	/**
-	 * Retrieve the insert id of the last model saved.
-	 *
-	 * @param string $sequence Optional name of a sequence to use
-	 * @return int
-	 */
-	public function insert_id($sequence=null)
-	{
-		return $this->connection->lastInsertId($sequence);
-	}
-
-	/**
-	 * Execute a raw SQL query on the database.
-	 *
-	 * @param string $sql Raw SQL string to execute.
-	 * @param array &$values Optional array of bind values
-	 * @return mixed A result set object
-	 */
-	public function query($sql, &$values=array())
-	{
-		if ($this->logging)
-			$this->logger->log($sql);
-
-		$this->last_query = $sql;
-
-		try {
-			if (!($sth = $this->connection->prepare($sql)))
-				throw new DatabaseException($this);
-		} catch (PDOException $e) {
-			throw new DatabaseException($this);
-		}
-
-		$sth->setFetchMode(PDO::FETCH_ASSOC);
-
-		try {
-			if (!$sth->execute($values))
-				throw new DatabaseException($this);
-		} catch (PDOException $e) {
-			throw new DatabaseException($sth);
-		}
-		return $sth;
-	}
-
-	/**
-	 * Execute a query that returns maximum of one row with one field and return it.
-	 *
-	 * @param string $sql Raw SQL string to execute.
-	 * @param array &$values Optional array of values to bind to the query.
-	 * @return string
-	 */
-	public function query_and_fetch_one($sql, &$values=array())
-	{
-		$sth = $this->query($sql,$values);
-		$row = $sth->fetch(PDO::FETCH_NUM);
-		return $row[0];
-	}
-
-	/**
-	 * Execute a raw SQL query and fetch the results.
-	 *
-	 * @param string $sql Raw SQL string to execute.
-	 * @param Closure $handler Closure that will be passed the fetched results.
-	 */
-	public function query_and_fetch($sql, Closure $handler)
-	{
-		$sth = $this->query($sql);
-
-		while (($row = $sth->fetch(PDO::FETCH_ASSOC)))
-			$handler($row);
-	}
-
-	/**
-	 * Returns all tables for the current database.
-	 *
-	 * @return array Array containing table names.
-	 */
-	public function tables()
-	{
-		$tables = array();
-		$sth = $this->query_for_tables();
-
-		while (($row = $sth->fetch(PDO::FETCH_NUM)))
-			$tables[] = $row[0];
-
-		return $tables;
-	}
-
-	/**
-	 * Starts a transaction.
-	 */
-	public function transaction()
-	{
-		if (!$this->connection->beginTransaction())
-			throw new DatabaseException($this);
-	}
-
-	/**
-	 * Commits the current transaction.
-	 */
-	public function commit()
-	{
-		if (!$this->connection->commit())
-			throw new DatabaseException($this);
-	}
-
-	/**
-	 * Rollback a transaction.
-	 */
-	public function rollback()
-	{
-		if (!$this->connection->rollback())
-			throw new DatabaseException($this);
-	}
-
-	/**
-	 * Tells you if this adapter supports sequences or not.
-	 *
-	 * @return boolean
-	 */
-	function supports_sequences() { return false; }
-
-	/**
-	 * Return a default sequence name for the specified table.
-	 *
-	 * @param string $table Name of a table
-	 * @param string $column_name Name of column sequence is for
-	 * @return string sequence name or null if not supported.
-	 */
-	public function get_sequence_name($table, $column_name)
-	{
-		return "{$table}_seq";
-	}
-
-	/**
-	 * Return SQL for getting the next value in a sequence.
-	 *
-	 * @param string $sequence_name Name of the sequence
-	 * @return string
-	 */
-	public function next_sequence_value($sequence_name) { return null; }
-
-	/**
-	 * Quote a name like table names and field names.
-	 *
-	 * @param string $string String to quote.
-	 * @return string
-	 */
-	public function quote_name($string)
-	{
-		return $string[0] === static::$QUOTE_CHARACTER || $string[strlen($string)-1] === static::$QUOTE_CHARACTER ?
-			$string : static::$QUOTE_CHARACTER . $string . static::$QUOTE_CHARACTER;
-	}
-
-	/**
-	 * Return a date time formatted into the database's date format.
-	 *
-	 * @param DateTime $datetime The DateTime object
-	 * @return string
-	 */
-	public function date_to_string($datetime)
-	{
-		return $datetime->format('Y-m-d');
-	}
-
-	/**
-	 * Return a date time formatted into the database's datetime format.
-	 *
-	 * @param DateTime $datetime The DateTime object
-	 * @return string
-	 */
-	public function datetime_to_string($datetime)
-	{
-		return $datetime->format('Y-m-d H:i:s T');
-	}
-
-	/**
-	 * Converts a string representation of a datetime into a DateTime object.
-	 *
-	 * @param string $string A datetime in the form accepted by date_create()
-	 * @return DateTime
-	 */
-	public function string_to_datetime($string)
-	{
-		$date = date_create($string);
-		$errors = \DateTime::getLastErrors();
-
-		if ($errors['warning_count'] > 0 || $errors['error_count'] > 0)
-			return null;
-
-		return new DateTime($date->format('Y-m-d H:i:s T'));
-	}
-
-	/**
-	 * Adds a limit clause to the SQL query.
-	 *
-	 * @param string $sql The SQL statement.
-	 * @param int $offset Row offset to start at.
-	 * @param int $limit Maximum number of rows to return.
-	 * @return string The SQL query that will limit results to specified parameters
-	 */
-	abstract function limit($sql, $offset, $limit);
-
-	/**
-	 * Query for column meta info and return statement handle.
-	 *
-	 * @param string $table Name of a table
-	 * @return PDOStatement
-	 */
-	abstract public function query_column_info($table);
-
-	/**
-	 * Query for all tables in the current database. The result must only
-	 * contain one column which has the name of the table.
-	 *
-	 * @return PDOStatement
-	 */
-	abstract function query_for_tables();
-};
-?>
diff --git a/lib/ar/ConnectionManager.php b/lib/ar/ConnectionManager.php
deleted file mode 100644
index a421a4b..0000000
--- a/lib/ar/ConnectionManager.php
+++ /dev/null
@@ -1,38 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Singleton to manage any and all database connections.
- *
- * @package ActiveRecord
- */
-class ConnectionManager extends Singleton
-{
-	/**
-	 * Array of {@link Connection} objects.
-	 * @var array
-	 */
-	static private $connections = array();
-
-	/**
-	 * If $name is null then the default connection will be returned.
-	 *
-	 * @see Config
-	 * @param string $name Optional name of a connection
-	 * @return Connection
-	 */
-	public static function get_connection($name=null)
-	{
-		if (!isset(self::$connections[$name]) || !self::$connections[$name]->connection)
-		{
-			$config = Config::instance();
-			$connection_string = $name ? $config->get_connection($name) : $config->get_default_connection();
-			self::$connections[$name] = Connection::instance($connection_string);
-		}
-		return self::$connections[$name];
-	}
-};
-?>
diff --git a/lib/ar/DateTime.php b/lib/ar/DateTime.php
deleted file mode 100644
index 3dbefb1..0000000
--- a/lib/ar/DateTime.php
+++ /dev/null
@@ -1,45 +0,0 @@
-<?php
-namespace ActiveRecord;
-
-class DateTime extends \DateTime
-{
-	private $model;
-	private $attribute_name;
-
-	public function attribute_of($model, $attribute_name)
-	{
-		$this->model = $model;
-		$this->attribute_name = $attribute_name;
-	}
-
-	private function flag_dirty()
-	{
-		if ($this->model)
-			$this->model->flag_dirty($this->attribute_name);
-	}
-
-	public function setDate($year, $month, $day)
-	{
-		$this->flag_dirty();
-		call_user_func_array(array($this,'parent::setDate'),func_get_args());
-	}
-
-	public function setISODate($year, $week , $day=null)
-	{
-		$this->flag_dirty();
-		call_user_func_array(array($this,'parent::setISODate'),func_get_args());
-	}
-
-	public function setTime($hour, $minute, $second=null)
-	{
-		$this->flag_dirty();
-		call_user_func_array(array($this,'parent::setTime'),func_get_args());
-	}
-
-	public function setTimestamp($unixtimestamp)
-	{
-		$this->flag_dirty();
-		call_user_func_array(array($this,'parent::setTimestamp'),func_get_args());
-	}
-}
-?>
\ No newline at end of file
diff --git a/lib/ar/Exceptions.php b/lib/ar/Exceptions.php
deleted file mode 100644
index db18165..0000000
--- a/lib/ar/Exceptions.php
+++ /dev/null
@@ -1,137 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Generic base exception for all ActiveRecord specific errors.
- *
- * @package ActiveRecord
- */
-class ActiveRecordException extends \Exception {};
-
-/**
- * Thrown when a record cannot be found.
- *
- * @package ActiveRecord
- */
-class RecordNotFound extends ActiveRecordException {};
-
-/**
- * Thrown when there was an error performing a database operation.
- *
- * The error will be specific to whatever database you are running.
- *
- * @package ActiveRecord
- */
-class DatabaseException extends ActiveRecordException
-{
-	public function __construct($adapter_or_string_or_mystery)
-	{
-		if ($adapter_or_string_or_mystery instanceof Connection)
-		{
-			parent::__construct(
-				join(", ",$adapter_or_string_or_mystery->connection->errorInfo()),
-				intval($adapter_or_string_or_mystery->connection->errorCode()));
-		}
-		elseif ($adapter_or_string_or_mystery instanceof \PDOStatement)
-		{
-			parent::__construct(
-				join(", ",$adapter_or_string_or_mystery->errorInfo()),
-				intval($adapter_or_string_or_mystery->errorCode()));
-		}
-		else
-			parent::__construct($adapter_or_string_or_mystery);
-	}
-};
-
-/**
- * Thrown by {@link Model}.
- *
- * @package ActiveRecord
- */
-class ModelException extends ActiveRecordException {};
-
-/**
- * Thrown by {@link Expressions}.
- *
- * @package ActiveRecord
- */
-class ExpressionsException extends ActiveRecordException {};
-
-/**
- * Thrown for configuration problems.
- *
- * @package ActiveRecord
- */
-class ConfigException extends ActiveRecordException {};
-
-/**
- * Thrown when attempting to access an invalid property on a {@link Model}.
- *
- * @package ActiveRecord
- */
-class UndefinedPropertyException extends ModelException
-{
-	/**
-	 * Sets the exception message to show the undefined property's name.
-	 *
-	 * @param str $property_name name of undefined property
-	 * @return void
-	 */
-	public function __construct($class_name, $property_name)
-	{
-		if (is_array($property_name))
-		{
-			$this->message = implode("\r\n", $property_name);
-			return;
-		}
-
-		$this->message = "Undefined property: {$class_name}->{$property_name} in {$this->file} on line {$this->line}";
-		parent::__construct();
-	}
-};
-
-/**
- * Thrown when attempting to perform a write operation on a {@link Model} that is in read-only mode.
- *
- * @package ActiveRecord
- */
-class ReadOnlyException extends ModelException
-{
-	/**
-	 * Sets the exception message to show the undefined property's name.
-	 *
-	 * @param str $class_name name of the model that is read only
-	 * @param str $method_name name of method which attempted to modify the model
-	 * @return void
-	 */
-	public function __construct($class_name, $method_name)
-	{
-		$this->message = "{$class_name}::{$method_name}() cannot be invoked because this model is set to read only";
-		parent::__construct();
-	}
-};
-
-/**
- * Thrown for validations exceptions.
- *
- * @package ActiveRecord
- */
-class ValidationsArgumentError extends ActiveRecordException {};
-
-/**
- * Thrown for relationship exceptions.
- *
- * @package ActiveRecord
- */
-class RelationshipException extends ActiveRecordException {};
-
-/**
- * Thrown for has many thru exceptions.
- *
- * @package ActiveRecord
- */
-class HasManyThroughAssociationException extends RelationshipException {};
-?>
\ No newline at end of file
diff --git a/lib/ar/Expressions.php b/lib/ar/Expressions.php
deleted file mode 100644
index ee7509c..0000000
--- a/lib/ar/Expressions.php
+++ /dev/null
@@ -1,183 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Templating like class for building SQL statements.
- *
- * Examples:
- * 'name = :name AND author = :author'
- * 'id = IN(:ids)'
- * 'id IN(:subselect)'
- * 
- * @package ActiveRecord
- */
-class Expressions
-{
-	const ParameterMarker = '?';
-
-	private $expressions;
-	private $values = array();
-	private $connection;
-
-	public function __construct($connection, $expressions=null /* [, $values ... ] */)
-	{
-		$values = null;
-		$this->connection = $connection;
-
-		if (is_array($expressions))
-		{
-			$glue = func_num_args() > 2 ? func_get_arg(2) : ' AND ';
-			list($expressions,$values) = $this->build_sql_from_hash($expressions,$glue);
-		}
-
-		if ($expressions != '')
-		{
-			if (!$values)
-				$values = array_slice(func_get_args(),2);
-
-			$this->values = $values;
-			$this->expressions = $expressions;
-		}
-	}
-
-	/**
-	 * Bind a value to the specific one based index. There must be a bind marker
-	 * for each value bound or to_s() will throw an exception.
-	 */
-	public function bind($parameter_number, $value)
-	{
-		if ($parameter_number <= 0)
-			throw new ExpressionsException("Invalid parameter index: $parameter_number");
-
-		$this->values[$parameter_number-1] = $value;
-	}
-
-	public function bind_values($values)
-	{
-		$this->values = $values;
-	}
-
-	/**
-	 * Returns all the values currently bound.
-	 */
-	public function values()
-	{
-		return $this->values;
-	}
-
-	/**
-	 * Returns the connection object.
-	 */
-	public function get_connection()
-	{
-		return $this->connection;
-	}
-
-	/**
-	 * Sets the connection object. It is highly recommended to set this so we can
-	 * use the adapter's native escaping mechanism.
-	 *
-	 * @param string $connection a Connection instance
-	 */
-	public function set_connection($connection)
-	{
-		$this->connection = $connection;
-	}
-
-	public function to_s($substitute=false, &$options=null)
-	{
-		if (!$options) $options = array();
-		
-		$values = array_key_exists('values',$options) ? $options['values'] : $this->values;
-
-		$ret = "";
-		$replace = array();
-		$num_values = count($values);
-		$len = strlen($this->expressions);
-		$quotes = 0;
-
-		for ($i=0,$n=strlen($this->expressions),$j=0; $i<$n; ++$i)
-		{
-			$ch = $this->expressions[$i];
-
-			if ($ch == self::ParameterMarker)
-			{
-				if ($quotes % 2 == 0)
-				{
-					if ($j > $num_values-1)
-						throw new ExpressionsException("No bound parameter for index $j");
-
-					$ch = $this->substitute($values,$substitute,$i,$j++);
-				}
-			}
-			elseif ($ch == '\'' && $i > 0 && $this->expressions[$i-1] != '\\')
-				++$quotes;
-
-			$ret .= $ch;
-		}
-		return $ret;
-	}
-
-	private function build_sql_from_hash(&$hash, $glue)
-	{
-		$sql = $g = "";
-
-		foreach ($hash as $name => $value)
-		{
-			if ($this->connection)
-				$name = $this->connection->quote_name($name);
-
-			if (is_array($value))
-				$sql .= "$g$name IN(?)";
-			else
-				$sql .= "$g$name=?";
-
-			$g = $glue;
-		}
-		return array($sql,array_values($hash));
-	}
-
-	private function substitute(&$values, $substitute, $pos, $parameter_index)
-	{
-		$value = $values[$parameter_index];
-
-		if (is_array($value))
-		{
-			if ($substitute)
-			{
-				$ret = '';
-
-				for ($i=0,$n=count($value); $i<$n; ++$i)
-					$ret .= ($i > 0 ? ',' : '') . $this->stringify_value($value[$i]);
-
-				return $ret;
-			}
-			return join(',',array_fill(0,count($value),self::ParameterMarker));
-		}
-
-		if ($substitute)
-			return $this->stringify_value($value);
-
-		return $this->expressions[$pos];
-	}
-
-	private function stringify_value($value)
-	{
-		if (is_null($value))
-			return "NULL";
-
-		return is_string($value) ? $this->quote_string($value) : $value;
-	}
-
-	private function quote_string($value)
-	{
-		if ($this->connection)
-			return $this->connection->escape($value);
-
-		return "'" . str_replace("'","''",$value) . "'";
-	}
-}
-?>
diff --git a/lib/ar/Inflector.php b/lib/ar/Inflector.php
deleted file mode 100644
index f084655..0000000
--- a/lib/ar/Inflector.php
+++ /dev/null
@@ -1,115 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * @package ActiveRecord
- */
-abstract class Inflector
-{
-	/**
-	 * Get an instance of the {@link Inflector} class.
-	 *
-	 * @return object
-	 */
-	public static function instance()
-	{
-		return new StandardInflector();
-	}
-
-	/**
-	 * Turn a string into its camelized version.
-	 *
-	 * @param string $s string to convert
-	 * @return string
-	 */
-	public function camelize($s)
-	{
-		$s = preg_replace('/[_-]+/','_',trim($s));
-		$s = str_replace(' ', '_', $s);
-
-		$camelized = '';
-
-		for ($i=0,$n=strlen($s); $i<$n; ++$i)
-		{
-			if ($s[$i] == '_' && $i+1 < $n)
-				$camelized .= strtoupper($s[++$i]);
-			else
-				$camelized .= $s[$i];
-		}
-
-		$camelized = trim($camelized,' _');
-
-		if (strlen($camelized) > 0)
-			$camelized[0] = strtolower($camelized[0]);
-
-		return $camelized;
-	}
-
-	/**
-	 * Determines if a string contains all uppercase characters.
-	 *
-	 * @param string $s string to check
-	 * @return bool
-	 */
-	public static function is_upper($s)
-	{
-		return (strtoupper($s) === $s);
-	}
-
-	/**
-	 * Determines if a string contains all lowercase characters.
-	 *
-	 * @param string $s string to check
-	 * @return bool
-	 */
-	public static function is_lower($s)
-	{
-		return (strtolower($s) === $s);
-	}
-
-	/**
-	 * Convert a camelized string to a lowercase, underscored string.
-	 *
-	 * @param string $s string to convert
-	 * @return string
-	 */
-	public function uncamelize($s)
-	{
-		$normalized = '';
-
-		for ($i=0,$n=strlen($s); $i<$n; ++$i)
-		{
-			if (ctype_alpha($s[$i]) && self::is_upper($s[$i]))
-				$normalized .= '_' . strtolower($s[$i]);
-			else
-				$normalized .= $s[$i];
-		}
-		return trim($normalized,' _');
-	}
-
-	/**
-	 * Convert a string with space into a underscored equivalent.
-	 *
-	 * @param string $s string to convert
-	 * @return string
-	 */
-	public function underscorify($s)
-	{
-		return preg_replace(array('/[_\- ]+/','/([a-z])([A-Z])/'),array('_','\\1_\\2'),trim($s));
-	}
-
-	abstract function variablize($s);
-}
-
-/**
- * @package ActiveRecord
- */
-class StandardInflector extends Inflector
-{
-	public function tableize($s) { return Utils::pluralize(strtolower($this->underscorify($s))); }
-	public function variablize($s) { return str_replace(array('-',' '),array('_','_'),strtolower(trim($s))); }
-}
-?>
\ No newline at end of file
diff --git a/lib/ar/Model.php b/lib/ar/Model.php
deleted file mode 100644
index 669a423..0000000
--- a/lib/ar/Model.php
+++ /dev/null
@@ -1,1673 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * The base class for your models.
- *
- * Defining an ActiveRecord model for a table called people and orders:
- *
- * <code>
- * CREATE TABLE people(
- *   id int primary key auto_increment,
- *   parent_id int,
- *   first_name varchar(50),
- *   last_name varchar(50)
- * );
- *
- * CREATE TABLE orders(
- *   id int primary key auto_increment,
- *   person_id int not null,
- *   cost decimal(10,2),
- *   total decimal(10,2)
- * );
- * </code>
- *
- * <code>
- * class Person extends ActiveRecord\Model {
- *   static $belongs_to = array(
- *     array('parent', 'foreign_key' => 'parent_id', 'class_name' => 'Person')
- *   );
- *
- *   static $has_many = array(
- *     array('children', 'foreign_key' => 'parent_id', 'class_name' => 'Person'),
- *     array('orders')
- *   );
- *
- *   static $validates_length_of = array(
- *     array('first_name', 'within' => array(1,50)),
- *     array('last_name', 'within' => array(1,50))
- *   );
- * }
- *
- * class Order extends ActiveRecord\Model {
- *   static $belongs_to = array(
- *     array('person')
- *   );
- *
- *   static $validates_numericality_of = array(
- *     array('cost', 'greater_than' => 0),
- *     array('total', 'greater_than' => 0)
- *   );
- *
- *   static $before_save = array('calculate_total_with_tax');
- *
- *   public function calculate_total_with_tax() {
- *     $this->total = $this->cost * 0.045;
- *   }
- * }
- * </code>
- *
- * For a more in-depth look at defining models, relationships, callbacks and many other things
- * please consult our {@link http://www.phpactiverecord.org/guides Guides}.
- *
- * @package ActiveRecord
- * @see BelongsTo
- * @see CallBack
- * @see HasMany
- * @see HasAndBelongsToMany
- * @see Serialization
- * @see Validations
- */
-class Model
-{
-	/**
-	 * An instance of {@link Errors} and will be instantiated once a write method is called.
-	 *
-	 * @var Errors
-	 */
-	public $errors;
-
-	/**
-	 * Contains model values as column_name => value
-	 *
-	 * @var array
-	 */
-	private $attributes = array();
-
-	/**
-	 * Flag whether or not this model's attributes have been modified since it will either be null or an array of column_names that have been modified
-	 *
-	 * @var array
-	 */
-	private $__dirty = null;
-
-	/**
-	 * Flag that determines of this model can have a writer method invoked such as: save/update/insert/delete
-	 *
-	 * @var boolean
-	 */
-	private $__readonly = false;
-
-	/**
-	 * Array of relationship objects as model_attribute_name => relationship
-	 *
-	 * @var array
-	 */
-	private $__relationships = array();
-
-	/**
-	 * Flag that determines if a call to save() should issue an insert or an update sql statement
-	 *
-	 * @var boolean
-	 */
-	private $__new_record = true;
-
-	/**
-	 * Set to the name of the connection this {@link Model} should use.
-	 *
-	 * @var string
-	 */
-	static $connection;
-
-	/**
-	 * Set to the name of the database this Model's table is in.
-	 *
-	 * @var string
-	 */
-	static $db;
-
-	/**
-	 * Set this to explicitly specify the model's table name if different from inferred name.
-	 *
-	 * If your table doesn't follow our table name convention you can set this to the
-	 * name of your table to explicitly tell ActiveRecord what your table is called.
-	 *
-	 * @var string
-	 */
-	static $table_name; 
-
-	/**
-	 * Set this to override the default primary key name if different from default name of "id".
-	 *
-	 * @var string
-	 */
-	static $primary_key;
-
-	/**
-	 * Set this to explicitly specify the sequence name for the table.
-	 *
-	 * @var string
-	 */
-	static $sequence;
-
-	/**
-	 * Allows you to create aliases for attributes.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $alias_attribute = array(
-	 *     'the_first_name' => 'first_name',
-	 *     'the_last_name' => 'last_name');
-	 * }
-	 *
-	 * $person = Person::first();
-	 * $person->the_first_name = 'Tito';
-	 * echo $person->the_first_name;
-	 * </code>
-	 *
-	 * @var array
-	 */
-	static $alias_attribute = array();
-
-	/**
-	 * Whitelist of attributes that are checked from mass-assignment calls such as constructing a model or using update_attributes.
-	 *
-	 * This is the opposite of {@link attr_protected $attr_protected}.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $attr_accessible = array('first_name','last_name');
-	 * }
-	 *
-	 * $person = new Person(array(
-	 *   'first_name' => 'Tito',
-	 *   'last_name' => 'the Grief',
-	 *   'id' => 11111));
-	 *
-	 * echo $person->id; # => null
-	 * </code>
-	 *
-	 * @var array
-	 */
-	static $attr_accessible = array();
-
-	/**
-	 * Blacklist of attributes that cannot be mass-assigned.
-	 *
-	 * This is the opposite of {@link attr_accessible $attr_accessible} and the format
-	 * for defining these are exactly the same.
-	 *
-	 * @var array
-	 */
-	static $attr_protected = array();
-
-	/**
-	 * Delegates calls to a relationship.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $belongs_to = array(array('venue'),array('host'));
-	 *   static $delegate = array(
-	 *     array('name', 'state', 'to' => 'venue'),
-	 *     array('name', 'to' => 'host', 'prefix' => 'woot'));
-	 * }
-	 * </code>
-	 *
-	 * Can then do:
-	 *
-	 * <code>
-	 * $person->state     # same as calling $person->venue->state
-	 * $person->name      # same as calling $person->venue->name
-	 * $person->woot_name # same as calling $person->host->name
-	 * </code>
-	 *
-	 * @var array
-	 */
-	static $delegate = array();
-
-	/**
-	 * Define customer setters methods for the model.
-	 *
-	 * You can also use this to define custom setters for attributes as well.
-	 *
-	 * <code>
-	 * class User extends ActiveRecord\Model {
-	 *   static $setters = array('password','more','even_more');
-	 *
-	 *   # now to define the setter methods. Note you must
-	 *   # prepend set_ to your method name:
-	 *   function set_password($plaintext) {
-	 *     $this->encrypted_password = md5($plaintext);
-	 *   }
-	 * }
-	 *
-	 * $user = new User();
-	 * $user->password = 'plaintext';  # will call $user->set_password('plaintext')
-	 * </code>
-	 *
-	 * If you define a custom setter with the same name as an attribute then you
-	 * will need to use assign_attribute() to assign the value to the attribute.
-	 * This is necessary due to the way __set() works.
-	 *
-	 * For example, assume 'name' is a field on the table and we're defining a
-	 * custom setter for 'name':
-	 *
-	 * <code>
-	 * class User extends ActiveRecord\Model {
-	 *   static $setters = array('name');
-	 *
-	 *   # INCORRECT way to do it
-	 *   # function set_name($name) {
-	 *   #   $this->name = strtoupper($name);
-	 *   # }
-	 *
-	 *   function set_name($name) {
-	 *     $this->assign_attribute('name',strtoupper($name));
-	 *   }
-	 * }
-	 *
-	 * $user = new User();
-	 * $user->name = 'bob';
-	 * echo $user->name; # => BOB
-	 * </code>
-	 *
-	 * @var array
-	 */
-	static $setters = array();
-
-	/**
-	 * Define customer getter methods for the model.
-	 *
-	 * <code>
-	 * class User extends ActiveRecord\Model {
-	 *   static $getters = array('middle_initial','more','even_more');
-	 *
-	 *   # now to define the getter method. Note you must
-	 *   # prepend get_ to your method name:
-	 *   function get_middle_initial() {
-	 *     return $this->middle_name{0};
-	 *   }
-	 * }
-	 *
-	 * $user = new User();
-	 * echo $user->middle_name;  # will call $user->get_middle_name()
-	 * </code>
-	 *
-	 * If you define a custom getter with the same name as an attribute then you
-	 * will need to use read_attribute() to get the attribute's value.
-	 * This is necessary due to the way __get() works.
-	 *
-	 * For example, assume 'name' is a field on the table and we're defining a
-	 * custom getter for 'name':
-	 *
-	 * <code>
-	 * class User extends ActiveRecord\Model {
-	 *   static $getters = array('name');
-	 *
-	 *   # INCORRECT way to do it
-	 *   # function get_name() {
-	 *   #   return strtoupper($this->name);
-	 *   # }
-	 *
-	 *   function get_name() {
-	 *     return strtoupper($this->read_attribute('name'));
-	 *   }
-	 * }
-	 *
-	 * $user = new User();
-	 * $user->name = 'bob';
-	 * echo $user->name; # => BOB
-	 * </code>
-	 *
-	 * @var array
-	 */
-	static $getters = array();
-
-	/**
-	 * Constructs a model.
-	 *
-	 * When a user instantiates a new object (e.g.: it was not ActiveRecord that instantiated via a find)
-	 * then @var $attributes will be mapped according to the schema's defaults. Otherwise, the given
-	 * $attributes will be mapped via set_attributes_via_mass_assignment.
-	 *
-	 * <code>
-	 * new Person(array('first_name' => 'Tito', 'last_name' => 'the Grief'));
-	 * </code>
-	 *
-	 * @param array $attributes Hash containing names and values to mass assign to the model
-	 * @param boolean $guard_attributes Set to true to guard attributes
-	 * @param boolean $instantiating_via_find Set to true if this model is being created from a find call
-	 * @param boolean $new_record Set to true if this should be considered a new record
-	 * @return Model
-	 */
-	public function __construct(array $attributes=array(), $guard_attributes=true, $instantiating_via_find=false, $new_record=true)
-	{
-		$this->__new_record = $new_record;
-
-		// initialize attributes applying defaults
-		if (!$instantiating_via_find)
-		{
-			foreach (static::table()->columns as $name => $meta)
-				$this->attributes[$meta->inflected_name] = $meta->default;
-		}
-
-		$this->set_attributes_via_mass_assignment($attributes, $guard_attributes);
-
-		// since all attribute assignment now goes thru assign_attributes() we want to reset
-		// dirty if instantiating via find since nothing is really dirty when doing that
-		if ($instantiating_via_find)
-			$this->__dirty = array();
-
-		$this->invoke_callback('after_construct',false);
-	}
-
-	/**
-	 * Magic method which delegates to read_attribute(). This handles firing off getter methods,
-	 * as they are not checked/invoked inside of read_attribute(). This circumvents the problem with
-	 * a getter being accessed with the same name as an actual attribute.
-	 *
-	 * @see read_attribute()
-	 * @param string $name Name of an attribute
-	 * @return mixed The value of the attribute
-	 */
-	public function &__get($name)
-	{
-		// check for getter
-		if (in_array("get_$name",static::$getters))
-		{
-			$name = "get_$name";
-			$value = $this->$name();
-			return $value;
-		}
-
-		return $this->read_attribute($name);
-	}
-
-	/**
-	 * Determines if an attribute exists for this {@link Model}.
-	 *
-	 * @param string $attribute_name
-	 * @return boolean
-	 */
-	public function __isset($attribute_name)
-	{
-		return array_key_exists($attribute_name,$this->attributes) || array_key_exists($attribute_name,static::$alias_attribute);
-	}
-
-	/**
-	 * Magic allows un-defined attributes to set via $attributes
-	 *
-	 * @throws {@link UndefinedPropertyException} if $name does not exist
-	 * @param string $name Name of attribute, relationship or other to set
-	 * @param mixed $value The value
-	 * @return mixed The value
-	 */
-	public function __set($name, $value)
-	{
-		if (array_key_exists($name, static::$alias_attribute))
-			$name = static::$alias_attribute[$name];
-
-		elseif (in_array("set_$name",static::$setters))
-		{
-			$name = "set_$name";
-			return $this->$name($value);
-		}
-
-		if (array_key_exists($name,$this->attributes))
-			return $this->assign_attribute($name,$value);
-
-		foreach (static::$delegate as &$item)
-		{
-			if (($delegated_name = $this->is_delegated($name,$item)))
-				return $this->$item['to']->$delegated_name = $value;
-		}
-
-		throw new UndefinedPropertyException(get_called_class(),$name);
-	}
-
-	public function __wakeup()
-	{
-		// make sure the models Table instance gets initialized when waking up
-		static::table();
-	}
-
-	/**
-	 * Assign a value to an attribute.
-	 *
-	 * @param string $name Name of the attribute
-	 * @param mixed &$value Value of the attribute
-	 * @return mixed the attribute value
-	 */
-	public function assign_attribute($name, $value)
-	{
-		$table = static::table();
-
-		if (array_key_exists($name,$table->columns) && !is_object($value))
-			$value = $table->columns[$name]->cast($value,static::connection());
-
-		// convert php's \DateTime to ours
-		if ($value instanceof \DateTime)
-			$value = new DateTime($value->format('Y-m-d H:i:s T'));
-
-		// make sure DateTime values know what model they belong to so
-		// dirty stuff works when calling set methods on the DateTime object
-		if ($value instanceof DateTime)
-			$value->attribute_of($this,$name);
-
-		$this->attributes[$name] = $value;
-		$this->flag_dirty($name);
-		return $value;
-	}
-
-	/**
-	 * Retrieves an attribute's value or a relationship object based on the name passed. If the attribute
-	 * accessed is 'id' then it will return the model's primary key no matter what the actual attribute name is
-	 * for the primary key.
-	 *
-	 * @param string $name Name of an attribute
-	 * @return mixed The value of the attribute
-	 * @throws {@link UndefinedPropertyException} if name could not be resolved to an attribute, relationship, ...
-	 */
-	public function &read_attribute($name)
-	{
-		// check for aliased attribute
-		if (array_key_exists($name, static::$alias_attribute))
-			$name = static::$alias_attribute[$name];
-
-		// check for attribute
-		if (array_key_exists($name,$this->attributes))
-			return $this->attributes[$name];
-
-		// check relationships if no attribute
-		if (array_key_exists($name,$this->__relationships))
-			return $this->__relationships[$name];
-
-		$table = static::table();
-
-		// this may be first access to the relationship so check Table
-		if (($relationship = $table->get_relationship($name)))
-		{
-			$this->__relationships[$name] = $relationship->load($this);
-			return $this->__relationships[$name];
-		}
-
-		if ($name == 'id')
-		{
-			if (count($this->get_primary_key()) > 1)
-				throw new Exception("TODO composite key support");
-
-			if (isset($this->attributes[$table->pk[0]]))
-				return $this->attributes[$table->pk[0]];
-		}
-
-		//do not remove - have to return null by reference in strict mode
-		$null = null;
-
-		foreach (static::$delegate as &$item)
-		{
-			if (($delegated_name = $this->is_delegated($name,$item)))
-			{
-				$to = $item['to'];
-				if ($this->$to)
-				{
-					$val =& $this->$to->$delegated_name;
-					return $val;
-				}
-				else
-					return $null;
-			}
-		}
-
-		throw new UndefinedPropertyException(get_called_class(),$name);
-	}
-
-	/**
-	 * Flags an attribute as dirty.
-	 *
-	 * @param string $name Attribute name
-	 */
-	public function flag_dirty($name)
-	{
-		if (!$this->__dirty)
-			$this->__dirty = array();
-
-		$this->__dirty[$name] = true;
-	}
-
-	/**
-	 * Returns hash of attributes that have been modified since loading the model.
-	 *
-	 * @return mixed null if no dirty attributes otherwise returns array of dirty attributes.
-	 */
-	public function dirty_attributes()
-	{
-		if (!$this->__dirty)
-			return null;
-
-		$dirty = array_intersect_key($this->attributes,$this->__dirty);
-		return !empty($dirty) ? $dirty : null;
-	}
-
-	/**
-	 * Returns a copy of the model's attributes hash.
-	 *
-	 * @return array A copy of the model's attribute data
-	 */
-	public function attributes()
-	{
-		return $this->attributes;
-	}
-
-	/**
-	 * Retrieve the primary key name.
-	 *
-	 * @return string The primary key for the model
-	 */
-	public function get_primary_key()
-	{
-		return Table::load(get_class($this))->pk;
-	}
-
-	/**
-	 * Returns the actual attribute name if $name is aliased.
-	 *
-	 * @param string $name An attribute name
-	 * @return string
-	 */
-	public function get_real_attribute_name($name)
-	{
-		if (array_key_exists($name,$this->attributes))
-			return $name;
-
-		if (array_key_exists($name,static::$alias_attribute))
-			return static::$alias_attribute[$name];
-
-		return null;
-	}
-
-	/**
-	 * Returns array of validator data for this Model.
-	 *
-	 * Will return an array looking like:
-	 *
-	 * <code>
-	 * array(
-	 *   'name' => array(
-	 *     array('validator' => 'validates_presence_of'),
-	 *     array('validator' => 'validates_inclusion_of', 'in' => array('Bob','Joe','John')),
-	 *   'password' => array(
-	 *     array('validator' => 'validates_length_of', 'minimum' => 6))
-	 *   )
-	 * );
-	 * </code>
-	 *
-	 * @return array An array containing validator data for this model.
-	 */
-	public function get_validation_rules()
-	{
-		require_once 'Validations.php';
-
-		$validator = new Validations($this);
-		return $validator->rules();
-	}
-
-	/**
-	 * Returns an associative array containing values for all the attributes in $attributes
-	 *
-	 * @param array $attributes Array containing attribute names
-	 * @return array A hash containing $name => $value
-	 */
-	public function get_values_for($attributes)
-	{
-		$ret = array();
-
-		foreach ($attributes as $name)
-		{
-			if (array_key_exists($name,$this->attributes))
-				$ret[$name] = $this->attributes[$name];
-		}
-		return $ret;
-	}
-
-	/**
-	 * Retrieves the name of the table for this Model.
-	 *
-	 * @return string
-	 */
-	public static function table_name()
-	{
-		return static::table()->table;
-	}
-
-	/**
-	 * Returns the attribute name on the delegated relationship if $name is
-	 * delegated or null if not delegated.
-	 *
-	 * @param string $name Name of an attribute
-	 * @param array $delegate An array containing delegate data
-	 * @return delegated attribute name or null
-	 */
-	private function is_delegated($name, &$delegate)
-	{
-		if ($delegate['prefix'] != '')
-			$name = substr($name,strlen($delegate['prefix'])+1);
-
-		if (is_array($delegate) && in_array($name,$delegate['delegate']))
-			return $name;
-
-		return null;
-	}
-
-	/**
-	 * Determine if the model is in read-only mode.
-	 *
-	 * @return boolean
-	 */
-	public function is_readonly()
-	{
-		return $this->__readonly;
-	}
-
-	/**
-	 * Determine if the model is a new record.
-	 *
-	 * @return boolean
-	 */
-	public function is_new_record()
-	{
-		return $this->__new_record;
-	}
-
-	/**
-	 * Throws an exception if this model is set to readonly.
-	 *
-	 * @throws ActiveRecord\ReadOnlyException
-	 * @param string $method_name Name of method that was invoked on model for exception message
-	 */
-	private function verify_not_readonly($method_name)
-	{
-		if ($this->is_readonly())
-			throw new ReadOnlyException(get_class($this), $method_name);
-	}
-
-	/**
-	 * Flag model as readonly.
-	 *
-	 * @param boolean $readonly Set to true to put the model into readonly mode
-	 */
-	public function readonly($readonly=true)
-	{
-		$this->__readonly = $readonly;
-	}
-
-	/**
-	 * Retrieve the connection for this model.
-	 *
-	 * @return Connection
-	 */
-	public static function connection()
-	{
-		return static::table()->conn;
-	}
-
-	/**
-	 * Returns the {@link Table} object for this model.
-	 *
-	 * Be sure to call in static scoping: static::table()
-	 *
-	 * @return Table
-	 */
-	public static function table()
-	{
-		return Table::load(get_called_class());
-	}
-
-	/**
-	 * Creates a model and saves it to the database.
-	 *
-	 * @param array $attributes Array of the models attributes
-	 * @param boolean $validate True if the validators should be run
-	 * @return Model
-	 */
-	public static function create($attributes, $validate=true)
-	{
-		$class_name = get_called_class();
-		$model = new $class_name($attributes);
-		$model->save($validate);
-		return $model;
-	}
-
-	/**
-	 * Save the model to the database.
-	 *
-	 * This function will automatically determine if an INSERT or UPDATE needs to occur.
-	 * If a validation or a callback for this model returns false, then the model will
-	 * not be saved and this will return false.
-	 *
-	 * If saving an existing model only data that has changed will be saved.
-	 *
-	 * @param boolean $validate Set to true or false depending on if you want the validators to run or not
-	 * @return boolean True if the model was saved to the database otherwise false
-	 */
-	public function save($validate=true)
-	{
-		$this->verify_not_readonly('save');
-		return $this->is_new_record() ? $this->insert($validate) : $this->update($validate);
-	}
-
-	/**
-	 * Issue an INSERT sql statement for this model's attribute.
-	 *
-	 * @see save
-	 * @param boolean $validate Set to true or false depending on if you want the validators to run or not
-	 * @return boolean True if the model was saved to the database otherwise false
-	 */
-	private function insert($validate=true)
-	{
-		$this->verify_not_readonly('insert');
-
-		if (($validate && !$this->_validate() || !$this->invoke_callback('before_create',false)))
-			return false;
-
-		$table = static::table();
-
-		if (!($attributes = $this->dirty_attributes()))
-			$attributes = $this->attributes;
-
-		$pk = $this->get_primary_key();
-		$use_sequence = false;
-
-		if ($table->sequence && !isset($attributes[$pk[0]]))
-		{
-			if (($conn = static::connection()) instanceof OciAdapter)
-			{
-				// terrible oracle makes us select the nextval first
-				$attributes[$pk[0]] = $conn->get_next_sequence_value($table->sequence);
-				$table->insert($attributes);
-				$this->attributes[$pk[0]] = $attributes[$pk[0]];
-			}
-			else
-			{
-				// unset pk that was set to null
-				if (array_key_exists($pk[0],$attributes))
-					unset($attributes[$pk[0]]);
-
-				$table->insert($attributes,$pk[0],$table->sequence);
-				$use_sequence = true;
-			}
-		}
-		else
-			$table->insert($attributes);
-
-		// if we've got an autoincrementing/sequenced pk set it
-		if (count($pk) == 1)
-		{
-			$column = $table->get_column_by_inflected_name($pk[0]);
-
-			if ($column->auto_increment || $use_sequence)
-				$this->attributes[$pk[0]] = $table->conn->insert_id($table->sequence);
-		}
-
-		$this->invoke_callback('after_create',false);
-		$this->__new_record = false;
-		return true;
-	}
-
-	/**
-	 * Issue an UPDATE sql statement for this model's dirty attributes.
-	 *
-	 * @see save
-	 * @param boolean $validate Set to true or false depending on if you want the validators to run or not
-	 * @return boolean True if the model was saved to the database otherwise false
-	 */
-	private function update($validate=true)
-	{
-		$this->verify_not_readonly('update');
-
-		if ($validate && !$this->_validate())
-			return false;
-
-		if ($this->is_dirty())
-		{
-			$pk = $this->values_for_pk();
-
-			if (empty($pk))
-				throw new ActiveRecordException("Cannot update, no primary key defined for: " . get_called_class());
-
-			if (!$this->invoke_callback('before_update',false))
-				return false;
-
-			$dirty = $this->dirty_attributes();
-			static::table()->update($dirty,$pk);
-			$this->invoke_callback('after_update',false);
-		}
-
-		return true;
-	}
-
-	/**
-	 * Deletes this model from the database and returns true if successful.
-	 *
-	 * @return boolean
-	 */
-	public function delete()
-	{
-		$this->verify_not_readonly('delete');
-
-		$pk = $this->values_for_pk();
-
-		if (empty($pk))
-			throw new ActiveRecordException("Cannot delete, no primary key defined for: " . get_called_class());
-
-		if (!$this->invoke_callback('before_destroy',false))
-			return false;
-
-		static::table()->delete($pk);
-		$this->invoke_callback('after_destroy',false);
-
-		return true;
-	}
-
-	/**
-	 * Helper that creates an array of values for the primary key(s).
-	 *
-	 * @return array An array in the form array(key_name => value, ...)
-	 */
-	public function values_for_pk()
-	{
-		return $this->values_for(static::table()->pk);
-	}
-
-	/**
-	 * Helper to return a hash of values for the specified attributes.
-	 *
-	 * @param array $attribute_names Array of attribute names
-	 * @return array An array in the form array(name => value, ...)
-	 */
-	public function values_for($attribute_names)
-	{
-		$filter = array();
-
-		foreach ($attribute_names as $name)
-			$filter[$name] = $this->$name;
-
-		return $filter;
-	}
-
-	/**
-	 * Validates the model.
-	 *
-	 * @return boolean True if passed validators otherwise false
-	 */
-	private function _validate()
-	{
-		require_once 'Validations.php';
-
-		$validator = new Validations($this);
-		$validation_on = 'validation_on_' . ($this->is_new_record() ? 'create' : 'update');
-
-		foreach (array('before_validation', "before_$validation_on") as $callback)
-		{
-			if (!$this->invoke_callback($callback,false))
-				return false;
-		}
-
-		$this->errors = $validator->validate();
-
-		foreach (array('after_validation', "after_$validation_on") as $callback)
-			$this->invoke_callback($callback,false);
-
-		if (!$this->errors->is_empty())
-			return false;
-
-		return true;
-	}
-
-	/**
-	 * Returns true if the model has been modified.
-	 *
-	 * @return boolean true if modified
-	 */
-	public function is_dirty()
-	{
-		return empty($this->__dirty) ? false : true;
-	}
-
-	/**
-	 * Run validations on model and returns whether or not model passed validation.
-	 *
-	 * @see is_invalid
-	 * @return boolean
-	 */
-	public function is_valid()
-	{
-		return $this->_validate();
-	}
-
-	/**
-	 * Runs validations and returns true if invalid.
-	 *
-	 * @see is_valid
-	 * @return boolean
-	 */
-	public function is_invalid()
-	{
-		return !$this->_validate();
-	}
-
-	/**
-	 * Updates a model's timestamps.
-	 */
-	public function set_timestamps()
-	{
-		$now = date('Y-m-d H:i:s');
-
-		if (isset($this->updated_at))
-			$this->updated_at = $now;
-
-		if (isset($this->created_at) && $this->is_new_record())
-			$this->created_at = $now;
-	}
-
-	/**
-	 * Mass update the model with an array of attribute data and saves to the database.
-	 *
-	 * @param array $attributes An attribute data array in the form array(name => value, ...)
-	 * @return boolean True if successfully updated and saved otherwise false
-	 */
-	public function update_attributes($attributes)
-	{
-		$this->set_attributes($attributes);
-		return $this->save();
-	}
-
-	/**
-	 * Updates a single attribute and saves the record without going through the normal validation procedure.
-	 *
-	 * @param string $name Name of attribute
-	 * @param mixed $value Value of the attribute
-	 * @return boolean True if successful otherwise false
-	 */
-	public function update_attribute($name, $value)
-	{
-		$this->__set($name, $value);
-		return $this->update(false);
-	}
-
-	/**
-	 * Mass update the model with data from an attributes hash.
-	 *
-	 * Unlike update_attributes() this method only updates the model's data
-	 * but DOES NOT save it to the database.
-	 *
-	 * @see update_attributes
-	 * @param array $attributes An array containing data to update in the form array(name => value, ...)
-	 */
-	public function set_attributes(array $attributes)
-	{
-		$this->set_attributes_via_mass_assignment($attributes, true);
-	}
-
-	/**
-	 * Passing $guard_attributes as true will throw an exception if an attribute does not exist.
-	 *
-	 * @throws ActiveRecord\UndefinedPropertyException
-	 * @param array $attributes An array in the form array(name => value, ...)
-	 * @param boolean $guard_attributes Flag of whether or not attributes should be guarded
-	 */
-	private function set_attributes_via_mass_assignment(array &$attributes, $guard_attributes)
-	{
-		//access uninflected columns since that is what we would have in result set
-		$table = static::table();
-		$exceptions = array();
-		$use_attr_accessible = !empty(static::$attr_accessible);
-		$use_attr_protected = !empty(static::$attr_protected);
-		$connection = static::connection();
-
-		foreach ($attributes as $name => $value)
-		{
-			// is a normal field on the table
-			if (array_key_exists($name,$table->columns))
-			{
-				$value = $table->columns[$name]->cast($value,$connection);
-				$name = $table->columns[$name]->inflected_name;
-			}
-
-			if ($guard_attributes)
-			{
-				if ($use_attr_accessible && !in_array($name,static::$attr_accessible))
-					continue;
-
-				if ($use_attr_protected && in_array($name,static::$attr_protected))
-					continue;
-
-				// set valid table data
-				try {
-					$this->$name = $value;
-				} catch (UndefinedPropertyException $e) {
-					$exceptions[] = $e->getMessage();
-				}
-			}
-			else
-			{
-				// ignore OciAdapter's limit() stuff
-				if ($name == 'ar_rnum__')
-					continue;
-
-				// set arbitrary data
-				$this->assign_attribute($name,$value);
-			}
-		}
-
-		if (!empty($exceptions))
-			throw new UndefinedPropertyException(get_called_class(),$exceptions);
-	}
-
-	/**
-	 * Add a model to the given named ($name) relationship.
-	 *
-	 * @internal This should <strong>only</strong> be used by eager load
-	 * @param Model $model
-	 * @param $name of relationship for this table
-	 * @return void
-	 */
-	public function set_relationship_from_eager_load(Model $model=null, $name)
-	{
-		$table = static::table();
-
-		if (($rel = $table->get_relationship($name)))
-		{
-			if ($rel->is_poly())
-			{
-				// if the related model is null and it is a poly then we should have an empty array
-				if (is_null($model))
-					return $this->__relationships[$name] = array();
-				else
-					return $this->__relationships[$name][] = $model;
-			}
-			else
-				return $this->__relationships[$name] = $model;
-		}
-
-		throw new RelationshipException("Relationship named $name has not been declared for class: {$table->class->getName()}");
-	}
-
-	/**
-	 * Reloads the attributes and relationships of this object from the database.
-	 *
-	 * @return Model
-	 */
-	public function reload()
-	{
-		$this->__relationships = array();
-		$pk = array_values($this->get_values_for($this->get_primary_key()));
-
-		$this->set_attributes($this->find($pk)->attributes);
-		$this->reset_dirty();
-
-		return $this;
-	}
-
-	public function __clone()
-	{
-		$this->__relationships = array();
-		$this->reset_dirty();
-		return $this;
-	}
-
-	/**
-	 * Resets the dirty array.
-	 *
-	 * @see dirty_attributes
-	 */
-	public function reset_dirty()
-	{
-		$this->__dirty = null;
-	}
-
-	/**
-	 * A list of valid finder options.
-	 *
-	 * @var array
-	 */
-	static $VALID_OPTIONS = array('conditions', 'limit', 'offset', 'order', 'select', 'joins', 'include', 'readonly', 'group', 'from', 'having');
-
-	/**
-	 * Enables the use of dynamic finders.
-	 *
-	 * Dynamic finders are just an easy way to do queries quickly without having to
-	 * specify an options array with conditions in it.
-	 *
-	 * <code>
-	 * SomeModel::find_by_first_name('Tito');
-	 * SomeModel::find_by_first_name_and_last_name('Tito','the Grief');
-	 * SomeModel::find_by_first_name_or_last_name('Tito','the Grief');
-	 * SomeModel::find_all_by_last_name('Smith');
-	 * SomeModel::count_by_name('Bob')
-	 * SomeModel::count_by_name_or_state('Bob','VA')
-	 * SomeModel::count_by_name_and_state('Bob','VA')
-	 * </code>
-	 *
-	 * You can also create the model if the find call returned no results:
-	 *
-	 * <code>
-	 * Person::find_or_create_by_name('Tito');
-	 *
-	 * # would be the equivalent of
-	 * if (!Person::find_by_name('Tito'))
-	 *   Person::create(array('Tito'));
-	 * </code>
-	 *
-	 * Some other examples of find_or_create_by:
-	 *
-	 * <code>
-	 * Person::find_or_create_by_name_and_id('Tito',1);
-	 * Person::find_or_create_by_name_and_id(array('name' => 'Tito', 'id' => 1));
-	 * </code>
-	 *
-	 * @param string $method Name of method
-	 * @param mixed $args Method args
-	 * @return Model
-	 * @throws {@link ActiveRecordException} if invalid query
-	 * @see find
-	 */
-	public static function __callStatic($method, $args)
-	{
-		$options = static::extract_and_validate_options($args);
-		$create = false;
-
-		if (substr($method,0,17) == 'find_or_create_by')
-		{
-			$attributes = substr($method,17);
-
-			// can't take any finders with OR in it when doing a find_or_create_by
-			if (strpos($attributes,'_or_') !== false)
-				throw new ActiveRecordException("Cannot use OR'd attributes in find_or_create_by");
-
-			$create = true;
-			$method = 'find_by' . substr($method,17);
-		}
-
-		if (substr($method,0,7) === 'find_by')
-		{
-			$attributes = substr($method,8);
-			$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string(static::table()->conn,$attributes,$args,static::$alias_attribute);
-
-			if (!($ret = static::find('first',$options)) && $create)
-				return static::create(SQLBuilder::create_hash_from_underscored_string($attributes,$args,static::$alias_attribute));
-
-			return $ret;
-		}
-		elseif (substr($method,0,11) === 'find_all_by')
-		{
-			$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string(static::table()->conn,substr($method,12),$args,static::$alias_attribute);
-			return static::find('all',$options);
-		}
-		elseif (substr($method,0,8) === 'count_by')
-		{
-			$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string(static::table()->conn,substr($method,9),$args,static::$alias_attribute);
-			return static::count($options);
-		}
-
-		throw new ActiveRecordException("Call to undefined method: $method");
-	}
-
-	/**
-	 * Enables the use of build|create for associations.
-	 *
-	 * @param string $method Name of method
-	 * @param mixed $args Method args
-	 * @return mixed An instance of a given {@link AbstractRelationship}
-	 */
-	public function __call($method, $args)
-	{
-		//check for build|create_association methods
-		if (preg_match('/(build|create)_/', $method))
-		{
-			if (!empty($args))
-				$args = $args[0];
-
-			$association_name = str_replace(array('build_', 'create_'), '', $method);
-
-			if (($association = static::table()->get_relationship($association_name)))
-			{
-				//access association to ensure that the relationship has been loaded
-				//so that we do not double-up on records if we append a newly created
-				$this->$association_name;
-				$method = str_replace($association_name,'association', $method);
-				return $association->$method($this, $args);
-			}
-		}
-
-		throw new ActiveRecordException("Call to undefined method: $method");
-	}
-
-	/**
-	 * Alias for self::find('all').
-	 *
-	 * @see find
-	 * @return array array of records found
-	 */
-	public static function all(/* ... */)
-	{
-		return call_user_func_array('static::find',array_merge(array('all'),func_get_args()));
-	}
-
-	/**
-	 * Get a count of qualifying records.
-	 *
-	 * <code>
-	 * YourModel::count(array('conditions' => 'amount > 3.14159265'));
-	 * </code>
-	 *
-	 * @see find
-	 * @return int Number of records that matched the query
-	 */
-	public static function count(/* ... */)
-	{
-		$args = func_get_args();
-		$options = static::extract_and_validate_options($args);
-		$options['select'] = 'COUNT(*)';
-
-		if (!empty($args))
-		{
-			if (is_hash($args[0]))
-				$options['conditions'] = $args[0];
-			else
-				$options['conditions'] = call_user_func_array('static::pk_conditions',$args);
-		}
-
-		$table = static::table();
-		$sql = $table->options_to_sql($options);
-		$values = $sql->get_where_values();
-		return $table->conn->query_and_fetch_one($sql->to_s(),$values);
-	}
-
-	/**
-	 * Determine if a record exists.
-	 *
-	 * <code>
-	 * SomeModel::exists(123);
-	 * SomeModel::exists(array('conditions' => array('id=? and name=?', 123, 'Tito')));
-	 * SomeModel::exists(array('id' => 123, 'name' => 'Tito'));
-	 * </code>
-	 *
-	 * @see find
-	 * @return boolean
-	 */
-	public static function exists(/* ... */)
-	{
-		return call_user_func_array('static::count',func_get_args()) > 0 ? true : false;
-	}
-
-	/**
-	 * Alias for self::find('first').
-	 *
-	 * @see find
-	 * @return Model The first matched record or null if not found
-	 */
-	public static function first(/* ... */)
-	{
-		return call_user_func_array('static::find',array_merge(array('first'),func_get_args()));
-	}
-
-	/**
-	 * Alias for self::find('last')
-	 *
-	 * @see find
-	 * @return Model The last matched record or null if not found
-	 */
-	public static function last(/* ... */)
-	{
-		return call_user_func_array('static::find',array_merge(array('last'),func_get_args()));
-	}
-
-	/**
-	 * Find records in the database.
-	 *
-	 * Finding by the primary key:
-	 *
-	 * <code>
-	 * # queries for the model with id=123
-	 * YourModel::find(123);
-	 *
-	 * # queries for model with id in(1,2,3)
-	 * YourModel::find(1,2,3);
-	 *
-	 * # finding by pk accepts an options array
-	 * YourModel::find(123,array('order' => 'name desc'));
-	 * </code>
-	 *
-	 * Finding by using a conditions array:
-	 *
-	 * <code>
-	 * YourModel::find('first', array('conditions' => array('name=?','Tito'),
-	 *   'order' => 'name asc'))
-	 * YourModel::find('all', array('conditions' => 'amount > 3.14159265'));
-	 * YourModel::find('all', array('conditions' => array('id in(?)', array(1,2,3))));
-	 * </code>
-	 *
-	 * Finding by using a hash:
-	 *
-	 * <code>
-	 * YourModel::find(array('name' => 'Tito', 'id' => 1));
-	 * YourModel::find('first',array('name' => 'Tito', 'id' => 1));
-	 * YourModel::find('all',array('name' => 'Tito', 'id' => 1));
-	 * </code>
-	 *
-	 * An options array can take the following parameters:
-	 *
-	 * <ul>
-	 * <li><b>select:</b> A SQL fragment for what fields to return such as: '*', 'people.*', 'first_name, last_name, id'</li>
-	 * <li><b>joins:</b> A SQL join fragment such as: 'JOIN roles ON(roles.user_id=user.id)' or a named association on the model</li>
-	 * <li><b>include:</b> to do not implemented yet</li>
-	 * <li><b>conditions:</b> A SQL fragment such as: 'id=1', array('id=1'), array('name=? and id=?','Tito',1), array('name IN(?)', array('Tito','Bob')),
-	 * array('name' => 'Tito', 'id' => 1)</li>
-	 * <li><b>limit:</b> Number of records to limit the query to</li>
-	 * <li><b>offset:</b> The row offset to return results from for the query</li>
-	 * <li><b>order:</b> A SQL fragment for order such as: 'name asc', 'name asc, id desc'</li>
-	 * <li><b>readonly:</b> Return all the models in readonly mode</li>
-	 * <li><b>group:</b> A SQL group by fragment</li>
-	 * </ul>
-	 *
-	 * @throws {@link RecordNotFound} if no options are passed or finding by pk and no records matched
-	 * @return mixed An array of records found if doing a find_all otherwise a
-	 *   single Model object or null if it wasn't found. NULL is only return when
-	 *   doing a first/last find. If doing an all find and no records matched this
-	 *   will return an empty array.
-	 */
-	public static function find(/* $type, $options */)
-	{
-		$class = get_called_class();
-
-		if (func_num_args() <= 0)
-			throw new RecordNotFound("Couldn't find $class without an ID");
-
-		$args = func_get_args();
-		$options = static::extract_and_validate_options($args);
-		$num_args = count($args);
-		$single = true;
-
-		if ($num_args > 0 && ($args[0] === 'all' || $args[0] === 'first' || $args[0] === 'last'))
-		{
-			switch ($args[0])
-			{
-				case 'all':
-					$single = false;
-					break;
-
-			 	case 'last':
-					if (!array_key_exists('order',$options))
-						$options['order'] = join(' DESC, ',static::table()->pk) . ' DESC';
-					else
-						$options['order'] = SQLBuilder::reverse_order($options['order']);
-
-					// fall thru
-
-			 	case 'first':
-			 		$options['limit'] = 1;
-			 		$options['offset'] = 0;
-			 		break;
-			}
-
-			$args = array_slice($args,1);
-			$num_args--;
-		}
-		//find by pk
-		elseif (1 === count($args) && 1 == $num_args)
-			$args = $args[0];
-
-		// anything left in $args is a find by pk
-		if ($num_args > 0 && !isset($options['conditions']))
-			return static::find_by_pk($args, $options);
-
-		$options['mapped_names'] = static::$alias_attribute;
-		$list = static::table()->find($options);
-
-		return $single ? (!empty($list) ? $list[0] : null) : $list;
-	}
-
-	/**
-	 * Finder method which will find by a single or array of primary keys for this model.
-	 *
-	 * @see find
-	 * @param array $values An array containing values for the pk
-	 * @param array $options An options array
-	 * @return Model
-	 * @throws {@link RecordNotFound} if a record could not be found
-	 */
-	public static function find_by_pk($values, $options)
-	{
-		$options['conditions'] = static::pk_conditions($values);
-		$list = static::table()->find($options);
-		$results = count($list);
-
-		if ($results != ($expected = count($values)))
-		{
-			$class = get_called_class();
-
-			if ($expected == 1)
-			{
-				if (!is_array($values))
-					$values = array($values);
-
-				throw new RecordNotFound("Couldn't find $class with ID=" . join(',',$values));
-			}
-
-			$values = join(',',$values);
-			throw new RecordNotFound("Couldn't find all $class with IDs ($values) (found $results, but was looking for $expected)");
-		}
-		return $expected == 1 ? $list[0] : $list;
-	}
-
-	/**
-	 * Find using a raw SELECT query.
-	 *
-	 * <code>
-	 * YourModel::find_by_sql("SELECT * FROM people WHERE name=?",array('Tito'));
-	 * YourModel::find_by_sql("SELECT * FROM people WHERE name='Tito'");
-	 * </code>
-	 *
-	 * @param string $sql The raw SELECT query
-	 * @param array $values An array of values for any parameters that needs to be bound
-	 * @return array An array of models
-	 */
-	public static function find_by_sql($sql, $values=null)
-	{
-		return static::table()->find_by_sql($sql, $values, true);
-	}
-
-	/**
-	 * Determines if the specified array is a valid ActiveRecord options array.
-	 *
-	 * @param array $array An options array
-	 * @param bool $throw True to throw an exception if not valid
-	 * @return boolean True if valid otherwise valse
-	 * @throws {@link ActiveRecordException} if the array contained any invalid options
-	 */
-	public static function is_options_hash($array, $throw=true)
-	{
-		if (is_hash($array))
-		{
-			$keys = array_keys($array);
-			$diff = array_diff($keys,self::$VALID_OPTIONS);
-
-			if (!empty($diff) && $throw)
-				throw new ActiveRecordException("Unknown key(s): " . join(', ',$diff));
-
-			$intersect = array_intersect($keys,self::$VALID_OPTIONS);
-
-			if (!empty($intersect))
-				return true;
-		}
-		return false;
-	}
-
-	/**
-	 * Returns a hash containing the names => values of the primary key.
-	 *
-	 * @internal This needs to eventually support composite keys.
-	 * @param mixed $args Primary key value(s)
-	 * @return array An array in the form array(name => value, ...)
-	 */
-	public static function pk_conditions($args)
-	{
-		$table = static::table();
-		$ret = array($table->pk[0] => $args);
-		return $ret;
-	}
-
-	/**
-	 * Pulls out the options hash from $array if any.
-	 *
-	 * @internal DO NOT remove the reference on $array.
-	 * @param array &$array An array
-	 * @return array A valid options array
-	 */
-	public static function extract_and_validate_options(array &$array)
-	{
-		$options = array();
-
-		if ($array)
-		{
-			$last = &$array[count($array)-1];
-
-			try
-			{
-				if (self::is_options_hash($last))
-				{
-					array_pop($array);
-					$options = $last;
-				}
-			}
-			catch (ActiveRecordException $e)
-			{
-				if (!is_hash($last))
-					throw $e;
-
-				$options = array('conditions' => $last);
-			}
-		}
-		return $options;
-	}
-
-	/**
-	 * Returns a JSON representation of this model.
-	 *
-	 * @see Serialization
-	 * @param array $options An array containing options for json serialization (see {@link Serialization} for valid options)
-	 * @return string JSON representation of the model
-	 */
-	public function to_json(array $options=array())
-	{
-		return $this->serialize('Json', $options);
-	}
-
-	/**
-	 * Returns an XML representation of this model.
-	 *
-	 * @see Serialization
-	 * @param array $options An array containing options for xml serialization (see {@link Serialization} for valid options)
-	 * @return string XML representation of the model
-	 */
-	public function to_xml(array $options=array())
-	{
-		return $this->serialize('Xml', $options);
-	}
-
-	/**
-	 * Creates a serializer based on pre-defined to_serializer()
-	 *
-	 * An options array can take the following parameters:
-	 *
-	 * <ul>
-	 * <li><b>only:</b> a string or array of attributes to be included.</li>
-	 * <li><b>excluded:</b> a string or array of attributes to be excluded.</li>
-	 * <li><b>methods:</b> a string or array of methods to invoke. The method's name will be used as a key for the final attributes array
-	 * along with the method's returned value</li>
-	 * <li><b>include:</b> a string or array of associated models to include in the final serialized product.</li>
-	 * </ul>
-	 *
-	 * @param string $type Either Xml or Json
-	 * @param array $options Options array for the serializer
-	 * @return string Serialized representation of the model
-	 */
-	private function serialize($type, $options)
-	{
-		require_once 'Serialization.php';
-		$class = "ActiveRecord\\{$type}Serializer";
-		$serializer = new $class($this, $options);
-		return $serializer->to_s();
-	}
-
-	/**
-	 * Invokes the specified callback on this model.
-	 *
-	 * @param string $method_name Name of the call back to run.
-	 * @param boolean $must_exist Set to true to raise an exception if the callback does not exist.
-	 * @return boolean True if invoked or null if not
-	 */
-	private function invoke_callback($method_name, $must_exist=true)
-	{
-		return static::table()->callback->invoke($this,$method_name,$must_exist);
-	}
-
-	/**
-	 * Executes a block of code inside a database transaction.
-	 *
-	 * <code>
-	 * YourModel::transaction(function()
-	 * {
-	 *   YourModel::create(array("name" => "blah"));
-	 * });
-	 * </code>
-	 *
-	 * If an exception is thrown inside the closure the transaction will
-	 * automatically be rolled back. You can also return false from your
-	 * closure to cause a rollback:
-	 *
-	 * <code>
-	 * YourModel::transaction(function()
-	 * {
-	 *   YourModel::create(array("name" => "blah"));
-	 *   throw new Exception("rollback!");
-	 * });
-	 *
-	 * YourModel::transaction(function()
-	 * {
-	 *   YourModel::create(array("name" => "blah"));
-	 *   return false; # rollback!
-	 * });
-	 * </code>
-	 *
-	 * @param Closure $closure The closure to execute. To cause a rollback have your closure return false or throw an exception.
-	 * @return boolean True if the transaction was committed, False if rolled back.
-	 */
-	public static function transaction($closure)
-	{
-		$connection = static::connection();
-
-		try
-		{
-			$connection->transaction();
-
-			if ($closure() === false)
-			{
-				$connection->rollback();
-				return false;
-			}
-			else
-				$connection->commit();
-		}
-		catch (\Exception $e)
-		{
-			$connection->rollback();
-			throw $e;
-		}
-		return true;
-	}
-};
-?>
diff --git a/lib/ar/Reflections.php b/lib/ar/Reflections.php
deleted file mode 100644
index 881532f..0000000
--- a/lib/ar/Reflections.php
+++ /dev/null
@@ -1,86 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-use ReflectionClass;
-
-/**
- * Simple class that caches reflections of classes.
- *
- * @package ActiveRecord
- */
-class Reflections extends Singleton
-{
-	/**
-	 * Current reflections.
-	 *
-	 * @var array
-	 */
-	private $reflections = array();
-
-	/**
-	 * Instantiates a new ReflectionClass for the given class.
-	 *
-	 * @param string $class Name of a class
-	 * @return Reflections $this so you can chain calls like Reflections::instance()->add('class')->get()
-	 */
-	public function add($class=null)
-	{
-		$class = $this->get_class($class);
-
-		if (!isset($this->reflections[$class]))
-			$this->reflections[$class] = new ReflectionClass($class);
-			
-		return $this;
-	}
-
-	/**
-	 * Destroys the cached ReflectionClass.
-	 *
-	 * Put this here mainly for testing purposes.
-	 * 
-	 * @param string $class Name of a class.
-	 * @return void
-	 */
-	public function destroy($class)
-	{
-		if (isset($this->reflections[$class]))
-			$this->reflections[$class] = null;
-	}
-	
-	/**
-	 * Get a cached ReflectionClass.
-	 *
-	 * @param string $class Optional name of a class
-	 * @return mixed null or a ReflectionClass instance
-	 * @throws ActiveRecordException if class was not found
-	 */
-	public function get($class=null)
-	{
-		$class = $this->get_class($class);
-
-		if (isset($this->reflections[$class]))
-			return $this->reflections[$class];
-
-		throw new ActiveRecordException("Class not found: $class");
-	}
-
-	/**
-	 * Retrieve a class name to be reflected.
-	 *
-	 * @param mixed $mixed An object or name of a class
-	 * @return string
-	 */
-	private function get_class($mixed=null)
-	{
-		if (is_object($mixed))
-			return get_class($mixed);
-
-		if (!is_null($mixed))
-			return $mixed;
-
-		return $this->get_called_class();
-	}
-}
-?>
\ No newline at end of file
diff --git a/lib/ar/Relationship.php b/lib/ar/Relationship.php
deleted file mode 100644
index 1e00eb6..0000000
--- a/lib/ar/Relationship.php
+++ /dev/null
@@ -1,636 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Interface for a table relationship.
- *
- * @package ActiveRecord
- */
-interface InterfaceRelationship
-{
-	public function __construct($options=array());
-	public function build_association(Model $model, $attributes=array());
-	public function create_association(Model $model, $attributes=array());
-}
-
-/**
- * Abstract class that all relationships must extend from.
- *
- * @package ActiveRecord
- * @see http://www.phpactiverecord.org/guides/associations
- */
-abstract class AbstractRelationship implements InterfaceRelationship
-{
-	/**
-	 * Name to be used that will trigger call to the relationship.
-	 *
-	 * @var string
-	 */
-	public $attribute_name;
-
-	/**
-	 * Class name of the associated model.
-	 *
-	 * @var string
-	 */
-	public $class_name;
-
-	/**
-	 * Name of the foreign key.
-	 *
-	 * @var string
-	 */
-	public $foreign_key = array();
-
-	/**
-	 * Options of the relationship.
-	 *
-	 * @var array
-	 */
-	protected $options = array();
-
-	/**
-	 * Is the relationship single or multi.
-	 *
-	 * @var boolean
-	 */
-	protected $poly_relationship = false;
-
-	/**
-	 * List of valid options for relationships.
-	 *
-	 * @var array
-	 */
-	static protected $valid_association_options = array('class_name', 'class', 'foreign_key', 'conditions', 'select', 'readonly');
-
-	/**
-	 * Constructs a relationship.
-	 *
-	 * @param array $options Options for the relationship (see {@link valid_association_options})
-	 * @return mixed
-	 */
-	public function __construct($options=array())
-	{
-		$this->attribute_name = $options[0];
-		$this->options = $this->merge_association_options($options);
-
-		$relationship = strtolower(denamespace(get_called_class()));
-
-		if ($relationship === 'hasmany' || $relationship === 'hasandbelongstomany')
-			$this->poly_relationship = true;
-
-		if (isset($this->options['conditions']) && !is_array($this->options['conditions']))
-			$this->options['conditions'] = array($this->options['conditions']);
-
-		if (isset($this->options['class']))
-			$this->set_class_name($this->options['class']);
-		elseif (isset($this->options['class_name']))
-			$this->set_class_name($this->options['class_name']);
-
-		$this->attribute_name = strtolower(Inflector::instance()->variablize($this->attribute_name));
-
-		if (!$this->foreign_key && isset($this->options['foreign_key']))
-			$this->foreign_key = is_array($this->options['foreign_key']) ? $this->options['foreign_key'] : array($this->options['foreign_key']);
-	}
-
-	protected function get_table()
-	{
-		return Table::load($this->class_name);
-	}
-
-	/**
-	 * What is this relationship's cardinality?
-	 *
-	 * @return bool
-	 */
-	public function is_poly()
-	{
-		return $this->poly_relationship;
-	}
-
-	/**
-	 * Eagerly loads relationships for $models.
-	 *
-	 * This method takes an array of models, collects PK or FK (whichever is needed for relationship), then queries
-	 * the related table by PK/FK and attaches the array of returned relationships to the appropriately named relationship on
-	 * $models.
-	 *
-	 * @param Table $table
-	 * @param $models array of model objects
-	 * @param $attributes array of attributes from $models
-	 * @param $includes array of eager load directives
-	 * @param $query_keys -> key(s) to be queried for on included/related table
-	 * @param $model_values_keys -> key(s)/value(s) to be used in query from model which is including
-	 * @return void
-	 */
-	protected function query_and_attach_related_models_eagerly(Table $table, $models, $attributes, $includes=array(), $query_keys=array(), $model_values_keys=array())
-	{
-		$values = array();
-		$options = array();
-		$inflector = Inflector::instance();
-		$query_key = $query_keys[0];
-		$model_values_key = $model_values_keys[0];
-
-		foreach ($attributes as $column => $value)
-			$values[] = $value[$inflector->variablize($model_values_key)];
-
-		$values = array($values);
-		$options['conditions'] = SQLBuilder::create_conditions_from_underscored_string($table->conn,$query_key,$values);
-
-		if (!empty($includes))
-			$options['include'] = $includes;
-
-		$class = $this->class_name;
-
-		$related_models = $class::find('all', $options);
-		$used_models = array();
-		$model_values_key = $inflector->variablize($model_values_key);
-		$query_key = $inflector->variablize($query_key);
-
-		foreach ($models as $model)
-		{
-			$matches = 0;
-			$key_to_match = $model->$model_values_key;
-
-			foreach ($related_models as $related)
-			{
-				if ($related->$query_key == $key_to_match)
-				{
-					$hash = spl_object_hash($related);
-
-					if (in_array($hash, $used_models))
-						$model->set_relationship_from_eager_load(clone($related), $this->attribute_name);
-					else
-						$model->set_relationship_from_eager_load($related, $this->attribute_name);
-
-					$used_models[] = $hash;
-					$matches++;
-				}
-			}
-
-			if (0 === $matches)
-				$model->set_relationship_from_eager_load(null, $this->attribute_name);
-		}
-	}
-
-	/**
-	 * Creates a new instance of specified {@link Model} with the attributes pre-loaded.
-	 *
-	 * @param Model $model The model which holds this association
-	 * @param array $attributes Hash containing attributes to initialize the model with
-	 * @return Model
-	 */
-	public function build_association(Model $model, $attributes=array())
-	{
-		$class_name = $this->class_name;
-		return new $class_name($attributes);
-	}
-
-	/**
-	 * Creates a new instance of {@link Model} and invokes save.
-	 *
-	 * @param Model $model The model which holds this association
-	 * @param array $attributes Hash containing attributes to initialize the model with
-	 * @return Model
-	 */
-	public function create_association(Model $model, $attributes=array())
-	{
-		$class_name = $this->class_name;
-		$new_record = $class_name::create($attributes);
-		return $this->append_record_to_associate($model, $new_record);
-	}
-
-	protected function append_record_to_associate(Model $associate, Model $record)
-	{
-		$association =& $associate->{$this->attribute_name};
-
-		if ($this->poly_relationship)
-			$association[] = $record;
-		else
-			$association = $record;
-
-		return $record;
-	}
-
-	protected function merge_association_options($options)
-	{
-		$available_options = array_merge(self::$valid_association_options,static::$valid_association_options);
-		$valid_options = array_intersect_key(array_flip($available_options),$options);
-
-		foreach ($valid_options as $option => $v)
-			$valid_options[$option] = $options[$option];
-
-		return $valid_options;
-	}
-
-	protected function unset_non_finder_options($options)
-	{
-		foreach (array_keys($options) as $option)
-		{
-			if (!in_array($option, Model::$VALID_OPTIONS))
-				unset($options[$option]);
-		}
-		return $options;
-	}
-
-	protected function keyify($class_name)
-	{
-		return strtolower(classify(denamespace($class_name))). '_id';
-	}
-
-	/**
-	 * Infers the $this->class_name based on $this->attribute_name.
-	 *
-	 * Will try to guess the appropriate class by singularizing and uppercasing $this->attribute_name.
-	 *
-	 * @return void
-	 * @see attribute_name
-	 */
-	protected function set_inferred_class_name()
-	{
-		$this->set_class_name(classify($this->attribute_name, true));
-	}
-
-	protected function set_class_name($class_name)
-	{
-		$reflection = Reflections::instance()->add($class_name)->get($class_name);
-
-		if (!$reflection->isSubClassOf('ActiveRecord\\Model'))
-			throw new RelationshipException("'$class_name' must extend from ActiveRecord\\Model");
-
-		$this->class_name = $class_name;
-	}
-
-	protected function create_conditions_from_keys(Model $model, $condition_keys=array(), $value_keys=array())
-	{
-		$condition_string = implode('_and_', $condition_keys);
-		$condition_values = array_values($model->get_values_for($value_keys));
-
-		// return null if all the foreign key values are null so that we don't try to do a query like "id is null"
-		if (all(null,$condition_values))
-			return null;
-
-		$conditions = SQLBuilder::create_conditions_from_underscored_string(Table::load(get_class($model))->conn,$condition_string,$condition_values);
-
-		# DO NOT CHANGE THE NEXT TWO LINES. add_condition operates on a reference and will screw options array up
-		if (isset($this->options['conditions']))
-			$options_conditions = $this->options['conditions'];
-		else
-			$options_conditions = array();
-
-		return Utils::add_condition($options_conditions, $conditions);
-	}
-
-	/**
-	 * Creates INNER JOIN SQL for associations.
-	 *
-	 * @param Table $from_table the table used for the FROM SQL statement
-	 * @param bool $using_through is this a THROUGH relationship?
-	 * @param string $alias a table alias for when a table is being joined twice
-	 * @return string SQL INNER JOIN fragment
-	 */
-	public function construct_inner_join_sql(Table $from_table, $using_through=false, $alias=null)
-	{
-		if ($using_through)
-		{
-			$join_table = $from_table;
-			$join_table_name = $from_table->get_fully_qualified_table_name();
-			$from_table_name = Table::load($this->class_name)->get_fully_qualified_table_name();
- 		}
-		else
-		{
-			$join_table = Table::load($this->class_name);
-			$join_table_name = $join_table->get_fully_qualified_table_name();
-			$from_table_name = $from_table->get_fully_qualified_table_name();
-		}
-
-		// need to flip the logic when the key is on the other table
-		if ($this instanceof HasMany || $this instanceof HasOne)
-		{
-			$this->set_keys($from_table->class->getName());
-
-			if ($using_through)
-			{
-				$foreign_key = $this->primary_key[0];
-				$join_primary_key = $this->foreign_key[0];
-			}
-			else
-			{
-				$join_primary_key = $this->foreign_key[0];
-				$foreign_key = $this->primary_key[0];
-			}
-		}
-		else
-		{
-			$foreign_key = $this->foreign_key[0];
-			$join_primary_key = $this->primary_key[0];
-		}
-
-		if (!is_null($alias))
-		{
-			$aliased_join_table_name = $alias = $this->get_table()->conn->quote_name($alias);
-			$alias .= ' ';
-		}
-		else
-			$aliased_join_table_name = $join_table_name;
-
-		return "INNER JOIN $join_table_name {$alias}ON($from_table_name.$foreign_key = $aliased_join_table_name.$join_primary_key)";
-	}
-
-	/**
-	 * This will load the related model data.
-	 *
-	 * @param Model $model The model this relationship belongs to
-	 */
-	abstract function load(Model $model);
-};
-
-/**
- * One-to-many relationship.
- *
- * <code>
- * # Table: people
- * # Primary key: id
- * # Foreign key: school_id
- * class Person extends ActiveRecord\Model {}
- *
- * # Table: schools
- * # Primary key: id
- * class School extends ActiveRecord\Model {
- *   static $has_many = array(
- *     array('people')
- *   );
- * });
- * </code>
- *
- * Example using options:
- *
- * <code>
- * class Payment extends ActiveRecord\Model {
- *   static $belongs_to = array(
- *     array('person'),
- *     array('order')
- *   );
- * }
- *
- * class Order extends ActiveRecord\Model {
- *   static $has_many = array(
- *     array('people',
- *           'through'    => 'payments',
- *           'select'     => 'people.*, payments.amount',
- *           'conditions' => 'payments.amount < 200')
- *     );
- * }
- * </code>
- *
- * @package ActiveRecord
- * @see http://www.phpactiverecord.org/guides/associations
- * @see valid_association_options
- */
-class HasMany extends AbstractRelationship
-{
-	/**
-	 * Valid options to use for a {@link HasMany} relationship.
-	 *
-	 * <ul>
-	 * <li><b>limit/offset:</b> limit the number of records</li>
-     * <li><b>primary_key:</b> name of the primary_key of the association (defaults to "id")</li>
-     * <li><b>group:</b> GROUP BY clause</li>
-     * <li><b>order:</b> ORDER BY clause</li>
-     * <li><b>through:</b> name of a model</li>
-     * </ul>
-	 *
-	 * @var array
-	 */
-	static protected $valid_association_options = array('primary_key', 'order', 'group', 'having', 'limit', 'offset', 'through', 'source');
-
-	protected $primary_key;
-
-	private $has_one = false;
-	private $through;
-
-	/**
-	 * Constructs a {@link HasMany} relationship.
-	 *
-	 * @param array $options Options for the association
-	 * @return HasMany
-	 */
-	public function __construct($options=array())
-	{
-		parent::__construct($options);
-
-		if (isset($this->options['through']))
-		{
-			$this->through = $this->options['through'];
-
-			if (isset($this->options['source']))
-				$this->set_class_name($this->options['source']);
-		}
-
-		if (!$this->primary_key && isset($this->options['primary_key']))
-			$this->primary_key = is_array($this->options['primary_key']) ? $this->options['primary_key'] : array($this->options['primary_key']);
-
-		if (!$this->class_name)
-			$this->set_inferred_class_name();
-	}
-
-	protected function set_keys($model_class_name, $override=false)
-	{
-		//infer from class_name
-		if (!$this->foreign_key || $override)
-			$this->foreign_key = array($this->keyify($model_class_name));
-
-		if (!$this->primary_key || $override)
-			$this->primary_key = Table::load($model_class_name)->pk;
-	}
-
-	public function load(Model $model)
-	{
-		$class_name = $this->class_name;
-		$this->set_keys(get_class($model));
-
-		// since through relationships depend on other relationships we can't do
-		// this initiailization in the constructor since the other relationship
-		// may not have been created yet and we only want this to run once
-		if (!isset($this->initialized))
-		{
-			if ($this->through)
-			{
-				// verify through is a belongs_to or has_many for access of keys
-				if (!($through_relationship = $this->get_table()->get_relationship($this->through)))
-					throw new HasManyThroughAssociationException("Could not find the association $this->through in model " . get_class($model));
-
-				if (!($through_relationship instanceof HasMany) && !($through_relationship instanceof BelongsTo))
-					throw new HasManyThroughAssociationException('has_many through can only use a belongs_to or has_many association');
-
-				// save old keys as we will be reseting them below for inner join convenience
-				$pk = $this->primary_key;
-				$fk = $this->foreign_key;
-
-				$this->set_keys($this->get_table()->class->getName(), true);
-
-				$through_table = Table::load(classify($this->through, true));
-				$this->options['joins'] = $this->construct_inner_join_sql($through_table, true);
-
-				// reset keys
-				$this->primary_key = $pk;
-				$this->foreign_key = $fk;
-			}
-
-			$this->initialized = true;
-		}
-
-		if (!($conditions = $this->create_conditions_from_keys($model, $this->foreign_key, $this->primary_key)))
-			return null;
-
-		$options = $this->unset_non_finder_options($this->options);
-		$options['conditions'] = $conditions;
-		return $class_name::find($this->poly_relationship ? 'all' : 'first',$options);
-	}
-
-	private function inject_foreign_key_for_new_association(Model $model, &$attributes)
-	{
-		$this->set_keys($model);
-		$primary_key = Inflector::instance()->variablize($this->foreign_key[0]);
-
-		if (!isset($attributes[$primary_key]))
-			$attributes[$primary_key] = $model->id;
-
-		return $attributes;
-	}
-
-	public function build_association(Model $model, $attributes=array())
-	{
-		$attributes = $this->inject_foreign_key_for_new_association($model, $attributes);
-		return parent::build_association($model, $attributes);
-	}
-
-	public function create_association(Model $model, $attributes=array())
-	{
-		$attributes = $this->inject_foreign_key_for_new_association($model, $attributes);
-		return parent::create_association($model, $attributes);
-	}
-
-	public function load_eagerly($models=array(), $attributes=array(), $includes, Table $table)
-	{
-		$this->set_keys($table->class->name);
-		$this->query_and_attach_related_models_eagerly($table,$models,$attributes,$includes,$this->foreign_key, $table->pk);
-	}
-};
-
-/**
- * One-to-one relationship.
- *
- * <code>
- * # Table name: states
- * # Primary key: id
- * class State extends ActiveRecord\Model {}
- *
- * # Table name: people
- * # Foreign key: state_id
- * class Person extends ActiveRecord\Model {
- *   static $has_one = array(array('state'));
- * }
- * </code>
- *
- * @package ActiveRecord
- * @see http://www.phpactiverecord.org/guides/associations
- */
-class HasOne extends HasMany
-{
-};
-
-/**
- * @package ActiveRecord
- * @see http://www.phpactiverecord.org/guides/associations
- */
-class HasAndBelongsToMany extends AbstractRelationship
-{
-	public function __construct($options=array())
-	{
-		/* options =>
-		 *   join_table - name of the join table if not in lexical order
-		 *   foreign_key -
-		 *   association_foreign_key - default is {assoc_class}_id
-		 *   uniq - if true duplicate assoc objects will be ignored
-		 *   validate
-		 */
-	}
-
-	public function load(Model $model)
-	{
-
-	}
-};
-
-/**
- * Belongs to relationship.
- *
- * <code>
- * class School extends ActiveRecord\Model {}
- *
- * class Person extends ActiveRecord\Model {
- *   static $belongs_to = array(
- *     array('school')
- *   );
- * }
- * </code>
- *
- * Example using options:
- *
- * <code>
- * class School extends ActiveRecord\Model {}
- *
- * class Person extends ActiveRecord\Model {
- *   static $belongs_to = array(
- *     array('school', 'primary_key' => 'school_id')
- *   );
- * }
- * </code>
- *
- * @package ActiveRecord
- * @see valid_association_options
- * @see http://www.phpactiverecord.org/guides/associations
- */
-class BelongsTo extends AbstractRelationship
-{
-	public function __construct($options=array())
-	{
-		parent::__construct($options);
-
-		if (!$this->class_name)
-			$this->set_inferred_class_name();
-
-		//infer from class_name
-		if (!$this->foreign_key)
-			$this->foreign_key = array($this->keyify($this->class_name));
-
-		$this->primary_key = array(Table::load($this->class_name)->pk[0]);
-	}
-
-	public function load(Model $model)
-	{
-		$keys = array();
-		$inflector = Inflector::instance();
-
-		foreach ($this->foreign_key as $key)
-			$keys[] = $inflector->variablize($key);
-
-		if (!($conditions = $this->create_conditions_from_keys($model, $this->primary_key, $keys)))
-			return null;
-
-		$options = $this->unset_non_finder_options($this->options);
-		$options['conditions'] = $conditions;
-		$class = $this->class_name;
-		return $class::first($options);
-	}
-
-	public function load_eagerly($models=array(), $attributes, $includes, Table $table)
-	{
-		$this->query_and_attach_related_models_eagerly($table,$models,$attributes,$includes, $this->primary_key,$this->foreign_key);
-	}
-};
-?>
diff --git a/lib/ar/SQLBuilder.php b/lib/ar/SQLBuilder.php
deleted file mode 100644
index 74872b6..0000000
--- a/lib/ar/SQLBuilder.php
+++ /dev/null
@@ -1,396 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Helper class for building sql statements progmatically.
- *
- * @package ActiveRecord
- */
-class SQLBuilder
-{
-	private $connection;
-	private $operation = 'SELECT';
-	private $table;
-	private $select = '*';
-	private $joins;
-	private $order;
-	private $limit;
-	private $offset;
-	private $group;
-	private $having;
-
-	// for where
-	private $where;
-	private $where_values = array();
-
-	// for insert/update
-	private $data;
-	private $sequence;
-
-	/**
-	 * Constructor.
-	 *
-	 * @param Connection $connection A database connection object
-	 * @param string $table Name of a table
-	 * @return SQLBuilder
-	 * @throws ActiveRecordException if connection was invalid
-	 */
-	public function __construct($connection, $table)
-	{
-		if (!$connection)
-			throw new ActiveRecordException('A valid database connection is required.');
-
-		$this->connection	= $connection;
-		$this->table		= $table;
-	}
-
-	/**
-	 * Returns the SQL string.
-	 *
-	 * @return string
-	 */
-	public function __toString()
-	{
-		return $this->to_s();
-	}
-
-	/**
-	 * Returns the SQL string.
-	 *
-	 * @see __toString
-	 * @return string
-	 */
-	public function to_s()
-	{
-		$func = 'build_' . strtolower($this->operation);
-		return $this->$func();
-	}
-
-	/**
-	 * Returns the bind values.
-	 *
-	 * @return array
-	 */
-	public function bind_values()
-	{
-		$ret = array();
-
-		if ($this->data)
-			$ret = array_values($this->data);
-
-		if ($this->get_where_values())
-			$ret = array_merge($ret,$this->get_where_values());
-
-		return array_flatten($ret);
-	}
-
-	public function get_where_values()
-	{
-		return $this->where_values;
-	}
-
-	public function where(/* (conditions, values) || (hash) */)
-	{
-		$this->apply_where_conditions(func_get_args());
-		return $this;
-	}
-
-	public function order($order)
-	{
-		$this->order = $order;
-		return $this;
-	}
-
-	public function group($group)
-	{
-		$this->group = $group;
-		return $this;
-	}
-
-	public function having($having)
-	{
-		$this->having = $having;
-		return $this;
-	}
-
-	public function limit($limit)
-	{
-		$this->limit = intval($limit);
-		return $this;
-	}
-
-	public function offset($offset)
-	{
-		$this->offset = intval($offset);
-		return $this;
-	}
-
-	public function select($select)
-	{
-		$this->operation = 'SELECT';
-		$this->select = $select;
-		return $this;
-	}
-
-	public function joins($joins)
-	{
-		$this->joins = $joins;
-		return $this;
-	}
-
-	public function insert($hash, $pk=null, $sequence_name=null)
-	{
-		if (!is_hash($hash))
-			throw new ActiveRecordException('Inserting requires a hash.');
-
-		$this->operation = 'INSERT';
-		$this->data = $hash;
-
-		if ($pk && $sequence_name)
-			$this->sequence = array($pk,$sequence_name);
-
-		return $this;
-	}
-
-	public function update($hash)
-	{
-		if (!is_hash($hash))
-			throw new ActiveRecordException('Updating requires a hash.');
-
-		$this->operation = 'UPDATE';
-		$this->data = $hash;
-		return $this;
-	}
-
-	public function delete()
-	{
-		$this->operation = 'DELETE';
-		$this->apply_where_conditions(func_get_args());
-		return $this;
-	}
-
-	/**
-	 * Reverses an order clause.
-	 */
-	public static function reverse_order($order)
-	{
-		if (!trim($order))
-			return $order;
-
-		$parts = explode(',',$order);
-
-		for ($i=0,$n=count($parts); $i<$n; ++$i)
-		{
-			$v = strtolower($parts[$i]);
-
-			if (strpos($v,' asc') !== false)
-				$parts[$i] = preg_replace('/asc/i','DESC',$parts[$i]);
-			elseif (strpos($v,' desc') !== false)
-				$parts[$i] = preg_replace('/desc/i','ASC',$parts[$i]);
-			else
-				$parts[$i] .= ' DESC';
-		}
-		return join(',',$parts);
-	}
-
-	/**
-	 * Converts a string like "id_and_name_or_z" into a conditions value like array("id=? AND name=? OR z=?", values, ...).
-	 *
-	 * @param Connection $connection
-	 * @param $name Underscored string
-	 * @param $values Array of values for the field names. This is used
-	 *   to determine what kind of bind marker to use: =?, IN(?), IS NULL
-	 * @param $map A hash of "mapped_column_name" => "real_column_name"
-	 * @return A conditions array in the form array(sql_string, value1, value2,...)
-	 */
-	public static function create_conditions_from_underscored_string(Connection $connection, $name, &$values=array(), &$map=null)
-	{
-		if (!$name)
-			return null;
-
-		$parts = preg_split('/(_and_|_or_)/i',$name,-1,PREG_SPLIT_DELIM_CAPTURE);
-		$num_values = count($values);
-		$conditions = array('');
-
-		for ($i=0,$j=0,$n=count($parts); $i<$n; $i+=2,++$j)
-		{
-			if ($i >= 2)
-				$conditions[0] .= preg_replace(array('/_and_/i','/_or_/i'),array(' AND ',' OR '),$parts[$i-1]);
-
-			if ($j < $num_values)
-			{
-				if (!is_null($values[$j]))
-				{
-					$bind = is_array($values[$j]) ? ' IN(?)' : '=?';
-					$conditions[] = $values[$j];
-				}
-				else
-					$bind = ' IS NULL';
-			}
-			else
-				$bind = ' IS NULL';
-
-			// map to correct name if $map was supplied
-			$name = $map && isset($map[$parts[$i]]) ? $map[$parts[$i]] : $parts[$i];
-
-			$conditions[0] .= $connection->quote_name($name) . $bind;
-		}
-		return $conditions;
-	}
-
-	/**
-	 * Like create_conditions_from_underscored_string but returns a hash of name => value array instead.
-	 *
-	 * @param string $name A string containing attribute names connected with _and_ or _or_
-	 * @param $args Array of values for each attribute in $name
-	 * @param $map A hash of "mapped_column_name" => "real_column_name"
-	 * @return array A hash of array(name => value, ...)
-	 */
-	public static function create_hash_from_underscored_string($name, &$values=array(), &$map=null)
-	{
-		$parts = preg_split('/(_and_|_or_)/i',$name);
-		$hash = array();
-
-		for ($i=0,$n=count($parts); $i<$n; ++$i)
-		{
-			// map to correct name if $map was supplied
-			$name = $map && isset($map[$parts[$i]]) ? $map[$parts[$i]] : $parts[$i];
-			$hash[$name] = $values[$i];
-		}
-		return $hash;
-	}
-
-	/**
-	 * prepends table name to hash of field names to get around ambiguous fields when SQL builder
-	 * has joins
-	 *
-	 * @param array $hash
-	 * @return array $new
-	 */
-	private function prepend_table_name_to_fields($hash=array())
-	{
-		$new = array();
-		$table = $this->connection->quote_name($this->table);
-
-		foreach ($hash as $key => $value)
-		{
-			$k = $this->connection->quote_name($key);
-			$new[$table.'.'.$k] = $value;
-		}
-
-		return $new;
-	}
-
-	private function apply_where_conditions($args)
-	{
-		require_once 'Expressions.php';
-		$num_args = count($args);
-
-		if ($num_args == 1 && is_hash($args[0]))
-		{
-			$hash = is_null($this->joins) ? $args[0] : $this->prepend_table_name_to_fields($args[0]);
-			$e = new Expressions($this->connection,$hash);
-			$this->where = $e->to_s();
-			$this->where_values = array_flatten($e->values());
-		}
-		elseif ($num_args > 0)
-		{
-			// if the values has a nested array then we'll need to use Expressions to expand the bind marker for us
-			$values = array_slice($args,1);
-
-			foreach ($values as $name => &$value)
-			{
-				if (is_array($value))
-				{
-					$e = new Expressions($this->connection,$args[0]);
-					$e->bind_values($values);
-					$this->where = $e->to_s();
-					$this->where_values = array_flatten($e->values());
-					return;
-				}
-			}
-
-			// no nested array so nothing special to do
-			$this->where = $args[0];
-			$this->where_values = &$values;
-		}
-	}
-
-	private function build_delete()
-	{
-		$sql = "DELETE FROM $this->table";
-
-		if ($this->where)
-			$sql .= " WHERE $this->where";
-
-		return $sql;
-	}
-
-	private function build_insert()
-	{
-		require_once 'Expressions.php';
-		$keys = join(',',$this->quoted_key_names());
-
-		if ($this->sequence)
-		{
-			$sql =
-				"INSERT INTO $this->table($keys," . $this->connection->quote_name($this->sequence[0]) .
-				") VALUES(?," . $this->connection->next_sequence_value($this->sequence[1]) . ")";
-		}
-		else
-			$sql = "INSERT INTO $this->table($keys) VALUES(?)";
-
-		$e = new Expressions($this->connection,$sql,array_values($this->data));
-		return $e->to_s();
-	}
-
-	private function build_select()
-	{
-		$sql = "SELECT $this->select FROM $this->table";
-
-		if ($this->joins)
-			$sql .= ' ' . $this->joins;
-
-		if ($this->where)
-			$sql .= " WHERE $this->where";
-
-		if ($this->group)
-			$sql .= " GROUP BY $this->group";
-
-		if ($this->having)
-			$sql .= " HAVING $this->having";
-
-		if ($this->order)
-			$sql .= " ORDER BY $this->order";
-
-		if ($this->limit || $this->offset)
-			$sql = $this->connection->limit($sql,$this->offset,$this->limit);
-
-		return $sql;
-	}
-
-	private function build_update()
-	{
-		$fields = $this->quoted_key_names();
-		$sql = "UPDATE $this->table SET " . join('=?, ',$fields) . '=?';
-
-		if ($this->where)
-			$sql .= " WHERE $this->where";
-
-		return $sql;
-	}
-
-	private function quoted_key_names()
-	{
-		$keys = array();
-
-		foreach ($this->data as $key => $value)
-			$keys[] = $this->connection->quote_name($key);
-
-		return $keys;
-	}
-}
-?>
diff --git a/lib/ar/Serialization.php b/lib/ar/Serialization.php
deleted file mode 100644
index 03aa271..0000000
--- a/lib/ar/Serialization.php
+++ /dev/null
@@ -1,302 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-use XmlWriter;
-
-/**
- * Base class for Model serializers.
- *
- * All serializers support the following options:
- *
- * <ul>
- * <li><b>only:</b> a string or array of attributes to be included.</li>
- * <li><b>exclude:</b> a string or array of attributes to be excluded.</li>
- * <li><b>methods:</b> a string or array of methods to invoke. The method's name will be used as a key for the final attributes array
- * along with the method's returned value</li>
- * <li><b>include:</b> a string or array of associated models to include in the final serialized product.</li>
- * <li><b>skip_instruct:</b> set to true to skip the <?xml ...?> declaration.</li>
- * </ul>
- *
- * Example usage:
- *
- * <code>
- * # include the attributes id and name
- * # run $model->encoded_description() and include its return value
- * # include the comments association
- * # include posts association with its own options (nested)
- * $model->to_json(array(
- *   'only' => array('id','name', 'encoded_description'),
- *   'methods' => array('encoded_description'),
- *   'include' => array('comments', 'posts' => array('only' => 'id'))
- * ));
- *
- * # exclude the password field from being included
- * $model->to_xml(array('exclude' => 'password')));
- * </code>
- *
- * @package ActiveRecord
- * @link http://www.phpactiverecord.org/guides/utilities#topic-serialization
- */
-abstract class Serialization
-{
-	protected $model;
-	protected $options;
-	protected $attributes;
-
-	/**
-	 * Set this to true if the serializer needs to create a nested array keyed
-	 * on the name of the included classes such as for xml serialization.
-	 *
-	 * Setting this to true will produce the following attributes array when
-	 * the include option was used:
-	 *
-	 * <code>
-	 * $user = array('id' => 1, 'name' => 'Tito',
-	 *   'permissions' => array(
-	 *     'permission' => array(
-	 *       array('id' => 100, 'name' => 'admin'),
-	 *       array('id' => 101, 'name' => 'normal')
-	 *     )
-	 *   )
-	 * );
-	 * </code>
-	 *
-	 * Setting to false will produce this:
-	 *
-	 * <code>
-	 * $user = array('id' => 1, 'name' => 'Tito',
-	 *   'permissions' => array(
-	 *     array('id' => 100, 'name' => 'admin'),
-	 *     array('id' => 101, 'name' => 'normal')
-	 *   )
-	 * );
-	 * </code>
-	 *
-	 * @var boolean
-	 */
-	protected $includes_with_class_name_element = false;
-
-	/**
-	 * Constructs a {@link Serialization} object.
-	 *
-	 * @param Model $model The model to serialize
-	 * @param array &$options Options for serialization
-	 * @return Serialization
-	 */
-	public function __construct(Model $model, &$options)
-	{
-		$this->model = $model;
-		$this->options = $options;
-		$this->attributes = $model->attributes();
-		$this->parse_options();
-	}
-
-	private function parse_options()
-	{
-		$this->check_only();
-		$this->check_except();
-		$this->check_methods();
-		$this->check_include();
-	}
-
-	private function check_only()
-	{
-		if (isset($this->options['only']))
-		{
-			$this->options_to_a('only');
-
-			$exclude = array_diff(array_keys($this->attributes),$this->options['only']);
-			$this->attributes = array_diff_key($this->attributes,array_flip($exclude));
-		}
-	}
-
-	private function check_except()
-	{
-		if (isset($this->options['except']) && !isset($this->options['only']))
-		{
-			$this->options_to_a('except');
-			$this->attributes = array_diff_key($this->attributes,array_flip($this->options['except']));
-		}
-	}
-
-	private function check_methods()
-	{
-		if (isset($this->options['methods']))
-		{
-			$this->options_to_a('methods');
-
-			foreach ($this->options['methods'] as $method)
-			{
-				if (method_exists($this->model, $method))
-					$this->attributes[$method] = $this->model->$method();
-			}
-		}
-	}
-
-	private function check_include()
-	{
-		if (isset($this->options['include']))
-		{
-			$this->options_to_a('include');
-
-			$serializer_class = get_class($this);
-
-			foreach ($this->options['include'] as $association => $options)
-			{
-				if (!is_array($options))
-				{
-					$association = $options;
-					$options = array();
-				}
-
-				try {
-					$assoc = $this->model->$association;
-
-					if (!is_array($assoc))
-					{
-						$serialized = new $serializer_class($assoc, $options);
-						$this->attributes[$association] = $serialized->to_a();;
-					}
-					else
-					{
-						$includes = array();
-
-						foreach ($assoc as $a)
-						{
-							$serialized = new $serializer_class($a, $options);
-
-							if ($this->includes_with_class_name_element)
-								$includes[strtolower(get_class($a))][] = $serialized->to_a();
-							else
-								$includes[] = $serialized->to_a();
-						}
-
-						$this->attributes[$association] = $includes;
-					}
-
-				} catch (UndefinedPropertyException $e) {
-					;//move along
-				}
-			}
-		}
-	}
-
-	final protected function options_to_a($key)
-	{
-		if (!is_array($this->options[$key]))
-			$this->options[$key] = array($this->options[$key]);
-	}
-
-	/**
-	 * Returns the attributes array.
-	 * @return array
-	 */
-	final public function to_a()
-	{
-		$date_format = Config::instance()->get_date_format();
-
-		foreach ($this->attributes as &$value)
-		{
-			if ($value instanceof \DateTime)
-				$value = $value->format($date_format);
-		}
-		return $this->attributes;
-	}
-
-	/**
-	 * Returns the serialized object as a string.
-	 * @see to_s
-	 * @return string
-	 */
-	final public function __toString()
-	{
-		return $this->to_s();
-	}
-
-	/**
-	 * Performs the serialization.
-	 * @return string
-	 */
-	abstract public function to_s();
-};
-
-/**
- * JSON serializer.
- *
- * @package ActiveRecord
- */
-class JsonSerializer extends Serialization
-{
-	public static $include_root = false;
-
-	public function to_s()
-	{
-		return json_encode(self::$include_root ? array(strtolower(get_class($this->model)) => $this->to_a()) : $this->to_a());
-	}
-}
-
-/**
- * XML serializer.
- *
- * @package ActiveRecord
- */
-class XmlSerializer extends Serialization
-{
-	private $writer;
-
-	public function __construct(Model $model, &$options)
-	{
-		$this->includes_with_class_name_element = true;
-		parent::__construct($model,$options);
-	}
-
-	public function to_s()
-	{
-		return $this->xml_encode();
-	}
-
-	private function xml_encode()
-	{
-		$this->writer = new XmlWriter();
-		$this->writer->openMemory();
-		$this->writer->startDocument('1.0', 'UTF-8');
-		$this->writer->startElement(strtolower(denamespace(($this->model))));
-		$this->write($this->to_a());
-		$this->writer->endElement();
-		$this->writer->endDocument();
-		$xml = $this->writer->outputMemory(true);
-
-		if (@$this->options['skip_instruct'] == true)
-			$xml = preg_replace('/<\?xml version.*?\?>/','',$xml);
-
-		return $xml;
-	}
-
-	private function write($data, $tag=null)
-	{
-		foreach ($data as $attr => $value)
-		{
-			if ($tag != null)
-				$attr = $tag;
-
-			if (is_array($value) || is_object($value))
-			{
-				if (!is_int(key($value)))
-				{
-					$this->writer->startElement($attr);
-					$this->write($value);
-					$this->writer->endElement();
-				}
-				else
-					$this->write($value, $attr);
-
-				continue;
-			}
-
-			$this->writer->writeElement($attr, $value);
-		}
-	}
-}
-?>
diff --git a/lib/ar/Singleton.php b/lib/ar/Singleton.php
deleted file mode 100644
index c652927..0000000
--- a/lib/ar/Singleton.php
+++ /dev/null
@@ -1,57 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * This implementation of the singleton pattern does not conform to the strong definition
- * given by the "Gang of Four." The __construct() method has not be privatized so that
- * a singleton pattern is capable of being achieved; however, multiple instantiations are also
- * possible. This allows the user more freedom with this pattern.
- *
- * @package ActiveRecord
- */
-abstract class Singleton
-{
-	/**
-	 * Array of cached singleton objects.
-	 *
-	 * @var array
-	 */
-	private static $instances = array();
-
-	/**
-	 * Static method for instantiating a singleton object.
-	 *
-	 * @return object
-	 */
-	final public static function instance()
-	{
-		$class_name = get_called_class();
-
-		if (!isset(self::$instances[$class_name]))
-			self::$instances[$class_name] = new $class_name;
-
-		return self::$instances[$class_name];
-	}
-
-	/**
-	 * Singleton objects should not be cloned.
-	 *
-	 * @return void
-	 */
-	final private function __clone() {}
-
-	/**
-	 * Similar to a get_called_class() for a child class to invoke.
-	 *
-	 * @return string
-	 */
-	final protected function get_called_class()
-	{
-		$backtrace = debug_backtrace();
-    	return get_class($backtrace[2]['object']);
-	}
-}
-?>
\ No newline at end of file
diff --git a/lib/ar/Table.php b/lib/ar/Table.php
deleted file mode 100644
index 30c78a4..0000000
--- a/lib/ar/Table.php
+++ /dev/null
@@ -1,547 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Manages reading and writing to a database table.
- *
- * This class manages a database table and is used by the Model class for
- * reading and writing to its database table. There is one instance of Table
- * for every table you have a model for.
- *
- * @package ActiveRecord
- */
-class Table
-{
-	private static $cache = array();
-
-	public $class;
-	public $conn;
-	public $pk;
-	public $last_sql;
-
-	// Name/value pairs of columns in this table
-	public $columns = array();
-
-	/**
-	 * Name of the table.
-	 */
-	public $table;
-
-	/**
-	 * Name of the database (optional)
-	 */
-	public $db_name;
-
-	/**
-	 * Name of the sequence for this table (optional). Defaults to {$table}_seq
-	 */
-	public $sequence;
-
-	/**
-	 * A instance of CallBack for this model/table
-	 * @static
-	 * @var object ActiveRecord\CallBack
-	 */
-	public $callback;
-
-	/**
-	 * List of relationships for this table.
-	 */
-	private $relationships = array();
-
-	public static function load($model_class_name)
-	{
-		if (!isset(self::$cache[$model_class_name]))
-		{
-			/* do not place set_assoc in constructor..it will lead to infinite loop due to
-			   relationships requesting the model's table, but the cache hasn't been set yet */
-			self::$cache[$model_class_name] = new Table($model_class_name);
-			self::$cache[$model_class_name]->set_associations();
-		}
-
-		return self::$cache[$model_class_name];
-	}
-
-	public static function clear_cache($model_class_name=null)
-	{
-		if ($model_class_name && array_key_exists($model_class_name,self::$cache))
-			unset(self::$cache[$model_class_name]);
-		else
-			self::$cache = array();
-	}
-
-	public function __construct($class_name)
-	{
-		$this->class = Reflections::instance()->add($class_name)->get($class_name);
-
-		// if connection name property is null the connection manager will use the default connection
-		$connection = $this->class->getStaticPropertyValue('connection',null);
-
-		$this->conn = ConnectionManager::get_connection($connection);
-		$this->set_table_name();
-		$this->get_meta_data();
-		$this->set_primary_key();
-		$this->set_sequence_name();
-		$this->set_delegates();
-		$this->set_setters_and_getters();
-
-		$this->callback = new CallBack($class_name);
-		$this->callback->register('before_save', function(Model $model) { $model->set_timestamps(); }, array('prepend' => true));
-		$this->callback->register('after_save', function(Model $model) { $model->reset_dirty(); }, array('prepend' => true));
-	}
-
-	public function create_joins($joins)
-	{
-		if (!is_array($joins))
-			return $joins;
-
-		$self = $this->table;
-		$ret = $space = '';
-
-		$existing_tables = array();
-		foreach ($joins as $value)
-		{
-			$ret .= $space;
-
-			if (stripos($value,'JOIN ') === false)
-			{
-				if (array_key_exists($value, $this->relationships))
-				{
-					$rel = $this->get_relationship($value);
-
-					// if there is more than 1 join for a given table we need to alias the table names
-					if (array_key_exists($rel->class_name, $existing_tables))
-					{
-						$alias = $value;
-						$existing_tables[$rel->class_name]++;
-					}
-					else
-					{
-						$existing_tables[$rel->class_name] = true;
-						$alias = null;
-					}
-
-					$ret .= $rel->construct_inner_join_sql($this, false, $alias);
-				}
-				else
-					throw new RelationshipException("Relationship named $value has not been declared for class: {$this->class->getName()}");
-			}
-			else
-				$ret .= $value;
-
-			$space = ' ';
-		}
-		return $ret;
-	}
-
-	public function options_to_sql($options)
-	{
-		$table = array_key_exists('from', $options) ? $options['from'] : $this->get_fully_qualified_table_name();
-		$sql = new SQLBuilder($this->conn, $table);
-
-		if (array_key_exists('joins',$options))
-		{
-			$sql->joins($this->create_joins($options['joins']));
-
-			// by default, an inner join will not fetch the fields from the joined table
-			if (!array_key_exists('select', $options))
-				$options['select'] = $this->get_fully_qualified_table_name() . '.*';
-		}
-
-		if (array_key_exists('select',$options))
-			$sql->select($options['select']);
-
-		if (array_key_exists('conditions',$options))
-		{
-			if (!is_hash($options['conditions']))
-			{
-				if (is_string($options['conditions']))
-					$options['conditions'] = array($options['conditions']);
-
-				call_user_func_array(array($sql,'where'),$options['conditions']);
-			}
-			else
-			{
-				if (!empty($options['mapped_names']))
-					$options['conditions'] = $this->map_names($options['conditions'],$options['mapped_names']);
-
-				$sql->where($options['conditions']);
-			}
-		}
-
-		if (array_key_exists('order',$options))
-			$sql->order($options['order']);
-
-		if (array_key_exists('limit',$options))
-			$sql->limit($options['limit']);
-
-		if (array_key_exists('offset',$options))
-			$sql->offset($options['offset']);
-
-		if (array_key_exists('group',$options))
-			$sql->group($options['group']);
-
-		if (array_key_exists('having',$options))
-			$sql->having($options['having']);
-
-		return $sql;
-	}
-
-	public function find($options)
-	{
-		$sql = $this->options_to_sql($options);
-		$readonly = (array_key_exists('readonly',$options) && $options['readonly']) ? true : false;
-		$eager_load = array_key_exists('include',$options) ? $options['include'] : null;
-
-		return $this->find_by_sql($sql->to_s(),$sql->get_where_values(), $readonly, $eager_load);
-	}
-
-	public function find_by_sql($sql, $values=null, $readonly=false, $includes=null)
-	{
-		$this->last_sql = $sql;
-
-		$collect_attrs_for_includes = is_null($includes) ? false : true;
-		$list = $attrs = array();
-		$sth = $this->conn->query($sql,$this->process_data($values));
-
-		while (($row = $sth->fetch()))
-		{
-			$model = new $this->class->name($row,false,true,false);
-
-			if ($readonly)
-				$model->readonly();
-
-			if ($collect_attrs_for_includes)
-				$attrs[] = $model->attributes();
-
-			$list[] = $model;
-		}
-
-		if ($collect_attrs_for_includes && !empty($list))
-			$this->execute_eager_load($list, $attrs, $includes);
-
-		return $list;
-	}
-
-	/**
-	 * Executes an eager load of a given named relationship for this table.
-	 *
-	 * @param $models array found modesl for this table
-	 * @param $attrs array of attrs from $models
-	 * @param $includes array eager load directives
-	 * @return void
-	 */
-	private function execute_eager_load($models=array(), $attrs=array(), $includes=array())
-	{
-		if (!is_array($includes))
-			$includes = array($includes);
-
-		foreach ($includes as $index => $name)
-		{
-			// nested include
-			if (is_array($name))
-			{
-				$nested_includes = count($name) > 1 ? $name : $name[0];
-				$name = $index;
-			}
-			else
-				$nested_includes = array();
-
-			$rel = $this->get_relationship($name, true);
-			$rel->load_eagerly($models, $attrs, $nested_includes, $this);
-		}
-	}
-
-	public function get_column_by_inflected_name($inflected_name)
-	{
-		foreach ($this->columns as $raw_name => $column)
-		{
-			if ($column->inflected_name == $inflected_name)
-				return $column;
-		}
-		return null;
-	}
-
-	public function get_fully_qualified_table_name($quote_name=true)
-	{
-		$table = $quote_name ? $this->conn->quote_name($this->table) : $this->table;
-
-		if ($this->db_name)
-			$table = $this->conn->quote_name($this->db_name) . ".$table";
-
-		return $table;
-	}
-
-	/**
-	 * Retrieve a relationship object for this table. Strict as true will throw an error
-	 * if the relationship name does not exist.
-	 *
-	 * @param $name string name of Relationship
-	 * @param $strict bool
-	 * @throws RelationshipException
-	 * @return Relationship or null
-	 */
-	public function get_relationship($name, $strict=false)
-	{
-		if ($this->has_relationship($name))
-			return $this->relationships[$name];
-
-		if ($strict)
-			throw new RelationshipException("Relationship named $name has not been declared for class: {$this->class->getName()}");
-
-		return null;
-	}
-
-	/**
-	 * Does a given relationship exist?
-	 *
-	 * @param $name string name of Relationship
-	 * @return bool
-	 */
-	public function has_relationship($name)
-	{
-		return array_key_exists($name, $this->relationships);
-	}
-
-	public function insert(&$data, $pk=null, $sequence_name=null)
-	{
-		$data = $this->process_data($data);
-
-		$sql = new SQLBuilder($this->conn,$this->get_fully_qualified_table_name());
-		$sql->insert($data,$pk,$sequence_name);
-
-		$values = array_values($data);
-		return $this->conn->query(($this->last_sql = $sql->to_s()),$values);
-	}
-
-	public function update(&$data, $where)
-	{
-		$data = $this->process_data($data);
-
-		$sql = new SQLBuilder($this->conn,$this->get_fully_qualified_table_name());
-		$sql->update($data)->where($where);
-
-		$values = $sql->bind_values();
-		return $this->conn->query(($this->last_sql = $sql->to_s()),$values);
-	}
-
-	public function delete($data)
-	{
-		$data = $this->process_data($data);
-
-		$sql = new SQLBuilder($this->conn,$this->get_fully_qualified_table_name());
-		$sql->delete($data);
-
-		$values = $sql->bind_values();
-		return $this->conn->query(($this->last_sql = $sql->to_s()),$values);
-	}
-
-	/**
-	 * Add a relationship.
-	 *
-	 * @param Relationship $relationship a Relationship object
-	 */
-	private function add_relationship($relationship)
-	{
-		$this->relationships[$relationship->attribute_name] = $relationship;
-	}
-
-	private function get_meta_data()
-	{
-		// as more adapters are added probably want to do this a better way
-		// than using instanceof but gud enuff for now
-		$quote_name = !($this->conn instanceof PgsqlAdapter);
-
-		$this->columns = $this->conn->columns($this->get_fully_qualified_table_name($quote_name));
-	}
-
-	/**
-	 * Replaces any aliases used in a hash based condition.
-	 *
-	 * @param $hash array A hash
-	 * @param $map array Hash of used_name => real_name
-	 * @return array Array with any aliases replaced with their read field name
-	 */
-	private function map_names(&$hash, &$map)
-	{
-		$ret = array();
-
-		foreach ($hash as $name => &$value)
-		{
-			if (array_key_exists($name,$map))
-				$name = $map[$name];
-
-			$ret[$name] = $value;
-		}
-		return $ret;
-	}
-
-	private function &process_data($hash)
-	{
-		if (!$hash)
-			return $hash;
-
-		foreach ($hash as $name => &$value)
-		{
-			if ($value instanceof \DateTime)
-			{
-				if (isset($this->columns[$name]) && $this->columns[$name]->type == Column::DATE)
-					$hash[$name] = $this->conn->date_to_string($value);
-				else
-					$hash[$name] = $this->conn->datetime_to_string($value);
-			}
-			else
-				$hash[$name] = $value;
-		}
-		return $hash;
-	}
-
-	private function set_primary_key()
-	{
-		if (($pk = $this->class->getStaticPropertyValue('pk',null)) || ($pk = $this->class->getStaticPropertyValue('primary_key',null)))
-			$this->pk = is_array($pk) ? $pk : array($pk);
-		else
-		{
-			$this->pk = array();
-
-			foreach ($this->columns as $c)
-			{
-				if ($c->pk)
-					$this->pk[] = $c->inflected_name;
-			}
-		}
-	}
-
-	private function set_table_name()
-	{
-		if (($table = $this->class->getStaticPropertyValue('table',null)) || ($table = $this->class->getStaticPropertyValue('table_name',null)))
-			$this->table = $table;
-		else
-		{
-			// infer table name from the class name
-			$this->table = Inflector::instance()->tableize($this->class->getName());
-
-			// strip namespaces from the table name if any
-			$parts = explode('\\',$this->table);
-			$this->table = $parts[count($parts)-1];
-		}
-
-		if(($db = $this->class->getStaticPropertyValue('db',null)) || ($db = $this->class->getStaticPropertyValue('db_name',null)))
-			$this->db_name = $db;
-	}
-
-	private function set_sequence_name()
-	{
-		if (!$this->conn->supports_sequences())
-			return;
-
-		if (!($this->sequence = $this->class->getStaticPropertyValue('sequence')))
-			$this->sequence = $this->conn->get_sequence_name($this->table,$this->pk[0]);
-	}
-
-	private function set_associations()
-	{
-		require_once 'Relationship.php';
-
-		foreach ($this->class->getStaticProperties() as $name => $definitions)
-		{
-			if (!$definitions || !is_array($definitions))
-				continue;
-
-			foreach ($definitions as $definition)
-			{
-				$relationship = null;
-
-				switch ($name)
-				{
-					case 'has_many':
-						$relationship = new HasMany($definition);
-						break;
-
-					case 'has_one':
-						$relationship = new HasOne($definition);
-						break;
-
-					case 'belongs_to':
-						$relationship = new BelongsTo($definition);
-						break;
-
-					case 'has_and_belongs_to_many':
-						$relationship = new HasAndBelongsToMany($definition);
-						break;
-				}
-
-				if ($relationship)
-					$this->add_relationship($relationship);
-			}
-		}
-	}
-
-	/**
-	 * Rebuild the delegates array into format that we can more easily work with in Model.
-	 * Will end up consisting of array of:
-	 *
-	 * array('delegate' => array('field1','field2',...),
-	 *       'to'       => 'delegate_to_relationship',
-	 *       'prefix'	=> 'prefix')
-	 */
-	private function set_delegates()
-	{
-		$delegates = $this->class->getStaticPropertyValue('delegate',array());
-		$new = array();
-
-		if (!array_key_exists('processed', $delegates))
-			$delegates['processed'] = false;
-
-		if (!empty($delegates) && !$delegates['processed'])
-		{
-			foreach ($delegates as &$delegate)
-			{
-				if (!is_array($delegate) || !isset($delegate['to']))
-					continue;
-
-				if (!isset($delegate['prefix']))
-					$delegate['prefix'] = null;
-
-				$new_delegate = array(
-					'to'		=> $delegate['to'],
-					'prefix'	=> $delegate['prefix'],
-					'delegate'	=> array());
-
-				foreach ($delegate as $name => $value)
-				{
-					if (is_numeric($name))
-						$new_delegate['delegate'][] = $value;
-				}
-
-				$new[] = $new_delegate;
-			}
-
-			$new['processed'] = true;
-			$this->class->setStaticPropertyValue('delegate',$new);
-		}
-	}
-
-	/**
-	 * Builds the getters/setters array by prepending get_/set_ to the method names.
-	 */
-	private function set_setters_and_getters()
-	{
-		$build = array('setters', 'getters');
-
-		foreach ($build as $type)
-		{
-			$methods = array();
-			$prefix = substr($type,0,3) . "_";
-
-			foreach ($this->class->getStaticPropertyValue($type,array()) as $method)
-				$methods[] = (substr($method,0,4) != $prefix ? "{$prefix}$method" : $method);
-
-			$this->class->setStaticPropertyValue($type,$methods);
-		}
-	}
-};
-?>
diff --git a/lib/ar/Utils.php b/lib/ar/Utils.php
deleted file mode 100644
index 82a928a..0000000
--- a/lib/ar/Utils.php
+++ /dev/null
@@ -1,351 +0,0 @@
-<?php
-/**
- *
- * @package ActiveRecord
- */
-
-/*
- * Thanks to http://www.eval.ca/articles/php-pluralize (MIT license)
- *           http://dev.rubyonrails.org/browser/trunk/activesupport/lib/active_support/inflections.rb (MIT license)
- *           http://www.fortunecity.com/bally/durrus/153/gramch13.html
- *           http://www2.gsu.edu/~wwwesl/egw/crump.htm
- *
- * Changes (12/17/07)
- *   Major changes
- *   --
- *   Fixed irregular noun algorithm to use regular expressions just like the original Ruby source.
- *       (this allows for things like fireman -> firemen
- *   Fixed the order of the singular array, which was backwards.
- *
- *   Minor changes
- *   --
- *   Removed incorrect pluralization rule for /([^aeiouy]|qu)ies$/ => $1y
- *   Expanded on the list of exceptions for *o -> *oes, and removed rule for buffalo -> buffaloes
- *   Removed dangerous singularization rule for /([^f])ves$/ => $1fe
- *   Added more specific rules for singularizing lives, wives, knives, sheaves, loaves, and leaves and thieves
- *   Added exception to /(us)es$/ => $1 rule for houses => house and blouses => blouse
- *   Added excpetions for feet, geese and teeth
- *   Added rule for deer -> deer
- *
- * Changes:
- *   Removed rule for virus -> viri
- *   Added rule for potato -> potatoes
- *   Added rule for *us -> *uses
- */
-namespace ActiveRecord;
-
-use \Closure;
-
-function classify($class_name, $singularize=false)
-{
-	if ($singularize)
-	{
-		$parts = explode('_',  Inflector::instance()->uncamelize($class_name));
-		$class_name = '';
-		foreach ($parts as $name)
-			$class_name .= '_' . Utils::singularize($name);
-
-		$class_name = ltrim($class_name, '_');
-	}
-
-	$class_name = Inflector::instance()->camelize($class_name);
-
-	return ucfirst($class_name);
-}
-
-// http://snippets.dzone.com/posts/show/4660
-function array_flatten(array $array)
-{
-	$i = 0;
-	$n = count($array);
-
-	while ($i < $n)
-	{
-		if (is_array($array[$i]))
-			array_splice($array,$i,1,$array[$i]);
-        else
-			++$i;
-
-		$n = count($array);
-    }
-    return $array;
-}
-
-/**
- * Somewhat naive way to determine if an array is a hash.
- */
-function is_hash(&$array)
-{
-	if (!is_array($array))
-		return false;
-
-	$keys = array_keys($array);
-	return @is_string($keys[0]) ? true : false;
-}
-
-/**
- * Strips a class name of any namespaces and namespace operator.
- *
- * @param string $class
- * @return string stripped class name
- * @access public
- */
-function denamespace($class_name)
-{
-	if (is_object($class_name))
-		$class_name = get_class($class_name);
-
-	if (has_namespace($class_name))
-	{
-		$parts = explode('\\', $class_name);
-		return end($parts);
-	}
-	return $class_name;
-}
-
-function get_namespaces($class_name)
-{
-	if (has_namespace($class_name))
-		return explode('\\', $class_name);
-	return null;
-}
-
-function has_namespace($class_name)
-{
-	if (strpos($class_name, '\\') !== false)
-		return true;
-	return false;
-}
-
-/**
- * Returns true if all values in $haystack === $needle
- * @param $needle
- * @param $haystack
- * @return unknown_type
- */
-function all($needle, array $haystack)
-{
-	foreach ($haystack as $value)
-	{
-		if ($value !== $needle)
-			return false;
-	}
-	return true;
-}
-
-function collect(&$enumerable, $name_or_closure)
-{
-	$ret = array();
-
-	foreach ($enumerable as $value)
-	{
-		if (is_string($name_or_closure))
-			$ret[] = is_array($value) ? $value[$name_or_closure] : $value->$name_or_closure;
-		elseif ($name_or_closure instanceof Closure)
-			$ret[] = $name_or_closure($value);
-	}
-	return $ret;
-}
-
-/**
- * Some internal utility functions.
- *
- * @package ActiveRecord
- */
-class Utils
-{
-	public static function extract_options($options)
-	{
-		return is_array(end($options)) ? end($options) : array();
-	}
-
-	public static function add_condition(&$conditions=array(), $condition, $conjuction='AND')
-	{
-		if (is_array($condition))
-		{
-			if (empty($conditions))
-				$conditions = array_flatten($condition);
-			else
-			{
-				$conditions[0] .= " $conjuction " . array_shift($condition);
-				$conditions[] = array_flatten($condition);
-			}
-		}
-		elseif (is_string($condition))
-			$conditions[0] .= " $conjuction $condition";
-
-		return $conditions;
-	}
-
-	public static function human_attribute($attr)
-	{
-		$inflector = Inflector::instance();
-		$inflected = $inflector->variablize($attr);
-		$normal = $inflector->uncamelize($inflected);
-
-		return ucfirst(str_replace('_', ' ', $normal));
-	}
-
-	public static function is_odd($number)
-	{
-		return $number & 1;
-	}
-
-	public static function is_a($type, $var)
-	{
-		switch($type)
-		{
-			case 'range':
-				if (is_array($var) && (int)$var[0] < (int)$var[1])
-					return true;
-
-		}
-
-		return false;
-	}
-
-	public static function is_blank($var)
-	{
-		return 0 === strlen($var);
-	}
-
-	private static $plural = array(
-        '/(quiz)$/i'               => "$1zes",
-        '/^(ox)$/i'                => "$1en",
-        '/([m|l])ouse$/i'          => "$1ice",
-        '/(matr|vert|ind)ix|ex$/i' => "$1ices",
-        '/(x|ch|ss|sh)$/i'         => "$1es",
-        '/([^aeiouy]|qu)y$/i'      => "$1ies",
-        '/(hive)$/i'               => "$1s",
-        '/(?:([^f])fe|([lr])f)$/i' => "$1$2ves",
-        '/(shea|lea|loa|thie)f$/i' => "$1ves",
-        '/sis$/i'                  => "ses",
-        '/([ti])um$/i'             => "$1a",
-        '/(tomat|potat|ech|her|vet)o$/i'=> "$1oes",
-        '/(bu)s$/i'                => "$1ses",
-        '/(alias)$/i'              => "$1es",
-        '/(octop)us$/i'            => "$1i",
-        '/(ax|test)is$/i'          => "$1es",
-        '/(us)$/i'                 => "$1es",
-        '/s$/i'                    => "s",
-        '/$/'                      => "s"
-    );
-
-    private static $singular = array(
-        '/(quiz)zes$/i'             => "$1",
-        '/(matr)ices$/i'            => "$1ix",
-        '/(vert|ind)ices$/i'        => "$1ex",
-        '/^(ox)en$/i'               => "$1",
-        '/(alias)es$/i'             => "$1",
-        '/(octop|vir)i$/i'          => "$1us",
-        '/(cris|ax|test)es$/i'      => "$1is",
-        '/(shoe)s$/i'               => "$1",
-        '/(o)es$/i'                 => "$1",
-        '/(bus)es$/i'               => "$1",
-        '/([m|l])ice$/i'            => "$1ouse",
-        '/(x|ch|ss|sh)es$/i'        => "$1",
-        '/(m)ovies$/i'              => "$1ovie",
-        '/(s)eries$/i'              => "$1eries",
-        '/([^aeiouy]|qu)ies$/i'     => "$1y",
-        '/([lr])ves$/i'             => "$1f",
-        '/(tive)s$/i'               => "$1",
-        '/(hive)s$/i'               => "$1",
-        '/(li|wi|kni)ves$/i'        => "$1fe",
-        '/(shea|loa|lea|thie)ves$/i'=> "$1f",
-        '/(^analy)ses$/i'           => "$1sis",
-        '/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i'  => "$1$2sis",
-        '/([ti])a$/i'               => "$1um",
-        '/(n)ews$/i'                => "$1ews",
-        '/(h|bl)ouses$/i'           => "$1ouse",
-        '/(corpse)s$/i'             => "$1",
-        '/(us)es$/i'                => "$1",
-        '/s$/i'                     => ""
-    );
-
-    private static $irregular = array(
-        'move'   => 'moves',
-        'foot'   => 'feet',
-        'goose'  => 'geese',
-        'sex'    => 'sexes',
-        'child'  => 'children',
-        'man'    => 'men',
-        'tooth'  => 'teeth',
-        'person' => 'people'
-    );
-
-    private static $uncountable = array(
-        'sheep',
-        'fish',
-        'deer',
-        'series',
-        'species',
-        'money',
-        'rice',
-        'information',
-        'equipment'
-    );
-
-    public static function pluralize( $string )
-    {
-        // save some time in the case that singular and plural are the same
-        if ( in_array( strtolower( $string ), self::$uncountable ) )
-            return $string;
-
-        // check for irregular singular forms
-        foreach ( self::$irregular as $pattern => $result )
-        {
-            $pattern = '/' . $pattern . '$/i';
-
-            if ( preg_match( $pattern, $string ) )
-                return preg_replace( $pattern, $result, $string);
-        }
-
-        // check for matches using regular expressions
-        foreach ( self::$plural as $pattern => $result )
-        {
-            if ( preg_match( $pattern, $string ) )
-                return preg_replace( $pattern, $result, $string );
-        }
-
-        return $string;
-    }
-
-    public static function singularize( $string )
-    {
-        // save some time in the case that singular and plural are the same
-        if ( in_array( strtolower( $string ), self::$uncountable ) )
-            return $string;
-
-        // check for irregular plural forms
-        foreach ( self::$irregular as $result => $pattern )
-        {
-            $pattern = '/' . $pattern . '$/i';
-
-            if ( preg_match( $pattern, $string ) )
-                return preg_replace( $pattern, $result, $string);
-        }
-
-        // check for matches using regular expressions
-        foreach ( self::$singular as $pattern => $result )
-        {
-            if ( preg_match( $pattern, $string ) )
-                return preg_replace( $pattern, $result, $string );
-        }
-
-        return $string;
-    }
-
-    public static function pluralize_if($count, $string)
-    {
-        if ($count == 1)
-            return $string;
-        else
-            return self::pluralize($string);
-    }
-
-	public static function squeeze($char, $string)
-	{
-		return preg_replace("/$char+/",$char,$string);
-	}
-};
-?>
\ No newline at end of file
diff --git a/lib/ar/Validations.php b/lib/ar/Validations.php
deleted file mode 100644
index 7ddb81c..0000000
--- a/lib/ar/Validations.php
+++ /dev/null
@@ -1,833 +0,0 @@
-<?php
-/**
- * These two classes have been <i>heavily borrowed</i> from Ruby on Rails' ActiveRecord so much that
- * this piece can be considered a straight port. The reason for this is that the vaildation process is
- * tricky due to order of operations/events. The former combined with PHP's odd typecasting means
- * that it was easier to formulate this piece base on the rails code.
- *
- * @package ActiveRecord
- */
-
-namespace ActiveRecord;
-use ActiveRecord\Model;
-use IteratorAggregate;
-use ArrayIterator;
-
-/**
- * Manages validations for a {@link Model}.
- *
- * This class isn't meant to be directly used. Instead you define
- * validators thru static variables in your {@link Model}. Example:
- *
- * <code>
- * class Person extends ActiveRecord\Model {
- *   static $validates_length_of = array(
- *     array('name', 'within' => array(30,100),
- *     array('state', 'is' => 2)
- *   );
- * }
- *
- * $person = new Person();
- * $person->name = 'Tito';
- * $person->state = 'this is not two characters';
- *
- * if (!$person->is_valid())
- *   print_r($person->errors);
- * </code>
- *
- * @package ActiveRecord
- * @see Errors
- * @link http://www.phpactiverecord.org/guides/validations
- */
-class Validations
-{
-	private $model;
-	private $options = array();
-	private $validators = array();
-	private $record;
-
-	private static $VALIDATION_FUNCTIONS = array(
-		'validates_presence_of',
-		'validates_size_of',
-		'validates_length_of',
-		'validates_inclusion_of',
-		'validates_exclusion_of',
-		'validates_format_of',
-		'validates_numericality_of',
-		'validates_uniqueness_of'
-	);
-
-	private static $DEFAULT_VALIDATION_OPTIONS = array(
-		'on' => 'save',
-		'allow_null' => false,
-		'allow_blank' => false,
-		'message' => null,
-	);
-
-	private static  $ALL_RANGE_OPTIONS = array(
-		'is' => null,
-		'within' => null,
-		'in' => null,
-		'minimum' => null,
-		'maximum' => null,
-	);
-
-	private static $ALL_NUMERICALITY_CHECKS = array(
-		'greater_than' => null,
-		'greater_than_or_equal_to'  => null,
-		'equal_to' => null,
-		'less_than' => null,
-		'less_than_or_equal_to' => null,
-		'odd' => null,
-		'even' => null
-	);
-
-	/**
-	 * Constructs a {@link Validations} object.
-	 *
-	 * @param Model $model The model to validate
-	 * @return Validations
-	 */
-	public function __construct(Model $model)
-	{
-		$this->model = $model;
-		$this->record = new Errors($this->model);
-		$this->validators = array_intersect(array_keys(Reflections::instance()->get(get_class($this->model))->getStaticProperties()), self::$VALIDATION_FUNCTIONS);
-	}
-
-	/**
-	 * Returns validator data.
-	 *
-	 * @return array
-	 */
-	public function rules()
-	{
-		$data = array();
-		$reflection = Reflections::instance()->get(get_class($this->model));
-
-		foreach ($this->validators as $validate)
-		{
-			$attrs = $reflection->getStaticPropertyValue($validate);
-
-			foreach ($attrs as $attr)
-			{
-				$field = $attr[0];
-
-				if (!isset($data[$field]) || !is_array($data[$field]))
-					$data[$field] = array();
-
-				$attr['validator'] = $validate;
-				unset($attr[0]);
-				array_push($data[$field],$attr);
-			}
-		}
-		return $data;
-	}
-
-	/**
-	 * Runs the validators.
-	 *
-	 * @return Errors the validation errors if any
-	 */
-	public function validate()
-	{
-		$reflection = Reflections::instance()->get(get_class($this->model));
-
-		foreach ($this->validators as $validate)
-			$this->$validate($reflection->getStaticPropertyValue($validate));
-
-		$this->record->clear_model();
-		return $this->record;
-	}
-
-	/**
-	 * Validates a field is not null and not blank.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $validates_presence_of = array(
-	 *     array('first_name'),
-	 *     array('last_name')
-	 *   );
-	 * }
-	 * </code>
-	 *
-	 * Available options:
-	 *
-	 * <ul>
-	 * <li><b>message:</b> custom error message</li>
-	 * </ul>
-	 *
-	 * @param array $attrs Validation definition
-	 */
-	public function validates_presence_of($attrs)
-	{
-		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('message' => Errors::$DEFAULT_ERROR_MESSAGES['blank'], 'on' => 'save'));
-
-		foreach ($attrs as $attr)
-		{
-			$options = array_merge($configuration, $attr);
-			$this->record->add_on_blank($options[0], $options['message']);
-		}
-	}
-
-	/**
-	 * Validates that a value is included the specified array.
-	 *
-	 * <code>
-	 * class Car extends ActiveRecord\Model {
-	 *   static $validates_inclusion_of = array(
-	 *     array('fuel_type', 'in' => array('hyrdogen', 'petroleum', 'electric')),
-	 *   );
-	 * }
-	 * </code>
-	 *
-	 * Available options:
-	 *
-	 * <ul>
-	 * <li><b>in/within:</b> attribute should/shouldn't be a value within an array</li>
-	 * <li><b>message:</b> custome error message</li>
-	 * </ul>
-	 *
-	 * @param array $attrs Validation definition
-	 */
-	public function validates_inclusion_of($attrs)
-	{
-		$this->validates_inclusion_or_exclusion_of('inclusion', $attrs);
-	}
-
-	/**
-	 * This is the opposite of {@link validates_include_of}.
-	 *
-	 * @param array $attrs Validation definition
-	 * @see validates_inclusion_of
-	 */
-	public function validates_exclusion_of($attrs)
-	{
-		$this->validates_inclusion_or_exclusion_of('exclusion', $attrs);
-	}
-
-	/**
-	 * Validates that a value is in or out of a specified list of values.
-	 *
-	 * @see validates_inclusion_of
-	 * @see validates_exclusion_of
-	 * @param string $type Either inclusion or exclusion
-	 * @param $attrs Validation definition
-	 */
-	public function validates_inclusion_or_exclusion_of($type, $attrs)
-	{
-		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('message' => Errors::$DEFAULT_ERROR_MESSAGES[$type], 'on' => 'save'));
-
-		foreach ($attrs as $attr)
-		{
-			$options = array_merge($configuration, $attr);
-			$attribute = $options[0];
-			$var = $this->model->$attribute;
-
-			if (isset($options['in']))
-				$enum = $options['in'];
-			elseif (isset($options['within']))
-				$enum = $options['within'];
-
-			if (!is_array($enum))
-				array($enum);
-
-			$message = str_replace('%s', $var, $options['message']);
-
-			if ($this->is_null_with_option($var, $options) || $this->is_blank_with_option($var, $options))
-				continue;
-
-			if (('inclusion' == $type && !in_array($var, $enum)) || ('exclusion' == $type && in_array($var, $enum)))
-				$this->record->add($attribute, $message);
-		}
-	}
-
-	/**
-	 * Validates that a value is numeric.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $validates_numericality_of = array(
-	 *     array('salary', 'greater_than' => 19.99, 'less_than' => 99.99)
-	 *   );
-	 * }
-	 * </code>
-	 *
-	 * Available options:
-	 *
-	 * <ul>
-	 * <li><b>only_integer:</b> value must be an integer (e.g. not a float)</li>
-	 * <li><b>even:</b> must be even</li>
-	 * <li><b>odd:</b> must be odd"</li>
-	 * <li><b>greater_than:</b> must be greater than specified number</li>
-	 * <li><b>greater_than_or_equal_to:</b> must be greater than or equal to specified number</li>
-	 * <li><b>equal_to:</b> ...</li>
-	 * <li><b>less_than:</b> ...</li>
-	 * <li><b>less_than_or_equal_to:</b> ...</li>
-	 * </ul>
-	 *
-	 * @param array $attrs Validation definition
-	 */
-	public function validates_numericality_of($attrs)
-	{
-		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('only_integer' => false));
-
-		// Notice that for fixnum and float columns empty strings are converted to nil.
-		// Validates whether the value of the specified attribute is numeric by trying to convert it to a float with Kernel.Float
-		// (if only_integer is false) or applying it to the regular expression /\A[+\-]?\d+\Z/ (if only_integer is set to true).
-		foreach ($attrs as $attr)
-		{
-			$options = array_merge($configuration, $attr);
-			$attribute = $options[0];
-			$var = $this->model->$attribute;
-
-			$numericalityOptions = array_intersect_key(self::$ALL_NUMERICALITY_CHECKS, $options);
-
-			if ($this->is_null_with_option($var, $options))
-				continue;
-
-			if (true === $options['only_integer'] && !is_integer($var))
-			{
-				if (!preg_match('/\A[+-]?\d+\Z/', (string)($var)))
-				{
-					if (isset($options['message']))
-						$message = $options['message'];
-					else
-						$message = Errors::$DEFAULT_ERROR_MESSAGES['not_a_number'];
-
-					$this->record->add($attribute, $message);
-					continue;
-				}
-			}
-			else
-			{
-				if (!is_numeric($var))
-				{
-					$this->record->add($attribute, Errors::$DEFAULT_ERROR_MESSAGES['not_a_number']);
-					continue;
-				}
-
-				$var = (float)$var;
-			}
-
-			foreach ($numericalityOptions as $option => $check)
-			{
-				$option_value = $options[$option];
-
-				if ('odd' != $option && 'even' != $option)
-				{
-					$option_value = (float)$options[$option];
-
-					if (!is_numeric($option_value))
-						throw new  ValidationsArgumentError("$option must be a number");
-
-					if (isset($options['message']))
-						$message = $options['message'];
-					else
-						$message = Errors::$DEFAULT_ERROR_MESSAGES[$option];
-
-					$message = str_replace('%d', $option_value, $message);
-
-					if ('greater_than' == $option && !($var > $option_value))
-						$this->record->add($attribute, $message);
-
-					elseif ('greater_than_or_equal_to' == $option && !($var >= $option_value))
-						$this->record->add($attribute, $message);
-
-					elseif ('equal_to' == $option && !($var == $option_value))
-						$this->record->add($attribute, $message);
-
-					elseif ('less_than' == $option && !($var < $option_value))
-						$this->record->add($attribute, $message);
-
-					elseif ('less_than_or_equal_to' == $option && !($var <= $option_value))
-						$this->record->add($attribute, $message);
-				}
-				else
-				{
-					if (isset($options['message']))
-						$message = $options['message'];
-					else
-						$message = Errors::$DEFAULT_ERROR_MESSAGES[$option];
-
-					if ( ('odd' == $option && !( Utils::is_odd($var))) || ('even' == $option && ( Utils::is_odd($var))))
-						$this->record->add($attribute, $message);
-				}
-			}
-		}
-	}
-
-	/**
-	 * Alias of {@link validates_length_of}
-	 *
-	 * @param array $attrs Validation definition
-	 */
-	public function validates_size_of($attrs)
-	{
-		$this->validates_length_of($attrs);
-	}
-
-	/**
-	 * Validates that a value is matches a regex.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $validates_format_of = array(
-	 *     array('email', 'with' => '/^.*?@.*$/')
-	 *   );
-	 * }
-	 * </code>
-	 *
-	 * Available options:
-	 *
-	 * <ul>
-	 * <li><b>with:</b> a regular expression</li>
-	 * <li><b>message:</b> custom error message</li>
-	 * </ul>
-	 *
-	 * @param array $attrs Validation definition
-	 */
-	public function validates_format_of($attrs)
-	{
-		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array('message' => Errors::$DEFAULT_ERROR_MESSAGES['invalid'], 'on' => 'save', 'with' => null));
-
-		foreach ($attrs as $attr)
-		{
-			$options = array_merge($configuration, $attr);
-			$attribute = $options[0];
-			$var = $this->model->$attribute;
-
-			if (is_null($options['with']) || !is_string($options['with']) || !is_string($options['with']))
-				throw new ValidationsArgumentError('A regular expression must be supplied as the [with] option of the configuration array.');
-			else
-				$expression = $options['with'];
-
-			if ($this->is_null_with_option($var, $options) || $this->is_blank_with_option($var, $options))
-				continue;
-
-			if (!@preg_match($expression, $var))
-			$this->record->add($attribute, $options['message']);
-		}
-	}
-
-	/**
-	 * Validates the length of a value.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $validates_length_of = array(
-	 *     array('name', 'within' => array(1,50))
-	 *   );
-	 * }
-	 * </code>
-	 *
-	 * Available options:
-	 *
-	 * <ul>
-	 * <li><b>is:</b> attribute should be exactly n characters long</li>
-	 * <li><b>in/within:</b> attribute should be within an range array(min,max)</li>
-	 * <li><b>maximum/minimum:</b> attribute should not be above/below respectively</li>
-	 * </ul>
-	 *
-	 * @param array $attrs Validation definition
-	 */
-	public function validates_length_of($attrs)
-	{
-		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array(
-			'too_long'     => Errors::$DEFAULT_ERROR_MESSAGES['too_long'],
-			'too_short'    => Errors::$DEFAULT_ERROR_MESSAGES['too_short'],
-			'wrong_length' => Errors::$DEFAULT_ERROR_MESSAGES['wrong_length']
-		));
-
-		foreach ($attrs as $attr)
-		{
-			$options = array_merge($configuration, $attr);
-			$range_options = array_intersect(array_keys(self::$ALL_RANGE_OPTIONS), array_keys($attr));
-			sort($range_options);
-
-			switch (sizeof($range_options))
-			{
-				case 0:
-					throw new  ValidationsArgumentError('Range unspecified.  Specify the [within], [maximum], or [is] option.');
-
-				case 1:
-					break;
-
-				default:
-					throw new  ValidationsArgumentError('Too many range options specified.  Choose only one.');
-			}
-
-			$attribute = $options[0];
-			$var = $this->model->$attribute;
-			$range_option = $range_options[0];
-
-			if ($this->is_null_with_option($var, $options) || $this->is_blank_with_option($var, $options))
-				continue;
-
-			if ('within' == $range_option || 'in' == $range_option)
-			{
-				$range = $options[$range_options[0]];
-
-				if (!(Utils::is_a('range', $range)))
-					throw new  ValidationsArgumentError("$range_option must be an array composing a range of numbers with key [0] being less than key [1]");
-
-				if (is_float($range[0]) || is_float($range[1]))
-					throw new  ValidationsArgumentError("Range values cannot use floats for length.");
-
-				if ((int)$range[0] <= 0 || (int)$range[1] <= 0)
-					throw new  ValidationsArgumentError("Range values cannot use signed integers.");
-
-				$too_short = isset($options['message']) ? $options['message'] : $options['too_short'];
-				$too_long =  isset($options['message']) ? $options['message'] : $options['too_long'];
-
-				$too_short = str_replace('%d', $range[0], $too_short);
-				$too_long = str_replace('%d', $range[1], $too_long);
-
-				if (strlen($this->model->$attribute) < (int)$range[0])
-					$this->record->add($attribute, $too_short);
-				elseif (strlen($this->model->$attribute) > (int)$range[1])
-					$this->record->add($attribute, $too_long);
-			}
-
-			elseif ('is' == $range_option || 'minimum' == $range_option || 'maximum' == $range_option)
-			{
-				$option = $options[$range_option];
-
-				if ((int)$option <= 0)
-					throw new  ValidationsArgumentError("$range_option value cannot use a signed integer.");
-
-				if (is_float($option))
-					throw new  ValidationsArgumentError("$range_option value cannot use a float for length.");
-
-				if (!is_null($this->model->$attribute))
-				{
-					$messageOptions = array('is' => 'wrong_length', 'minimum' => 'too_short', 'maximum' => 'too_long');
-
-					if (isset($options[$messageOptions[$range_option]]))
-						$message = $options[$messageOptions[$range_option]];
-					else
-						$message = $options['message'];
-
-					$message = str_replace('%d', $option, $message);
-					$attribute_value = $this->model->$attribute;
-					$len = strlen($attribute_value);
-					$value = (int)$attr[$range_option];
-
-					if ('maximum' == $range_option && $len > $value)
-						$this->record->add($attribute, $message);
-
-					if ('minimum' == $range_option && $len < $value)
-						$this->record->add($attribute, $message);
-
-					if ('is' == $range_option && $len !== $value)
-						$this->record->add($attribute, $message);
-				}
-			}
-		}
-	}
-
-	/**
-	 * Validates the uniqueness of a value.
-	 *
-	 * <code>
-	 * class Person extends ActiveRecord\Model {
-	 *   static $validates_uniqueness_of = array(
-	 *     array('name'),
-	 *     array(array('blah','bleh'), 'message' => 'blech')
-	 *   );
-	 * }
-	 * </code>
-	 *
-	 * @param array $attrs Validation definition
-	 */
-	public function validates_uniqueness_of($attrs)
-	{
-		$configuration = array_merge(self::$DEFAULT_VALIDATION_OPTIONS, array(
-			'message' => Errors::$DEFAULT_ERROR_MESSAGES['unique']
-		));
-
-		foreach ($attrs as $attr)
-		{
-			$options = array_merge($configuration, $attr);
-			$pk = $this->model->get_primary_key();
-			$pk_value = $this->model->$pk[0];
-
-			if (is_array($options[0]))
-			{
-				$add_record = join("_and_", $options[0]);
-				$fields = $options[0];
-			}
-			else
-			{
-				$add_record = $options[0];
-				$fields = array($options[0]);
-			}
-
-			$sql = "";
-			$conditions = array("");
-
-			if ($pk_value === null)
-				$sql = "{$pk[0]} is not null";
-			else
-			{
-				$sql = "{$pk[0]}!=?";
-				array_push($conditions,$pk_value);
-			}
-
-			foreach ($fields as $field)
-			{
-				$field = $this->model->get_real_attribute_name($field);
-				$sql .= " and {$field}=?";
-				array_push($conditions,$this->model->$field);
-			}
-
-			$conditions[0] = $sql;
-
-			if ($this->model->exists(array('conditions' => $conditions)))
-				$this->record->add($add_record, $options['message']);
-		}
-	}
-
-	private function is_null_with_option($var, &$options)
-	{
-		return (is_null($var) && (isset($options['allow_null']) && $options['allow_null']));
-	}
-
-	private function is_blank_with_option($var, &$options)
-	{
-		return (Utils::is_blank($var) && (isset($options['allow_blank']) && $options['allow_blank']));
-	}
-}
-
-/**
- * Class that holds {@link Validations} errors.
- *
- * @package ActiveRecord
- */
-class Errors implements IteratorAggregate
-{
-	private $model;
-	private $errors;
-
-	public static $DEFAULT_ERROR_MESSAGES = array(
-   		'inclusion'		=> "is not included in the list",
-     	'exclusion'		=> "is reserved",
-      	'invalid'		=> "is invalid",
-      	'confirmation'	=> "doesn't match confirmation",
-      	'accepted'		=> "must be accepted",
-      	'empty'			=> "can't be empty",
-      	'blank'			=> "can't be blank",
-      	'too_long'		=> "is too long (maximum is %d characters)",
-      	'too_short'		=> "is too short (minimum is %d characters)",
-      	'wrong_length'	=> "is the wrong length (should be %d characters)",
-      	'taken'			=> "has already been taken",
-      	'not_a_number'	=> "is not a number",
-      	'greater_than'	=> "must be greater than %d",
-      	'equal_to'		=> "must be equal to %d",
-      	'less_than'		=> "must be less than %d",
-      	'odd'			=> "must be odd",
-      	'even'			=> "must be even",
-		'unique'		=> "must be unique",
-      	'less_than_or_equal_to' => "must be less than or equal to %d",
-      	'greater_than_or_equal_to' => "must be greater than or equal to %d"
-   	);
-
-   	/**
-	 * Constructs an {@link Errors} object.
-	 *
-	 * @param Model $model The model the error is for
-	 * @return Errors
-   	 */
-	public function __construct(Model $model)
-	{
-		$this->model = $model;
-	}
-
-	/**
-	 * Nulls $model so we don't get pesky circular references. $model is only needed during the
-	 * validation process and so can be safely cleared once that is done.
-	 */
-	public function clear_model()
-	{
-		$this->model = null;
-	}
-
-	/**
-	 * Add an error message.
-	 *
-	 * @param string $attribute Name of an attribute on the model
-	 * @param string $msg The error message
-	 */
-	public function add($attribute, $msg)
-	{
-		if (is_null($msg))
-			$msg = self :: $DEFAULT_ERROR_MESSAGES['invalid'];
-
-		if (!isset($this->errors[$attribute]))
-			$this->errors[$attribute] = array($msg);
-		else
-			$this->errors[$attribute][] = $msg;
-	}
-
-	/**
-	 * Adds an error message only if the attribute value is {@link http://www.php.net/empty empty}.
-	 *
-	 * @param string $attribute Name of an attribute on the model
-	 * @param string $msg The error message
-	 */
-	public function add_on_empty($attribute, $msg)
-	{
-		if (empty($msg))
-			$msg = self::$DEFAULT_ERROR_MESSAGES['empty'];
-
-		if (empty($this->model->$attribute))
-			$this->add($attribute, $msg);
-	}
-
-	/**
-	 * Retrieve error message for an attribute.
-	 *
-	 * @param string $attribute Name of an attribute on the model
-	 * @return string
-	 */
-	public function __get($attribute)
-	{
-		if (!isset($this->errors[$attribute]))
-			return null;
-
-		return $this->errors[$attribute];
-	}
-
-	/**
-	 * Adds the error message only if the attribute value was null or an empty string.
-	 *
-	 * @param string $attribute Name of an attribute on the model
-	 * @param string $msg The error message
-	 */
-	public function add_on_blank($attribute, $msg)
-	{
-		if (!$msg)
-			$msg = self::$DEFAULT_ERROR_MESSAGES['blank'];
-
-		if (($value = $this->model->$attribute) === '' || $value === null)
-			$this->add($attribute, $msg);
-	}
-
-	/**
-	 * Returns true if the specified attribute had any error messages.
-	 *
-	 * @param string $attribute Name of an attribute on the model
-	 * @return boolean
-	 */
-	public function is_invalid($attribute)
-	{
-		return isset($this->errors[$attribute]);
-	}
-
-	/**
-	 * Returns the error message for the specified attribute or null if none.
-	 *
-	 * @param string $attribute Name of an attribute on the model
-	 * @return string
-	 */
-	public function on($attribute)
-	{
-		if (!isset($this->errors[$attribute]))
-			return null;
-
-		$errors = $this->errors[$attribute];
-
-		if (null === $errors)
-			return null;
-		else
-			return count($errors) == 1 ? $errors[0] : $errors;
-	}
-
-	/**
-	 * Returns all the error messages as an array.
-	 *
-	 * <code>
-	 * $model->errors->full_messages();
-	 *
-	 * # array(
-	 * #  "Name can't be blank",
-	 * #  "State is the wrong length (should be 2 chars)"
-	 * # )
-	 * </code>
-	 *
-	 * @param array $options Options for messages
-	 * @return array
-	 */
-	public function full_messages()
-	{
-		$full_messages = array();
-
-		if ($this->errors)
-		{
-			foreach ($this->errors as $attribute => $messages)
-			{
-				foreach ($messages as $msg)
-				{
-					if (is_null($msg))
-						continue;
-
-					$full_messages[] = Utils::human_attribute($attribute) . ' ' . $msg;
-				}
-			}
-		}
-		return $full_messages;
-	}
-
-	/**
-	 * Returns true if there are no error messages.
-	 * @return boolean
-	 */
-	public function is_empty()
-	{
-		return empty($this->errors);
-	}
-
-	/**
-	 * Clears out all error messages.
-	 */
-	public function clear()
-	{
-		$this->errors = array();
-	}
-
-	/**
-	 * Returns the number of error messages there are.
-	 * @return int
-	 */
-	public function size()
-	{
-		if ($this->is_empty())
-			return 0;
-
-		$count = 0;
-
-		foreach ($this->errors as $attribute => $error)
-			$count += count($error);
-
-		return $count;
-	}
-
-	/**
-	 * Returns an iterator to the error messages.
-	 *
-	 * This will allow you to iterate over the {@link Errors} object using foreach.
-	 *
-	 * <code>
-	 * foreach ($model->errors as $msg)
-	 *   echo "$msg\n";
-	 * </code>
-	 *
-	 * @return ArrayIterator
-	 */
-	public function getIterator()
-	{
-		return new ArrayIterator($this->full_messages());
-	}
-};
-?>
diff --git a/lib/ar/adapters/MysqlAdapter.php b/lib/ar/adapters/MysqlAdapter.php
deleted file mode 100644
index c04187c..0000000
--- a/lib/ar/adapters/MysqlAdapter.php
+++ /dev/null
@@ -1,73 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Adapter for MySQL.
- *
- * @package ActiveRecord
- */
-class MysqlAdapter extends Connection
-{
-	static $DEFAULT_PORT = 3306;
-
-	public function limit($sql, $offset, $limit)
-	{
-		$offset = intval($offset);
-		$limit = intval($limit);
-		return "$sql LIMIT $offset,$limit";
-	}
-
-	public function query_column_info($table)
-	{
-		return $this->query("SHOW COLUMNS FROM $table");
-	}
-
-	public function query_for_tables()
-	{
-		return $this->query('SHOW TABLES');
-	}
-
-	public function create_column(&$column)
-	{
-		$c = new Column();
-		$c->inflected_name	= Inflector::instance()->variablize($column['field']);
-		$c->name			= $column['field'];
-		$c->nullable		= ($column['null'] === 'YES' ? true : false);
-		$c->pk				= ($column['key'] === 'PRI' ? true : false);
-		$c->auto_increment	= ($column['extra'] === 'auto_increment' ? true : false);
-
-		if ($column['type'] == 'timestamp' || $column['type'] == 'datetime')
-		{
-			$c->raw_type = 'datetime';
-			$c->length = 19;
-		}
-		elseif ($column['type'] == 'date')
-		{
-			$c->raw_type = 'date';
-			$c->length = 10;
-		}
-		elseif ($column['type'] == 'time')
-		{
-			$c->raw_type = 'time';
-			$c->length = 8;
-		}
-		else
-		{
-			preg_match('/^([A-Za-z0-9_]+)(\(([0-9]+(,[0-9]+)?)\))?/',$column['type'],$matches);
-
-			$c->raw_type = (count($matches) > 0 ? $matches[1] : $column['type']);
-
-			if (count($matches) >= 4)
-				$c->length = intval($matches[3]);
-		}
-
-		$c->map_raw_type();
-		$c->default = $c->cast($column['default'],$this);
-
-		return $c;
-	}
-}
-?>
diff --git a/lib/ar/adapters/OciAdapter.php b/lib/ar/adapters/OciAdapter.php
deleted file mode 100644
index 3e2a0f2..0000000
--- a/lib/ar/adapters/OciAdapter.php
+++ /dev/null
@@ -1,121 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-use PDO;
-
-/**
- * Adapter for OCI (not completed yet).
- * 
- * @package ActiveRecord
- */
-class OciAdapter extends Connection
-{
-	static $QUOTE_CHARACTER = '';
-	static $DEFAULT_PORT = 1521;
-
-	protected function __construct($info)
-	{
-		try {
-			$this->connection = new PDO("oci:dbname=//$info->host/$info->db",$info->user,$info->pass,static::$PDO_OPTIONS);
-		} catch (PDOException $e) {
-			throw new DatabaseException($e);
-		}
-	}
-
-	public function supports_sequences() { return true; }
-	
-	public function get_next_sequence_value($sequence_name)
-	{
-		return $this->query_and_fetch_one('SELECT ' . $this->next_sequence_value($sequence_name) . ' FROM dual');
-	}
-
-	public function next_sequence_value($sequence_name)
-	{
-		return "$sequence_name.nextval";
-	}
-
-	public function date_to_string($datetime)
-	{
-		return $datetime->format('d-M-Y');
-	}
-
-	public function datetime_to_string($datetime)
-	{
-		return $datetime->format('d-M-Y h:i:s A');
-	}
-
-	// $string = DD-MON-YYYY HH12:MI:SS(\.[0-9]+) AM
-	public function string_to_datetime($string)
-	{
-		return parent::string_to_datetime(str_replace('.000000','',$string));
-	}
-
-	public function limit($sql, $offset, $limit)
-	{
-		$offset = intval($offset);
-		$stop = $offset + intval($limit);
-		return 
-			"SELECT * FROM (SELECT a.*, rownum ar_rnum__ FROM ($sql) a " .
-			"WHERE rownum <= $stop) WHERE ar_rnum__ > $offset";
-	}
-
-	public function query_column_info($table)
-	{
-		$sql = 
-			"SELECT c.column_name, c.data_type, c.data_length, c.data_scale, c.data_default, c.nullable, " .
-				"(SELECT a.constraint_type " .
-				"FROM all_constraints a, all_cons_columns b " .
-				"WHERE a.constraint_type='P' " .
-				"AND a.constraint_name=b.constraint_name " .
-				"AND a.table_name = t.table_name AND b.column_name=c.column_name) AS pk " .
-			"FROM user_tables t " .
-			"INNER JOIN user_tab_columns c on(t.table_name=c.table_name) " .
-			"WHERE t.table_name=?";
-
-		$values = array(strtoupper($table));
-		return $this->query($sql,$values);
-	}
-
-	public function query_for_tables()
-	{
-		return $this->query("SELECT table_name FROM user_tables");
-	}
-
-	public function create_column(&$column)
-	{
-		$column['column_name'] = strtolower($column['column_name']);
-		$column['data_type'] = strtolower(preg_replace('/\(.*?\)/','',$column['data_type']));
-
-		if ($column['data_default'] !== null)
-			$column['data_default'] = trim($column['data_default'],"' ");
-
-		if ($column['data_type'] == 'number')
-		{
-			if ($column['data_scale'] > 0)
-				$column['data_type'] = 'decimal';
-			elseif ($column['data_scale'] == 0)
-				$column['data_type'] = 'int';
-		}
-
-		$c = new Column();
-		$c->inflected_name	= Inflector::instance()->variablize($column['column_name']);
-		$c->name			= $column['column_name'];
-		$c->nullable		= $column['nullable'] == 'Y' ? true : false;
-		$c->pk				= $column['pk'] == 'P' ? true : false;
-		$c->length			= $column['data_length'];
-	
-		if ($column['data_type'] == 'timestamp')
-			$c->raw_type = 'datetime';
-		else
-			$c->raw_type = $column['data_type'];
-
-		$c->map_raw_type();
-		$c->default	= $c->cast($column['data_default'],$this);
-
-		return $c;
-	}
-};
-?>
\ No newline at end of file
diff --git a/lib/ar/adapters/PgsqlAdapter.php b/lib/ar/adapters/PgsqlAdapter.php
deleted file mode 100644
index 53e01bc..0000000
--- a/lib/ar/adapters/PgsqlAdapter.php
+++ /dev/null
@@ -1,104 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-/**
- * Adapter for Postgres (not completed yet)
- * 
- * @package ActiveRecord
- */
-class PgsqlAdapter extends Connection
-{
-	static $QUOTE_CHARACTER	= '"';
-	static $DEFAULT_PORT	= 5432;
-
-	public function supports_sequences() { return true; }
-
-	public function get_sequence_name($table, $column_name)
-	{
-		return "{$table}_{$column_name}_seq";
-	}
-
-	public function next_sequence_value($sequence_name)
-	{
-		return "nextval('" . str_replace("'","\\'",$sequence_name) . "')";
-	}
-
-	public function limit($sql, $offset, $limit)
-	{
-		return $sql . ' LIMIT ' . intval($limit) . ' OFFSET ' . intval($offset);
-	}
-
-	public function query_column_info($table)
-	{
-		$sql = <<<SQL
-SELECT a.attname AS field, a.attlen,
-REPLACE(pg_catalog.format_type(a.atttypid, a.atttypmod),'character varying','varchar') AS type,
-a.attnotnull AS not_nullable, 
-i.indisprimary as pk,
-REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(s.column_default,'::[a-z_ ]+',''),'\'$',''),'^\'','') AS default
-FROM pg_catalog.pg_attribute a
-LEFT JOIN pg_catalog.pg_class c ON(a.attrelid=c.oid)
-LEFT JOIN pg_catalog.pg_index i ON(c.oid=i.indrelid AND a.attnum=any(i.indkey))
-LEFT JOIN information_schema.columns s ON(s.table_name=? AND a.attname=s.column_name)
-WHERE a.attrelid = (select c.oid from pg_catalog.pg_class c inner join pg_catalog.pg_namespace n on(n.oid=c.relnamespace) where c.relname=? and pg_catalog.pg_table_is_visible(c.oid))
-AND a.attnum > 0
-AND NOT a.attisdropped
-ORDER BY a.attnum
-SQL;
-		$values = array($table,$table);
-		return $this->query($sql,$values);
-	}
-
-	public function query_for_tables()
-	{
-		return $this->query("SELECT tablename FROM pg_tables WHERE schemaname NOT IN('information_schema','pg_catalog')");
-	}
-
-	public function create_column(&$column)
-	{
-		$c = new Column();
-		$c->inflected_name	= Inflector::instance()->variablize($column['field']);
-		$c->name			= $column['field'];
-		$c->nullable		= ($column['not_nullable'] ? false : true);
-		$c->pk				= ($column['pk'] ? true : false);
-		$c->auto_increment	= false;
-
-		if (substr($column['type'],0,9) == 'timestamp')
-		{
-			$c->raw_type = 'datetime';
-			$c->length = 19;
-		}
-		elseif ($column['type'] == 'date')
-		{
-			$c->raw_type = 'date';
-			$c->length = 10;
-		}
-		else
-		{
-			preg_match('/^([A-Za-z0-9_]+)(\(([0-9]+(,[0-9]+)?)\))?/',$column['type'],$matches);
-
-			$c->raw_type = (count($matches) > 0 ? $matches[1] : $column['type']);
-			$c->length = count($matches) >= 4 ? intval($matches[3]) : intval($column['attlen']);
-
-			if ($c->length < 0)
-				$c->length = null;
-		}
-
-		$c->map_raw_type();
-
-		if ($column['default'])
-		{
-			preg_match("/^nextval\('(.*)'\)$/",$column['default'],$matches);
-
-			if (count($matches) == 2)
-				$c->sequence = $matches[1];
-			else
-				$c->default = $c->cast($column['default'],$this);
-		}
-		return $c;
-	}
-};
-?>
\ No newline at end of file
diff --git a/lib/ar/adapters/SqliteAdapter.php b/lib/ar/adapters/SqliteAdapter.php
deleted file mode 100644
index 81daeab..0000000
--- a/lib/ar/adapters/SqliteAdapter.php
+++ /dev/null
@@ -1,81 +0,0 @@
-<?php
-/**
- * @package ActiveRecord
- */
-namespace ActiveRecord;
-
-use PDO;
-
-/**
- * Adapter for SQLite.
- *
- * @package ActiveRecord
- */
-class SqliteAdapter extends Connection
-{
-	protected function __construct($info)
-	{
-		if (!file_exists($info->host))
-			throw new DatabaseException("Could not find sqlite db: $info->host");
-
-		$this->connection = new PDO("sqlite:$info->host",null,null,static::$PDO_OPTIONS);
-	}
-
-	public function limit($sql, $offset, $limit)
-	{
-		$offset = intval($offset);
-		$limit = intval($limit);
-		return "$sql LIMIT $offset,$limit";
-	}
-
-	public function query_column_info($table)
-	{
-		return $this->query("pragma table_info($table)");
-	}
-
-	public function query_for_tables()
-	{
-		return $this->query("SELECT name FROM sqlite_master");
-	}
-
-	public function create_column($column)
-	{
-		$c = new Column();
-		$c->inflected_name	= Inflector::instance()->variablize($column['name']);
-		$c->name			= $column['name'];
-		$c->nullable		= $column['notnull'] ? false : true;
-		$c->pk				= $column['pk'] ? true : false;
-		$c->auto_increment	= $column['type'] == 'INTEGER' && $c->pk;
-
-		$column['type'] = preg_replace('/ +/',' ',$column['type']);
-		$column['type'] = str_replace(array('(',')'),' ',$column['type']);
-		$column['type'] = Utils::squeeze(' ',$column['type']);
-		$matches = explode(' ',$column['type']);
-
-		if (!empty($matches))
-		{
-			$c->raw_type = strtolower($matches[0]);
-
-			if (count($matches) > 1)
-				$c->length = intval($matches[1]);
-		}
-
-		$c->map_raw_type();
-
-		if ($c->type == Column::DATETIME)
-			$c->length = 19;
-		elseif ($c->type == Column::DATE)
-			$c->length = 10;
-
-		// From SQLite3 docs: The value is a signed integer, stored in 1, 2, 3, 4, 6,
-		// or 8 bytes depending on the magnitude of the value.
-		// so is it ok to assume it's possible an int can always go up to 8 bytes?
-		if ($c->type == Column::INTEGER && !$c->length)
-			$c->length = 8;
-
-		$c->default = $c->cast($column['dflt_value'],$this);
-
-		return $c;
-	}
-};
-?>
\ No newline at end of file
diff --git a/lib/routing/Config.php b/lib/routing/Config.php
deleted file mode 100644
index 79dbcc2..0000000
--- a/lib/routing/Config.php
+++ /dev/null
@@ -1,69 +0,0 @@
-<?php
-/**  
- * библиотека отвечающая за роутинг
- * 
- * @package    lib
- * @subpackage routing
- * @since      07.10.2010 10:12:00
- * @author     enesterov
- * @category   none
- */
-
-namespace Routing;
-use ActiveRecord;
-use Controllers;
-use Closure;
-
-
-class Config extends ActiveRecord\Singleton
-{
-	
-	public static $route = array();
-	public $key;
-	private $controller_directory;
-	private $mapper;
-
-	public static function initialize(Closure $initializer)
-	{
-		$initializer(parent::instance());
-	}
-	
-	public function MapSet($addr)
-	{
-		
-	}
-	public function Map($addr, $controler, $action, $argv=array())
-	{
-		if (!$addr || !$controler || !$action)
-			throw new ActiveRecord\ConfigException("Build routing map faild");
-			
-		$file = ROOT_PATH . "/controllers/$controler.php";
-		if (file_exists($file))
-		{
-			require_once $file;
-		}
-		
-		self::$route[$addr] =  array('Controllers\Controller' . $controler, $action, $argv);
-	}
-	
-	public function set_controller_directory($dir)
-	{
-		if (!file_exists($dir))
-			throw new ActiveRecord\ConfigException("Invalid or non-existent directory: $dir");
-
-		$this->controller_directory = $dir;
-	}
-
-	/**
-	 * Returns the controller directory.
-	 *
-	 * @return string
-	 */
-	public function get_controller_directory()
-	{
-		return $this->controller_directory;
-	}
-	private function Set(){}
-	private static function init(){}
-};
-?>
\ No newline at end of file
diff --git a/lib/routing/Connection.php b/lib/routing/Connection.php
deleted file mode 100644
index 5b84b91..0000000
--- a/lib/routing/Connection.php
+++ /dev/null
@@ -1,57 +0,0 @@
-<?php
-
-namespace Routing;
-use ActiveRecord;
-
-class Routing extends Config{
-	
-	public function __construct()
-	{
-		//$this->Set();
-		$this->init();
-	}
-//	private function Set()
-//	{
-//		preg_match("/\/(?P<controller>\w+)\/(?P<action>\w+)\/?/i", $_SERVER['REQUEST_URI'], $matches);
-//		
-//		if(array_key_exists("controller", $matches) && array_key_exists("action", $matches)) {
-//			$this->key = "/%s/%s/" % array($matches["controller"], $matches["action"]);
-//			Routing::Map(  $this->key , $matches["controller"], $matches["action"] );
-//		} else
-//		{
-//			//throw new ActiveRecord\ConfigException("no exist controller or action");
-//		}
-//	}
-	private static function yeld($item2, $key)
-	{
-		preg_match("@" . $key . "@i", $_SERVER['REQUEST_URI'], $matches);
-		print_r($matches);
-		if ($matches)
-			$this->m = $matches[0];
-			
-		return $this->m;
-	}
-	private static function init() 
-	{
-		$item = false;
-		$arrKey;
-		while (list($key, $value) = each(self::$route)) {
-			preg_match("@" . $key . "@i", $_SERVER['REQUEST_URI'], $matches);
-			if ($matches)
-			{
-				$item = True;
-				$arrKey = $key;
-				break;
-			}
-		}
-		if(array_key_exists($arrKey, self::$route)) {
-			//print_r(self::$route);
-			$ins = new self::$route[$arrKey][0];
-			$fnc = self::$route[$arrKey][1];
-			$argv = self::$route[$arrKey][2];
-			$ins->$fnc($argv);
-		} else {
-			throw new ActiveRecord\ConfigException("Key not exist: $arrKey");
-		}
-	}
-}
\ No newline at end of file
diff --git a/model/Actions.php b/model/Actions.php
index 744db59..1444bb9 100644
--- a/model/Actions.php
+++ b/model/Actions.php
@@ -1,9 +1,9 @@
 <?php
 /**  
+ * таблица акций
  * 
- * 
- * @package    model
- * @subpackage Actions
+ * @package    Actions
+ * @subpackage ActiveRecord
  * @since      11.10.2010 12:13:09
  * @author     enesterov
  * @category   models
@@ -19,35 +19,3 @@ class Actions extends ActiveRecord\Model
 	static $connection = CONNECTION;
 }
 
-class Segments extends ActiveRecord\Model
-{
-	static $table_name = 'segment_cache';
-	//static $primary_key = 'segment_id';
-	static $connection = CONNECTION;
-	
-	public function segmentWarez($options)
-	{
-		return self::find('all', $options);
-	}
-	
-	public function segmentDirs($region, $name)
-	{
-		$sql = "
-			SELECT t.*,DirName
-			FROM dirs
-			JOIN (
-				SELECT
-					w.DirID,
-					COUNT(1) AS num
-				FROM segment_cache
-				JOIN warez_".$region." AS w ON w.warecode = segment_cache.warecode
-				WHERE segment_cache.segment_name = '".$name."'
-				AND segment_cache.region_id = ".$region."
-	            GROUP BY w.DirID
-			) AS t ON t.DirID=dirs.DirID
-			ORDER BY t.num DESC
-		";
-		print $sql;
-		return self::find_by_sql($sql);
-	}
-}
\ No newline at end of file
diff --git a/model/Category.php b/model/Category.php
index 6a80f8b..e93183c 100644
--- a/model/Category.php
+++ b/model/Category.php
@@ -1,9 +1,9 @@
 <?php
 /**  
+ * таблица категорий товаров
  * 
- * 
- * @package    model
- * @subpackage Category
+ * @package    Category
+ * @subpackage ActiveRecord
  * @since      11.10.2010 12:13:09
  * @author     enesterov
  * @category   models
@@ -11,26 +11,6 @@
 
 	namespace Models;
 	use ActiveRecord;
-class Dirs extends ActiveRecord\Model
-{
-	static $table_name = 'dirs';
-	static $primary_key = 'dirid';
-	static $connection = CONNECTION;
-}
-
-class Classes extends ActiveRecord\Model
-{
-	static $table_name = 'classes';
-	static $primary_key = 'classid';
-	static $connection = CONNECTION;
-}
-
-class Groups extends ActiveRecord\Model
-{
-	static $table_name = 'groups';
-	static $primary_key = 'grid';
-	static $connection = CONNECTION;
-}
 
 class Category extends ActiveRecord\Model
 {
@@ -78,11 +58,5 @@ class Category extends ActiveRecord\Model
 	}
 }
 
-class Marks extends ActiveRecord\Model
-{
-	static $table_name = 'marks';
-	static $primary_key = 'markid';
-	static $connection = CONNECTION;
-	
-}
+
 
diff --git a/model/Classes.php b/model/Classes.php
new file mode 100644
index 0000000..aa35e5d
--- /dev/null
+++ b/model/Classes.php
@@ -0,0 +1,20 @@
+<?php
+/**
+  * таблица класов товаров
+  * 
+  * @package    Class
+  * @subpackage ActiveRecord
+  * @since      19.04.2011 10:56:01
+  * @author     enesterov
+  * @category   models
+  */
+
+	namespace Models;
+	use ActiveRecord;
+	
+class Classes extends ActiveRecord\Model
+{
+	static $table_name = 'classes';
+	static $primary_key = 'classid';
+	static $connection = CONNECTION;
+}
\ No newline at end of file
diff --git a/model/Desclist.php b/model/Desclist.php
deleted file mode 100644
index e1e33d7..0000000
--- a/model/Desclist.php
+++ /dev/null
@@ -1,37 +0,0 @@
-<?php
-/**  
- * 
- * 
- * @package    model
- * @subpackage Desclist
- * @since      13.10.2010 17:58:37
- * @author     enesterov
- * @category   none
- */
-
-	namespace Models;
-	use ActiveRecord;
-
-class Description extends ActiveRecord\Model
-{
-	static $table_name = 'warereviews';
-	static $connection = CONNECTION;
-	static $alias_attribute = array(
-		'id' => 'warecode',
-		'text' => 'reviewtext'
-		);
-	public $description;
-	
-	
-	static function desctriptions()
-	{
-		if($this->reviewtext)
-			$this->description = $this->reviewtext;
-	}
-}
-
-class Optionlist extends ActiveRecord\Model
-{
-	static $table_name = 'descriptionlist';
-	static $connection = CONNECTION;
-}
\ No newline at end of file
diff --git a/model/Description.php b/model/Description.php
new file mode 100644
index 0000000..378255b
--- /dev/null
+++ b/model/Description.php
@@ -0,0 +1,37 @@
+<?php
+/**  
+ * таблица описания товаров
+ * 
+ * @package    model
+ * @subpackage ActiveRecord
+ * @since      13.10.2010 17:58:37
+ * @author     enesterov
+ * @category   model
+ */
+
+	namespace Models;
+	use ActiveRecord;
+
+class Description extends ActiveRecord\Model
+{
+	static $table_name = 'warereviews';
+	static $connection = CONNECTION;
+	static $alias_attribute = array(
+		'id' => 'warecode',
+		'text' => 'reviewtext'
+		);
+	public $description;
+	
+	
+	static function desctriptions()
+	{
+		if($this->reviewtext)
+			$this->description = $this->reviewtext;
+	}
+}
+
+class Optionlist extends ActiveRecord\Model
+{
+	static $table_name = 'descriptionlist';
+	static $connection = CONNECTION;
+}
\ No newline at end of file
diff --git a/model/Dirs.php b/model/Dirs.php
new file mode 100644
index 0000000..9b339d5
--- /dev/null
+++ b/model/Dirs.php
@@ -0,0 +1,20 @@
+<?php
+/**
+  * таблица разделов товаров
+  * 
+  * @package    Dirs
+  * @subpackage ActiveRecord
+  * @since      19.04.2011 10:55:51
+  * @author     enesterov
+  * @category   models
+  */
+
+	namespace Models;
+	use ActiveRecord;
+	
+class Dirs extends ActiveRecord\Model
+{
+	static $table_name = 'dirs';
+	static $primary_key = 'dirid';
+	static $connection = CONNECTION;
+}
\ No newline at end of file
diff --git a/model/Groups.php b/model/Groups.php
new file mode 100644
index 0000000..8531d61
--- /dev/null
+++ b/model/Groups.php
@@ -0,0 +1,20 @@
+<?php
+/**
+  * аблица групп товаров
+  * 
+  * @package    Groups
+  * @subpackage ActiveRecord
+  * @since      19.04.2011 10:56:49
+  * @author     enesterov
+  * @category   models
+  */
+
+	namespace Models;
+	use ActiveRecord;
+
+class Groups extends ActiveRecord\Model
+{
+	static $table_name = 'groups';
+	static $primary_key = 'grid';
+	static $connection = CONNECTION;
+}
\ No newline at end of file
diff --git a/model/Link.php b/model/Link.php
new file mode 100644
index 0000000..c498f56
--- /dev/null
+++ b/model/Link.php
@@ -0,0 +1,61 @@
+<?php
+/**
+  * таблица links
+  * 
+  * @package    Links.php
+  * @subpackage ActiveRecord
+  * @since      19.04.2011 10:49:14
+  * @author     enesterov
+  * @category   models
+  */
+
+	namespace Models;
+	use ActiveRecord;
+	
+class Link extends ActiveRecord\Model{
+	static $table_name = 'warez_aks';
+	//static $belongs_to = array(array('warez_1'));
+	static $connection = CONNECTION;
+	public $description;
+	public $rating = 0.0;
+	public $reviews = 0;
+	
+	public static function getAccess($region_id, $code, $limit){
+		//select * from linkw inner join warez_1 on (linkw.warecodel = warez_1.warecode) where warecodem = 11032149;
+		$join = "inner join warez_$region_id w on (warecodel = w.warecode) where warecodem = $code";
+		$sel = array('select' => '*','joins'=> $join, 'order' => 'w.grid asc');
+		if($limit===true)
+			$sel['group']='w.grid';
+		//var_dump($sel);
+		return self::all($sel);
+		
+		
+	}
+	
+	public function getDesctiptions()
+	{
+		$description = Description::first(array("id"=>$this->warecode));
+		if($description)
+			if($description->text)
+				$this->description = $description->text;
+	}
+	
+	public function getRatingRev()
+	{
+		$options = array('select' => 'count(rating) c, sum(rating) s', 
+						'conditions' => array('approved=1 and warecode = ?', $this->warecode));
+		$rewiews = Reviews::first($options);
+		if($options)
+		{
+			$this->reviews = 0;
+			$this->rating = number_format(0, 1, '.', '');
+			if($rewiews->c > 0)
+			{
+				$this->rating = number_format(round((float)((int)$rewiews->s/(int)$rewiews->c),1, PHP_ROUND_HALF_UP), 1, '.', '');
+				$this->reviews = $rewiews->c;
+			}
+		}
+	}
+	
+	
+}
\ No newline at end of file
diff --git a/model/Marks.php b/model/Marks.php
new file mode 100644
index 0000000..975df57
--- /dev/null
+++ b/model/Marks.php
@@ -0,0 +1,21 @@
+<?php
+/**
+  * таблица производителей
+  * 
+  * @package    Marks
+  * @subpackage ActiveRecord
+  * @since      19.04.2011 10:59:47
+  * @author     enesterov
+  * @category   models
+  */
+
+	namespace Models;
+	use ActiveRecord;
+	
+class Marks extends ActiveRecord\Model
+{
+	static $table_name = 'marks';
+	static $primary_key = 'markid';
+	static $connection = CONNECTION;
+	
+}
\ No newline at end of file
diff --git a/model/Segments.php b/model/Segments.php
new file mode 100644
index 0000000..362e7d3
--- /dev/null
+++ b/model/Segments.php
@@ -0,0 +1,46 @@
+<?php
+/**
+  * таблица сегментов
+  * 
+  * @package    Segments
+  * @subpackage ActiveRecord
+  * @since      19.04.2011 10:53:23
+  * @author     enesterov
+  * @category   models
+  */
+
+	namespace Models;
+	use ActiveRecord;
+	
+class Segments extends ActiveRecord\Model
+{
+	static $table_name = 'segment_cache';
+	//static $primary_key = 'segment_id';
+	static $connection = CONNECTION;
+	
+	public function segmentWarez($options)
+	{
+		return self::find('all', $options);
+	}
+	
+	public function segmentDirs($region, $name)
+	{
+		$sql = "
+			SELECT t.*,DirName
+			FROM dirs
+			JOIN (
+				SELECT
+					w.DirID,
+					COUNT(1) AS num
+				FROM segment_cache
+				JOIN warez_".$region." AS w ON w.warecode = segment_cache.warecode
+				WHERE segment_cache.segment_name = '".$name."'
+				AND segment_cache.region_id = ".$region."
+	            GROUP BY w.DirID
+			) AS t ON t.DirID=dirs.DirID
+			ORDER BY t.num DESC
+		";
+		print $sql;
+		return self::find_by_sql($sql);
+	}
+}
\ No newline at end of file
diff --git a/model/Warez.php b/model/Warez.php
index 3a28cd4..7333750 100644
--- a/model/Warez.php
+++ b/model/Warez.php
@@ -1,9 +1,9 @@
 <?php
 /**  
+ * таблица продуктов
  * 
- * 
- * @package    model
- * @subpackage Warez
+ * @package    Warez
+ * @subpackage ActiveRecords
  * @since      11.10.2010 12:13:09
  * @author     enesterov
  * @category   models
@@ -254,50 +254,4 @@ class Warez extends ActiveRecord\Model
 
 }
 
-class Link extends ActiveRecord\Model{
-	static $table_name = 'warez_aks';
-	//static $belongs_to = array(array('warez_1'));
-	static $connection = CONNECTION;
-	public $description;
-	public $rating = 0.0;
-	public $reviews = 0;
-	
-	public static function getAccess($region_id, $code, $limit){
-		//select * from linkw inner join warez_1 on (linkw.warecodel = warez_1.warecode) where warecodem = 11032149;
-		$join = "inner join warez_$region_id w on (warecodel = w.warecode) where warecodem = $code";
-		$sel = array('select' => '*','joins'=> $join, 'order' => 'w.grid asc');
-		if($limit===true)
-			$sel['group']='w.grid';
-		//var_dump($sel);
-		return self::all($sel);
-		
-		
-	}
-	
-	public function getDesctiptions()
-	{
-		$description = Description::first(array("id"=>$this->warecode));
-		if($description)
-			if($description->text)
-				$this->description = $description->text;
-	}
-	
-	public function getRatingRev()
-	{
-		$options = array('select' => 'count(rating) c, sum(rating) s', 
-						'conditions' => array('approved=1 and warecode = ?', $this->warecode));
-		$rewiews = Reviews::first($options);
-		if($options)
-		{
-			$this->reviews = 0;
-			$this->rating = number_format(0, 1, '.', '');
-			if($rewiews->c > 0)
-			{
-				$this->rating = number_format(round((float)((int)$rewiews->s/(int)$rewiews->c),1, PHP_ROUND_HALF_UP), 1, '.', '');
-				$this->reviews = $rewiews->c;
-			}
-		}
-	}
-	
-	
-}
+
diff --git a/model/__init__.php b/model/__init__.php
deleted file mode 100644
index 93c5910..0000000
--- a/model/__init__.php
+++ /dev/null
@@ -1,10 +0,0 @@
-<?php
-
-	require_once dirname(__FILE__) . '/Regions.php';
-	require_once dirname(__FILE__) . '/Shops.php';
-	require_once dirname(__FILE__) . '/Category.php';
-	require_once dirname(__FILE__) . '/Products.php';
-	require_once dirname(__FILE__) . '/Warez.php';
-	require_once dirname(__FILE__) . '/Desclist.php';
-	require_once dirname(__FILE__) . '/Reviews.php';
-	require_once dirname(__FILE__) . '/Actions.php';
diff --git a/public/img b/public/img
deleted file mode 120000
index 6ffc6ca..0000000
--- a/public/img
+++ /dev/null
@@ -1 +0,0 @@
-../img
\ No newline at end of file
diff --git a/public/start.dtd b/public/start.dtd
new file mode 100644
index 0000000..05a39a1
--- /dev/null
+++ b/public/start.dtd
@@ -0,0 +1,8 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!ELEMENT mvideo_xml ((startpage)) >
+<!ATTLIST mvideo_xml date CDATA  "YYYY-MM-DD hh:mm:ss">
+<!ELEMENT startpage ((name, banner_img, action_name, action_id))>
+<!ELEMENT name (#PCDATA)>
+<!ELEMENT banner_img (#PCDATA)>
+<!ELEMENT action_name (#PCDATA)>
+<!ELEMENT action_id (#PCDATA)>
\ No newline at end of file
diff --git a/run.php b/run.php
index a7856e1..0906a97 100644
--- a/run.php
+++ b/run.php
@@ -7,26 +7,20 @@
 	require_once ROOT_PATH . '/conf_parse.php';
 	
 	$conn = new config(FILE);
-	define( "DEBUG", ($conn->debug)?$conn->debug:True );
-	define( 'CONNECTION', ($conn->base)?$conn->base:'develop' );
-	define('MVIDEO_PATH', '/www/sites/newmvideo');
-
+	define( "DEBUG", ($conn->debug)? $conn->debug: True );
+	define( 'CONNECTION', ($conn->base)? $conn->base: 'develop' );
+	define( 'LIB_PATH', ($conn->lib)? $conn->lib: ROOT_PATH.'/lib' );
+	define( 'MVIDEO_PATH', ($conn->mvideo)? $conn->mvideo: dirname(ROOT_PATH) . "/mvideo");
+	
+	//var_dump(MVIDEO_PATH);
 	if(DEBUG)
 	{
 		ini_set('display_errors', True);
 		error_reporting(E_ALL);
 	}
-	
-	require_once ROOT_PATH . '/lib/Utils.php';
+	$except = false;
 	require_once ROOT_PATH . '/lib/Exception.php';
-	require_once ROOT_PATH . '/lib/ActiveRecord.php';
-	require_once ROOT_PATH . '/lib/Routing.php';
-	require_once ROOT_PATH . '/lib/Template.php';
-	
+	require_once ROOT_PATH . '/lib/Utils.php';
 	require_once ROOT_PATH . '/config/config.php';
-	//require_once ROOT_PATH . '/config/template.php';
-	require_once ROOT_PATH . '/config/routing.php'; # require after templates
-	
-	require_once ROOT_PATH . '/model/__init__.php';
-	
+	$ar = new ActiveRecord();
 	$routing = new Routing\Routing();
diff --git a/tests/PHPUnit/Autoload.php b/tests/PHPUnit/Autoload.php
deleted file mode 100644
index 09951f6..0000000
--- a/tests/PHPUnit/Autoload.php
+++ /dev/null
@@ -1,89 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-require_once 'PHPUnit/Util/Filesystem.php';
-require_once 'PHP/CodeCoverage/Filter.php';
-
-if (!function_exists('phpunit_autoload')) {
-    function phpunit_autoload($class)
-    {
-        if (strpos($class, 'PHPUnit_') === 0) {
-            $file = str_replace('_', '/', $class) . '.php';
-            $file = PHPUnit_Util_Filesystem::fileExistsInIncludePath($file);
-
-            if ($file) {
-                require_once $file;
-            }
-        }
-    }
-
-    spl_autoload_register('phpunit_autoload');
-
-    $dir    = dirname(__FILE__);
-    $filter = PHP_CodeCoverage_Filter::getInstance();
-
-    $filter->addDirectoryToBlacklist(
-      $dir . '/Extensions', '.php', '', 'PHPUNIT', FALSE
-    );
-
-    $filter->addDirectoryToBlacklist(
-      $dir . '/Framework', '.php', '', 'PHPUNIT', FALSE
-    );
-
-    $filter->addDirectoryToBlacklist(
-      $dir . '/Runner', '.php', '', 'PHPUNIT', FALSE
-    );
-
-    $filter->addDirectoryToBlacklist(
-      $dir . '/TextUI', '.php', '', 'PHPUNIT', FALSE
-    );
-
-    $filter->addDirectoryToBlacklist(
-      $dir . '/Util', '.php', '', 'PHPUNIT', FALSE
-    );
-
-    $filter->addFileToBlacklist(__FILE__, 'PHPUNIT', FALSE);
-
-    unset($dir, $filter);
-}
diff --git a/tests/PHPUnit/Extensions/GroupTestSuite.php b/tests/PHPUnit/Extensions/GroupTestSuite.php
deleted file mode 100644
index 623839e..0000000
--- a/tests/PHPUnit/Extensions/GroupTestSuite.php
+++ /dev/null
@@ -1,100 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * We have a TestSuite object A.
- * In TestSuite object A we have Tests tagged with @group.
- * We want a TestSuite object B that contains TestSuite objects C, D, ...
- * for the Tests tagged with @group C, @group D, ...
- * Running the Tests from TestSuite object B results in Tests tagged with both
- * @group C and @group D in TestSuite object A to be run twice .
- *
- * <code>
- * $suite = new PHPUnit_Extensions_GroupTestSuite($A, array('C', 'D'));
- * </code>
- *
- * @package    PHPUnit
- * @subpackage Extensions
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_GroupTestSuite extends PHPUnit_Framework_TestSuite
-{
-    public function __construct(PHPUnit_Framework_TestSuite $suite, array $groups)
-    {
-        $groupSuites = array();
-        $name        = $suite->getName();
-
-        foreach ($groups as $group) {
-            $groupSuites[$group] = new PHPUnit_Framework_TestSuite($name . ' - ' . $group);
-            $this->addTest($groupSuites[$group]);
-        }
-
-        $tests = new RecursiveIteratorIterator(
-          new PHPUnit_Util_TestSuiteIterator($suite),
-          RecursiveIteratorIterator::LEAVES_ONLY
-        );
-
-        foreach ($tests as $test) {
-            if ($test instanceof PHPUnit_Framework_TestCase) {
-                $testGroups = PHPUnit_Util_Test::getGroups(
-                  get_class($test), $test->getName(FALSE)
-                );
-
-                foreach ($groups as $group) {
-                    foreach ($testGroups as $testGroup) {
-                        if ($group == $testGroup) {
-                            $groupSuites[$group]->addTest($test);
-                        }
-                    }
-                }
-            }
-        }
-    }
-}
diff --git a/tests/PHPUnit/Extensions/OutputTestCase.php b/tests/PHPUnit/Extensions/OutputTestCase.php
deleted file mode 100644
index aebf7e5..0000000
--- a/tests/PHPUnit/Extensions/OutputTestCase.php
+++ /dev/null
@@ -1,202 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * A TestCase that expects a specified output.
- *
- * @package    PHPUnit
- * @subpackage Extensions
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-abstract class PHPUnit_Extensions_OutputTestCase extends PHPUnit_Framework_TestCase
-{
-    /**
-     * @var    string
-     */
-    protected $expectedRegex = NULL;
-
-    /**
-     * @var    string
-     */
-    protected $expectedString = NULL;
-
-    /**
-     * @var    string
-     */
-    protected $output = '';
-
-    /**
-     * @var    boolean
-     */
-    protected $obActive = FALSE;
-
-    /**
-     * @var    mixed
-     */
-    protected $outputCallback = FALSE;
-
-    /**
-     * @return bool
-     */
-    public function setOutputCallback($callback)
-    {
-        if (is_callable($callback)) {
-            $this->outputCallback = $callback;
-            return TRUE;
-        }
-
-        return FALSE;
-    }
-
-    /**
-     * @return string
-     */
-    public function normalizeOutput($buffer)
-    {
-        return str_replace("\r", '', $buffer);
-    }
-
-    /**
-     * @return string
-     */
-    public function getActualOutput()
-    {
-        if (!$this->obActive) {
-            return $this->output;
-        } else {
-            return ob_get_contents();
-        }
-    }
-
-    /**
-     * @return string
-     */
-    public function expectedRegex()
-    {
-        return $this->expectedRegex;
-    }
-
-    /**
-     * @param  string  $expectedRegex
-     */
-    public function expectOutputRegex($expectedRegex)
-    {
-        if ($this->expectedString !== NULL) {
-            throw new PHPUnit_Framework_Exception;
-        }
-
-        if (is_string($expectedRegex) || is_null($expectedRegex)) {
-            $this->expectedRegex = $expectedRegex;
-        }
-    }
-
-    /**
-     * @return string
-     */
-    public function expectedString()
-    {
-        return $this->expectedString;
-    }
-
-    /**
-     * @param  string  $expectedString
-     */
-    public function expectOutputString($expectedString)
-    {
-        if ($this->expectedRegex !== NULL) {
-            throw new PHPUnit_Framework_Exception;
-        }
-
-        if (is_string($expectedString) || is_null($expectedString)) {
-            $this->expectedString = $expectedString;
-        }
-    }
-
-    /**
-     * @return mixed
-     * @throws RuntimeException
-     */
-    protected function runTest()
-    {
-        ob_start();
-        $this->obActive = TRUE;
-
-        try {
-            $testResult = parent::runTest();
-        }
-
-        catch (Exception $e) {
-            ob_end_clean();
-            $this->obActive = FALSE;
-            throw $e;
-        }
-
-        if ($this->outputCallback === FALSE) {
-            $this->output = ob_get_contents();
-        } else {
-            $this->output = call_user_func_array($this->outputCallback, array(ob_get_contents()));
-        }
-
-        ob_end_clean();
-        $this->obActive = FALSE;
-
-        if ($this->expectedRegex !== NULL) {
-            $this->assertRegExp($this->expectedRegex, $this->output);
-            $this->expectedRegex = NULL;
-        }
-
-        else if ($this->expectedString !== NULL) {
-            $this->assertEquals($this->expectedString, $this->output);
-            $this->expectedString = NULL;
-        }
-
-        return $testResult;
-    }
-}
diff --git a/tests/PHPUnit/Extensions/PhptTestCase.php b/tests/PHPUnit/Extensions/PhptTestCase.php
deleted file mode 100644
index 4819645..0000000
--- a/tests/PHPUnit/Extensions/PhptTestCase.php
+++ /dev/null
@@ -1,277 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_PhptTestCase
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.4
- */
-
-if (PHPUnit_Util_Filesystem::fileExistsInIncludePath('PEAR/RunTest.php')) {
-    $currentErrorReporting = error_reporting(E_ERROR | E_WARNING | E_PARSE);
-    PHPUnit_Util_Filesystem::collectStart();
-    require_once 'PEAR/RunTest.php';
-    error_reporting($currentErrorReporting);
-
-    PHPUnit_Util_Filesystem::collectEndAndAddToBlacklist();
-}
-
-require_once 'PHP/CodeCoverage.php';
-require_once 'PHP/Timer.php';
-
-/**
- * Wrapper to run .phpt test cases.
- *
- * @package    PHPUnit
- * @subpackage Extensions_PhptTestCase
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.4
- */
-class PHPUnit_Extensions_PhptTestCase implements PHPUnit_Framework_Test, PHPUnit_Framework_SelfDescribing
-{
-    /**
-     * The filename of the .phpt file.
-     *
-     * @var    string
-     */
-    protected $filename;
-
-    /**
-     * Options for PEAR_RunTest.
-     *
-     * @var    array
-     */
-    protected $options = array();
-
-    /**
-     * Constructs a test case with the given filename.
-     *
-     * @param  string $filename
-     * @param  array  $options
-     */
-    public function __construct($filename, array $options = array())
-    {
-        if (!is_string($filename)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_file($filename)) {
-            throw new PHPUnit_Framework_Exception(
-              sprintf(
-                'File "%s" does not exist.',
-                $filename
-              )
-            );
-        }
-
-        $this->filename = $filename;
-        $this->options  = $options;
-    }
-
-    /**
-     * Counts the number of test cases executed by run(TestResult result).
-     *
-     * @return integer
-     */
-    public function count()
-    {
-        return 1;
-    }
-
-    /**
-     * Runs a test and collects its result in a TestResult instance.
-     *
-     * @param  PHPUnit_Framework_TestResult $result
-     * @param  array                        $options
-     * @return PHPUnit_Framework_TestResult
-     */
-    public function run(PHPUnit_Framework_TestResult $result = NULL, array $options = array())
-    {
-        if (!class_exists('PEAR_RunTest', FALSE)) {
-            throw new PHPUnit_Framework_Exception('Class PEAR_RunTest not found.');
-        }
-
-        if (isset($GLOBALS['_PEAR_destructor_object_list']) &&
-            is_array($GLOBALS['_PEAR_destructor_object_list']) &&
-            !empty($GLOBALS['_PEAR_destructor_object_list'])) {
-            $pearDestructorObjectListCount = count($GLOBALS['_PEAR_destructor_object_list']);
-        } else {
-            $pearDestructorObjectListCount = 0;
-        }
-
-        if ($result === NULL) {
-            $result = new PHPUnit_Framework_TestResult;
-        }
-
-        $coverage = $result->getCollectCodeCoverageInformation();
-        $options  = array_merge($options, $this->options);
-
-        if (!isset($options['include_path'])) {
-            $options['include_path'] = get_include_path();
-        }
-
-        if ($coverage) {
-            $options['coverage'] = TRUE;
-        } else {
-            $options['coverage'] = FALSE;
-        }
-
-        $currentErrorReporting = error_reporting(E_ERROR | E_WARNING | E_PARSE);
-        $runner                = new PEAR_RunTest(new PHPUnit_Extensions_PhptTestCase_Logger, $options);
-
-        if ($coverage) {
-            $runner->xdebug_loaded = TRUE;
-        } else {
-            $runner->xdebug_loaded = FALSE;
-        }
-
-        $result->startTest($this);
-
-        PHP_Timer::start();
-
-        $buffer = $runner->run($this->filename, $options);
-        $time   = PHP_Timer::stop();
-
-        error_reporting($currentErrorReporting);
-
-        $base         = basename($this->filename);
-        $path         = dirname($this->filename);
-        $coverageFile = $path . DIRECTORY_SEPARATOR . str_replace(
-                          '.phpt', '.xdebug', $base
-                        );
-        $diffFile     = $path . DIRECTORY_SEPARATOR . str_replace(
-                          '.phpt', '.diff', $base
-                        );
-        $expFile      = $path . DIRECTORY_SEPARATOR . str_replace(
-                          '.phpt', '.exp', $base
-                        );
-        $logFile      = $path . DIRECTORY_SEPARATOR . str_replace(
-                          '.phpt', '.log', $base
-                        );
-        $outFile      = $path . DIRECTORY_SEPARATOR . str_replace(
-                          '.phpt', '.out', $base
-                        );
-        $phpFile      = $path . DIRECTORY_SEPARATOR . str_replace(
-                          '.phpt', '.php', $base
-                        );
-
-        if (file_exists($phpFile)) {
-            PHP_CodeCoverage_Filter::getInstance()->addFileToBlacklist(
-              $phpFile, 'TESTS'
-            );
-        }
-
-        if (is_object($buffer) && $buffer instanceof PEAR_Error) {
-            $result->addError(
-              $this,
-              new RuntimeException($buffer->getMessage()),
-              $time
-            );
-        }
-
-        else if ($buffer == 'SKIPPED') {
-            $result->addFailure($this, new PHPUnit_Framework_SkippedTestError, 0);
-        }
-
-        else if ($buffer != 'PASSED') {
-            $result->addFailure(
-              $this,
-              PHPUnit_Framework_ComparisonFailure::diffEqual(
-                file_get_contents($expFile),
-                file_get_contents($outFile)
-              ),
-              $time
-            );
-        }
-
-        foreach (array($diffFile, $expFile, $logFile, $phpFile, $outFile) as $file) {
-            if (file_exists($file)) {
-                unlink($file);
-            }
-        }
-
-        if ($coverage && file_exists($coverageFile)) {
-            eval('$coverageData = ' . file_get_contents($coverageFile) . ';');
-            unset($coverageData[$phpFile]);
-
-            $result->getCodeCoverage()->append($coverageData, $this);
-            unlink($coverageFile);
-        }
-
-        $result->endTest($this, $time);
-
-        // Do not invoke PEAR's destructor mechanism for PHP 4
-        // as it raises an E_STRICT.
-        if ($pearDestructorObjectListCount == 0) {
-            unset($GLOBALS['_PEAR_destructor_object_list']);
-        } else {
-            $count = count($GLOBALS['_PEAR_destructor_object_list']) - $pearDestructorObjectListCount;
-
-            for ($i = 0; $i < $count; $i++) {
-                array_pop($GLOBALS['_PEAR_destructor_object_list']);
-            }
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns the name of the test case.
-     *
-     * @return string
-     */
-    public function getName()
-    {
-        return $this->toString();
-    }
-
-    /**
-     * Returns a string representation of the test case.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return $this->filename;
-    }
-}
diff --git a/tests/PHPUnit/Extensions/PhptTestCase/Logger.php b/tests/PHPUnit/Extensions/PhptTestCase/Logger.php
deleted file mode 100644
index 8834533..0000000
--- a/tests/PHPUnit/Extensions/PhptTestCase/Logger.php
+++ /dev/null
@@ -1,63 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_PhptTestCase
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.4
- */
-
-/**
- * Dummy logger for PEAR_RunTest.
- *
- * @package    PHPUnit
- * @subpackage Extensions_PhptTestCase
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.4
- */
-class PHPUnit_Extensions_PhptTestCase_Logger
-{
-    public function log($level, $msg, $append_crlf = TRUE)
-    {
-    }
-}
diff --git a/tests/PHPUnit/Extensions/PhptTestSuite.php b/tests/PHPUnit/Extensions/PhptTestSuite.php
deleted file mode 100644
index f8acf50..0000000
--- a/tests/PHPUnit/Extensions/PhptTestSuite.php
+++ /dev/null
@@ -1,86 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_PhptTestCase
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.4
- */
-
-require_once 'File/Iterator/Factory.php';
-
-/**
- * Suite for .phpt test cases.
- *
- * @package    PHPUnit
- * @subpackage Extensions_PhptTestCase
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.4
- */
-class PHPUnit_Extensions_PhptTestSuite extends PHPUnit_Framework_TestSuite
-{
-    /**
-     * Constructs a new TestSuite for .phpt test cases.
-     *
-     * @param  string $directory
-     * @param  array  $options Array with ini settings for the php instance run,
-     *                         key being the name if the setting, value the ini value.
-     * @throws InvalidArgumentException
-     */
-    public function __construct($directory, array $options = array())
-    {
-        if (is_string($directory) && is_dir($directory)) {
-            $this->setName($directory);
-
-            $iterator = File_Iterator_Factory::getFileIterator(
-              $directory, '.phpt'
-            );
-
-            foreach ($iterator as $testFile) {
-                $this->addTestFile($testFile->getPathname(), TRUE, $options);
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'directory name');
-        }
-    }
-}
diff --git a/tests/PHPUnit/Extensions/RepeatedTest.php b/tests/PHPUnit/Extensions/RepeatedTest.php
deleted file mode 100644
index c8f22bb..0000000
--- a/tests/PHPUnit/Extensions/RepeatedTest.php
+++ /dev/null
@@ -1,154 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A Decorator that runs a test repeatedly.
- *
- * @package    PHPUnit
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Extensions_RepeatedTest extends PHPUnit_Extensions_TestDecorator
-{
-    /**
-     * @var mixed
-     */
-    protected $filter = FALSE;
-
-    /**
-     * @var array
-     */
-    protected $groups = array();
-
-    /**
-     * @var array
-     */
-    protected $excludeGroups = array();
-
-    /**
-     * @var boolean
-     */
-    protected $processIsolation = FALSE;
-
-    /**
-     * @var integer
-     */
-    protected $timesRepeat = 1;
-
-    /**
-     * Constructor.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  integer                $timesRepeat
-     * @param  mixed                  $filter
-     * @param  array                  $groups
-     * @param  array                  $excludeGroups
-     * @param  boolean                $processIsolation
-     * @throws InvalidArgumentException
-     */
-    public function __construct(PHPUnit_Framework_Test $test, $timesRepeat = 1, $filter = FALSE, array $groups = array(), array $excludeGroups = array(), $processIsolation = FALSE)
-    {
-        parent::__construct($test);
-
-        if (is_integer($timesRepeat) &&
-            $timesRepeat >= 0) {
-            $this->timesRepeat = $timesRepeat;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              2, 'positive integer'
-            );
-        }
-
-        $this->filter           = $filter;
-        $this->groups           = $groups;
-        $this->excludeGroups    = $excludeGroups;
-        $this->processIsolation = $processIsolation;
-    }
-
-    /**
-     * Counts the number of test cases that
-     * will be run by this test.
-     *
-     * @return integer
-     */
-    public function count()
-    {
-        return $this->timesRepeat * count($this->test);
-    }
-
-    /**
-     * Runs the decorated test and collects the
-     * result in a TestResult.
-     *
-     * @param  PHPUnit_Framework_TestResult $result
-     * @return PHPUnit_Framework_TestResult
-     * @throws InvalidArgumentException
-     */
-    public function run(PHPUnit_Framework_TestResult $result = NULL)
-    {
-        if ($result === NULL) {
-            $result = $this->createResult();
-        }
-
-        for ($i = 0; $i < $this->timesRepeat && !$result->shouldStop(); $i++) {
-            if ($this->test instanceof PHPUnit_Framework_TestSuite) {
-                $this->test->run(
-                  $result,
-                  $this->filter,
-                  $this->groups,
-                  $this->excludeGroups,
-                  $this->processIsolation
-                );
-            } else {
-                $this->test->run($result);
-            }
-        }
-
-        return $result;
-    }
-}
diff --git a/tests/PHPUnit/Extensions/Story/Given.php b/tests/PHPUnit/Extensions/Story/Given.php
deleted file mode 100644
index 126b62d..0000000
--- a/tests/PHPUnit/Extensions/Story/Given.php
+++ /dev/null
@@ -1,71 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * A "Given" step.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_Story_Given extends PHPUnit_Extensions_Story_Step
-{
-    /**
-     * Returns this step's name.
-     *
-     * @return string
-     */
-    public function getName()
-    {
-        return 'Given';
-    }
-}
diff --git a/tests/PHPUnit/Extensions/Story/ResultPrinter.php b/tests/PHPUnit/Extensions/Story/ResultPrinter.php
deleted file mode 100644
index 321a98f..0000000
--- a/tests/PHPUnit/Extensions/Story/ResultPrinter.php
+++ /dev/null
@@ -1,102 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Base for Story result printers.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_Story_ResultPrinter extends PHPUnit_Util_TestDox_ResultPrinter
-{
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        if ($test instanceof PHPUnit_Extensions_Story_TestCase ||
-            $test instanceof PHPUnit_Extensions_Story_SeleniumTestCase) {
-            if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_PASSED) {
-                $this->successful++;
-                $success = TRUE;
-            } else {
-                $success = FALSE;
-            }
-
-            $this->onTest(
-              $this->currentTestMethodPrettified,
-              $success,
-              $test->getScenario()->getSteps()
-            );
-        }
-    }
-
-    /**
-     */
-    protected function doEndClass()
-    {
-        $this->endClass($this->testClass);
-    }
-
-    /**
-     * Handler for 'on test' event.
-     *
-     * @param  string  $name
-     * @param  boolean $success
-     * @param  array   $steps
-     */
-    protected function onTest($name, $success = TRUE, array $steps = array())
-    {
-    }
-}
diff --git a/tests/PHPUnit/Extensions/Story/ResultPrinter/HTML.php b/tests/PHPUnit/Extensions/Story/ResultPrinter/HTML.php
deleted file mode 100644
index 859a9a6..0000000
--- a/tests/PHPUnit/Extensions/Story/ResultPrinter/HTML.php
+++ /dev/null
@@ -1,212 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Prints stories in HTML format.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_Story_ResultPrinter_HTML extends PHPUnit_Extensions_Story_ResultPrinter
-{
-    /**
-     * @var boolean
-     */
-    protected $printsHTML = TRUE;
-
-    /**
-     * @var integer
-     */
-    protected $id = 0;
-
-    /**
-     * @var string
-     */
-    protected $scenarios = '';
-
-    /**
-     * @var string
-     */
-    protected $templatePath;
-
-    /**
-     * Constructor.
-     *
-     * @param  mixed   $out
-     * @throws InvalidArgumentException
-     */
-    public function __construct($out = NULL)
-    {
-        parent::__construct($out);
-
-        $this->templatePath = sprintf(
-          '%s%sTemplate%s',
-
-          dirname(__FILE__),
-          DIRECTORY_SEPARATOR,
-          DIRECTORY_SEPARATOR
-        );
-    }
-
-    /**
-     * Handler for 'start class' event.
-     *
-     * @param  string $name
-     */
-    protected function startClass($name)
-    {
-        $scenarioHeaderTemplate = new Text_Template(
-          $this->templatePath . 'scenario_header.html'
-        );
-
-        $scenarioHeaderTemplate->setVar(
-          array(
-            'name' => $this->currentTestClassPrettified
-          )
-        );
-
-        $this->scenarios .= $scenarioHeaderTemplate->render();
-    }
-
-    /**
-     * Handler for 'on test' event.
-     *
-     * @param  string  $name
-     * @param  boolean $success
-     * @param  array   $steps
-     */
-    protected function onTest($name, $success = TRUE, array $steps = array())
-    {
-        if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_FAILURE) {
-            $scenarioStatus = 'scenarioFailed';
-        }
-
-        else if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_SKIPPED) {
-            $scenarioStatus = 'scenarioSkipped';
-        }
-
-        else if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_INCOMPLETE) {
-            $scenarioStatus = 'scenarioIncomplete';
-        }
-
-        else {
-            $scenarioStatus = 'scenarioSuccess';
-        }
-
-        $lastStepName = '';
-        $stepsBuffer  = '';
-
-        foreach ($steps as $step) {
-            $currentStepName = $step->getName();
-
-            if ($lastStepName == $currentStepName) {
-                $stepText = 'and';
-            } else {
-                $stepText = $currentStepName;
-            }
-
-            $lastStepName = $currentStepName;
-
-            $stepTemplate = new Text_Template(
-              $this->templatePath . 'step.html'
-            );
-
-            $stepTemplate->setVar(
-              array(
-                'text'   => $stepText,
-                'action' => $step->getAction() . ' ' . $step->getArguments(TRUE),
-              )
-            );
-
-            $stepsBuffer .= $stepTemplate->render();
-        }
-
-        $scenarioTemplate = new Text_Template(
-          $this->templatePath . 'scenario.html'
-        );
-
-        $scenarioTemplate->setVar(
-          array(
-            'id'             => ++$this->id,
-            'name'           => $name,
-            'scenarioStatus' => $scenarioStatus,
-            'steps'          => $stepsBuffer,
-          )
-        );
-
-        $this->scenarios .= $scenarioTemplate->render();
-    }
-
-    /**
-     * Handler for 'end run' event.
-     *
-     */
-    protected function endRun()
-    {
-        $scenariosTemplate = new Text_Template(
-          $this->templatePath . 'scenarios.html'
-        );
-
-        $scenariosTemplate->setVar(
-          array(
-            'scenarios'           => $this->scenarios,
-            'successfulScenarios' => $this->successful,
-            'failedScenarios'     => $this->failed,
-            'skippedScenarios'    => $this->skipped,
-            'incompleteScenarios' => $this->incomplete
-          )
-        );
-
-        $this->write($scenariosTemplate->render());
-    }
-}
diff --git a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenario.html.dist b/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenario.html.dist
deleted file mode 100644
index caa149a..0000000
--- a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenario.html.dist
+++ /dev/null
@@ -1,13 +0,0 @@
-   <tr>
-    <td>
-     <p class="{scenarioStatus}" onclick="showHide('{id}', this)">[+] {name}</p>
-    </td>
-   </tr>
-   <tr>
-    <td>
-     <table border="0" width="100%" class="{scenarioStatus} scenarioStepsTable" id="stepContainer{id}">
-{steps}
-     </table>
-    </td>
-   </tr>
-
diff --git a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenario_header.html.dist b/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenario_header.html.dist
deleted file mode 100644
index 7b205d1..0000000
--- a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenario_header.html.dist
+++ /dev/null
@@ -1,6 +0,0 @@
-   <tr>
-    <td>
-     <p class="header">{name}</p>
-    </td>
-   </tr>
-
diff --git a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenarios.html.dist b/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenarios.html.dist
deleted file mode 100644
index 21bf38e..0000000
--- a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/scenarios.html.dist
+++ /dev/null
@@ -1,60 +0,0 @@
-<html>
- <head>
-  <style type ="text/css">
-  body { font-family: Andale Mono, monospace; }
-  .header { font-size: large; font-weight: bold; }
-  .scenarioSuccess { color: green; }
-  .scenario { color: black; }
-  .scenarioFailed { color: red; }
-  .scenarioSkipped { color: teal; }
-  .scenarioIncomplete { color: gray; }
-  .scenarioStepsTable { margin-left: 10px; display: none; }
-  .stepName { }
-  </style>
-  <script type="text/javascript">
-  function showHide(nodeId, linkObj)
-  {
-    var subObj = document.getElementById('stepContainer' + nodeId);
-
-    if (linkObj.innerHTML.indexOf('+')>0) {
-      linkObj.innerHTML = linkObj.innerHTML.replace('+','-');
-      subObj.style.display='block';
-      subObj.style.width = '100%';
-    } else {
-      linkObj.innerHTML = linkObj.innerHTML.replace('-','+');
-      subObj.style.display='none';
-    }
-  }
-  </script>
- </head>
- <body>
-  <table border="0">
-{scenarios}
-   <tr>
-    <td>
-     <p style="margin-top: 20px;" id="Summary" onclick="showHide('Summary', this)">[+] Summary:</p>
-     <div style="margin-left: 10px; display:none" id="stepContainerSummary">
-      <table border="0">
-       <tr>
-        <td width="250" class="scenarioSuccess">Successful scenarios:</td>
-        <td class="scenarioSuccessValue">{successfulScenarios}</td>
-       </tr>
-       <tr>
-        <td class="scenarioFailed">Failed scenarios:</td>
-        <td class="scenarioFailedValue">{failedScenarios}</td>
-       </tr>
-       <tr>
-        <td class="scenarioSkipped">Skipped scenarios:</td>
-        <td class="scenarioSkippedValue">{skippedScenarios}</td>
-       </tr>
-       <tr>
-        <td class="scenarioIncomplete">Incomplete scenarios:</td>
-        <td class="scenarioIncompleteValue">{incompleteScenarios}</td>
-       </tr>
-      </table>
-     </div>
-    </td>
-   </tr>
-  </table>
- </body>
-</html>
diff --git a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/step.html.dist b/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/step.html.dist
deleted file mode 100644
index bcdce3f..0000000
--- a/tests/PHPUnit/Extensions/Story/ResultPrinter/Template/step.html.dist
+++ /dev/null
@@ -1,6 +0,0 @@
-      <tr>
-       <td width="60">{text}</td>
-       <td class="stepName">{action}</td>
-       <td>&nbsp;</td>
-      </tr>
-
diff --git a/tests/PHPUnit/Extensions/Story/ResultPrinter/Text.php b/tests/PHPUnit/Extensions/Story/ResultPrinter/Text.php
deleted file mode 100644
index b2426d3..0000000
--- a/tests/PHPUnit/Extensions/Story/ResultPrinter/Text.php
+++ /dev/null
@@ -1,150 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Prints stories in HTML format.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_Story_ResultPrinter_Text extends PHPUnit_Extensions_Story_ResultPrinter
-{
-    /**
-     * Handler for 'start class' event.
-     *
-     * @param  string $name
-     */
-    protected function startClass($name)
-    {
-        $this->write($this->currentTestClassPrettified . "\n");
-    }
-
-    /**
-     * Handler for 'on test' event.
-     *
-     * @param  string  $name
-     * @param  boolean $success
-     * @param  array   $steps
-     */
-    protected function onTest($name, $success = TRUE, array $steps = array())
-    {
-        if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_FAILURE) {
-            $scenarioStatus = 'failed';
-        }
-
-        else if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_SKIPPED) {
-            $scenarioStatus = 'skipped';
-        }
-
-        else if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_INCOMPLETE) {
-            $scenarioStatus = 'incomplete';
-        }
-
-        else {
-            $scenarioStatus = 'successful';
-        }
-
-        $this->write(
-          sprintf(
-            " [%s] %s\n\n",
-            $scenarioStatus == 'successful' ? 'x' : ' ',
-            $name
-          )
-        );
-
-        $lastStepName = '';
-        $stepsBuffer  = '';
-
-        foreach ($steps as $step) {
-            $currentStepName = $step->getName();
-
-            if ($lastStepName == $currentStepName) {
-                $stepText = 'and';
-            } else {
-                $stepText = $currentStepName;
-            }
-
-            $lastStepName = $currentStepName;
-
-            $this->write(
-              sprintf(
-                "   %5s %s %s\n",
-                $stepText,
-                $step->getAction(),
-                $step->getArguments(TRUE)
-              )
-            );
-        }
-
-        $this->write("\n");
-    }
-
-    /**
-     * Handler for 'end run' event.
-     *
-     */
-    protected function endRun()
-    {
-        $this->write(
-          sprintf(
-            "Scenarios: %d, Failed: %d, Skipped: %d, Incomplete: %d.\n",
-
-            $this->successful + $this->failed +
-            $this->skipped    + $this->incomplete,
-            $this->failed,
-            $this->skipped,
-            $this->incomplete
-          )
-        );
-    }
-}
diff --git a/tests/PHPUnit/Extensions/Story/Scenario.php b/tests/PHPUnit/Extensions/Story/Scenario.php
deleted file mode 100644
index 3c17600..0000000
--- a/tests/PHPUnit/Extensions/Story/Scenario.php
+++ /dev/null
@@ -1,189 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * A scenario.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_Story_Scenario
-{
-    /**
-     * @var    PHPUnit_Extensions_Story_TestCase
-     */
-    protected $test;
-
-    /**
-     * @var    array
-     */
-    protected $steps = array();
-
-    /**
-     * @var    string
-     */
-    protected $lastCalledMethod;
-
-    /**
-     * Constructor.
-     *
-     * @param  PHPUnit_Extensions_Story_TestCase $caller
-     */
-    public function __construct($test)
-    {
-        if ($test instanceof PHPUnit_Extensions_Story_TestCase ||
-            $test instanceof PHPUnit_Extensions_Story_SeleniumTestCase) {
-            $this->test = $test;
-        } else {
-            throw new Exception('$test must either be PHPUnit_Extensions_Story_TestCase or PHPUnit_Extensions_Story_SeleniumTestCase');
-        }
-    }
-
-    /**
-     * Adds a "Given" step to the scenario.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    public function given($arguments)
-    {
-        return $this->addStep(new PHPUnit_Extensions_Story_Given($arguments));
-    }
-
-    /**
-     * Adds a "When" step to the scenario.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    public function when($arguments)
-    {
-        return $this->addStep(new PHPUnit_Extensions_Story_When($arguments));
-    }
-
-    /**
-     * Adds a "Then" step to the scenario.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    public function then($arguments)
-    {
-        return $this->addStep(new PHPUnit_Extensions_Story_Then($arguments));
-    }
-
-    /**
-     * Add another step of the same type as the step that was added before.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    public function _and($arguments)
-    {
-        $lastCalledStepClass = get_class($this->steps[count($this->steps)-1]);
-
-        return $this->addStep(new $lastCalledStepClass($arguments));
-    }
-
-    /**
-     * Runs this scenario.
-     *
-     * @param  array $world
-     */
-    public function run(array &$world)
-    {
-        foreach ($this->steps as $step)
-        {
-            if ($step instanceof PHPUnit_Extensions_Story_Given) {
-                $this->test->runGiven(
-                  $world, $step->getAction(), $step->getArguments()
-                );
-            }
-
-            else if ($step instanceof PHPUnit_Extensions_Story_When) {
-                $this->test->runWhen(
-                  $world, $step->getAction(), $step->getArguments()
-                );
-            }
-
-            else {
-                $this->test->runThen(
-                  $world, $step->getAction(), $step->getArguments()
-                );
-            }
-        }
-    }
-
-    /**
-     * Adds a step to the scenario.
-     *
-     * @param  PHPUnit_Extensions_Story_Step $step
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    protected function addStep(PHPUnit_Extensions_Story_Step $step)
-    {
-        $this->steps[] = $step;
-
-        return $this->test;
-    }
-
-    /**
-     * Returns the steps of this scenario.
-     *
-     * @return array
-     */
-    public function getSteps()
-    {
-        return $this->steps;
-    }
-}
diff --git a/tests/PHPUnit/Extensions/Story/Step.php b/tests/PHPUnit/Extensions/Story/Step.php
deleted file mode 100644
index a1a903e..0000000
--- a/tests/PHPUnit/Extensions/Story/Step.php
+++ /dev/null
@@ -1,128 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * A step of a scenario.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-abstract class PHPUnit_Extensions_Story_Step
-{
-    /**
-     * @var    string
-     */
-    protected $action;
-
-    /**
-     * @var    array
-     */
-    protected $arguments;
-
-    /**
-     * Constructor.
-     *
-     * @param  array $arguments
-     */
-    public function __construct(array $arguments)
-    {
-        $this->action    = array_shift($arguments);
-        $this->arguments = $arguments;
-    }
-
-    /**
-     * Returns this step's action.
-     *
-     * @return string
-     */
-    public function getAction()
-    {
-        return $this->action;
-    }
-
-    /**
-     * Returns this step's arguments.
-     *
-     * @param  boolean $asString
-     * @return array|string
-     */
-    public function getArguments($asString = FALSE)
-    {
-        if (!$asString) {
-            return $this->arguments;
-        } else {
-            switch (count($this->arguments)) {
-                case 0: {
-                    return '';
-                }
-                break;
-
-                case 1: {
-                    return $this->arguments[0];
-                }
-                break;
-
-                default: {
-                    return var_export($this->arguments, TRUE);
-                }
-            }
-        }
-    }
-
-    /**
-     * Returns this step's name.
-     *
-     * @return string
-     */
-    abstract public function getName();
-}
diff --git a/tests/PHPUnit/Extensions/Story/TestCase.php b/tests/PHPUnit/Extensions/Story/TestCase.php
deleted file mode 100644
index dd68dad..0000000
--- a/tests/PHPUnit/Extensions/Story/TestCase.php
+++ /dev/null
@@ -1,210 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * A story test case.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-abstract class PHPUnit_Extensions_Story_TestCase extends PHPUnit_Framework_TestCase
-{
-    /**
-     * @var    PHPUnit_Extensions_Story_Scenario
-     */
-    protected $scenario;
-
-    /**
-     * @var    array
-     */
-    protected $world = array();
-
-    /**
-     * Constructs a test case with the given name.
-     *
-     * @param  string $name
-     * @param  array  $data
-     * @param  string $dataName
-     */
-    public function __construct($name = NULL, array $data = array(), $dataName = '')
-    {
-        parent::__construct($name, $data, $dataName);
-        $this->scenario = new PHPUnit_Extensions_Story_Scenario($this);
-    }
-
-    /**
-     * @method PHPUnit_Extensions_Story_Step and($contextOrOutcome)
-     */
-    public function __call($command, $arguments)
-    {
-        switch ($command) {
-            case 'and': {
-                return $this->scenario->_and($arguments);
-            }
-            break;
-
-            default: {
-                throw new BadMethodCallException(
-                  "Method $command not defined."
-                );
-            }
-        }
-    }
-
-    /**
-     * Returns this test's scenario.
-     *
-     * @return PHPUnit_Extensions_Story_Scenario
-     */
-    public function getScenario()
-    {
-        return $this->scenario;
-    }
-
-    /**
-     *
-     *
-     */
-    protected function notImplemented($action)
-    {
-        if (strstr($action, ' ')) {
-            $this->markTestIncomplete("step: $action not implemented.");
-        }
-
-        throw new BadMethodCallException("Method $action not defined.");
-    }
-
-    /**
-     * Adds a "Given" step to the scenario.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    protected function given($context)
-    {
-        return $this->scenario->given(func_get_args());
-    }
-
-    /**
-     * Adds a "When" step to the scenario.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    protected function when($event)
-    {
-        return $this->scenario->when(func_get_args());
-    }
-
-    /**
-     * Adds a "Then" step to the scenario.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    protected function then($outcome)
-    {
-        return $this->scenario->then(func_get_args());
-    }
-
-    /**
-     * Add another step of the same type as the step that was added before.
-     *
-     * @param  array $arguments
-     * @return PHPUnit_Extensions_Story_TestCase
-     */
-    protected function _and($contextOrOutcome)
-    {
-        return $this->scenario->_and(func_get_args());
-    }
-
-    /**
-     * Run this test's scenario.
-     *
-     * @return mixed
-     * @throws RuntimeException
-     */
-    protected function runTest()
-    {
-        $testResult = parent::runTest();
-        $this->scenario->run($this->world);
-        return $testResult;
-    }
-
-    /**
-     * Implementation for "Given" steps.
-     *
-     * @param  array  $world
-     * @param  string $action
-     * @param  array  $arguments
-     */
-    abstract protected function runGiven(&$world, $action, $arguments);
-
-    /**
-     * Implementation for "When" steps.
-     *
-     * @param  array  $world
-     * @param  string $action
-     * @param  array  $arguments
-     */
-    abstract protected function runWhen(&$world, $action, $arguments);
-
-    /**
-     * Implementation for "Then" steps.
-     *
-     * @param  array  $world
-     * @param  string $action
-     * @param  array  $arguments
-     */
-    abstract protected function runThen(&$world, $action, $arguments);
-}
diff --git a/tests/PHPUnit/Extensions/Story/Then.php b/tests/PHPUnit/Extensions/Story/Then.php
deleted file mode 100644
index bffae64..0000000
--- a/tests/PHPUnit/Extensions/Story/Then.php
+++ /dev/null
@@ -1,71 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * A "Then" step.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_Story_Then extends PHPUnit_Extensions_Story_Step
-{
-    /**
-     * Returns this step's name.
-     *
-     * @return string
-     */
-    public function getName()
-    {
-        return 'Then';
-    }
-}
diff --git a/tests/PHPUnit/Extensions/Story/When.php b/tests/PHPUnit/Extensions/Story/When.php
deleted file mode 100644
index 7b7623c..0000000
--- a/tests/PHPUnit/Extensions/Story/When.php
+++ /dev/null
@@ -1,71 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * A "When" step.
- *
- * @package    PHPUnit
- * @subpackage Extensions_Story
- * @author     Mattis Stordalen Flister <mattis@xait.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Extensions_Story_When extends PHPUnit_Extensions_Story_Step
-{
-    /**
-     * Returns this step's name.
-     *
-     * @return string
-     */
-    public function getName()
-    {
-        return 'When';
-    }
-}
diff --git a/tests/PHPUnit/Extensions/TestDecorator.php b/tests/PHPUnit/Extensions/TestDecorator.php
deleted file mode 100644
index 6f38760..0000000
--- a/tests/PHPUnit/Extensions/TestDecorator.php
+++ /dev/null
@@ -1,151 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A Decorator for Tests.
- *
- * Use TestDecorator as the base class for defining new
- * test decorators. Test decorator subclasses can be introduced
- * to add behaviour before or after a test is run.
- *
- * @package    PHPUnit
- * @subpackage Extensions
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Extensions_TestDecorator extends PHPUnit_Framework_Assert implements PHPUnit_Framework_Test, PHPUnit_Framework_SelfDescribing
-{
-    /**
-     * The Test to be decorated.
-     *
-     * @var    object
-     */
-    protected $test = NULL;
-
-    /**
-     * Constructor.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function __construct(PHPUnit_Framework_Test $test)
-    {
-        $this->test = $test;
-    }
-
-    /**
-     * Returns a string representation of the test.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return $this->test->toString();
-    }
-
-    /**
-     * Runs the test and collects the
-     * result in a TestResult.
-     *
-     * @param  PHPUnit_Framework_TestResult $result
-     */
-    public function basicRun(PHPUnit_Framework_TestResult $result)
-    {
-        $this->test->run($result);
-    }
-
-    /**
-     * Counts the number of test cases that
-     * will be run by this test.
-     *
-     * @return integer
-     */
-    public function count()
-    {
-        return count($this->test);
-    }
-
-    /**
-     * Creates a default TestResult object.
-     *
-     * @return PHPUnit_Framework_TestResult
-     */
-    protected function createResult()
-    {
-        return new PHPUnit_Framework_TestResult;
-    }
-
-    /**
-     * Returns the test to be run.
-     *
-     * @return PHPUnit_Framework_Test
-     */
-    public function getTest()
-    {
-        return $this->test;
-    }
-
-    /**
-     * Runs the decorated test and collects the
-     * result in a TestResult.
-     *
-     * @param  PHPUnit_Framework_TestResult $result
-     * @return PHPUnit_Framework_TestResult
-     * @throws InvalidArgumentException
-     */
-    public function run(PHPUnit_Framework_TestResult $result = NULL)
-    {
-        if ($result === NULL) {
-            $result = $this->createResult();
-        }
-
-        $this->basicRun($result);
-
-        return $result;
-    }
-}
diff --git a/tests/PHPUnit/Extensions/TicketListener.php b/tests/PHPUnit/Extensions/TicketListener.php
deleted file mode 100644
index 4388dc1..0000000
--- a/tests/PHPUnit/Extensions/TicketListener.php
+++ /dev/null
@@ -1,225 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_TicketListener
- * @author     Sean Coates <sean@caedmon.net>
- * @author     Raphael Stolt <raphael.stolt@gmail.com>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- * Base class for test listeners that interact with an issue tracker.
- *
- * @package    PHPUnit
- * @subpackage Extensions_TicketListener
- * @author     Sean Coates <sean@caedmon.net>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-abstract class PHPUnit_Extensions_TicketListener implements PHPUnit_Framework_TestListener
-{
-    /**
-     * @var array
-     */
-    protected $ticketCounts = array();
-
-    /**
-     * @var boolean
-     */
-    protected $ran = FALSE;
-
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     * @since  Method available since Release 3.0.0
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * A test suite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-    }
-
-    /**
-     * A test suite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-    }
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        if (!$test instanceof PHPUnit_Framework_Warning) {
-            if ($this->ran) {
-                return;
-            }
-
-            $name    = $test->getName();
-            $tickets = PHPUnit_Util_Test::getTickets(get_class($test), $name);
-
-            foreach ($tickets as $ticket) {
-                $this->ticketCounts[$ticket][$name] = 1;
-            }
-
-            $this->ran = TRUE;
-        }
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        if (!$test instanceof PHPUnit_Framework_Warning) {
-            if ($test->getStatus() == PHPUnit_Runner_BaseTestRunner::STATUS_PASSED) {
-                $ifStatus   = array('assigned', 'new', 'reopened');
-                $newStatus  = 'closed';
-                $message    = 'Automatically closed by PHPUnit (test passed).';
-                $resolution = 'fixed';
-                $cumulative = TRUE;
-            }
-
-            else if ($test->getStatus() == PHPUnit_Runner_BaseTestRunner::STATUS_FAILURE) {
-                $ifStatus   = array('closed');
-                $newStatus  = 'reopened';
-                $message    = 'Automatically reopened by PHPUnit (test failed).';
-                $resolution = '';
-                $cumulative = FALSE;
-            }
-
-            else {
-                return;
-            }
-
-            $name    = $test->getName();
-            $tickets = PHPUnit_Util_Test::getTickets(get_class($test), $name);
-
-            foreach ($tickets as $ticket) {
-                // Remove this test from the totals (if it passed).
-                if ($test->getStatus() == PHPUnit_Runner_BaseTestRunner::STATUS_PASSED) {
-                    unset($this->ticketCounts[$ticket][$name]);
-                }
-
-                // Only close tickets if ALL referenced cases pass
-                // but reopen tickets if a single test fails.
-                if ($cumulative) {
-                    // Determine number of to-pass tests:
-                    if (count($this->ticketCounts[$ticket]) > 0) {
-                        // There exist remaining test cases with this reference.
-                        $adjustTicket = FALSE;
-                    } else {
-                        // No remaining tickets, go ahead and adjust.
-                        $adjustTicket = TRUE;
-                    }
-                } else {
-                    $adjustTicket = TRUE;
-                }
-
-                $ticketInfo = $this->getTicketInfo($ticket);
-
-                if ($adjustTicket && in_array($ticketInfo['status'], $ifStatus)) {
-                    $this->updateTicket($ticket, $newStatus, $message, $resolution);
-                }
-            }
-        }
-    }
-
-    abstract protected function getTicketInfo($ticketId = NULL);
-    abstract protected function updateTicket($ticketId, $newStatus, $message, $resolution);
-}
diff --git a/tests/PHPUnit/Extensions/TicketListener/GitHub.php b/tests/PHPUnit/Extensions/TicketListener/GitHub.php
deleted file mode 100644
index c0c4450..0000000
--- a/tests/PHPUnit/Extensions/TicketListener/GitHub.php
+++ /dev/null
@@ -1,204 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_TicketListener
- * @author     Raphael Stolt <raphael.stolt@gmail.com>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * A ticket listener that interacts with the GitHub issue API.
- *
- * @package    PHPUnit
- * @subpackage Extensions_TicketListener
- * @author     Raphael Stolt <raphael.stolt@gmail.com>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.5.0
- */
-class PHPUnit_Extensions_TicketListener_GitHub extends PHPUnit_Extensions_TicketListener
-{
-    const STATUS_CLOSE  = 'closed';
-    const STATUS_REOPEN = 'reopened';
-
-    private $username;
-    private $apiToken;
-    private $repository;
-    private $apiPath = 'http://github.com/api/v2/json/issues';
-    private $printTicketStateChanges;
-
-    /**
-     * @param string $username   The username associated with the GitHub account.
-     * @param string $apiToken   The API token associated with the GitHub account.
-     * @param string $repository The repository of the system under test (SUT) on GitHub.
-     * @param string $printTicketChanges Boolean flag to print the ticket state
-     * changes in the test result.
-     * @throws RuntimeException
-     */
-    public function __construct($username, $apiToken, $repository, $printTicketStateChanges = FALSE)
-    {
-        if (!extension_loaded('curl')) {
-            throw new RuntimeException('ext/curl is not available');
-        }
-
-        if (!extension_loaded('json')) {
-            throw new RuntimeException('ext/json is not available');
-        }
-
-        $this->username                = $username;
-        $this->apiToken                = $apiToken;
-        $this->repository              = $repository;
-        $this->printTicketStateChanges = $printTicketStateChanges;
-    }
-
-    /**
-     * @param  integer $ticketId
-     * @return string
-     * @throws RuntimeException
-     */
-    public function getTicketInfo($ticketId = NULL)
-    {
-        if (!is_numeric($ticketId)) {
-            return array('status' => 'invalid_ticket_id');
-        }
-
-        $ticket = $this->callGitHub(
-          $this->apiPath . '/show/' . $this->username . '/' .
-          $this->repository . '/' . $ticketId,
-          TRUE
-        );
-
-        if ($ticket['state'] === 'open') {
-            return array('status' => 'new');
-        }
-
-        if ($ticket['state'] === 'closed') {
-            return array('status' => 'closed');
-        }
-
-        if ($ticket['state'] === 'unknown_ticket') {
-            return array('status' => 'unknown_ticket');
-        }
-    }
-
-    /**
-     * @param string $ticketId   The ticket number of the ticket under test (TUT).
-     * @param string $statusToBe The status of the TUT after running the associated test.
-     * @param string $message    The additional message for the TUT.
-     * @param string $resolution The resolution for the TUT.
-     * @throws RuntimeException
-     */
-    protected function updateTicket($ticketId, $statusToBe, $message, $resolution)
-    {
-        $acceptedResponseIssueStates = array('open', 'closed');
-
-        if ($statusToBe === self::STATUS_CLOSE) {
-            $apiEndpoint = $this->apiPath . '/close/' .
-                           $this->username . '/' . $this->repository . '/' .
-                           $ticketId;
-        }
-
-        else if ($statusToBe === self::STATUS_REOPEN) {
-            $apiEndpoint = $this->apiPath . '/reopen/' .
-                           $this->username . '/' . $this->repository . '/' .
-                           $ticketId;
-        }
-
-        if (isset($apiEndpoint)) {
-            $ticket = $this->callGitHub($apiEndpoint);
-
-            if (!in_array($ticket['state'], $acceptedResponseIssueStates)) {
-                throw new RuntimeException(
-                  'Received an unaccepted issue state from the GitHub Api'
-                );
-            }
-
-            if ($this->printTicketStateChanges) {
-                printf(
-                  "\nUpdating GitHub issue #%d, status: %s\n",
-                  $ticketId,
-                  $statusToBe
-                );
-            }
-        }
-    }
-
-    /**
-     * @param string  $apiEndpoint API endpoint to call against the GitHub issue API.
-     * @param boolean $isShowMethodCall Show method of the GitHub issue API is called?
-     * @return array
-     * @throws RuntimeException
-     */
-    private function callGitHub($apiEndpoint, $isShowMethodCall = FALSE)
-    {
-        $curlHandle = curl_init();
-
-        curl_setopt($curlHandle, CURLOPT_URL, $apiEndpoint);
-        curl_setopt($curlHandle, CURLOPT_FOLLOWLOCATION, TRUE);
-        curl_setopt($curlHandle, CURLOPT_FAILONERROR, TRUE);
-        curl_setopt($curlHandle, CURLOPT_FRESH_CONNECT, TRUE);
-        curl_setopt($curlHandle, CURLOPT_RETURNTRANSFER, TRUE);
-        curl_setopt($curlHandle, CURLOPT_HTTPPROXYTUNNEL, TRUE);
-        curl_setopt($curlHandle, CURLOPT_USERAGENT, __CLASS__);
-        curl_setopt(
-          $curlHandle,
-          CURLOPT_POSTFIELDS,
-          'login=' . $this->username . '&token=' . $this->apiToken
-        );
-
-        $response = curl_exec($curlHandle);
-
-        if (!$response && $isShowMethodCall) {
-            return array('state' => 'unknown_ticket');
-        }
-
-        if (!$response) {
-            throw new RuntimeException(curl_error($curlHandle));
-        }
-
-        curl_close($curlHandle);
-
-        $issue = (array)json_decode($response);
-
-        return (array)$issue['issue'];
-    }
-}
diff --git a/tests/PHPUnit/Extensions/TicketListener/GoogleCode.php b/tests/PHPUnit/Extensions/TicketListener/GoogleCode.php
deleted file mode 100644
index 4bd02f3..0000000
--- a/tests/PHPUnit/Extensions/TicketListener/GoogleCode.php
+++ /dev/null
@@ -1,271 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Extensions_TicketListener
- * @author     Jan Sorgalla <jsorgalla@googlemail.com>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * A ticket listener that interacts with the GoogleCode issue API.
- *
- * @package    PHPUnit
- * @subpackage Extensions_TicketListener
- * @author     Jan Sorgalla <jsorgalla@googlemail.com>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.5.0
- */
-class PHPUnit_Extensions_TicketListener_GoogleCode extends PHPUnit_Extensions_TicketListener
-{
-    private $email;
-    private $password;
-    private $project;
-
-    private $statusClosed;
-    private $statusReopened;
-
-    private $printTicketStateChanges;
-
-    private $authUrl    = 'https://www.google.com/accounts/ClientLogin';
-    private $apiBaseUrl = 'http://code.google.com/feeds/issues/p/%s/issues';
-    private $authToken;
-
-    /**
-     * @param string $email          The email associated with the Google account.
-     * @param string $password       The password associated with the Google account.
-     * @param string $project        The project name of the system under test (SUT) on Google Code.
-     * @param string $printTicketChanges Boolean flag to print the ticket state changes in the test result.
-     * @param string $statusClosed   The status name of the closed state.
-     * @param string $statusReopened The status name of the reopened state.
-     * @throws RuntimeException
-     */
-    public function __construct($email, $password, $project, $printTicketStateChanges = FALSE, $statusClosed = 'Fixed', $statusReopened = 'Started')
-    {
-        if (!extension_loaded('curl')) {
-            throw new RuntimeException('ext/curl is not available');
-        }
-
-        $this->email                   = $email;
-        $this->password                = $password;
-        $this->project                 = $project;
-        $this->statusClosed            = $statusClosed;
-        $this->statusReopened          = $statusReopened;
-        $this->printTicketStateChanges = $printTicketStateChanges;
-        $this->apiBaseUrl              = sprintf($this->apiBaseUrl, $project);
-    }
-
-    /**
-     * @param  integer $ticketId
-     * @return array
-     * @throws RuntimeException
-     */
-    public function getTicketInfo($ticketId = NULL)
-    {
-        if (!is_numeric($ticketId)) {
-            return array('status' => 'invalid_ticket_id');
-        }
-
-        $url    = $this->apiBaseUrl . '/full/' . $ticketId;
-        $header = array(
-          'Authorization: GoogleLogin auth=' . $this->getAuthToken()
-        );
-
-        list($status, $response) = $this->callGoogleCode($url, $header);
-
-        if ($status != 200 || !$response) {
-            return array('state' => 'unknown_ticket');
-        }
-
-        $ticket = new SimpleXMLElement(str_replace("xmlns=", "ns=", $response));
-        $result = $ticket->xpath('//issues:state');
-        $state  = (string)$result[0];
-
-        if ($state === 'open') {
-            return array('status' => 'new');
-        }
-
-        if ($state === 'closed') {
-            return array('status' => 'closed');
-        }
-
-        return array('status' => $state);
-    }
-
-    /**
-     * @param string $ticketId   The ticket number of the ticket under test (TUT).
-     * @param string $statusToBe The status of the TUT after running the associated test.
-     * @param string $message    The additional message for the TUT.
-     * @param string $resolution The resolution for the TUT.
-     * @throws RuntimeException
-     */
-    protected function updateTicket($ticketId, $statusToBe, $message, $resolution)
-    {
-        $url = $this->apiBaseUrl . '/' . $ticketId . '/comments/full';
-
-        $header = array(
-          'Authorization: GoogleLogin auth=' . $this->getAuthToken(),
-          'Content-Type: application/atom+xml'
-        );
-
-        if ($statusToBe == 'closed') {
-            $ticketStatus = $this->statusClosed;
-        } else {
-            $ticketStatus = $this->statusReopened;
-        }
-
-        list($author,) = explode('@', $this->email);
-
-        $post = '<?xml version="1.0" encoding="UTF-8"?>' .
-                '<entry xmlns="http://www.w3.org/2005/Atom" ' .
-                '       xmlns:issues="http://schemas.google.com/projecthosting/issues/2009">' .
-                '  <content type="html">' . htmlspecialchars($message, ENT_COMPAT, 'UTF-8') . '</content>' .
-                '  <author>' .
-                '    <name>' . htmlspecialchars($author, ENT_COMPAT, 'UTF-8') . '</name>' .
-                '  </author>' .
-                '  <issues:updates>' .
-                '    <issues:status>' . htmlspecialchars($ticketStatus, ENT_COMPAT, 'UTF-8') . '</issues:status>' .
-                '  </issues:updates>' .
-                '</entry>';
-
-        list($status, $response) = $this->callGoogleCode($url, $header, $post);
-
-        if ($status != 201) {
-            throw new RuntimeException('Updating GoogleCode issue failed with status code ' . $status);
-        }
-
-        if ($this->printTicketStateChanges) {
-            printf(
-                "\nUpdating GoogleCode issue #%d, status: %s\n",
-                $ticketId,
-                $statusToBe
-            );
-        }
-    }
-
-    /**
-     * @return string The auth token
-     * @throws RuntimeException
-     */
-    private function getAuthToken()
-    {
-        if (NULL !== $this->authToken) {
-            return $this->authToken;
-        }
-
-        $header = array(
-            'Content-Type: application/x-www-form-urlencoded',
-        );
-
-        $post = array(
-            'accountType' => 'GOOGLE',
-            'Email'       => $this->email,
-            'Passwd'      => $this->password,
-            'service'     => 'code',
-            'source'      => 'PHPUnit-TicketListener_GoogleCode-' . PHPUnit_Runner_Version::id(),
-        );
-
-        list($status, $response) = $this->callGoogleCode(
-            $this->authUrl,
-            $header,
-            http_build_query($post, NULL, '&')
-        );
-
-        if ($status != 200) {
-            throw new RuntimeException('Google account authentication failed');
-        }
-
-        foreach (explode("\n", $response) as $line) {
-            if (strpos(trim($line), 'Auth') === 0) {
-                list($name, $token) = explode('=', $line);
-                $this->authToken    = trim($token);
-                break;
-            }
-        }
-
-        if (NULL === $this->authToken) {
-            throw new RuntimeException('Could not detect auth token in response');
-        }
-
-        return $this->authToken;
-    }
-
-    /**
-     * @param string  $url URL to call
-     * @param array   $header Header
-     * @param string  $post Post data
-     * @return array
-     */
-    private function callGoogleCode($url, array $header = NULL, $post = NULL)
-    {
-        $curlHandle = curl_init();
-
-        curl_setopt($curlHandle, CURLOPT_URL, $url);
-        curl_setopt($curlHandle, CURLOPT_FOLLOWLOCATION, TRUE);
-        curl_setopt($curlHandle, CURLOPT_FAILONERROR, TRUE);
-        curl_setopt($curlHandle, CURLOPT_FRESH_CONNECT, TRUE);
-        curl_setopt($curlHandle, CURLOPT_RETURNTRANSFER, TRUE);
-        curl_setopt($curlHandle, CURLOPT_HTTPPROXYTUNNEL, TRUE);
-        curl_setopt($curlHandle, CURLOPT_USERAGENT, __CLASS__);
-        curl_setopt($curlHandle, CURLOPT_SSL_VERIFYPEER, FALSE);
-
-        if (NULL !== $header) {
-            curl_setopt($curlHandle, CURLOPT_HTTPHEADER, $header);
-        }
-
-        if (NULL !== $post) {
-            curl_setopt($curlHandle, CURLOPT_POST, TRUE);
-            curl_setopt($curlHandle, CURLOPT_POSTFIELDS, $post);
-        }
-
-        $response = curl_exec($curlHandle);
-        $status   = curl_getinfo($curlHandle, CURLINFO_HTTP_CODE);
-
-        if (!$response) {
-            throw new RuntimeException(curl_error($curlHandle));
-        }
-
-        curl_close($curlHandle);
-
-        return array($status, $response);
-    }
-}
diff --git a/tests/PHPUnit/Framework.php b/tests/PHPUnit/Framework.php
deleted file mode 100644
index 8db2a72..0000000
--- a/tests/PHPUnit/Framework.php
+++ /dev/null
@@ -1,50 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-require_once 'PHP/CodeCoverage/Filter.php';
-PHP_CodeCoverage_Filter::getInstance()->addFileToBlacklist(__FILE__, 'PHPUNIT');
-
-trigger_error(
-  'Please no longer include "PHPUnit/Framework.php".', E_USER_NOTICE
-);
diff --git a/tests/PHPUnit/Framework/Assert.php b/tests/PHPUnit/Framework/Assert.php
deleted file mode 100644
index c12b966..0000000
--- a/tests/PHPUnit/Framework/Assert.php
+++ /dev/null
@@ -1,2595 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A set of assert methods.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-abstract class PHPUnit_Framework_Assert
-{
-    /**
-     * @var integer
-     */
-    private static $count = 0;
-
-    /**
-     * Asserts that an array has a specified key.
-     *
-     * @param  mixed  $key
-     * @param  array  $array
-     * @param  string $message
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertArrayHasKey($key, array $array, $message = '')
-    {
-        if (!(is_integer($key) || is_string($key))) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              1, 'integer or string'
-            );
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_ArrayHasKey($key);
-
-        self::assertThat($array, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an array does not have a specified key.
-     *
-     * @param  mixed  $key
-     * @param  array  $array
-     * @param  string $message
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertArrayNotHasKey($key, array $array, $message = '')
-    {
-        if (!(is_integer($key) || is_string($key))) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              1, 'integer or string'
-            );
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_ArrayHasKey($key)
-        );
-
-        self::assertThat($array, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a haystack contains a needle.
-     *
-     * @param  mixed   $needle
-     * @param  mixed   $haystack
-     * @param  string  $message
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 2.1.0
-     */
-    public static function assertContains($needle, $haystack, $message = '', $ignoreCase = FALSE)
-    {
-        if (is_array($haystack) ||
-            is_object($haystack) && $haystack instanceof Traversable) {
-            $constraint = new PHPUnit_Framework_Constraint_TraversableContains(
-              $needle
-            );
-        }
-
-        else if (is_string($haystack)) {
-            $constraint = new PHPUnit_Framework_Constraint_StringContains(
-              $needle, $ignoreCase
-            );
-        }
-
-        else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              2, 'array, iterator or string'
-            );
-        }
-
-        self::assertThat($haystack, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a haystack that is stored in a static attribute of a class
-     * or an attribute of an object contains a needle.
-     *
-     * @param  mixed   $needle
-     * @param  string  $haystackAttributeName
-     * @param  mixed   $haystackClassOrObject
-     * @param  string  $message
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertAttributeContains($needle, $haystackAttributeName, $haystackClassOrObject, $message = '', $ignoreCase = FALSE)
-    {
-        self::assertContains(
-          $needle,
-          self::readAttribute($haystackClassOrObject, $haystackAttributeName),
-          $message,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that a haystack does not contain a needle.
-     *
-     * @param  mixed   $needle
-     * @param  mixed   $haystack
-     * @param  string  $message
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 2.1.0
-     */
-    public static function assertNotContains($needle, $haystack, $message = '', $ignoreCase = FALSE)
-    {
-        if (is_array($haystack) ||
-            is_object($haystack) && $haystack instanceof Traversable) {
-            $constraint = new PHPUnit_Framework_Constraint_Not(
-              new PHPUnit_Framework_Constraint_TraversableContains($needle)
-            );
-        }
-
-        else if (is_string($haystack)) {
-            $constraint = new PHPUnit_Framework_Constraint_Not(
-              new PHPUnit_Framework_Constraint_StringContains(
-                $needle, $ignoreCase
-              )
-            );
-        }
-
-        else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              2, 'array, iterator or string'
-            );
-        }
-
-        self::assertThat($haystack, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a haystack that is stored in a static attribute of a class
-     * or an attribute of an object does not contain a needle.
-     *
-     * @param  mixed   $needle
-     * @param  string  $haystackAttributeName
-     * @param  mixed   $haystackClassOrObject
-     * @param  string  $message
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertAttributeNotContains($needle, $haystackAttributeName, $haystackClassOrObject, $message = '', $ignoreCase = FALSE)
-    {
-        self::assertNotContains(
-          $needle,
-          self::readAttribute($haystackClassOrObject, $haystackAttributeName),
-          $message,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that a haystack contains only values of a given type.
-     *
-     * @param  string  $type
-     * @param  mixed   $haystack
-     * @param  boolean $isNativeType
-     * @param  string  $message
-     * @since  Method available since Release 3.1.4
-     */
-    public static function assertContainsOnly($type, $haystack, $isNativeType = NULL, $message = '')
-    {
-        if (!(is_array($haystack) ||
-            is_object($haystack) && $haystack instanceof Traversable)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              2, 'array or iterator'
-            );
-        }
-
-        if ($isNativeType == NULL) {
-            $isNativeType = PHPUnit_Util_Type::isType($type);
-        }
-
-        self::assertThat(
-          $haystack,
-          new PHPUnit_Framework_Constraint_TraversableContainsOnly(
-            $type, $isNativeType
-          ),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a haystack that is stored in a static attribute of a class
-     * or an attribute of an object contains only values of a given type.
-     *
-     * @param  string  $type
-     * @param  string  $haystackAttributeName
-     * @param  mixed   $haystackClassOrObject
-     * @param  boolean $isNativeType
-     * @param  string  $message
-     * @since  Method available since Release 3.1.4
-     */
-    public static function assertAttributeContainsOnly($type, $haystackAttributeName, $haystackClassOrObject, $isNativeType = NULL, $message = '')
-    {
-        self::assertContainsOnly(
-          $type,
-          self::readAttribute($haystackClassOrObject, $haystackAttributeName),
-          $isNativeType,
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a haystack does not contain only values of a given type.
-     *
-     * @param  string  $type
-     * @param  mixed   $haystack
-     * @param  boolean $isNativeType
-     * @param  string  $message
-     * @since  Method available since Release 3.1.4
-     */
-    public static function assertNotContainsOnly($type, $haystack, $isNativeType = NULL, $message = '')
-    {
-        if (!(is_array($haystack) ||
-            is_object($haystack) && $haystack instanceof Traversable)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              2, 'array or iterator'
-            );
-        }
-
-        if ($isNativeType == NULL) {
-            $isNativeType = PHPUnit_Util_Type::isType($type);
-        }
-
-        self::assertThat(
-          $haystack,
-          new PHPUnit_Framework_Constraint_Not(
-            new PHPUnit_Framework_Constraint_TraversableContainsOnly(
-              $type, $isNativeType
-            )
-          ),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a haystack that is stored in a static attribute of a class
-     * or an attribute of an object does not contain only values of a given
-     * type.
-     *
-     * @param  string  $type
-     * @param  string  $haystackAttributeName
-     * @param  mixed   $haystackClassOrObject
-     * @param  boolean $isNativeType
-     * @param  string  $message
-     * @since  Method available since Release 3.1.4
-     */
-    public static function assertAttributeNotContainsOnly($type, $haystackAttributeName, $haystackClassOrObject, $isNativeType = NULL, $message = '')
-    {
-        self::assertNotContainsOnly(
-          $type,
-          self::readAttribute($haystackClassOrObject, $haystackAttributeName),
-          $isNativeType,
-          $message
-        );
-    }
-
-    /**
-     * Asserts that two variables are equal.
-     *
-     * @param  mixed   $expected
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @param  float   $delta
-     * @param  integer $maxDepth
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     */
-    public static function assertEquals($expected, $actual, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        $constraint = new PHPUnit_Framework_Constraint_IsEqual(
-          $expected, $delta, $maxDepth, $canonicalize, $ignoreCase
-        );
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a variable is equal to an attribute of an object.
-     *
-     * @param  mixed   $expected
-     * @param  string  $actualAttributeName
-     * @param  string  $actualClassOrObject
-     * @param  string  $message
-     * @param  float   $delta
-     * @param  integer $maxDepth
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     */
-    public static function assertAttributeEquals($expected, $actualAttributeName, $actualClassOrObject, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        self::assertEquals(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message,
-          $delta,
-          $maxDepth,
-          $canonicalize,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that two variables are not equal.
-     *
-     * @param  mixed   $expected
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @param  float   $delta
-     * @param  integer $maxDepth
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 2.3.0
-     */
-    public static function assertNotEquals($expected, $actual, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_IsEqual(
-            $expected, $delta, $maxDepth, $canonicalize, $ignoreCase
-          )
-        );
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a variable is not equal to an attribute of an object.
-     *
-     * @param  mixed   $expected
-     * @param  string  $actualAttributeName
-     * @param  string  $actualClassOrObject
-     * @param  string  $message
-     * @param  float   $delta
-     * @param  integer $maxDepth
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     */
-    public static function assertAttributeNotEquals($expected, $actualAttributeName, $actualClassOrObject, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        self::assertNotEquals(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message,
-          $delta,
-          $maxDepth,
-          $canonicalize,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that a variable is empty.
-     *
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @throws PHPUnit_Framework_AssertionFailedError
-     */
-    public static function assertEmpty($actual, $message = '')
-    {
-        self::assertThat($actual, self::isEmpty(), $message);
-    }
-
-    /**
-     * Asserts that a static attribute of a class or an attribute of an object
-     * is empty.
-     *
-     * @param string $haystackAttributeName
-     * @param mixed  $haystackClassOrObject
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertAttributeEmpty($haystackAttributeName, $haystackClassOrObject, $message = '')
-    {
-        self::assertEmpty(
-          self::readAttribute($haystackClassOrObject, $haystackAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a variable is not empty.
-     *
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @throws PHPUnit_Framework_AssertionFailedError
-     */
-    public static function assertNotEmpty($actual, $message = '')
-    {
-        self::assertThat($actual, self::logicalNot(self::isEmpty()), $message);
-    }
-
-    /**
-     * Asserts that a static attribute of a class or an attribute of an object
-     * is not empty.
-     *
-     * @param string $haystackAttributeName
-     * @param mixed  $haystackClassOrObject
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertAttributeNotEmpty($haystackAttributeName, $haystackClassOrObject, $message = '')
-    {
-        self::assertNotEmpty(
-          self::readAttribute($haystackClassOrObject, $haystackAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a value is greater than another value.
-     *
-     * @param  mixed   $expected
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertGreaterThan($expected, $actual, $message = '')
-    {
-        self::assertThat($actual, self::greaterThan($expected), $message);
-    }
-
-    /**
-     * Asserts that an attribute is greater than another value.
-     *
-     * @param  mixed   $expected
-     * @param  string  $actualAttributeName
-     * @param  string  $actualClassOrObject
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertAttributeGreaterThan($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-    {
-        self::assertGreaterThan(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a value is greater than or equal to another value.
-     *
-     * @param  mixed   $expected
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertGreaterThanOrEqual($expected, $actual, $message = '')
-    {
-        self::assertThat(
-          $actual, self::greaterThanOrEqual($expected), $message
-        );
-    }
-
-    /**
-     * Asserts that an attribute is greater than or equal to another value.
-     *
-     * @param  mixed   $expected
-     * @param  string  $actualAttributeName
-     * @param  string  $actualClassOrObject
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertAttributeGreaterThanOrEqual($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-    {
-        self::assertGreaterThanOrEqual(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a value is smaller than another value.
-     *
-     * @param  mixed   $expected
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertLessThan($expected, $actual, $message = '')
-    {
-        self::assertThat($actual, self::lessThan($expected), $message);
-    }
-
-    /**
-     * Asserts that an attribute is smaller than another value.
-     *
-     * @param  mixed   $expected
-     * @param  string  $actualAttributeName
-     * @param  string  $actualClassOrObject
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertAttributeLessThan($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-    {
-        self::assertLessThan(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a value is smaller than or equal to another value.
-     *
-     * @param  mixed   $expected
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertLessThanOrEqual($expected, $actual, $message = '')
-    {
-        self::assertThat($actual, self::lessThanOrEqual($expected), $message);
-    }
-
-    /**
-     * Asserts that an attribute is smaller than or equal to another value.
-     *
-     * @param  mixed   $expected
-     * @param  string  $actualAttributeName
-     * @param  string  $actualClassOrObject
-     * @param  string  $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertAttributeLessThanOrEqual($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-    {
-        self::assertLessThanOrEqual(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that the contents of one file is equal to the contents of another
-     * file.
-     *
-     * @param  string  $expected
-     * @param  string  $actual
-     * @param  string  $message
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 3.2.14
-     */
-    public static function assertFileEquals($expected, $actual, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        self::assertFileExists($expected, $message);
-        self::assertFileExists($actual, $message);
-
-        self::assertEquals(
-          file_get_contents($expected),
-          file_get_contents($actual),
-          $message,
-          0,
-          10,
-          $canonicalize,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that the contents of one file is not equal to the contents of
-     * another file.
-     *
-     * @param  string  $expected
-     * @param  string  $actual
-     * @param  string  $message
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 3.2.14
-     */
-    public static function assertFileNotEquals($expected, $actual, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        self::assertFileExists($expected, $message);
-        self::assertFileExists($actual, $message);
-
-        self::assertNotEquals(
-          file_get_contents($expected),
-          file_get_contents($actual),
-          $message,
-          0,
-          10,
-          $canonicalize,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that the contents of a string is equal
-     * to the contents of a file.
-     *
-     * @param  string  $expectedFile
-     * @param  string  $actualString
-     * @param  string  $message
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 3.3.0
-     */
-    public static function assertStringEqualsFile($expectedFile, $actualString, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        self::assertFileExists($expectedFile, $message);
-
-        self::assertEquals(
-          file_get_contents($expectedFile),
-          $actualString,
-          $message,
-          0,
-          10,
-          $canonicalize,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that the contents of a string is not equal
-     * to the contents of a file.
-     *
-     * @param  string  $expectedFile
-     * @param  string  $actualString
-     * @param  string  $message
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     * @since  Method available since Release 3.3.0
-     */
-    public static function assertStringNotEqualsFile($expectedFile, $actualString, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        self::assertFileExists($expectedFile, $message);
-
-        self::assertNotEquals(
-          file_get_contents($expectedFile),
-          $actualString,
-          $message,
-          0,
-          10,
-          $canonicalize,
-          $ignoreCase
-        );
-    }
-
-    /**
-     * Asserts that a file exists.
-     *
-     * @param  string $filename
-     * @param  string $message
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertFileExists($filename, $message = '')
-    {
-        if (!is_string($filename)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_FileExists;
-
-        self::assertThat($filename, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a file does not exist.
-     *
-     * @param  string $filename
-     * @param  string $message
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertFileNotExists($filename, $message = '')
-    {
-        if (!is_string($filename)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_FileExists
-        );
-
-        self::assertThat($filename, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a condition is true.
-     *
-     * @param  boolean $condition
-     * @param  string  $message
-     * @throws PHPUnit_Framework_AssertionFailedError
-     */
-    public static function assertTrue($condition, $message = '')
-    {
-        self::assertThat($condition, self::isTrue(), $message);
-    }
-
-    /**
-     * Asserts that a condition is false.
-     *
-     * @param  boolean  $condition
-     * @param  string   $message
-     * @throws PHPUnit_Framework_AssertionFailedError
-     */
-    public static function assertFalse($condition, $message = '')
-    {
-        self::assertThat($condition, self::isFalse(), $message);
-    }
-
-    /**
-     * Asserts that a variable is not NULL.
-     *
-     * @param  mixed  $actual
-     * @param  string $message
-     */
-    public static function assertNotNull($actual, $message = '')
-    {
-        self::assertThat($actual, self::logicalNot(self::isNull()), $message);
-    }
-
-    /**
-     * Asserts that a variable is NULL.
-     *
-     * @param  mixed  $actual
-     * @param  string $message
-     */
-    public static function assertNull($actual, $message = '')
-    {
-        self::assertThat($actual, self::isNull(), $message);
-    }
-
-    /**
-     * Asserts that a class has a specified attribute.
-     *
-     * @param  string $attributeName
-     * @param  string $className
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertClassHasAttribute($attributeName, $className, $message = '')
-    {
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($className) || !class_exists($className, FALSE)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'class name');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_ClassHasAttribute(
-          $attributeName
-        );
-
-        self::assertThat($className, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a class does not have a specified attribute.
-     *
-     * @param  string $attributeName
-     * @param  string $className
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertClassNotHasAttribute($attributeName, $className, $message = '')
-    {
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($className) || !class_exists($className, FALSE)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'class name');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_ClassHasAttribute($attributeName)
-        );
-
-        self::assertThat($className, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a class has a specified static attribute.
-     *
-     * @param  string $attributeName
-     * @param  string $className
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertClassHasStaticAttribute($attributeName, $className, $message = '')
-    {
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($className) || !class_exists($className, FALSE)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'class name');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_ClassHasStaticAttribute(
-          $attributeName
-        );
-
-        self::assertThat($className, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a class does not have a specified static attribute.
-     *
-     * @param  string $attributeName
-     * @param  string $className
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertClassNotHasStaticAttribute($attributeName, $className, $message = '')
-    {
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($className) || !class_exists($className, FALSE)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'class name');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_ClassHasStaticAttribute(
-            $attributeName
-          )
-        );
-
-        self::assertThat($className, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an object has a specified attribute.
-     *
-     * @param  string $attributeName
-     * @param  object $object
-     * @param  string $message
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertObjectHasAttribute($attributeName, $object, $message = '')
-    {
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_object($object)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'object');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_ObjectHasAttribute(
-          $attributeName
-        );
-
-        self::assertThat($object, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an object does not have a specified attribute.
-     *
-     * @param  string $attributeName
-     * @param  object $object
-     * @param  string $message
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertObjectNotHasAttribute($attributeName, $object, $message = '')
-    {
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_object($object)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'object');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_ObjectHasAttribute($attributeName)
-        );
-
-        self::assertThat($object, $constraint, $message);
-    }
-
-    /**
-     * Asserts that two variables have the same type and value.
-     * Used on objects, it asserts that two variables reference
-     * the same object.
-     *
-     * @param  mixed  $expected
-     * @param  mixed  $actual
-     * @param  string $message
-     */
-    public static function assertSame($expected, $actual, $message = '')
-    {
-        if (is_bool($expected) && is_bool($actual)) {
-            self::assertEquals($expected, $actual, $message);
-        } else {
-            $constraint = new PHPUnit_Framework_Constraint_IsIdentical(
-              $expected
-            );
-
-            self::assertThat($actual, $constraint, $message);
-        }
-    }
-
-    /**
-     * Asserts that a variable and an attribute of an object have the same type
-     * and value.
-     *
-     * @param  mixed  $expected
-     * @param  string $actualAttributeName
-     * @param  object $actualClassOrObject
-     * @param  string $message
-     */
-    public static function assertAttributeSame($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-    {
-        self::assertSame(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that two variables do not have the same type and value.
-     * Used on objects, it asserts that two variables do not reference
-     * the same object.
-     *
-     * @param  mixed  $expected
-     * @param  mixed  $actual
-     * @param  string $message
-     */
-    public static function assertNotSame($expected, $actual, $message = '')
-    {
-        if (is_bool($expected) && is_bool($actual)) {
-            self::assertNotEquals($expected, $actual, $message);
-        } else {
-            $constraint = new PHPUnit_Framework_Constraint_Not(
-              new PHPUnit_Framework_Constraint_IsIdentical($expected)
-            );
-
-            self::assertThat($actual, $constraint, $message);
-        }
-    }
-
-    /**
-     * Asserts that a variable and an attribute of an object do not have the
-     * same type and value.
-     *
-     * @param  mixed  $expected
-     * @param  string $actualAttributeName
-     * @param  object $actualClassOrObject
-     * @param  string $message
-     */
-    public static function assertAttributeNotSame($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-    {
-        self::assertNotSame(
-          $expected,
-          self::readAttribute($actualClassOrObject, $actualAttributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a variable is of a given type.
-     *
-     * @param string $expected
-     * @param mixed  $actual
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertInstanceOf($expected, $actual, $message = '')
-    {
-        if (is_string($expected)) {
-            if (class_exists($expected) || interface_exists($expected)) {
-                $constraint = new PHPUnit_Framework_Constraint_IsInstanceOf(
-                  $expected
-                );
-            }
-
-            else {
-                throw PHPUnit_Util_InvalidArgumentHelper::factory(
-                  1, 'class or interface name'
-                );
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an attribute is of a given type.
-     *
-     * @param string $expected
-     * @param string $attributeName
-     * @param mixed  $classOrObject
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertAttributeInstanceOf($expected, $attributeName, $classOrObject, $message = '')
-    {
-        self::assertInstanceOf(
-          $expected,
-          self::readAttribute($classOrObject, $attributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a variable is not of a given type.
-     *
-     * @param string $expected
-     * @param mixed  $actual
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertNotInstanceOf($expected, $actual, $message = '')
-    {
-        if (is_string($expected)) {
-            if (class_exists($expected) || interface_exists($expected)) {
-                $constraint = new PHPUnit_Framework_Constraint_Not(
-                  new PHPUnit_Framework_Constraint_IsInstanceOf($expected)
-                );
-            }
-
-            else {
-                throw PHPUnit_Util_InvalidArgumentHelper::factory(
-                  1, 'class or interface name'
-                );
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an attribute is of a given type.
-     *
-     * @param string $expected
-     * @param string $attributeName
-     * @param mixed  $classOrObject
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertAttributeNotInstanceOf($expected, $attributeName, $classOrObject, $message = '')
-    {
-        self::assertNotInstanceOf(
-          $expected,
-          self::readAttribute($classOrObject, $attributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a variable is of a given type.
-     *
-     * @param string $expected
-     * @param mixed  $actual
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertInternalType($expected, $actual, $message = '')
-    {
-        if (is_string($expected)) {
-            $constraint = new PHPUnit_Framework_Constraint_IsType(
-              $expected
-            );
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an attribute is of a given type.
-     *
-     * @param string $expected
-     * @param string $attributeName
-     * @param mixed  $classOrObject
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertAttributeInternalType($expected, $attributeName, $classOrObject, $message = '')
-    {
-        self::assertInternalType(
-          $expected,
-          self::readAttribute($classOrObject, $attributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a variable is not of a given type.
-     *
-     * @param string $expected
-     * @param mixed  $actual
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertNotInternalType($expected, $actual, $message = '')
-    {
-        if (is_string($expected)) {
-            $constraint = new PHPUnit_Framework_Constraint_Not(
-              new PHPUnit_Framework_Constraint_IsType($expected)
-            );
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an attribute is of a given type.
-     *
-     * @param string $expected
-     * @param string $attributeName
-     * @param mixed  $classOrObject
-     * @param string $message
-     * @since Method available since Release 3.5.0
-     */
-    public static function assertAttributeNotInternalType($expected, $attributeName, $classOrObject, $message = '')
-    {
-        self::assertNotInternalType(
-          $expected,
-          self::readAttribute($classOrObject, $attributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a variable is of a given type.
-     *
-     * @param  string $expected
-     * @param  mixed  $actual
-     * @param  string $message
-     */
-    public static function assertType($expected, $actual, $message = '')
-    {
-        if (is_string($expected)) {
-            if (PHPUnit_Util_Type::isType($expected)) {
-                if (class_exists($expected) || interface_exists($expected)) {
-                    throw new InvalidArgumentException(
-                      sprintf('"%s" is ambigious', $expected)
-                    );
-                }
-
-                $constraint = new PHPUnit_Framework_Constraint_IsType(
-                  $expected
-                );
-            }
-
-            else if (class_exists($expected) || interface_exists($expected)) {
-                $constraint = new PHPUnit_Framework_Constraint_IsInstanceOf(
-                  $expected
-                );
-            }
-
-            else {
-                throw PHPUnit_Util_InvalidArgumentHelper::factory(
-                  1, 'class or interface name'
-                );
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an attribute is of a given type.
-     *
-     * @param  string  $expected
-     * @param  string  $attributeName
-     * @param  mixed   $classOrObject
-     * @param  string  $message
-     * @since  Method available since Release 3.4.0
-     */
-    public static function assertAttributeType($expected, $attributeName, $classOrObject, $message = '')
-    {
-        self::assertType(
-          $expected,
-          self::readAttribute($classOrObject, $attributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a variable is not of a given type.
-     *
-     * @param  string $expected
-     * @param  mixed  $actual
-     * @param  string $message
-     * @since  Method available since Release 2.2.0
-     */
-    public static function assertNotType($expected, $actual, $message = '')
-    {
-        if (is_string($expected)) {
-            if (PHPUnit_Util_Type::isType($expected)) {
-                if (class_exists($expected) || interface_exists($expected)) {
-                    throw new InvalidArgumentException(
-                      sprintf('"%s" is ambigious', $expected)
-                    );
-                }
-
-                $constraint = new PHPUnit_Framework_Constraint_Not(
-                  new PHPUnit_Framework_Constraint_IsType($expected)
-                );
-            }
-
-            else if (class_exists($expected) || interface_exists($expected)) {
-                $constraint = new PHPUnit_Framework_Constraint_Not(
-                  new PHPUnit_Framework_Constraint_IsInstanceOf($expected)
-                );
-            }
-
-            else {
-                throw PHPUnit_Util_InvalidArgumentHelper::factory(
-                  1, 'class or interface name'
-                );
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        self::assertThat($actual, $constraint, $message);
-    }
-
-    /**
-     * Asserts that an attribute is of a given type.
-     *
-     * @param  string  $expected
-     * @param  string  $attributeName
-     * @param  mixed   $classOrObject
-     * @param  string  $message
-     * @since  Method available since Release 3.4.0
-     */
-    public static function assertAttributeNotType($expected, $attributeName, $classOrObject, $message = '')
-    {
-        self::assertNotType(
-          $expected,
-          self::readAttribute($classOrObject, $attributeName),
-          $message
-        );
-    }
-
-    /**
-     * Asserts that a string matches a given regular expression.
-     *
-     * @param  string $pattern
-     * @param  string $string
-     * @param  string $message
-     */
-    public static function assertRegExp($pattern, $string, $message = '')
-    {
-        if (!is_string($pattern)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_PCREMatch($pattern);
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string does not match a given regular expression.
-     *
-     * @param  string $pattern
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 2.1.0
-     */
-    public static function assertNotRegExp($pattern, $string, $message = '')
-    {
-        if (!is_string($pattern)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_PCREMatch($pattern)
-        );
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string matches a given format string.
-     *
-     * @param  string $format
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.5.0
-     */
-    public static function assertStringMatchesFormat($format, $string, $message = '')
-    {
-        if (!is_string($format)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_StringMatches($format);
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string does not match a given format string.
-     *
-     * @param  string $format
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.5.0
-     */
-    public static function assertStringNotMatchesFormat($format, $string, $message = '')
-    {
-        if (!is_string($format)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_StringMatches($format)
-        );
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string matches a given format file.
-     *
-     * @param  string $formatFile
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.5.0
-     */
-    public static function assertStringMatchesFormatFile($formatFile, $string, $message = '')
-    {
-        self::assertFileExists($formatFile, $message);
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_StringMatches(
-          file_get_contents($formatFile)
-        );
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string does not match a given format string.
-     *
-     * @param  string $formatFile
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.5.0
-     */
-    public static function assertStringNotMatchesFormatFile($formatFile, $string, $message = '')
-    {
-        self::assertFileExists($formatFile, $message);
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_StringMatches(
-            file_get_contents($formatFile)
-          )
-        );
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string starts with a given prefix.
-     *
-     * @param  string $prefix
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.4.0
-     */
-    public static function assertStringStartsWith($prefix, $string, $message = '')
-    {
-        if (!is_string($prefix)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_StringStartsWith(
-          $prefix
-        );
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string starts not with a given prefix.
-     *
-     * @param  string $prefix
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.4.0
-     */
-    public static function assertStringStartsNotWith($prefix, $string, $message = '')
-    {
-        if (!is_string($prefix)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_StringStartsWith($prefix)
-        );
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string ends with a given prefix.
-     *
-     * @param  string $suffix
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.4.0
-     */
-    public static function assertStringEndsWith($suffix, $string, $message = '')
-    {
-        if (!is_string($suffix)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_StringEndsWith($suffix);
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that a string ends not with a given prefix.
-     *
-     * @param  string $suffix
-     * @param  string $string
-     * @param  string $message
-     * @since  Method available since Release 3.4.0
-     */
-    public static function assertStringEndsNotWith($suffix, $string, $message = '')
-    {
-        if (!is_string($suffix)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!is_string($string)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $constraint = new PHPUnit_Framework_Constraint_Not(
-          new PHPUnit_Framework_Constraint_StringEndsWith($suffix)
-        );
-
-        self::assertThat($string, $constraint, $message);
-    }
-
-    /**
-     * Asserts that two XML files are equal.
-     *
-     * @param  string $expectedFile
-     * @param  string $actualFile
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertXmlFileEqualsXmlFile($expectedFile, $actualFile, $message = '')
-    {
-        self::assertFileExists($expectedFile);
-        self::assertFileExists($actualFile);
-
-        $expected = new DOMDocument;
-        $expected->preserveWhiteSpace = FALSE;
-        $expected->load($expectedFile);
-
-        $actual = new DOMDocument;
-        $actual->preserveWhiteSpace = FALSE;
-        $actual->load($actualFile);
-
-        self::assertEquals($expected, $actual, $message);
-    }
-
-    /**
-     * Asserts that two XML files are not equal.
-     *
-     * @param  string $expectedFile
-     * @param  string $actualFile
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertXmlFileNotEqualsXmlFile($expectedFile, $actualFile, $message = '')
-    {
-        self::assertFileExists($expectedFile);
-        self::assertFileExists($actualFile);
-
-        $expected = new DOMDocument;
-        $expected->preserveWhiteSpace = FALSE;
-        $expected->load($expectedFile);
-
-        $actual = new DOMDocument;
-        $actual->preserveWhiteSpace = FALSE;
-        $actual->load($actualFile);
-
-        self::assertNotEquals($expected, $actual, $message);
-    }
-
-    /**
-     * Asserts that two XML documents are equal.
-     *
-     * @param  string $expectedFile
-     * @param  string $actualXml
-     * @param  string $message
-     * @since  Method available since Release 3.3.0
-     */
-    public static function assertXmlStringEqualsXmlFile($expectedFile, $actualXml, $message = '')
-    {
-        self::assertFileExists($expectedFile);
-
-        $expected = new DOMDocument;
-        $expected->preserveWhiteSpace = FALSE;
-        $expected->load($expectedFile);
-
-        $actual = new DOMDocument;
-        $actual->preserveWhiteSpace = FALSE;
-        $actual->loadXML($actualXml);
-
-        self::assertEquals($expected, $actual, $message);
-    }
-
-    /**
-     * Asserts that two XML documents are not equal.
-     *
-     * @param  string $expectedFile
-     * @param  string $actualXml
-     * @param  string $message
-     * @since  Method available since Release 3.3.0
-     */
-    public static function assertXmlStringNotEqualsXmlFile($expectedFile, $actualXml, $message = '')
-    {
-        self::assertFileExists($expectedFile);
-
-        $expected = new DOMDocument;
-        $expected->preserveWhiteSpace = FALSE;
-        $expected->load($expectedFile);
-
-        $actual = new DOMDocument;
-        $actual->preserveWhiteSpace = FALSE;
-        $actual->loadXML($actualXml);
-
-        self::assertNotEquals($expected, $actual, $message);
-    }
-
-    /**
-     * Asserts that two XML documents are equal.
-     *
-     * @param  string $expectedXml
-     * @param  string $actualXml
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertXmlStringEqualsXmlString($expectedXml, $actualXml, $message = '')
-    {
-        $expected = new DOMDocument;
-        $expected->preserveWhiteSpace = FALSE;
-        $expected->loadXML($expectedXml);
-
-        $actual = new DOMDocument;
-        $actual->preserveWhiteSpace = FALSE;
-        $actual->loadXML($actualXml);
-
-        self::assertEquals($expected, $actual, $message);
-    }
-
-    /**
-     * Asserts that two XML documents are not equal.
-     *
-     * @param  string $expectedXml
-     * @param  string $actualXml
-     * @param  string $message
-     * @since  Method available since Release 3.1.0
-     */
-    public static function assertXmlStringNotEqualsXmlString($expectedXml, $actualXml, $message = '')
-    {
-        $expected = new DOMDocument;
-        $expected->preserveWhiteSpace = FALSE;
-        $expected->loadXML($expectedXml);
-
-        $actual = new DOMDocument;
-        $actual->preserveWhiteSpace = FALSE;
-        $actual->loadXML($actualXml);
-
-        self::assertNotEquals($expected, $actual, $message);
-    }
-
-    /**
-     * Asserts that a hierarchy of DOMNodes matches.
-     *
-     * @param DOMNode $expectedNode
-     * @param DOMNode $actualNode
-     * @param boolean $checkAttributes
-     * @param string  $message
-     * @author Mattis Stordalen Flister <mattis@xait.no>
-     * @since  Method available since Release 3.3.0
-     */
-    public static function assertEqualXMLStructure(DOMNode $expectedNode, DOMNode $actualNode, $checkAttributes = FALSE, $message = '')
-    {
-        self::assertEquals(
-          $expectedNode->tagName,
-          $actualNode->tagName,
-          $message
-        );
-
-        if ($checkAttributes) {
-            self::assertEquals(
-              $expectedNode->attributes->length,
-              $actualNode->attributes->length,
-              sprintf(
-                '%s%sNumber of attributes on node "%s" does not match',
-                $message,
-                !empty($message) ? "\n" : '',
-                $expectedNode->tagName
-              )
-            );
-
-            for ($i = 0 ; $i < $expectedNode->attributes->length; $i++) {
-                $expectedAttribute = $expectedNode->attributes->item($i);
-                $actualAttribute   = $actualNode->attributes->getNamedItem(
-                  $expectedAttribute->name
-                );
-
-                if (!$actualAttribute) {
-                    self::fail(
-                      sprintf(
-                        '%s%sCould not find attribute "%s" on node "%s"',
-                        $message,
-                        !empty($message) ? "\n" : '',
-                        $expectedAttribute->name,
-                        $expectedNode->tagName
-                      )
-                    );
-                }
-            }
-        }
-
-        PHPUnit_Util_XML::removeCharacterDataNodes($expectedNode);
-        PHPUnit_Util_XML::removeCharacterDataNodes($actualNode);
-
-        self::assertEquals(
-          $expectedNode->childNodes->length,
-          $actualNode->childNodes->length,
-          sprintf(
-            '%s%sNumber of child nodes of "%s" differs',
-            $message,
-            !empty($message) ? "\n" : '',
-            $expectedNode->tagName
-          )
-        );
-
-        for ($i = 0; $i < $expectedNode->childNodes->length; $i++) {
-            self::assertEqualXMLStructure(
-              $expectedNode->childNodes->item($i),
-              $actualNode->childNodes->item($i),
-              $checkAttributes,
-              $message
-            );
-        }
-    }
-
-    /**
-     * Assert the presence, absence, or count of elements in a document matching
-     * the CSS $selector, regardless of the contents of those elements.
-     *
-     * The first argument, $selector, is the CSS selector used to match
-     * the elements in the $actual document.
-     *
-     * The second argument, $count, can be either boolean or numeric.
-     * When boolean, it asserts for presence of elements matching the selector
-     * (TRUE) or absence of elements (FALSE).
-     * When numeric, it asserts the count of elements.
-     *
-     * assertSelectCount("#binder", true, $xml);  // any?
-     * assertSelectCount(".binder", 3, $xml);     // exactly 3?
-     *
-     * @param  array   $selector
-     * @param  integer $count
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @param  boolean $isHtml
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function assertSelectCount($selector, $count, $actual, $message = '', $isHtml = TRUE)
-    {
-        self::assertSelectEquals(
-          $selector, TRUE, $count, $actual, $message, $isHtml
-        );
-    }
-
-    /**
-     * assertSelectRegExp("#binder .name", "/Mike|Derek/", true, $xml); // any?
-     * assertSelectRegExp("#binder .name", "/Mike|Derek/", 3, $xml);    // 3?
-     *
-     * @param  array   $selector
-     * @param  string  $pattern
-     * @param  integer $count
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @param  boolean $isHtml
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function assertSelectRegExp($selector, $pattern, $count, $actual, $message = '', $isHtml = TRUE)
-    {
-        self::assertSelectEquals(
-          $selector, "regexp:$pattern", $count, $actual, $message, $isHtml
-        );
-    }
-
-    /**
-     * assertSelectEquals("#binder .name", "Chuck", true,  $xml);  // any?
-     * assertSelectEquals("#binder .name", "Chuck", false, $xml);  // none?
-     *
-     * @param  array   $selector
-     * @param  string  $content
-     * @param  integer $count
-     * @param  mixed   $actual
-     * @param  string  $message
-     * @param  boolean $isHtml
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function assertSelectEquals($selector, $content, $count, $actual, $message = '', $isHtml = TRUE)
-    {
-        $tags = PHPUnit_Util_XML::cssSelect(
-          $selector, $content, $actual, $isHtml
-        );
-
-        // assert specific number of elements
-        if (is_numeric($count)) {
-            $counted = $tags ? count($tags) : 0;
-            self::assertEquals($count, $counted);
-        }
-
-        // assert any elements exist if true, assert no elements exist if false
-        else if (is_bool($count)) {
-            $any = count($tags) > 0 && $tags[0] instanceof DOMNode;
-
-            if ($count) {
-                self::assertTrue($any, $message);
-            } else {
-                self::assertFalse($any, $message);
-            }
-        }
-
-        // check for range number of elements
-        else if (is_array($count) &&
-                (isset($count['>']) || isset($count['<']) ||
-                isset($count['>=']) || isset($count['<=']))) {
-            $counted = $tags ? count($tags) : 0;
-
-            if (isset($count['>'])) {
-                self::assertTrue($counted > $count['>'], $message);
-            }
-
-            if (isset($count['>='])) {
-                self::assertTrue($counted >= $count['>='], $message);
-            }
-
-            if (isset($count['<'])) {
-                self::assertTrue($counted < $count['<'], $message);
-            }
-
-            if (isset($count['<='])) {
-                self::assertTrue($counted <= $count['<='], $message);
-            }
-        } else {
-            throw new InvalidArgumentException();
-        }
-    }
-
-    /**
-     * Evaluate an HTML or XML string and assert its structure and/or contents.
-     *
-     * The first argument ($matcher) is an associative array that specifies the
-     * match criteria for the assertion:
-     *
-     *  - `id`           : the node with the given id attribute must match the
-     *                     corresponsing value.
-     *  - `tag`          : the node type must match the corresponding value.
-     *  - `attributes`   : a hash. The node's attributres must match the
-     *                     corresponsing values in the hash.
-     *  - `content`      : The text content must match the given value.
-     *  - `parent`       : a hash. The node's parent must match the
-     *                     corresponsing hash.
-     *  - `child`        : a hash. At least one of the node's immediate children
-     *                     must meet the criteria described by the hash.
-     *  - `ancestor`     : a hash. At least one of the node's ancestors must
-     *                     meet the criteria described by the hash.
-     *  - `descendant`   : a hash. At least one of the node's descendants must
-     *                     meet the criteria described by the hash.
-     *  - `children`     : a hash, for counting children of a node.
-     *                     Accepts the keys:
-     *    - `count`        : a number which must equal the number of children
-     *                       that match
-     *    - `less_than`    : the number of matching children must be greater
-     *                       than this number
-     *    - `greater_than` : the number of matching children must be less than
-     *                       this number
-     *    - `only`         : another hash consisting of the keys to use to match
-     *                       on the children, and only matching children will be
-     *                       counted
-     *
-     * <code>
-     * // Matcher that asserts that there is an element with an id="my_id".
-     * $matcher = array('id' => 'my_id');
-     *
-     * // Matcher that asserts that there is a "span" tag.
-     * $matcher = array('tag' => 'span');
-     *
-     * // Matcher that asserts that there is a "span" tag with the content
-     * // "Hello World".
-     * $matcher = array('tag' => 'span', 'content' => 'Hello World');
-     *
-     * // Matcher that asserts that there is a "span" tag with content matching
-     * // the regular expression pattern.
-     * $matcher = array('tag' => 'span', 'content' => '/Try P(HP|ython)/');
-     *
-     * // Matcher that asserts that there is a "span" with an "list" class
-     * // attribute.
-     * $matcher = array(
-     *   'tag'        => 'span',
-     *   'attributes' => array('class' => 'list')
-     * );
-     *
-     * // Matcher that asserts that there is a "span" inside of a "div".
-     * $matcher = array(
-     *   'tag'    => 'span',
-     *   'parent' => array('tag' => 'div')
-     * );
-     *
-     * // Matcher that asserts that there is a "span" somewhere inside a
-     * // "table".
-     * $matcher = array(
-     *   'tag'      => 'span',
-     *   'ancestor' => array('tag' => 'table')
-     * );
-     *
-     * // Matcher that asserts that there is a "span" with at least one "em"
-     * // child.
-     * $matcher = array(
-     *   'tag'   => 'span',
-     *   'child' => array('tag' => 'em')
-     * );
-     *
-     * // Matcher that asserts that there is a "span" containing a (possibly
-     * // nested) "strong" tag.
-     * $matcher = array(
-     *   'tag'        => 'span',
-     *   'descendant' => array('tag' => 'strong')
-     * );
-     *
-     * // Matcher that asserts that there is a "span" containing 5-10 "em" tags
-     * // as immediate children.
-     * $matcher = array(
-     *   'tag'      => 'span',
-     *   'children' => array(
-     *     'less_than'    => 11,
-     *     'greater_than' => 4,
-     *     'only'         => array('tag' => 'em')
-     *   )
-     * );
-     *
-     * // Matcher that asserts that there is a "div", with an "ul" ancestor and
-     * // a "li" parent (with class="enum"), and containing a "span" descendant
-     * // that contains an element with id="my_test" and the text "Hello World".
-     * $matcher = array(
-     *   'tag'        => 'div',
-     *   'ancestor'   => array('tag' => 'ul'),
-     *   'parent'     => array(
-     *     'tag'        => 'li',
-     *     'attributes' => array('class' => 'enum')
-     *   ),
-     *   'descendant' => array(
-     *     'tag'   => 'span',
-     *     'child' => array(
-     *       'id'      => 'my_test',
-     *       'content' => 'Hello World'
-     *     )
-     *   )
-     * );
-     *
-     * // Use assertTag() to apply a $matcher to a piece of $html.
-     * $this->assertTag($matcher, $html);
-     *
-     * // Use assertTag() to apply a $matcher to a piece of $xml.
-     * $this->assertTag($matcher, $xml, '', FALSE);
-     * </code>
-     *
-     * The second argument ($actual) is a string containing either HTML or
-     * XML text to be tested.
-     *
-     * The third argument ($message) is an optional message that will be
-     * used if the assertion fails.
-     *
-     * The fourth argument ($html) is an optional flag specifying whether
-     * to load the $actual string into a DOMDocument using the HTML or
-     * XML load strategy.  It is TRUE by default, which assumes the HTML
-     * load strategy.  In many cases, this will be acceptable for XML as well.
-     *
-     * @param  array   $matcher
-     * @param  string  $actual
-     * @param  string  $message
-     * @param  boolean $isHtml
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function assertTag($matcher, $actual, $message = '', $isHtml = TRUE)
-    {
-        $dom     = PHPUnit_Util_XML::load($actual, $isHtml);
-        $tags    = PHPUnit_Util_XML::findNodes($dom, $matcher, $isHtml);
-        $matched = count($tags) > 0 && $tags[0] instanceof DOMNode;
-
-        self::assertTrue($matched, $message);
-    }
-
-    /**
-     * This assertion is the exact opposite of assertTag().
-     *
-     * Rather than asserting that $matcher results in a match, it asserts that
-     * $matcher does not match.
-     *
-     * @param  array   $matcher
-     * @param  string  $actual
-     * @param  string  $message
-     * @param  boolean $isHtml
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function assertNotTag($matcher, $actual, $message = '', $isHtml = TRUE)
-    {
-        $dom     = PHPUnit_Util_XML::load($actual, $isHtml);
-        $tags    = PHPUnit_Util_XML::findNodes($dom, $matcher, $isHtml);
-        $matched = count($tags) > 0 && $tags[0] instanceof DOMNode;
-
-        self::assertFalse($matched, $message);
-    }
-
-    /**
-     * Evaluates a PHPUnit_Framework_Constraint matcher object.
-     *
-     * @param  mixed                        $value
-     * @param  PHPUnit_Framework_Constraint $constraint
-     * @param  string                       $message
-     * @since  Method available since Release 3.0.0
-     */
-    public static function assertThat($value, PHPUnit_Framework_Constraint $constraint, $message = '')
-    {
-        self::$count += count($constraint);
-
-        if (!$constraint->evaluate($value)) {
-            $constraint->fail($value, $message);
-        }
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_And matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_And
-     * @since  Method available since Release 3.0.0
-     */
-    public static function logicalAnd()
-    {
-        $constraints = func_get_args();
-
-        $constraint = new PHPUnit_Framework_Constraint_And;
-        $constraint->setConstraints($constraints);
-
-        return $constraint;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_Or matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_Or
-     * @since  Method available since Release 3.0.0
-     */
-    public static function logicalOr()
-    {
-        $constraints = func_get_args();
-
-        $constraint = new PHPUnit_Framework_Constraint_Or;
-        $constraint->setConstraints($constraints);
-
-        return $constraint;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_Not matcher object.
-     *
-     * @param  PHPUnit_Framework_Constraint $constraint
-     * @return PHPUnit_Framework_Constraint_Not
-     * @since  Method available since Release 3.0.0
-     */
-    public static function logicalNot(PHPUnit_Framework_Constraint $constraint)
-    {
-        return new PHPUnit_Framework_Constraint_Not($constraint);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_Xor matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_Xor
-     * @since  Method available since Release 3.0.0
-     */
-    public static function logicalXor()
-    {
-        $constraints = func_get_args();
-
-        $constraint = new PHPUnit_Framework_Constraint_Xor;
-        $constraint->setConstraints($constraints);
-
-        return $constraint;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsAnything matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_IsAnything
-     * @since  Method available since Release 3.0.0
-     */
-    public static function anything()
-    {
-        return new PHPUnit_Framework_Constraint_IsAnything;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsTrue matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_IsTrue
-     * @since  Method available since Release 3.3.0
-     */
-    public static function isTrue()
-    {
-        return new PHPUnit_Framework_Constraint_IsTrue;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsFalse matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_IsFalse
-     * @since  Method available since Release 3.3.0
-     */
-    public static function isFalse()
-    {
-        return new PHPUnit_Framework_Constraint_IsFalse;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsNull matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_IsNull
-     * @since  Method available since Release 3.3.0
-     */
-    public static function isNull()
-    {
-        return new PHPUnit_Framework_Constraint_IsNull;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_Attribute matcher object.
-     *
-     * @param  PHPUnit_Framework_Constraint $constraint
-     * @param  string                       $attributeName
-     * @return PHPUnit_Framework_Constraint_Attribute
-     * @since  Method available since Release 3.1.0
-     */
-    public static function attribute(PHPUnit_Framework_Constraint $constraint, $attributeName)
-    {
-        return new PHPUnit_Framework_Constraint_Attribute(
-          $constraint, $attributeName
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_TraversableContains matcher
-     * object.
-     *
-     * @param  mixed $value
-     * @return PHPUnit_Framework_Constraint_TraversableContains
-     * @since  Method available since Release 3.0.0
-     */
-    public static function contains($value)
-    {
-        return new PHPUnit_Framework_Constraint_TraversableContains($value);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_TraversableContainsOnly matcher
-     * object.
-     *
-     * @param  string $type
-     * @return PHPUnit_Framework_Constraint_TraversableContainsOnly
-     * @since  Method available since Release 3.1.4
-     */
-    public static function containsOnly($type)
-    {
-        return new PHPUnit_Framework_Constraint_TraversableContainsOnly($type);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_ArrayHasKey matcher object.
-     *
-     * @param  mixed $key
-     * @return PHPUnit_Framework_Constraint_ArrayHasKey
-     * @since  Method available since Release 3.0.0
-     */
-    public static function arrayHasKey($key)
-    {
-        return new PHPUnit_Framework_Constraint_ArrayHasKey($key);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsEqual matcher object.
-     *
-     * @param  mixed   $value
-     * @param  float   $delta
-     * @param  integer $maxDepth
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     * @return PHPUnit_Framework_Constraint_IsEqual
-     * @since  Method available since Release 3.0.0
-     */
-    public static function equalTo($value, $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        return new PHPUnit_Framework_Constraint_IsEqual(
-          $value, $delta, $maxDepth, $canonicalize, $ignoreCase
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsEqual matcher object
-     * that is wrapped in a PHPUnit_Framework_Constraint_Attribute matcher
-     * object.
-     *
-     * @param  string  $attributeName
-     * @param  mixed   $value
-     * @param  float   $delta
-     * @param  integer $maxDepth
-     * @param  boolean $canonicalize
-     * @param  boolean $ignoreCase
-     * @return PHPUnit_Framework_Constraint_Attribute
-     * @since  Method available since Release 3.1.0
-     */
-    public static function attributeEqualTo($attributeName, $value, $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        return self::attribute(
-          self::equalTo(
-            $value, $delta, $maxDepth, $canonicalize, $ignoreCase
-          ),
-          $attributeName
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsEmpty matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_IsEmpty
-     * @since  Method available since Release 3.5.0
-     */
-    public static function isEmpty()
-    {
-        return new PHPUnit_Framework_Constraint_IsEmpty;
-    }
-    /**
-     * Returns a PHPUnit_Framework_Constraint_FileExists matcher object.
-     *
-     * @return PHPUnit_Framework_Constraint_FileExists
-     * @since  Method available since Release 3.0.0
-     */
-    public static function fileExists()
-    {
-        return new PHPUnit_Framework_Constraint_FileExists;
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_GreaterThan matcher object.
-     *
-     * @param  mixed $value
-     * @return PHPUnit_Framework_Constraint_GreaterThan
-     * @since  Method available since Release 3.0.0
-     */
-    public static function greaterThan($value)
-    {
-        return new PHPUnit_Framework_Constraint_GreaterThan($value);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_Or matcher object that wraps
-     * a PHPUnit_Framework_Constraint_IsEqual and a
-     * PHPUnit_Framework_Constraint_GreaterThan matcher object.
-     *
-     * @param  mixed $value
-     * @return PHPUnit_Framework_Constraint_Or
-     * @since  Method available since Release 3.1.0
-     */
-    public static function greaterThanOrEqual($value)
-    {
-        return self::logicalOr(
-          new PHPUnit_Framework_Constraint_IsEqual($value),
-          new PHPUnit_Framework_Constraint_GreaterThan($value)
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_ClassHasAttribute matcher object.
-     *
-     * @param  string $attributeName
-     * @return PHPUnit_Framework_Constraint_ClassHasAttribute
-     * @since  Method available since Release 3.1.0
-     */
-    public static function classHasAttribute($attributeName)
-    {
-        return new PHPUnit_Framework_Constraint_ClassHasAttribute(
-          $attributeName
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_ClassHasStaticAttribute matcher
-     * object.
-     *
-     * @param  string $attributeName
-     * @return PHPUnit_Framework_Constraint_ClassHasStaticAttribute
-     * @since  Method available since Release 3.1.0
-     */
-    public static function classHasStaticAttribute($attributeName)
-    {
-        return new PHPUnit_Framework_Constraint_ClassHasStaticAttribute(
-          $attributeName
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_ObjectHasAttribute matcher object.
-     *
-     * @param  string $attributeName
-     * @return PHPUnit_Framework_Constraint_ObjectHasAttribute
-     * @since  Method available since Release 3.0.0
-     */
-    public static function objectHasAttribute($attributeName)
-    {
-        return new PHPUnit_Framework_Constraint_ObjectHasAttribute(
-          $attributeName
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsIdentical matcher object.
-     *
-     * @param  mixed $value
-     * @return PHPUnit_Framework_Constraint_IsIdentical
-     * @since  Method available since Release 3.0.0
-     */
-    public static function identicalTo($value)
-    {
-        return new PHPUnit_Framework_Constraint_IsIdentical($value);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsInstanceOf matcher object.
-     *
-     * @param  string $className
-     * @return PHPUnit_Framework_Constraint_IsInstanceOf
-     * @since  Method available since Release 3.0.0
-     */
-    public static function isInstanceOf($className)
-    {
-        return new PHPUnit_Framework_Constraint_IsInstanceOf($className);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_IsType matcher object.
-     *
-     * @param  string $type
-     * @return PHPUnit_Framework_Constraint_IsType
-     * @since  Method available since Release 3.0.0
-     */
-    public static function isType($type)
-    {
-        return new PHPUnit_Framework_Constraint_IsType($type);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_LessThan matcher object.
-     *
-     * @param  mixed $value
-     * @return PHPUnit_Framework_Constraint_LessThan
-     * @since  Method available since Release 3.0.0
-     */
-    public static function lessThan($value)
-    {
-        return new PHPUnit_Framework_Constraint_LessThan($value);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_Or matcher object that wraps
-     * a PHPUnit_Framework_Constraint_IsEqual and a
-     * PHPUnit_Framework_Constraint_LessThan matcher object.
-     *
-     * @param  mixed $value
-     * @return PHPUnit_Framework_Constraint_Or
-     * @since  Method available since Release 3.1.0
-     */
-    public static function lessThanOrEqual($value)
-    {
-        return self::logicalOr(
-          new PHPUnit_Framework_Constraint_IsEqual($value),
-          new PHPUnit_Framework_Constraint_LessThan($value)
-        );
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_PCREMatch matcher object.
-     *
-     * @param  string $pattern
-     * @return PHPUnit_Framework_Constraint_PCREMatch
-     * @since  Method available since Release 3.0.0
-     */
-    public static function matchesRegularExpression($pattern)
-    {
-        return new PHPUnit_Framework_Constraint_PCREMatch($pattern);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_StringMatches matcher object.
-     *
-     * @param  string $string
-     * @return PHPUnit_Framework_Constraint_StringMatches
-     * @since  Method available since Release 3.5.0
-     */
-    public static function matches($string)
-    {
-        return new PHPUnit_Framework_Constraint_StringMatches($string);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_StringStartsWith matcher object.
-     *
-     * @param  mixed $prefix
-     * @return PHPUnit_Framework_Constraint_StringStartsWith
-     * @since  Method available since Release 3.4.0
-     */
-    public static function stringStartsWith($prefix)
-    {
-        return new PHPUnit_Framework_Constraint_StringStartsWith($prefix);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_StringContains matcher object.
-     *
-     * @param  string  $string
-     * @param  boolean $case
-     * @return PHPUnit_Framework_Constraint_StringContains
-     * @since  Method available since Release 3.0.0
-     */
-    public static function stringContains($string, $case = TRUE)
-    {
-        return new PHPUnit_Framework_Constraint_StringContains($string, $case);
-    }
-
-    /**
-     * Returns a PHPUnit_Framework_Constraint_StringEndsWith matcher object.
-     *
-     * @param  mixed $suffix
-     * @return PHPUnit_Framework_Constraint_StringEndsWith
-     * @since  Method available since Release 3.4.0
-     */
-    public static function stringEndsWith($suffix)
-    {
-        return new PHPUnit_Framework_Constraint_StringEndsWith($suffix);
-    }
-
-    /**
-     * Fails a test with the given message.
-     *
-     * @param  string $message
-     * @throws PHPUnit_Framework_AssertionFailedError
-     */
-    public static function fail($message = '')
-    {
-        throw new PHPUnit_Framework_AssertionFailedError($message);
-    }
-
-    /**
-     * Fails a test with a synthetic error.
-     *
-     * @param  string  $message
-     * @param  string  $file
-     * @param  integer $line
-     * @param  array   $trace
-     * @throws PHPUnit_Framework_SyntheticError
-     */
-    public static function syntheticFail($message = '', $file = '', $line = 0, $trace = array())
-    {
-        throw new PHPUnit_Framework_SyntheticError($message, 0, $file, $line, $trace);
-    }
-
-    /**
-     * Returns the value of an attribute of a class or an object.
-     * This also works for attributes that are declared protected or private.
-     *
-     * @param  mixed   $classOrObject
-     * @param  string  $attributeName
-     * @return mixed
-     * @throws InvalidArgumentException
-     */
-    public static function readAttribute($classOrObject, $attributeName)
-    {
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        if (is_string($classOrObject)) {
-            if (!class_exists($classOrObject)) {
-                throw PHPUnit_Util_InvalidArgumentHelper::factory(
-                  1, 'class name'
-                );
-            }
-
-            return PHPUnit_Util_Class::getStaticAttribute(
-              $classOrObject,
-              $attributeName
-            );
-        }
-
-        else if (is_object($classOrObject)) {
-            return PHPUnit_Util_Class::getObjectAttribute(
-              $classOrObject,
-              $attributeName
-            );
-        }
-
-        else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              1, 'class name or object'
-            );
-        }
-    }
-
-    /**
-     * Mark the test as incomplete.
-     *
-     * @param  string  $message
-     * @throws PHPUnit_Framework_IncompleteTestError
-     * @since  Method available since Release 3.0.0
-     */
-    public static function markTestIncomplete($message = '')
-    {
-        throw new PHPUnit_Framework_IncompleteTestError($message);
-    }
-
-    /**
-     * Mark the test as skipped.
-     *
-     * @param  string  $message
-     * @throws PHPUnit_Framework_SkippedTestError
-     * @since  Method available since Release 3.0.0
-     */
-    public static function markTestSkipped($message = '')
-    {
-        throw new PHPUnit_Framework_SkippedTestError($message);
-    }
-
-    /**
-     * Return the current assertion count.
-     *
-     * @return integer
-     * @since  Method available since Release 3.3.3
-     */
-    public static function getCount()
-    {
-        return self::$count;
-    }
-
-    /**
-     * Reset the assertion counter.
-     *
-     * @since  Method available since Release 3.3.3
-     */
-    public static function resetCount()
-    {
-        self::$count = 0;
-    }
-}
diff --git a/tests/PHPUnit/Framework/Assert/Functions.php b/tests/PHPUnit/Framework/Assert/Functions.php
deleted file mode 100644
index d18e5da..0000000
--- a/tests/PHPUnit/Framework/Assert/Functions.php
+++ /dev/null
@@ -1,1827 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * Returns a matcher that matches when the method it is evaluated for
- * is executed zero or more times.
- *
- * @return PHPUnit_Framework_MockObject_Matcher_AnyInvokedCount
- * @since  Method available since Release 3.0.0
- */
-function any()
-{
-    return PHPUnit_Framework_TestCase::any();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsAnything matcher object.
- *
- * @return PHPUnit_Framework_Constraint_IsAnything
- * @since  Method available since Release 3.0.0
- */
-function anything()
-{
-    return PHPUnit_Framework_Assert::anything();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_ArrayHasKey matcher object.
- *
- * @param  mixed $key
- * @return PHPUnit_Framework_Constraint_ArrayHasKey
- * @since  Method available since Release 3.0.0
- */
-function arrayHasKey($key)
-{
-    return PHPUnit_Framework_Assert::arrayHasKey($key);
-}
-
-/**
- * Asserts that an array has a specified key.
- *
- * @param  mixed  $key
- * @param  array  $array
- * @param  string $message
- * @since  Method available since Release 3.0.0
- */
-function assertArrayHasKey($key, array $array, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertArrayHasKey($key, $array, $message);
-}
-
-/**
- * Asserts that an array does not have a specified key.
- *
- * @param  mixed  $key
- * @param  array  $array
- * @param  string $message
- * @since  Method available since Release 3.0.0
- */
-function assertArrayNotHasKey($key, array $array, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertArrayNotHasKey($key, $array, $message);
-}
-
-/**
- * Asserts that a haystack that is stored in a static attribute of a class
- * or an attribute of an object contains a needle.
- *
- * @param  mixed   $needle
- * @param  string  $haystackAttributeName
- * @param  mixed   $haystackClassOrObject
- * @param  string  $message
- * @param  boolean $ignoreCase
- * @since  Method available since Release 3.0.0
- */
-function assertAttributeContains($needle, $haystackAttributeName, $haystackClassOrObject, $message = '', $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertAttributeContains($needle, $haystackAttributeName, $haystackClassOrObject, $message, $ignoreCase);
-}
-
-/**
- * Asserts that a haystack that is stored in a static attribute of a class
- * or an attribute of an object contains only values of a given type.
- *
- * @param  string  $type
- * @param  string  $haystackAttributeName
- * @param  mixed   $haystackClassOrObject
- * @param  boolean $isNativeType
- * @param  string  $message
- * @since  Method available since Release 3.1.4
- */
-function assertAttributeContainsOnly($type, $haystackAttributeName, $haystackClassOrObject, $isNativeType = NULL, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeContainsOnly($type, $haystackAttributeName, $haystackClassOrObject, $isNativeType, $message);
-}
-
-/**
- * Asserts that a static attribute of a class or an attribute of an object
- * is empty.
- *
- * @param string $haystackAttributeName
- * @param mixed  $haystackClassOrObject
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertAttributeEmpty($haystackAttributeName, $haystackClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeEmpty($haystackAttributeName, $haystackClassOrObject, $message);
-}
-
-/**
- * Asserts that a variable is equal to an attribute of an object.
- *
- * @param  mixed   $expected
- * @param  string  $actualAttributeName
- * @param  string  $actualClassOrObject
- * @param  string  $message
- * @param  float   $delta
- * @param  integer $maxDepth
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- */
-function assertAttributeEquals($expected, $actualAttributeName, $actualClassOrObject, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertAttributeEquals($expected, $actualAttributeName, $actualClassOrObject, $message, $delta, $maxDepth, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that an attribute is greater than another value.
- *
- * @param  mixed   $expected
- * @param  string  $actualAttributeName
- * @param  string  $actualClassOrObject
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertAttributeGreaterThan($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeGreaterThan($expected, $actualAttributeName, $actualClassOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is greater than or equal to another value.
- *
- * @param  mixed   $expected
- * @param  string  $actualAttributeName
- * @param  string  $actualClassOrObject
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertAttributeGreaterThanOrEqual($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeGreaterThanOrEqual($expected, $actualAttributeName, $actualClassOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is of a given type.
- *
- * @param string $expected
- * @param string $attributeName
- * @param mixed  $classOrObject
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertAttributeInstanceOf($expected, $attributeName, $classOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeInstanceOf($expected, $attributeName, $classOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is of a given type.
- *
- * @param string $expected
- * @param string $attributeName
- * @param mixed  $classOrObject
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertAttributeInternalType($expected, $attributeName, $classOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeInternalType($expected, $attributeName, $classOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is smaller than another value.
- *
- * @param  mixed   $expected
- * @param  string  $actualAttributeName
- * @param  string  $actualClassOrObject
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertAttributeLessThan($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeLessThan($expected, $actualAttributeName, $actualClassOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is smaller than or equal to another value.
- *
- * @param  mixed   $expected
- * @param  string  $actualAttributeName
- * @param  string  $actualClassOrObject
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertAttributeLessThanOrEqual($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeLessThanOrEqual($expected, $actualAttributeName, $actualClassOrObject, $message);
-}
-
-/**
- * Asserts that a haystack that is stored in a static attribute of a class
- * or an attribute of an object does not contain a needle.
- *
- * @param  mixed   $needle
- * @param  string  $haystackAttributeName
- * @param  mixed   $haystackClassOrObject
- * @param  string  $message
- * @param  boolean $ignoreCase
- * @since  Method available since Release 3.0.0
- */
-function assertAttributeNotContains($needle, $haystackAttributeName, $haystackClassOrObject, $message = '', $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotContains($needle, $haystackAttributeName, $haystackClassOrObject, $message, $ignoreCase);
-}
-
-/**
- * Asserts that a haystack that is stored in a static attribute of a class
- * or an attribute of an object does not contain only values of a given
- * type.
- *
- * @param  string  $type
- * @param  string  $haystackAttributeName
- * @param  mixed   $haystackClassOrObject
- * @param  boolean $isNativeType
- * @param  string  $message
- * @since  Method available since Release 3.1.4
- */
-function assertAttributeNotContainsOnly($type, $haystackAttributeName, $haystackClassOrObject, $isNativeType = NULL, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotContainsOnly($type, $haystackAttributeName, $haystackClassOrObject, $isNativeType, $message);
-}
-
-/**
- * Asserts that a static attribute of a class or an attribute of an object
- * is not empty.
- *
- * @param string $haystackAttributeName
- * @param mixed  $haystackClassOrObject
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertAttributeNotEmpty($haystackAttributeName, $haystackClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotEmpty($haystackAttributeName, $haystackClassOrObject, $message);
-}
-
-/**
- * Asserts that a variable is not equal to an attribute of an object.
- *
- * @param  mixed   $expected
- * @param  string  $actualAttributeName
- * @param  string  $actualClassOrObject
- * @param  string  $message
- * @param  float   $delta
- * @param  integer $maxDepth
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- */
-function assertAttributeNotEquals($expected, $actualAttributeName, $actualClassOrObject, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotEquals($expected, $actualAttributeName, $actualClassOrObject, $message, $delta, $maxDepth, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that an attribute is of a given type.
- *
- * @param string $expected
- * @param string $attributeName
- * @param mixed  $classOrObject
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertAttributeNotInstanceOf($expected, $attributeName, $classOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotInstanceOf($expected, $attributeName, $classOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is of a given type.
- *
- * @param string $expected
- * @param string $attributeName
- * @param mixed  $classOrObject
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertAttributeNotInternalType($expected, $attributeName, $classOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotInternalType($expected, $attributeName, $classOrObject, $message);
-}
-
-/**
- * Asserts that a variable and an attribute of an object do not have the
- * same type and value.
- *
- * @param  mixed  $expected
- * @param  string $actualAttributeName
- * @param  object $actualClassOrObject
- * @param  string $message
- */
-function assertAttributeNotSame($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotSame($expected, $actualAttributeName, $actualClassOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is of a given type.
- *
- * @param  string  $expected
- * @param  string  $attributeName
- * @param  mixed   $classOrObject
- * @param  string  $message
- * @since  Method available since Release 3.4.0
- */
-function assertAttributeNotType($expected, $attributeName, $classOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeNotType($expected, $attributeName, $classOrObject, $message);
-}
-
-/**
- * Asserts that a variable and an attribute of an object have the same type
- * and value.
- *
- * @param  mixed  $expected
- * @param  string $actualAttributeName
- * @param  object $actualClassOrObject
- * @param  string $message
- */
-function assertAttributeSame($expected, $actualAttributeName, $actualClassOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeSame($expected, $actualAttributeName, $actualClassOrObject, $message);
-}
-
-/**
- * Asserts that an attribute is of a given type.
- *
- * @param  string  $expected
- * @param  string  $attributeName
- * @param  mixed   $classOrObject
- * @param  string  $message
- * @since  Method available since Release 3.4.0
- */
-function assertAttributeType($expected, $attributeName, $classOrObject, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertAttributeType($expected, $attributeName, $classOrObject, $message);
-}
-
-/**
- * Asserts that a class has a specified attribute.
- *
- * @param  string $attributeName
- * @param  string $className
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertClassHasAttribute($attributeName, $className, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertClassHasAttribute($attributeName, $className, $message);
-}
-
-/**
- * Asserts that a class has a specified static attribute.
- *
- * @param  string $attributeName
- * @param  string $className
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertClassHasStaticAttribute($attributeName, $className, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertClassHasStaticAttribute($attributeName, $className, $message);
-}
-
-/**
- * Asserts that a class does not have a specified attribute.
- *
- * @param  string $attributeName
- * @param  string $className
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertClassNotHasAttribute($attributeName, $className, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertClassNotHasAttribute($attributeName, $className, $message);
-}
-
-/**
- * Asserts that a class does not have a specified static attribute.
- *
- * @param  string $attributeName
- * @param  string $className
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertClassNotHasStaticAttribute($attributeName, $className, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertClassNotHasStaticAttribute($attributeName, $className, $message);
-}
-
-/**
- * Asserts that a haystack contains a needle.
- *
- * @param  mixed   $needle
- * @param  mixed   $haystack
- * @param  string  $message
- * @param  boolean $ignoreCase
- * @since  Method available since Release 2.1.0
- */
-function assertContains($needle, $haystack, $message = '', $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertContains($needle, $haystack, $message, $ignoreCase);
-}
-
-/**
- * Asserts that a haystack contains only values of a given type.
- *
- * @param  string  $type
- * @param  mixed   $haystack
- * @param  boolean $isNativeType
- * @param  string  $message
- * @since  Method available since Release 3.1.4
- */
-function assertContainsOnly($type, $haystack, $isNativeType = NULL, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertContainsOnly($type, $haystack, $isNativeType, $message);
-}
-
-/**
- * Asserts that a variable is empty.
- *
- * @param  mixed   $actual
- * @param  string  $message
- * @throws PHPUnit_Framework_AssertionFailedError
- */
-function assertEmpty($actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertEmpty($actual, $message);
-}
-
-/**
- * Asserts that a hierarchy of DOMNodes matches.
- *
- * @param DOMNode $expectedNode
- * @param DOMNode $actualNode
- * @param boolean $checkAttributes
- * @param string  $message
- * @author Mattis Stordalen Flister <mattis@xait.no>
- * @since  Method available since Release 3.3.0
- */
-function assertEqualXMLStructure(DOMNode $expectedNode, DOMNode $actualNode, $checkAttributes = FALSE, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertEqualXMLStructure($expectedNode, $actualNode, $checkAttributes, $message);
-}
-
-/**
- * Asserts that two variables are equal.
- *
- * @param  mixed   $expected
- * @param  mixed   $actual
- * @param  string  $message
- * @param  float   $delta
- * @param  integer $maxDepth
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- */
-function assertEquals($expected, $actual, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertEquals($expected, $actual, $message, $delta, $maxDepth, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that a condition is false.
- *
- * @param  boolean  $condition
- * @param  string   $message
- * @throws PHPUnit_Framework_AssertionFailedError
- */
-function assertFalse($condition, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertFalse($condition, $message);
-}
-
-/**
- * Asserts that the contents of one file is equal to the contents of another
- * file.
- *
- * @param  string  $expected
- * @param  string  $actual
- * @param  string  $message
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- * @since  Method available since Release 3.2.14
- */
-function assertFileEquals($expected, $actual, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertFileEquals($expected, $actual, $message, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that a file exists.
- *
- * @param  string $filename
- * @param  string $message
- * @since  Method available since Release 3.0.0
- */
-function assertFileExists($filename, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertFileExists($filename, $message);
-}
-
-/**
- * Asserts that the contents of one file is not equal to the contents of
- * another file.
- *
- * @param  string  $expected
- * @param  string  $actual
- * @param  string  $message
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- * @since  Method available since Release 3.2.14
- */
-function assertFileNotEquals($expected, $actual, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertFileNotEquals($expected, $actual, $message, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that a file does not exist.
- *
- * @param  string $filename
- * @param  string $message
- * @since  Method available since Release 3.0.0
- */
-function assertFileNotExists($filename, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertFileNotExists($filename, $message);
-}
-
-/**
- * Asserts that a value is greater than another value.
- *
- * @param  mixed   $expected
- * @param  mixed   $actual
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertGreaterThan($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertGreaterThan($expected, $actual, $message);
-}
-
-/**
- * Asserts that a value is greater than or equal to another value.
- *
- * @param  mixed   $expected
- * @param  mixed   $actual
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertGreaterThanOrEqual($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertGreaterThanOrEqual($expected, $actual, $message);
-}
-
-/**
- * Asserts that a variable is of a given type.
- *
- * @param string $expected
- * @param mixed  $actual
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertInstanceOf($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertInstanceOf($expected, $actual, $message);
-}
-
-/**
- * Asserts that a variable is of a given type.
- *
- * @param string $expected
- * @param mixed  $actual
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertInternalType($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertInternalType($expected, $actual, $message);
-}
-
-/**
- * Asserts that a value is smaller than another value.
- *
- * @param  mixed   $expected
- * @param  mixed   $actual
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertLessThan($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertLessThan($expected, $actual, $message);
-}
-
-/**
- * Asserts that a value is smaller than or equal to another value.
- *
- * @param  mixed   $expected
- * @param  mixed   $actual
- * @param  string  $message
- * @since  Method available since Release 3.1.0
- */
-function assertLessThanOrEqual($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertLessThanOrEqual($expected, $actual, $message);
-}
-
-/**
- * Asserts that a haystack does not contain a needle.
- *
- * @param  mixed   $needle
- * @param  mixed   $haystack
- * @param  string  $message
- * @param  boolean $ignoreCase
- * @since  Method available since Release 2.1.0
- */
-function assertNotContains($needle, $haystack, $message = '', $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertNotContains($needle, $haystack, $message, $ignoreCase);
-}
-
-/**
- * Asserts that a haystack does not contain only values of a given type.
- *
- * @param  string  $type
- * @param  mixed   $haystack
- * @param  boolean $isNativeType
- * @param  string  $message
- * @since  Method available since Release 3.1.4
- */
-function assertNotContainsOnly($type, $haystack, $isNativeType = NULL, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotContainsOnly($type, $haystack, $isNativeType, $message);
-}
-
-/**
- * Asserts that a variable is not empty.
- *
- * @param  mixed   $actual
- * @param  string  $message
- * @throws PHPUnit_Framework_AssertionFailedError
- */
-function assertNotEmpty($actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotEmpty($actual, $message);
-}
-
-/**
- * Asserts that two variables are not equal.
- *
- * @param  mixed   $expected
- * @param  mixed   $actual
- * @param  string  $message
- * @param  float   $delta
- * @param  integer $maxDepth
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- * @since  Method available since Release 2.3.0
- */
-function assertNotEquals($expected, $actual, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertNotEquals($expected, $actual, $message, $delta, $maxDepth, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that a variable is not of a given type.
- *
- * @param string $expected
- * @param mixed  $actual
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertNotInstanceOf($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotInstanceOf($expected, $actual, $message);
-}
-
-/**
- * Asserts that a variable is not of a given type.
- *
- * @param string $expected
- * @param mixed  $actual
- * @param string $message
- * @since Method available since Release 3.5.0
- */
-function assertNotInternalType($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotInternalType($expected, $actual, $message);
-}
-
-/**
- * Asserts that a variable is not NULL.
- *
- * @param  mixed  $actual
- * @param  string $message
- */
-function assertNotNull($actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotNull($actual, $message);
-}
-
-/**
- * Asserts that a string does not match a given regular expression.
- *
- * @param  string $pattern
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 2.1.0
- */
-function assertNotRegExp($pattern, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotRegExp($pattern, $string, $message);
-}
-
-/**
- * Asserts that two variables do not have the same type and value.
- * Used on objects, it asserts that two variables do not reference
- * the same object.
- *
- * @param  mixed  $expected
- * @param  mixed  $actual
- * @param  string $message
- */
-function assertNotSame($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotSame($expected, $actual, $message);
-}
-
-/**
- * This assertion is the exact opposite of assertTag().
- *
- * Rather than asserting that $matcher results in a match, it asserts that
- * $matcher does not match.
- *
- * @param  array   $matcher
- * @param  string  $actual
- * @param  string  $message
- * @param  boolean $isHtml
- * @since  Method available since Release 3.3.0
- * @author Mike Naberezny <mike@maintainable.com>
- * @author Derek DeVries <derek@maintainable.com>
- */
-function assertNotTag($matcher, $actual, $message = '', $isHtml = TRUE)
-{
-    return PHPUnit_Framework_Assert::assertNotTag($matcher, $actual, $message, $isHtml);
-}
-
-/**
- * Asserts that a variable is not of a given type.
- *
- * @param  string $expected
- * @param  mixed  $actual
- * @param  string $message
- * @since  Method available since Release 2.2.0
- */
-function assertNotType($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNotType($expected, $actual, $message);
-}
-
-/**
- * Asserts that a variable is NULL.
- *
- * @param  mixed  $actual
- * @param  string $message
- */
-function assertNull($actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertNull($actual, $message);
-}
-
-/**
- * Asserts that an object has a specified attribute.
- *
- * @param  string $attributeName
- * @param  object $object
- * @param  string $message
- * @since  Method available since Release 3.0.0
- */
-function assertObjectHasAttribute($attributeName, $object, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertObjectHasAttribute($attributeName, $object, $message);
-}
-
-/**
- * Asserts that an object does not have a specified attribute.
- *
- * @param  string $attributeName
- * @param  object $object
- * @param  string $message
- * @since  Method available since Release 3.0.0
- */
-function assertObjectNotHasAttribute($attributeName, $object, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertObjectNotHasAttribute($attributeName, $object, $message);
-}
-
-/**
- * Asserts that a string matches a given regular expression.
- *
- * @param  string $pattern
- * @param  string $string
- * @param  string $message
- */
-function assertRegExp($pattern, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertRegExp($pattern, $string, $message);
-}
-
-/**
- * Asserts that two variables have the same type and value.
- * Used on objects, it asserts that two variables reference
- * the same object.
- *
- * @param  mixed  $expected
- * @param  mixed  $actual
- * @param  string $message
- */
-function assertSame($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertSame($expected, $actual, $message);
-}
-
-/**
- * Assert the presence, absence, or count of elements in a document matching
- * the CSS $selector, regardless of the contents of those elements.
- *
- * The first argument, $selector, is the CSS selector used to match
- * the elements in the $actual document.
- *
- * The second argument, $count, can be either boolean or numeric.
- * When boolean, it asserts for presence of elements matching the selector
- * (TRUE) or absence of elements (FALSE).
- * When numeric, it asserts the count of elements.
- *
- * assertSelectCount("#binder", true, $xml);  // any?
- * assertSelectCount(".binder", 3, $xml); // exactly 3?
- *
- * @param  array   $selector
- * @param  integer $count
- * @param  mixed   $actual
- * @param  string  $message
- * @param  boolean $isHtml
- * @since  Method available since Release 3.3.0
- * @author Mike Naberezny <mike@maintainable.com>
- * @author Derek DeVries <derek@maintainable.com>
- */
-function assertSelectCount($selector, $count, $actual, $message = '', $isHtml = TRUE)
-{
-    return PHPUnit_Framework_Assert::assertSelectCount($selector, $count, $actual, $message, $isHtml);
-}
-
-/**
- * assertSelectEquals("#binder .name", "Chuck", true,  $xml);  // any?
- * assertSelectEquals("#binder .name", "Chuck", false, $xml);  // none?
- *
- * @param  array   $selector
- * @param  string  $content
- * @param  integer $count
- * @param  mixed   $actual
- * @param  string  $message
- * @param  boolean $isHtml
- * @since  Method available since Release 3.3.0
- * @author Mike Naberezny <mike@maintainable.com>
- * @author Derek DeVries <derek@maintainable.com>
- */
-function assertSelectEquals($selector, $content, $count, $actual, $message = '', $isHtml = TRUE)
-{
-    return PHPUnit_Framework_Assert::assertSelectEquals($selector, $content, $count, $actual, $message, $isHtml);
-}
-
-/**
- * assertSelectRegExp("#binder .name", "/Mike|Derek/", true, $xml); // any?
- * assertSelectRegExp("#binder .name", "/Mike|Derek/", 3, $xml);// 3?
- *
- * @param  array   $selector
- * @param  string  $pattern
- * @param  integer $count
- * @param  mixed   $actual
- * @param  string  $message
- * @param  boolean $isHtml
- * @since  Method available since Release 3.3.0
- * @author Mike Naberezny <mike@maintainable.com>
- * @author Derek DeVries <derek@maintainable.com>
- */
-function assertSelectRegExp($selector, $pattern, $count, $actual, $message = '', $isHtml = TRUE)
-{
-    return PHPUnit_Framework_Assert::assertSelectRegExp($selector, $pattern, $count, $actual, $message, $isHtml);
-}
-
-/**
- * Asserts that a string ends not with a given prefix.
- *
- * @param  string $suffix
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.4.0
- */
-function assertStringEndsNotWith($suffix, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringEndsNotWith($suffix, $string, $message);
-}
-
-/**
- * Asserts that a string ends with a given prefix.
- *
- * @param  string $suffix
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.4.0
- */
-function assertStringEndsWith($suffix, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringEndsWith($suffix, $string, $message);
-}
-
-/**
- * Asserts that the contents of a string is equal
- * to the contents of a file.
- *
- * @param  string  $expectedFile
- * @param  string  $actualString
- * @param  string  $message
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- * @since  Method available since Release 3.3.0
- */
-function assertStringEqualsFile($expectedFile, $actualString, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertStringEqualsFile($expectedFile, $actualString, $message, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that a string matches a given format string.
- *
- * @param  string $format
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.5.0
- */
-function assertStringMatchesFormat($format, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringMatchesFormat($format, $string, $message);
-}
-
-/**
- * Asserts that a string matches a given format file.
- *
- * @param  string $formatFile
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.5.0
- */
-function assertStringMatchesFormatFile($formatFile, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringMatchesFormatFile($formatFile, $string, $message);
-}
-
-/**
- * Asserts that the contents of a string is not equal
- * to the contents of a file.
- *
- * @param  string  $expectedFile
- * @param  string  $actualString
- * @param  string  $message
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- * @since  Method available since Release 3.3.0
- */
-function assertStringNotEqualsFile($expectedFile, $actualString, $message = '', $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::assertStringNotEqualsFile($expectedFile, $actualString, $message, $canonicalize, $ignoreCase);
-}
-
-/**
- * Asserts that a string does not match a given format string.
- *
- * @param  string $format
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.5.0
- */
-function assertStringNotMatchesFormat($format, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringNotMatchesFormat($format, $string, $message);
-}
-
-/**
- * Asserts that a string does not match a given format string.
- *
- * @param  string $formatFile
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.5.0
- */
-function assertStringNotMatchesFormatFile($formatFile, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringNotMatchesFormatFile($formatFile, $string, $message);
-}
-
-/**
- * Asserts that a string starts not with a given prefix.
- *
- * @param  string $prefix
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.4.0
- */
-function assertStringStartsNotWith($prefix, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringStartsNotWith($prefix, $string, $message);
-}
-
-/**
- * Asserts that a string starts with a given prefix.
- *
- * @param  string $prefix
- * @param  string $string
- * @param  string $message
- * @since  Method available since Release 3.4.0
- */
-function assertStringStartsWith($prefix, $string, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertStringStartsWith($prefix, $string, $message);
-}
-
-/**
- * Evaluate an HTML or XML string and assert its structure and/or contents.
- *
- * The first argument ($matcher) is an associative array that specifies the
- * match criteria for the assertion:
- *
- *  - `id`   : the node with the given id attribute must match the
- * corresponsing value.
- *  - `tag`  : the node type must match the corresponding value.
- *  - `attributes`   : a hash. The node's attributres must match the
- * corresponsing values in the hash.
- *  - `content`  : The text content must match the given value.
- *  - `parent`   : a hash. The node's parent must match the
- * corresponsing hash.
- *  - `child`: a hash. At least one of the node's immediate children
- * must meet the criteria described by the hash.
- *  - `ancestor` : a hash. At least one of the node's ancestors must
- * meet the criteria described by the hash.
- *  - `descendant`   : a hash. At least one of the node's descendants must
- * meet the criteria described by the hash.
- *  - `children` : a hash, for counting children of a node.
- * Accepts the keys:
- *- `count`: a number which must equal the number of children
- *   that match
- *- `less_than`: the number of matching children must be greater
- *   than this number
- *- `greater_than` : the number of matching children must be less than
- *   this number
- *- `only` : another hash consisting of the keys to use to match
- *   on the children, and only matching children will be
- *   counted
- *
- * <code>
- * // Matcher that asserts that there is an element with an id="my_id".
- * $matcher = array('id' => 'my_id');
- *
- * // Matcher that asserts that there is a "span" tag.
- * $matcher = array('tag' => 'span');
- *
- * // Matcher that asserts that there is a "span" tag with the content
- * // "Hello World".
- * $matcher = array('tag' => 'span', 'content' => 'Hello World');
- *
- * // Matcher that asserts that there is a "span" tag with content matching
- * // the regular expression pattern.
- * $matcher = array('tag' => 'span', 'content' => '/Try P(HP|ython)/');
- *
- * // Matcher that asserts that there is a "span" with an "list" class
- * // attribute.
- * $matcher = array(
- *   'tag'=> 'span',
- *   'attributes' => array('class' => 'list')
- * );
- *
- * // Matcher that asserts that there is a "span" inside of a "div".
- * $matcher = array(
- *   'tag'=> 'span',
- *   'parent' => array('tag' => 'div')
- * );
- *
- * // Matcher that asserts that there is a "span" somewhere inside a
- * // "table".
- * $matcher = array(
- *   'tag'  => 'span',
- *   'ancestor' => array('tag' => 'table')
- * );
- *
- * // Matcher that asserts that there is a "span" with at least one "em"
- * // child.
- * $matcher = array(
- *   'tag'   => 'span',
- *   'child' => array('tag' => 'em')
- * );
- *
- * // Matcher that asserts that there is a "span" containing a (possibly
- * // nested) "strong" tag.
- * $matcher = array(
- *   'tag'=> 'span',
- *   'descendant' => array('tag' => 'strong')
- * );
- *
- * // Matcher that asserts that there is a "span" containing 5-10 "em" tags
- * // as immediate children.
- * $matcher = array(
- *   'tag'  => 'span',
- *   'children' => array(
- * 'less_than'=> 11,
- * 'greater_than' => 4,
- * 'only' => array('tag' => 'em')
- *   )
- * );
- *
- * // Matcher that asserts that there is a "div", with an "ul" ancestor and
- * // a "li" parent (with class="enum"), and containing a "span" descendant
- * // that contains an element with id="my_test" and the text "Hello World".
- * $matcher = array(
- *   'tag'=> 'div',
- *   'ancestor'   => array('tag' => 'ul'),
- *   'parent' => array(
- * 'tag'=> 'li',
- * 'attributes' => array('class' => 'enum')
- *   ),
- *   'descendant' => array(
- * 'tag'   => 'span',
- * 'child' => array(
- *   'id'  => 'my_test',
- *   'content' => 'Hello World'
- * )
- *   )
- * );
- *
- * // Use assertTag() to apply a $matcher to a piece of $html.
- * $this->assertTag($matcher, $html);
- *
- * // Use assertTag() to apply a $matcher to a piece of $xml.
- * $this->assertTag($matcher, $xml, '', FALSE);
- * </code>
- *
- * The second argument ($actual) is a string containing either HTML or
- * XML text to be tested.
- *
- * The third argument ($message) is an optional message that will be
- * used if the assertion fails.
- *
- * The fourth argument ($html) is an optional flag specifying whether
- * to load the $actual string into a DOMDocument using the HTML or
- * XML load strategy.  It is TRUE by default, which assumes the HTML
- * load strategy.  In many cases, this will be acceptable for XML as well.
- *
- * @param  array   $matcher
- * @param  string  $actual
- * @param  string  $message
- * @param  boolean $isHtml
- * @since  Method available since Release 3.3.0
- * @author Mike Naberezny <mike@maintainable.com>
- * @author Derek DeVries <derek@maintainable.com>
- */
-function assertTag($matcher, $actual, $message = '', $isHtml = TRUE)
-{
-    return PHPUnit_Framework_Assert::assertTag($matcher, $actual, $message, $isHtml);
-}
-
-/**
- * Evaluates a PHPUnit_Framework_Constraint matcher object.
- *
- * @param  mixed$value
- * @param  PHPUnit_Framework_Constraint $constraint
- * @param  string   $message
- * @since  Method available since Release 3.0.0
- */
-function assertThat($value, PHPUnit_Framework_Constraint $constraint, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertThat($value, $constraint, $message);
-}
-
-/**
- * Asserts that a condition is true.
- *
- * @param  boolean $condition
- * @param  string  $message
- * @throws PHPUnit_Framework_AssertionFailedError
- */
-function assertTrue($condition, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertTrue($condition, $message);
-}
-
-/**
- * Asserts that a variable is of a given type.
- *
- * @param  string $expected
- * @param  mixed  $actual
- * @param  string $message
- */
-function assertType($expected, $actual, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertType($expected, $actual, $message);
-}
-
-/**
- * Asserts that two XML files are equal.
- *
- * @param  string $expectedFile
- * @param  string $actualFile
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertXmlFileEqualsXmlFile($expectedFile, $actualFile, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertXmlFileEqualsXmlFile($expectedFile, $actualFile, $message);
-}
-
-/**
- * Asserts that two XML files are not equal.
- *
- * @param  string $expectedFile
- * @param  string $actualFile
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertXmlFileNotEqualsXmlFile($expectedFile, $actualFile, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertXmlFileNotEqualsXmlFile($expectedFile, $actualFile, $message);
-}
-
-/**
- * Asserts that two XML documents are equal.
- *
- * @param  string $expectedFile
- * @param  string $actualXml
- * @param  string $message
- * @since  Method available since Release 3.3.0
- */
-function assertXmlStringEqualsXmlFile($expectedFile, $actualXml, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertXmlStringEqualsXmlFile($expectedFile, $actualXml, $message);
-}
-
-/**
- * Asserts that two XML documents are equal.
- *
- * @param  string $expectedXml
- * @param  string $actualXml
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertXmlStringEqualsXmlString($expectedXml, $actualXml, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertXmlStringEqualsXmlString($expectedXml, $actualXml, $message);
-}
-
-/**
- * Asserts that two XML documents are not equal.
- *
- * @param  string $expectedFile
- * @param  string $actualXml
- * @param  string $message
- * @since  Method available since Release 3.3.0
- */
-function assertXmlStringNotEqualsXmlFile($expectedFile, $actualXml, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertXmlStringNotEqualsXmlFile($expectedFile, $actualXml, $message);
-}
-
-/**
- * Asserts that two XML documents are not equal.
- *
- * @param  string $expectedXml
- * @param  string $actualXml
- * @param  string $message
- * @since  Method available since Release 3.1.0
- */
-function assertXmlStringNotEqualsXmlString($expectedXml, $actualXml, $message = '')
-{
-    return PHPUnit_Framework_Assert::assertXmlStringNotEqualsXmlString($expectedXml, $actualXml, $message);
-}
-
-/**
- * Returns a matcher that matches when the method it is evaluated for
- * is invoked at the given $index.
- *
- * @param  integer $index
- * @return PHPUnit_Framework_MockObject_Matcher_InvokedAtIndex
- * @since  Method available since Release 3.0.0
- */
-function at($index)
-{
-    return PHPUnit_Framework_TestCase::at($index);
-}
-
-/**
- * Returns a matcher that matches when the method it is evaluated for
- * is executed at least once.
- *
- * @return PHPUnit_Framework_MockObject_Matcher_InvokedAtLeastOnce
- * @since  Method available since Release 3.0.0
- */
-function atLeastOnce()
-{
-    return PHPUnit_Framework_TestCase::atLeastOnce();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_Attribute matcher object.
- *
- * @param  PHPUnit_Framework_Constraint $constraint
- * @param  string   $attributeName
- * @return PHPUnit_Framework_Constraint_Attribute
- * @since  Method available since Release 3.1.0
- */
-function attribute(PHPUnit_Framework_Constraint $constraint, $attributeName)
-{
-    return PHPUnit_Framework_Assert::attribute($constraint, $attributeName);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsEqual matcher object
- * that is wrapped in a PHPUnit_Framework_Constraint_Attribute matcher
- * object.
- *
- * @param  string  $attributeName
- * @param  mixed   $value
- * @param  float   $delta
- * @param  integer $maxDepth
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- * @return PHPUnit_Framework_Constraint_Attribute
- * @since  Method available since Release 3.1.0
- */
-function attributeEqualTo($attributeName, $value, $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::attributeEqualTo($attributeName, $value, $delta, $maxDepth, $canonicalize, $ignoreCase);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_ClassHasAttribute matcher object.
- *
- * @param  string $attributeName
- * @return PHPUnit_Framework_Constraint_ClassHasAttribute
- * @since  Method available since Release 3.1.0
- */
-function classHasAttribute($attributeName)
-{
-    return PHPUnit_Framework_Assert::classHasAttribute($attributeName);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_ClassHasStaticAttribute matcher
- * object.
- *
- * @param  string $attributeName
- * @return PHPUnit_Framework_Constraint_ClassHasStaticAttribute
- * @since  Method available since Release 3.1.0
- */
-function classHasStaticAttribute($attributeName)
-{
-    return PHPUnit_Framework_Assert::classHasStaticAttribute($attributeName);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_TraversableContains matcher
- * object.
- *
- * @param  mixed $value
- * @return PHPUnit_Framework_Constraint_TraversableContains
- * @since  Method available since Release 3.0.0
- */
-function contains($value)
-{
-    return PHPUnit_Framework_Assert::contains($value);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_TraversableContainsOnly matcher
- * object.
- *
- * @param  string $type
- * @return PHPUnit_Framework_Constraint_TraversableContainsOnly
- * @since  Method available since Release 3.1.4
- */
-function containsOnly($type)
-{
-    return PHPUnit_Framework_Assert::containsOnly($type);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsEqual matcher object.
- *
- * @param  mixed   $value
- * @param  float   $delta
- * @param  integer $maxDepth
- * @param  boolean $canonicalize
- * @param  boolean $ignoreCase
- * @return PHPUnit_Framework_Constraint_IsEqual
- * @since  Method available since Release 3.0.0
- */
-function equalTo($value, $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-{
-    return PHPUnit_Framework_Assert::equalTo($value, $delta, $maxDepth, $canonicalize, $ignoreCase);
-}
-
-/**
- * Returns a matcher that matches when the method it is evaluated for
- * is executed exactly $count times.
- *
- * @param  integer $count
- * @return PHPUnit_Framework_MockObject_Matcher_InvokedCount
- * @since  Method available since Release 3.0.0
- */
-function exactly($count)
-{
-    return PHPUnit_Framework_TestCase::exactly($count);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_FileExists matcher object.
- *
- * @return PHPUnit_Framework_Constraint_FileExists
- * @since  Method available since Release 3.0.0
- */
-function fileExists()
-{
-    return PHPUnit_Framework_Assert::fileExists();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_GreaterThan matcher object.
- *
- * @param  mixed $value
- * @return PHPUnit_Framework_Constraint_GreaterThan
- * @since  Method available since Release 3.0.0
- */
-function greaterThan($value)
-{
-    return PHPUnit_Framework_Assert::greaterThan($value);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_Or matcher object that wraps
- * a PHPUnit_Framework_Constraint_IsEqual and a
- * PHPUnit_Framework_Constraint_GreaterThan matcher object.
- *
- * @param  mixed $value
- * @return PHPUnit_Framework_Constraint_Or
- * @since  Method available since Release 3.1.0
- */
-function greaterThanOrEqual($value)
-{
-    return PHPUnit_Framework_Assert::greaterThanOrEqual($value);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsIdentical matcher object.
- *
- * @param  mixed $value
- * @return PHPUnit_Framework_Constraint_IsIdentical
- * @since  Method available since Release 3.0.0
- */
-function identicalTo($value)
-{
-    return PHPUnit_Framework_Assert::identicalTo($value);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsEmpty matcher object.
- *
- * @return PHPUnit_Framework_Constraint_IsEmpty
- * @since  Method available since Release 3.5.0
- */
-function isEmpty()
-{
-    return PHPUnit_Framework_Assert::isEmpty();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsFalse matcher object.
- *
- * @return PHPUnit_Framework_Constraint_IsFalse
- * @since  Method available since Release 3.3.0
- */
-function isFalse()
-{
-    return PHPUnit_Framework_Assert::isFalse();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsInstanceOf matcher object.
- *
- * @param  string $className
- * @return PHPUnit_Framework_Constraint_IsInstanceOf
- * @since  Method available since Release 3.0.0
- */
-function isInstanceOf($className)
-{
-    return PHPUnit_Framework_Assert::isInstanceOf($className);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsNull matcher object.
- *
- * @return PHPUnit_Framework_Constraint_IsNull
- * @since  Method available since Release 3.3.0
- */
-function isNull()
-{
-    return PHPUnit_Framework_Assert::isNull();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsTrue matcher object.
- *
- * @return PHPUnit_Framework_Constraint_IsTrue
- * @since  Method available since Release 3.3.0
- */
-function isTrue()
-{
-    return PHPUnit_Framework_Assert::isTrue();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_IsType matcher object.
- *
- * @param  string $type
- * @return PHPUnit_Framework_Constraint_IsType
- * @since  Method available since Release 3.0.0
- */
-function isType($type)
-{
-    return PHPUnit_Framework_Assert::isType($type);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_LessThan matcher object.
- *
- * @param  mixed $value
- * @return PHPUnit_Framework_Constraint_LessThan
- * @since  Method available since Release 3.0.0
- */
-function lessThan($value)
-{
-    return PHPUnit_Framework_Assert::lessThan($value);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_Or matcher object that wraps
- * a PHPUnit_Framework_Constraint_IsEqual and a
- * PHPUnit_Framework_Constraint_LessThan matcher object.
- *
- * @param  mixed $value
- * @return PHPUnit_Framework_Constraint_Or
- * @since  Method available since Release 3.1.0
- */
-function lessThanOrEqual($value)
-{
-    return PHPUnit_Framework_Assert::lessThanOrEqual($value);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_And matcher object.
- *
- * @return PHPUnit_Framework_Constraint_And
- * @since  Method available since Release 3.0.0
- */
-function logicalAnd()
-{
-    return PHPUnit_Framework_Assert::logicalAnd();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_Not matcher object.
- *
- * @param  PHPUnit_Framework_Constraint $constraint
- * @return PHPUnit_Framework_Constraint_Not
- * @since  Method available since Release 3.0.0
- */
-function logicalNot(PHPUnit_Framework_Constraint $constraint)
-{
-    return PHPUnit_Framework_Assert::logicalNot($constraint);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_Or matcher object.
- *
- * @return PHPUnit_Framework_Constraint_Or
- * @since  Method available since Release 3.0.0
- */
-function logicalOr()
-{
-    return PHPUnit_Framework_Assert::logicalOr();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_Xor matcher object.
- *
- * @return PHPUnit_Framework_Constraint_Xor
- * @since  Method available since Release 3.0.0
- */
-function logicalXor()
-{
-    return PHPUnit_Framework_Assert::logicalXor();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_StringMatches matcher object.
- *
- * @param  string $string
- * @return PHPUnit_Framework_Constraint_StringMatches
- * @since  Method available since Release 3.5.0
- */
-function matches($string)
-{
-    return PHPUnit_Framework_Assert::matches($string);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_PCREMatch matcher object.
- *
- * @param  string $pattern
- * @return PHPUnit_Framework_Constraint_PCREMatch
- * @since  Method available since Release 3.0.0
- */
-function matchesRegularExpression($pattern)
-{
-    return PHPUnit_Framework_Assert::matchesRegularExpression($pattern);
-}
-
-/**
- * Returns a matcher that matches when the method it is evaluated for
- * is never executed.
- *
- * @return PHPUnit_Framework_MockObject_Matcher_InvokedCount
- * @since  Method available since Release 3.0.0
- */
-function never()
-{
-    return PHPUnit_Framework_TestCase::never();
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_ObjectHasAttribute matcher object.
- *
- * @param  string $attributeName
- * @return PHPUnit_Framework_Constraint_ObjectHasAttribute
- * @since  Method available since Release 3.0.0
- */
-function objectHasAttribute($attributeName)
-{
-    return PHPUnit_Framework_Assert::objectHasAttribute($attributeName);
-}
-
-/**
- *
- *
- * @param  mixed $value, ...
- * @return PHPUnit_Framework_MockObject_Stub_ConsecutiveCalls
- * @since  Method available since Release 3.0.0
- */
-function onConsecutiveCalls()
-{
-    return PHPUnit_Framework_TestCase::onConsecutiveCalls();
-}
-
-/**
- * Returns a matcher that matches when the method it is evaluated for
- * is executed exactly once.
- *
- * @return PHPUnit_Framework_MockObject_Matcher_InvokedCount
- * @since  Method available since Release 3.0.0
- */
-function once()
-{
-    return PHPUnit_Framework_TestCase::once();
-}
-
-/**
- *
- *
- * @param  integer $argumentIndex
- * @return PHPUnit_Framework_MockObject_Stub_ReturnArgument
- * @since  Method available since Release 3.3.0
- */
-function returnArgument($argumentIndex)
-{
-    return PHPUnit_Framework_TestCase::returnArgument($argumentIndex);
-}
-
-/**
- *
- *
- * @param  mixed $callback
- * @return PHPUnit_Framework_MockObject_Stub_ReturnCallback
- * @since  Method available since Release 3.3.0
- */
-function returnCallback($callback)
-{
-    return PHPUnit_Framework_TestCase::returnCallback($callback);
-}
-
-/**
- *
- *
- * @param  mixed $value
- * @return PHPUnit_Framework_MockObject_Stub_Return
- * @since  Method available since Release 3.0.0
- */
-function returnValue($value)
-{
-    return PHPUnit_Framework_TestCase::returnValue($value);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_StringContains matcher object.
- *
- * @param  string  $string
- * @param  boolean $case
- * @return PHPUnit_Framework_Constraint_StringContains
- * @since  Method available since Release 3.0.0
- */
-function stringContains($string, $case = TRUE)
-{
-    return PHPUnit_Framework_Assert::stringContains($string, $case);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_StringEndsWith matcher object.
- *
- * @param  mixed $suffix
- * @return PHPUnit_Framework_Constraint_StringEndsWith
- * @since  Method available since Release 3.4.0
- */
-function stringEndsWith($suffix)
-{
-    return PHPUnit_Framework_Assert::stringEndsWith($suffix);
-}
-
-/**
- * Returns a PHPUnit_Framework_Constraint_StringStartsWith matcher object.
- *
- * @param  mixed $prefix
- * @return PHPUnit_Framework_Constraint_StringStartsWith
- * @since  Method available since Release 3.4.0
- */
-function stringStartsWith($prefix)
-{
-    return PHPUnit_Framework_Assert::stringStartsWith($prefix);
-}
-
-/**
- *
- *
- * @param  Exception $exception
- * @return PHPUnit_Framework_MockObject_Stub_Exception
- * @since  Method available since Release 3.1.0
- */
-function throwException(Exception $exception)
-{
-    return PHPUnit_Framework_TestCase::throwException($exception);
-}
diff --git a/tests/PHPUnit/Framework/Assert/Functions.php.in b/tests/PHPUnit/Framework/Assert/Functions.php.in
deleted file mode 100644
index f85afe6..0000000
--- a/tests/PHPUnit/Framework/Assert/Functions.php.in
+++ /dev/null
@@ -1,44 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */{functions}
diff --git a/tests/PHPUnit/Framework/AssertionFailedError.php b/tests/PHPUnit/Framework/AssertionFailedError.php
deleted file mode 100644
index 22104fb..0000000
--- a/tests/PHPUnit/Framework/AssertionFailedError.php
+++ /dev/null
@@ -1,69 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * Thrown when an assertion failed.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Framework_AssertionFailedError extends Exception implements PHPUnit_Framework_SelfDescribing
-{
-    /**
-     * Wrapper for getMessage() which is declared as final.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return $this->getMessage();
-    }
-}
diff --git a/tests/PHPUnit/Framework/ComparisonFailure.php b/tests/PHPUnit/Framework/ComparisonFailure.php
deleted file mode 100644
index 35a6871..0000000
--- a/tests/PHPUnit/Framework/ComparisonFailure.php
+++ /dev/null
@@ -1,208 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * Thrown when an assertion for string equality failed.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-abstract class PHPUnit_Framework_ComparisonFailure extends PHPUnit_Framework_AssertionFailedError
-{
-    /**
-     * Expected value of the retrieval which does not match $actual.
-     * @var mixed
-     */
-    protected $expected;
-
-    /**
-     * Actually retrieved value which does not match $expected.
-     * @var mixed
-     */
-    protected $actual;
-
-    /**
-     * @var boolean
-     */
-    protected $identical;
-
-    /**
-     * Optional message which is placed in front of the first line
-     * returned by toString().
-     * @var string
-     */
-    protected $message;
-
-    /**
-     * Initialises with the expected value and the actual value.
-     *
-     * @param mixed $expected Expected value retrieved.
-     * @param mixed $actual Actual value retrieved.
-     * @param boolean $identical
-     * @param string $message A string which is prefixed on all returned lines
-     *                        in the difference output.
-     */
-    public function __construct($expected, $actual, $identical = FALSE, $message = '')
-    {
-        $this->expected  = $expected;
-        $this->actual    = $actual;
-        $this->identical = $identical;
-        $this->message   = $message;
-    }
-
-    /**
-     * @return mixed
-     */
-    public function getActual()
-    {
-        return $this->actual;
-    }
-
-    /**
-     * @return mixed
-     */
-    public function getExpected()
-    {
-        return $this->expected;
-    }
-
-    /**
-     * @return boolean
-     */
-    public function identical()
-    {
-        return $this->identical;
-    }
-
-    /**
-     * Figures out which diff class to use for the input types then
-     * instantiates that class and returns the object.
-     * @note The diff is type sensitive, if the type differs only the types
-     *       are shown.
-     *
-     * @param mixed $expected Expected value retrieved.
-     * @param mixed $actual Actual value retrieved.
-     * @param string $message A string which is prefixed on all returned lines
-     *                        in the difference output.
-     * @return PHPUnit_Framework_ComparisonFailure
-     */
-    public static function diffIdentical($expected, $actual, $message = '')
-    {
-        if (gettype($expected) !== gettype($actual)) {
-            return new PHPUnit_Framework_ComparisonFailure_Type(
-              $expected, $actual, TRUE, $message
-            );
-        }
-
-        else if (is_array($expected) && is_array($actual)) {
-            return new PHPUnit_Framework_ComparisonFailure_Array(
-              $expected, $actual, TRUE, $message
-            );
-        }
-
-        else if (is_object($expected) && is_object($actual)) {
-            return new PHPUnit_Framework_ComparisonFailure_Object(
-              $expected, $actual, TRUE, $message
-            );
-        }
-
-        else if (is_string($expected) && !is_object($actual)) {
-            return new PHPUnit_Framework_ComparisonFailure_String(
-              $expected, $actual, TRUE, $message
-            );
-        }
-
-        else if (is_null($expected) || is_scalar($expected)) {
-            return new PHPUnit_Framework_ComparisonFailure_Scalar(
-              $expected, $actual, TRUE, $message
-            );
-        }
-    }
-
-    /**
-     * Figures out which diff class to use for the input types then
-     * instantiates that class and returns the object.
-     * @note The diff is not type sensitive, if the type differs the $actual
-     *       value will be converted to the same type as the $expected.
-     *
-     * @param mixed $expected Expected value retrieved.
-     * @param mixed $actual Actual value retrieved.
-     * @param string $message A string which is prefixed on all returned lines
-     *                        in the difference output.
-     * @return PHPUnit_Framework_ComparisonFailure
-     */
-    public static function diffEqual($expected, $actual, $message = '')
-    {
-        if (is_array($expected) && is_array($actual)) {
-            return new PHPUnit_Framework_ComparisonFailure_Array(
-              $expected, $actual, FALSE, $message
-            );
-        }
-
-        else if (is_object($expected) && is_object($actual)) {
-            return new PHPUnit_Framework_ComparisonFailure_Object(
-              $expected, $actual, FALSE, $message
-            );
-        }
-
-        else if (is_string($expected) && !is_object($actual)) {
-            return new PHPUnit_Framework_ComparisonFailure_String(
-              $expected, $actual, FALSE, $message
-            );
-        }
-
-        else if (is_null($expected) || is_scalar($expected)) {
-            return new PHPUnit_Framework_ComparisonFailure_Scalar(
-              $expected, $actual, FALSE, $message
-            );
-        }
-    }
-}
diff --git a/tests/PHPUnit/Framework/ComparisonFailure/Array.php b/tests/PHPUnit/Framework/ComparisonFailure/Array.php
deleted file mode 100644
index 275d034..0000000
--- a/tests/PHPUnit/Framework/ComparisonFailure/Array.php
+++ /dev/null
@@ -1,138 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Thrown when an assertion for array equality failed.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_ComparisonFailure_Array extends PHPUnit_Framework_ComparisonFailure
-{
-    /**
-     * Returns a string describing the difference between the expected and the
-     * actual array.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        ksort($this->expected);
-        ksort($this->actual);
-
-        $diff = PHPUnit_Util_Diff::diff(
-          print_r($this->expected, TRUE),
-          print_r($this->actual, TRUE)
-        );
-
-        if ($diff !== FALSE) {
-            return trim($diff);
-        }
-
-        // Fallback: Either diff is not available or the print_r() output for
-        // the expected and the actual array are equal (but the arrays are not).
-
-        $expectedOnly = array();
-        $actualOnly   = array();
-        $diff         = '';
-
-        foreach ($this->expected as $expectedKey => $expectedValue) {
-            if (!array_key_exists($expectedKey, $this->actual)) {
-                $expectedOnly[] = $expectedKey;
-                continue;
-            }
-
-            if ($expectedValue === $this->actual[$expectedKey]) {
-                continue;
-            }
-
-            $diffObject = PHPUnit_Framework_ComparisonFailure::diffIdentical(
-              $expectedValue,
-              $this->actual[$expectedKey],
-              sprintf(
-                '%sarray key %s: ',
-
-                $this->message,
-                PHPUnit_Util_Type::toString($expectedKey)
-              )
-            );
-
-            $diff .= $diffObject->toString() . "\n";
-        }
-
-        foreach ($this->actual as $actualKey => $actualValue) {
-            if (!array_key_exists($actualKey, $this->expected)) {
-                $actualOnly[] = $actualKey;
-                continue;
-            }
-        }
-
-        foreach ($expectedOnly as $expectedKey) {
-            $diff .= sprintf(
-              "array key %s: only in expected %s\n",
-
-              PHPUnit_Util_Type::toString($expectedKey),
-              PHPUnit_Util_Type::toString($this->expected[$expectedKey])
-            );
-        }
-
-        foreach ($actualOnly as $actualKey) {
-            $diff .= sprintf(
-              "array key %s: only in actual %s\n",
-
-              PHPUnit_Util_Type::toString($actualKey),
-              PHPUnit_Util_Type::toString($this->actual[$actualKey])
-            );
-        }
-
-        return $diff;
-    }
-}
diff --git a/tests/PHPUnit/Framework/ComparisonFailure/Object.php b/tests/PHPUnit/Framework/ComparisonFailure/Object.php
deleted file mode 100644
index 4eeede0..0000000
--- a/tests/PHPUnit/Framework/ComparisonFailure/Object.php
+++ /dev/null
@@ -1,170 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Thrown when an assertion for object equality failed.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_ComparisonFailure_Object extends PHPUnit_Framework_ComparisonFailure
-{
-    /**
-     * Returns a string describing the difference between the expected and the
-     * actual object.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        $diff = PHPUnit_Util_Diff::diff(
-          print_r($this->expected, TRUE),
-          print_r($this->actual, TRUE)
-        );
-
-        if ($diff !== FALSE) {
-            return trim($diff);
-        }
-
-        // Fallback: Either diff is not available or the print_r() output for
-        // the expected and the actual object are equal (but the objects are
-        // not).
-
-        $expectedClass = get_class($this->expected);
-        $actualClass   = get_class($this->actual);
-
-        if ($expectedClass !== $actualClass) {
-            return sprintf(
-              "%s%sexpected class <%s>\n" .
-              '%sgot class      <%s>',
-
-              $this->message,
-              ($this->message != '') ? ' ' : '',
-              $expectedClass,
-              ($this->message != '') ? str_repeat(' ', strlen($this->message) + 1) : '',
-              $actualClass
-            );
-        } else {
-            $expectedReflection = new ReflectionClass($expectedClass);
-            $actualReflection   = new ReflectionClass($actualClass);
-
-            $diff = "in object of class <{$expectedClass}>:\n";
-            $i    = 0;
-
-            foreach($expectedReflection->getProperties() as $expectedAttribute) {
-                if ($expectedAttribute->isPrivate() ||
-                    $expectedAttribute->isProtected()) {
-                    continue;
-                }
-
-                $actualAttribute = $actualReflection->getProperty(
-                                     $expectedAttribute->getName()
-                                   );
-                $expectedValue   = $expectedAttribute->getValue(
-                                     $this->expected
-                                   );
-                $actualValue     = $actualAttribute->getValue($this->actual);
-
-                if ($expectedValue !== $actualValue) {
-                    if ($i > 0) {
-                        $diff .= "\n";
-                    }
-
-                    ++$i;
-
-                    $expectedType = gettype($expectedValue);
-                    $actualType   = gettype($actualValue);
-
-                    if ($expectedType !== $actualType) {
-                        $diffObject = new PHPUnit_Framework_ComparisonFailure_Type(
-                          $expectedValue,
-                          $actualValue,
-                          $this->message . 'attribute <' .
-                          $expectedAttribute->getName() . '>: '
-                        );
-
-                        $diff .= $diffObject->toString();
-                    }
-
-                    elseif (is_object($expectedValue)) {
-                        if (get_class($expectedValue) !== get_class($actualValue)) {
-                            $diffObject = new PHPUnit_Framework_ComparisonFailure_Type(
-                              $expectedValue,
-                              $actualValue,
-                              $this->message . 'attribute <' .
-                              $expectedAttribute->getName() . '>: '
-                            );
-
-                            $diff .= $diffObject->toString();
-                        } else {
-                            $diff .= 'attribute <' .
-                                     $expectedAttribute->getName() .
-                                     '> contains object <' .
-                                     get_class($expectedValue) .
-                                     '> with different attributes';
-                        }
-                    } else {
-                        $diffObject = PHPUnit_Framework_ComparisonFailure::diffIdentical(
-                          $expectedValue,
-                          $actualValue,
-                          $this->message . 'attribute <' .
-                          $expectedAttribute->getName() . '>: '
-                        );
-
-                        $diff .= $diffObject->toString();
-                    }
-                }
-            }
-
-            return $diff;
-        }
-    }
-}
diff --git a/tests/PHPUnit/Framework/ComparisonFailure/Scalar.php b/tests/PHPUnit/Framework/ComparisonFailure/Scalar.php
deleted file mode 100644
index 124230c..0000000
--- a/tests/PHPUnit/Framework/ComparisonFailure/Scalar.php
+++ /dev/null
@@ -1,74 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Thrown when an assertion for scalar equality failed.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_ComparisonFailure_Scalar extends PHPUnit_Framework_ComparisonFailure
-{
-    /**
-     * Returns a string describing the difference between the expected and the
-     * actual scalar value.
-     */
-    public function toString()
-    {
-        return sprintf(
-          'Failed asserting that %s %s %s.',
-
-          PHPUnit_Util_Type::toString($this->actual),
-          $this->identical ? 'is identical to' : 'matches expected',
-          PHPUnit_Util_Type::toString($this->expected)
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/ComparisonFailure/String.php b/tests/PHPUnit/Framework/ComparisonFailure/String.php
deleted file mode 100644
index 15f858c..0000000
--- a/tests/PHPUnit/Framework/ComparisonFailure/String.php
+++ /dev/null
@@ -1,82 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Thrown when an assertion for string equality failed.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_ComparisonFailure_String extends PHPUnit_Framework_ComparisonFailure
-{
-    /**
-     * Returns a string describing the difference between
-     * the expected and the actual string value.
-     */
-    public function toString()
-    {
-        $expected = (string)$this->expected;
-        $actual   = (string)$this->actual;
-        $diff     = PHPUnit_Util_Diff::diff($expected, $actual);
-
-        if ($diff === FALSE) {
-            $diff = '';
-        }
-
-        if (!empty($this->message)) {
-            $buffer = $this->message . "\n";
-        } else {
-            $buffer = '';
-        }
-
-        return trim($buffer . $diff);
-    }
-}
diff --git a/tests/PHPUnit/Framework/ComparisonFailure/Type.php b/tests/PHPUnit/Framework/ComparisonFailure/Type.php
deleted file mode 100644
index 9ee91e7..0000000
--- a/tests/PHPUnit/Framework/ComparisonFailure/Type.php
+++ /dev/null
@@ -1,73 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Thrown when an assertion for type equality failed.
- *
- * @package    PHPUnit
- * @subpackage Framework_ComparisonFailure
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_ComparisonFailure_Type extends PHPUnit_Framework_ComparisonFailure
-{
-    /**
-     * Returns a string describing the type difference between the expected
-     * and the actual value.
-     */
-    public function toString()
-    {
-        return sprintf(
-          '%s does not match expected type "%s".',
-
-          PHPUnit_Util_Type::toString($this->actual),
-          gettype($this->expected)
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint.php b/tests/PHPUnit/Framework/Constraint.php
deleted file mode 100644
index 1ae869f..0000000
--- a/tests/PHPUnit/Framework/Constraint.php
+++ /dev/null
@@ -1,170 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Abstract base class for constraints. which are placed upon any value.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 3.0.0
- */
-abstract class PHPUnit_Framework_Constraint implements Countable, PHPUnit_Framework_SelfDescribing
-{
-    /**
-     * Counts the number of constraint elements.
-     *
-     * @return integer
-     * @since  Method available since Release 3.4.0
-     */
-    public function count()
-    {
-        return 1;
-    }
-
-    /**
-     * Creates the appropriate exception for the constraint which can be caught
-     * by the unit test system. This can be called if a call to evaluate()
-     * fails.
-     *
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        throw new PHPUnit_Framework_ExpectationFailedException(
-          $this->failureDescription($other, $description, $not),
-          NULL
-        );
-    }
-
-    /**
-     * @param mixed   $other
-     * @param string  $description
-     * @param boolean $not
-     */
-    protected function failureDescription($other, $description, $not)
-    {
-        $failureDescription = $this->customFailureDescription(
-          $other, $description, $not
-        );
-
-        if ($failureDescription === NULL) {
-            $failureDescription = sprintf(
-              'Failed asserting that %s %s.',
-
-               PHPUnit_Util_Type::toString($other),
-               $this->toString()
-            );
-        }
-
-        if ($not) {
-            $failureDescription = self::negate($failureDescription);
-        }
-
-        if (!empty($description)) {
-            $failureDescription = $description . "\n" . $failureDescription;
-        }
-
-        return $failureDescription;
-    }
-
-    /**
-     * @param mixed   $other
-     * @param string  $description
-     * @param boolean $not
-     */
-    protected function customFailureDescription($other, $description, $not)
-    {
-    }
-
-    /**
-     * @param  string $string
-     * @return string
-     */
-    public static function negate($string)
-    {
-        return str_replace(
-          array(
-            'contains ',
-            'exists',
-            'has ',
-            'is ',
-            'matches ',
-            'starts with ',
-            'ends with ',
-            'not not '
-          ),
-          array(
-            'does not contain ',
-            'does not exist',
-            'does not have ',
-            'is not ',
-            'does not match ',
-            'starts not with ',
-            'ends not with ',
-            'not '
-          ),
-          $string
-        );
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    abstract public function evaluate($other);
-}
diff --git a/tests/PHPUnit/Framework/Constraint/And.php b/tests/PHPUnit/Framework/Constraint/And.php
deleted file mode 100644
index 3f03ba2..0000000
--- a/tests/PHPUnit/Framework/Constraint/And.php
+++ /dev/null
@@ -1,160 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Logical AND.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_And extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var PHPUnit_Framework_Constraint[]
-     */
-    protected $constraints = array();
-
-    /**
-     * @var PHPUnit_Framework_Constraint
-     */
-    protected $lastConstraint = NULL;
-
-    /**
-     * @param PHPUnit_Framework_Constraint[] $constraints
-     */
-    public function setConstraints(array $constraints)
-    {
-        $this->constraints = array();
-
-        foreach($constraints as $key => $constraint) {
-            if (!($constraint instanceof PHPUnit_Framework_Constraint)) {
-                throw new InvalidArgumentException(
-                  'All parameters to ' . __CLASS__ .
-                  ' must be a constraint object.'
-                );
-            }
-
-            $this->constraints[] = $constraint;
-        }
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        $this->lastConstraint = NULL;
-
-        foreach($this->constraints as $constraint) {
-            $this->lastConstraint = $constraint;
-
-            if (!$constraint->evaluate($other)) {
-                return FALSE;
-            }
-        }
-
-        return TRUE;
-    }
-
-    /**
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        $this->lastConstraint->fail($other, $description, $not);
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        $text = '';
-
-        foreach($this->constraints as $key => $constraint) {
-            if ($key > 0) {
-                $text .= ' and ';
-            }
-
-            $text .= $constraint->toString();
-        }
-
-        return $text;
-    }
-
-    /**
-     * Counts the number of constraint elements.
-     *
-     * @return integer
-     * @since  Method available since Release 3.4.0
-     */
-    public function count()
-    {
-        $count = 0;
-
-        foreach ($this->constraints as $constraint) {
-            $count += count($constraint);
-        }
-
-        return $count;
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/ArrayHasKey.php b/tests/PHPUnit/Framework/Constraint/ArrayHasKey.php
deleted file mode 100644
index f79506b..0000000
--- a/tests/PHPUnit/Framework/Constraint/ArrayHasKey.php
+++ /dev/null
@@ -1,113 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the array it is evaluated for has a given key.
- *
- * Uses array_key_exists() to check if the key is found in the input array, if
- * not found the evaluaton fails.
- *
- * The array key is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_ArrayHasKey extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var integer|string
-     */
-    protected $key;
-
-    /**
-     * @param integer|string $key
-     */
-    public function __construct($key)
-    {
-        $this->key = $key;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return array_key_exists($this->key, $other);
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'has the key ' . PHPUnit_Util_Type::toString($this->key);
-    }
-
-    /**
-     * @param mixed   $other
-     * @param string  $description
-     * @param boolean $not
-     */
-    protected function customFailureDescription($other, $description, $not)
-    {
-        return sprintf(
-          'Failed asserting that an array %s.',
-
-           $this->toString()
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/Attribute.php b/tests/PHPUnit/Framework/Constraint/Attribute.php
deleted file mode 100644
index 7233478..0000000
--- a/tests/PHPUnit/Framework/Constraint/Attribute.php
+++ /dev/null
@@ -1,149 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.0
- */
-
-/**
- *
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.0
- */
-
-class PHPUnit_Framework_Constraint_Attribute extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var string
-     */
-    protected $attributeName;
-
-    /**
-     * @var PHPUnit_Framework_Constraint
-     */
-    protected $constraint;
-
-    /**
-     * @param PHPUnit_Framework_Constraint $constraint
-     * @param string                       $attributeName
-     */
-    public function __construct(PHPUnit_Framework_Constraint $constraint, $attributeName)
-    {
-        $this->attributeName = $attributeName;
-        $this->constraint    = $constraint;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $this->constraint->evaluate(
-          PHPUnit_Framework_Assert::readAttribute(
-            $other, $this->attributeName
-          )
-        );
-    }
-
-    /**
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        parent::fail(
-          PHPUnit_Framework_Assert::readAttribute(
-            $other, $this->attributeName
-          ),
-          $description,
-          $not
-        );
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'attribute "' . $this->attributeName . '" ' .
-               $this->constraint->toString();
-    }
-
-    /**
-     * Counts the number of constraint elements.
-     *
-     * @return integer
-     * @since  Method available since Release 3.4.0
-     */
-    public function count()
-    {
-        return count($this->constraint);
-    }
-
-    /**
-     * @since Method available since Release 3.4.0
-     */
-    protected function customFailureDescription($other, $description, $not)
-    {
-        return sprintf(
-          'Failed asserting that %s.',
-
-           $this->toString()
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/ClassHasAttribute.php b/tests/PHPUnit/Framework/Constraint/ClassHasAttribute.php
deleted file mode 100644
index 57c29c4..0000000
--- a/tests/PHPUnit/Framework/Constraint/ClassHasAttribute.php
+++ /dev/null
@@ -1,110 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.0
- */
-
-/**
- * Constraint that asserts that the class it is evaluated for has a given
- * attribute.
- *
- * The attribute name is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.0
- */
-class PHPUnit_Framework_Constraint_ClassHasAttribute extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var string
-     */
-    protected $attributeName;
-
-    /**
-     * @param string $attributeName
-     */
-    public function __construct($attributeName)
-    {
-        $this->attributeName = $attributeName;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        $class = new ReflectionClass($other);
-
-        return $class->hasProperty($this->attributeName);
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return sprintf(
-          'has attribute "%s"',
-
-          $this->attributeName
-        );
-    }
-
-    protected function customFailureDescription($other, $description, $not)
-    {
-        return sprintf(
-          'Failed asserting that class "%s" %s.', $other, $this->toString()
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/ClassHasStaticAttribute.php b/tests/PHPUnit/Framework/Constraint/ClassHasStaticAttribute.php
deleted file mode 100644
index 6de9711..0000000
--- a/tests/PHPUnit/Framework/Constraint/ClassHasStaticAttribute.php
+++ /dev/null
@@ -1,97 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.0
- */
-
-/**
- * Constraint that asserts that the class it is evaluated for has a given
- * static attribute.
- *
- * The attribute name is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.0
- */
-class PHPUnit_Framework_Constraint_ClassHasStaticAttribute extends PHPUnit_Framework_Constraint_ClassHasAttribute
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        $class = new ReflectionClass($other);
-
-        if ($class->hasProperty($this->attributeName)) {
-            $attribute = $class->getProperty($this->attributeName);
-
-            return $attribute->isStatic();
-        } else {
-            return FALSE;
-        }
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     * @since  Method available since Release 3.3.0
-     */
-    public function toString()
-    {
-        return sprintf(
-          'has static attribute "%s"',
-
-          $this->attributeName
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/FileExists.php b/tests/PHPUnit/Framework/Constraint/FileExists.php
deleted file mode 100644
index 8e22a88..0000000
--- a/tests/PHPUnit/Framework/Constraint/FileExists.php
+++ /dev/null
@@ -1,112 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that checks if the file(name) that it is evaluated for exists.
- *
- * The file path to check is passed as $other in evaluate().
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_FileExists extends PHPUnit_Framework_Constraint
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return file_exists($other);
-    }
-
-    /**
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        $failureDescription = sprintf(
-          'Failed asserting that file "%s" exists.',
-
-           $other
-        );
-
-        if ($not) {
-            $failureDescription = self::negate($failureDescription);
-        }
-
-        if (!empty($description)) {
-            $failureDescription = $description . "\n" . $failureDescription;
-        }
-
-        throw new PHPUnit_Framework_ExpectationFailedException(
-          $failureDescription
-        );
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'file exists';
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/GreaterThan.php b/tests/PHPUnit/Framework/Constraint/GreaterThan.php
deleted file mode 100644
index bfe48f4..0000000
--- a/tests/PHPUnit/Framework/Constraint/GreaterThan.php
+++ /dev/null
@@ -1,95 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the value it is evaluated for is greater
- * than a given value.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_GreaterThan extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var numeric
-     */
-    protected $value;
-
-    /**
-     * @param numeric $value
-     */
-    public function __construct($value)
-    {
-        $this->value = $value;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $this->value < $other;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'is greater than ' . PHPUnit_Util_Type::toString($this->value);
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsAnything.php b/tests/PHPUnit/Framework/Constraint/IsAnything.php
deleted file mode 100644
index b559265..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsAnything.php
+++ /dev/null
@@ -1,103 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that accepts any input value.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_IsAnything extends PHPUnit_Framework_Constraint
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return TRUE;
-    }
-
-    /**
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'is anything';
-    }
-
-    /**
-     * Counts the number of constraint elements.
-     *
-     * @return integer
-     * @since  Method available since Release 3.5.0
-     */
-    public function count()
-    {
-        return 0;
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsEmpty.php b/tests/PHPUnit/Framework/Constraint/IsEmpty.php
deleted file mode 100644
index 80cf2df..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsEmpty.php
+++ /dev/null
@@ -1,102 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * Constraint that checks whether a variable is empty().
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.5.0
- */
-class PHPUnit_Framework_Constraint_IsEmpty extends PHPUnit_Framework_Constraint
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return empty($other);
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'is empty';
-    }
-
-    /**
-     * @param mixed   $other
-     * @param string  $description
-     * @param boolean $not
-     */
-    protected function customFailureDescription($other, $description, $not)
-    {
-        $type = gettype($other);
-
-        if ($type[0] == 'a' || $type[0] == 'o') {
-            $type = 'an ' . $type;
-        } else {
-            $type = 'a ' . $type;
-        }
-
-        return sprintf(
-          'Failed asserting that %s is empty.',
-          $type
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsEqual.php b/tests/PHPUnit/Framework/Constraint/IsEqual.php
deleted file mode 100644
index cd12d0d..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsEqual.php
+++ /dev/null
@@ -1,386 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Kore Nordmann <kn@ez.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that checks if one value is equal to another.
- *
- * Equality is checked with PHP's == operator, the operator is explained in
- * detail at {@url http://www.php.net/manual/en/types.comparisons.php}.
- * Two values are equal if they have the same value disregarding type.
- *
- * The expected value is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Kore Nordmann <kn@ez.no>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_IsEqual extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var mixed
-     */
-    protected $value;
-
-    /**
-     * @var float
-     */
-    protected $delta = 0;
-
-    /**
-     * @var integer
-     */
-    protected $maxDepth = 10;
-
-    /**
-     * @var boolean
-     */
-    protected $canonicalize = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $ignoreCase = FALSE;
-
-    /**
-     * @param mixed   $value
-     * @param float   $delta
-     * @param integer $maxDepth
-     * @param boolean $canonicalize
-     * @param boolean $ignoreCase
-     */
-    public function __construct($value, $delta = 0, $maxDepth = 10, $canonicalize = FALSE, $ignoreCase = FALSE)
-    {
-        if (!is_numeric($delta)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'numeric');
-        }
-
-        if (!is_int($maxDepth)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(3, 'integer');
-        }
-
-        if (!is_bool($canonicalize)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(4, 'boolean');
-        }
-
-        if (!is_bool($ignoreCase)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(5, 'boolean');
-        }
-
-        $this->value        = $value;
-        $this->delta        = $delta;
-        $this->maxDepth     = $maxDepth;
-        $this->canonicalize = $canonicalize;
-        $this->ignoreCase   = $ignoreCase;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $this->recursiveComparison($this->value, $other);
-    }
-
-    /**
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        $failureDescription = $this->failureDescription(
-          $other,
-          $description,
-          $not
-        );
-
-        if (!$not) {
-            if ($this->value instanceof DOMDocument) {
-                $value = $this->domToText($this->value);
-            } else {
-                $value = $this->value;
-            }
-
-            if ($other instanceof DOMDocument) {
-                $other = $this->domToText($other);
-            }
-
-            throw new PHPUnit_Framework_ExpectationFailedException(
-              $failureDescription,
-              PHPUnit_Framework_ComparisonFailure::diffEqual($value, $other),
-              $description
-            );
-        } else {
-            throw new PHPUnit_Framework_ExpectationFailedException(
-              $failureDescription,
-              NULL
-            );
-        }
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        $delta = '';
-
-        if (is_string($this->value)) {
-            if (strpos($this->value, "\n") !== FALSE) {
-                return 'is equal to <text>';
-            } else {
-                return sprintf(
-                  'is equal to <string:%s>',
-
-                  $this->value
-                );
-            }
-        } else {
-            if ($this->delta != 0) {
-                $delta = sprintf(
-                  ' with delta <%F>',
-
-                  $this->delta
-                );
-            }
-
-            return sprintf(
-              'is equal to %s%s',
-
-              PHPUnit_Util_Type::toString($this->value),
-              $delta
-            );
-        }
-    }
-
-    /**
-     * Perform the actual recursive comparision of two values
-     *
-     * @param mixed $a First value
-     * @param mixed $b Second value
-     * @param int $depth Depth
-     * @return bool
-     */
-    protected function recursiveComparison($a, $b, $depth = 0)
-    {
-        if ($a === $b) {
-            return TRUE;
-        }
-
-        if ($depth >= $this->maxDepth) {
-            return TRUE;
-        }
-
-        if (is_numeric($a) XOR is_numeric($b)) {
-            return FALSE;
-        }
-
-        if (is_array($a) XOR is_array($b)) {
-            return FALSE;
-        }
-
-        if (is_object($a) XOR is_object($b)) {
-            return FALSE;
-        }
-
-        if ($a instanceof SplObjectStorage XOR $b instanceof SplObjectStorage) {
-            return FALSE;
-        }
-
-        if ($a instanceof SplObjectStorage) {
-            foreach ($a as $object) {
-                if (!$b->contains($object)) {
-                    return FALSE;
-                }
-            }
-
-            foreach ($b as $object) {
-                if (!$a->contains($object)) {
-                    return FALSE;
-                }
-            }
-
-            return TRUE;
-        }
-
-        if ($a instanceof DOMDocument || $b instanceof DOMDocument) {
-            if (!$a instanceof DOMDocument) {
-                $_a = new DOMDocument;
-                $_a->preserveWhiteSpace = FALSE;
-                $_a->loadXML($a);
-                $a = $_a;
-                unset($_a);
-            }
-
-            if (!$b instanceof DOMDocument) {
-                $_b = new DOMDocument;
-                $_b->preserveWhiteSpace = FALSE;
-                $_b->loadXML($b);
-                $b = $_b;
-                unset($_b);
-            }
-
-            return $a->C14N() == $b->C14N();
-        }
-
-        if (is_object($a) && is_object($b) &&
-           (get_class($a) !== get_class($b))) {
-            return FALSE;
-        }
-
-        // Normal comparision for scalar values.
-        if ((!is_array($a) && !is_object($a)) ||
-            (!is_array($b) && !is_object($b))) {
-            if (is_numeric($a) && is_numeric($b)) {
-                // Optionally apply delta on numeric values.
-                return $this->numericComparison($a, $b);
-            }
-
-            if (is_string($a) && is_string($b)) {
-                if ($this->canonicalize && PHP_EOL != "\n") {
-                    $a = str_replace(PHP_EOL, "\n", $a);
-                    $b = str_replace(PHP_EOL, "\n", $b);
-                }
-
-                if ($this->ignoreCase) {
-                    $a = strtolower($a);
-                    $b = strtolower($b);
-                }
-            }
-
-            return ($a == $b);
-        }
-
-        if (is_object($a)) {
-            $isMock = $a instanceof PHPUnit_Framework_MockObject_MockObject;
-            $a      = (array)$a;
-            $b      = (array)$b;
-
-            if ($isMock) {
-                unset($a["\0*\0invocationMocker"]);
-
-                if (isset($b["\0*\0invocationMocker"])) {
-                    unset($b["\0*\0invocationMocker"]);
-                }
-            }
-        }
-
-        if ($this->canonicalize) {
-            sort($a);
-            sort($b);
-        }
-
-        $keysInB = array_flip(array_keys($b));
-
-        foreach ($a as $key => $v) {
-            if (!isset($keysInB[$key])) {
-                // Abort on missing key in $b.
-                return FALSE;
-            }
-
-            if (!$this->recursiveComparison($a[$key], $b[$key], $depth + 1)) {
-                // FALSE, if child comparision fails.
-                return FALSE;
-            }
-
-            // Unset key to check whether all keys of b are compared.
-            unset($b[$key]);
-        }
-
-        if (count($b)) {
-            // There is something in $b, that is missing in $a.
-            return FALSE;
-        }
-
-        return TRUE;
-    }
-
-    /**
-     * Compares two numeric values - use delta if applicable.
-     *
-     * @param mixed $a
-     * @param mixed $b
-     * @return bool
-     */
-    protected function numericComparison($a, $b)
-    {
-        if ($this->delta === FALSE) {
-            return ($a == $b);
-        } else {
-            return (abs($a - $b) <= $this->delta);
-        }
-    }
-
-    /**
-     * Returns the normalized, whitespace-cleaned, and indented textual
-     * representation of a DOMDocument.
-     *
-     * @param DOMDocument $document
-     * @return string
-     */
-    protected function domToText(DOMDocument $document)
-    {
-        $document->formatOutput = TRUE;
-        $document->normalizeDocument();
-
-        return $document->saveXML();
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsFalse.php b/tests/PHPUnit/Framework/Constraint/IsFalse.php
deleted file mode 100644
index d61149e..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsFalse.php
+++ /dev/null
@@ -1,81 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Constraint that accepts FALSE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Framework_Constraint_IsFalse extends PHPUnit_Framework_Constraint
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $other === FALSE;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'is false';
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsIdentical.php b/tests/PHPUnit/Framework/Constraint/IsIdentical.php
deleted file mode 100644
index 7fc089e..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsIdentical.php
+++ /dev/null
@@ -1,140 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that one value is identical to another.
- *
- * Identical check is performed with PHP's === operator, the operator is
- * explained in detail at
- * {@url http://www.php.net/manual/en/types.comparisons.php}.
- * Two values are identical if they have the same value and are of the same
- * type.
- *
- * The expected value is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_IsIdentical extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var mixed
-     */
-    protected $value;
-
-    /**
-     * @param mixed $value
-     */
-    public function __construct($value)
-    {
-        $this->value = $value;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $this->value === $other;
-    }
-
-    /**
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        $failureDescription = $this->failureDescription(
-          $other,
-          $description,
-          $not
-        );
-
-        if (!$not) {
-            throw new PHPUnit_Framework_ExpectationFailedException(
-              $failureDescription,
-              PHPUnit_Framework_ComparisonFailure::diffIdentical(
-                $this->value, $other
-              ),
-              $description
-            );
-        } else {
-            throw new PHPUnit_Framework_ExpectationFailedException(
-              $failureDescription,
-              NULL
-            );
-        }
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        if (is_object($this->value)) {
-            return 'is identical to an object of class "' .
-                   get_class($this->value) . '"';
-        } else {
-            return 'is identical to ' .
-                   PHPUnit_Util_Type::toString($this->value);
-        }
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsInstanceOf.php b/tests/PHPUnit/Framework/Constraint/IsInstanceOf.php
deleted file mode 100644
index 39d559e..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsInstanceOf.php
+++ /dev/null
@@ -1,128 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the object it is evaluated for is an instance
- * of a given class.
- *
- * The expected class name is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_IsInstanceOf extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var string
-     */
-    protected $className;
-
-    /**
-     * @param string $className
-     */
-    public function __construct($className)
-    {
-        $this->className = $className;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return ($other instanceof $this->className);
-    }
-
-    /**
-     * Creates the appropriate exception for the constraint which can be caught
-     * by the unit test system. This can be called if a call to evaluate()
-     * fails.
-     *
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        throw new PHPUnit_Framework_ExpectationFailedException(
-          sprintf(
-            '%sFailed asserting that %s is %san instance of class "%s".',
-
-            !empty($description) ? $description . "\n" : '',
-            PHPUnit_Util_Type::toString($other, TRUE),
-            $not ? 'not ' : '',
-            $this->className
-          ),
-          NULL
-        );
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return sprintf(
-          'is instance of class "%s"',
-
-          $this->className
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsNull.php b/tests/PHPUnit/Framework/Constraint/IsNull.php
deleted file mode 100644
index 12e04bd..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsNull.php
+++ /dev/null
@@ -1,81 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Constraint that accepts NULL.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Framework_Constraint_IsNull extends PHPUnit_Framework_Constraint
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $other === NULL;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'is null';
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsTrue.php b/tests/PHPUnit/Framework/Constraint/IsTrue.php
deleted file mode 100644
index 46941c3..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsTrue.php
+++ /dev/null
@@ -1,81 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Constraint that accepts TRUE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Framework_Constraint_IsTrue extends PHPUnit_Framework_Constraint
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $other === TRUE;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'is true';
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/IsType.php b/tests/PHPUnit/Framework/Constraint/IsType.php
deleted file mode 100644
index 87ba76f..0000000
--- a/tests/PHPUnit/Framework/Constraint/IsType.php
+++ /dev/null
@@ -1,183 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the value it is evaluated for is of a
- * specified type.
- *
- * The expected value is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_IsType extends PHPUnit_Framework_Constraint
-{
-    const TYPE_ARRAY    = 'array';
-    const TYPE_BOOL     = 'bool';
-    const TYPE_FLOAT    = 'float';
-    const TYPE_INT      = 'int';
-    const TYPE_NULL     = 'null';
-    const TYPE_NUMERIC  = 'numeric';
-    const TYPE_OBJECT   = 'object';
-    const TYPE_RESOURCE = 'resource';
-    const TYPE_STRING   = 'string';
-    const TYPE_SCALAR   = 'scalar';
-
-    /**
-     * @var array
-     */
-    protected $types = array(
-      'array' => TRUE,
-      'boolean' => TRUE,
-      'bool' => TRUE,
-      'float' => TRUE,
-      'integer' => TRUE,
-      'int' => TRUE,
-      'null' => TRUE,
-      'numeric' => TRUE,
-      'object' => TRUE,
-      'resource' => TRUE,
-      'string' => TRUE,
-      'scalar' => TRUE
-    );
-
-    /**
-     * @var string
-     */
-    protected $type;
-
-    /**
-     * @param  string $type
-     * @throws InvalidArgumentException
-     */
-    public function __construct($type)
-    {
-        if (!isset($this->types[$type])) {
-            throw new InvalidArgumentException(
-              sprintf(
-                'Type specified for PHPUnit_Framework_Constraint_IsType <%s> ' .
-                'is not a valid type.',
-                $type
-              )
-            );
-        }
-
-        $this->type = $type;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        switch ($this->type) {
-            case 'numeric': {
-                return is_numeric($other);
-            }
-
-            case 'integer':
-            case 'int': {
-                return is_integer($other);
-            }
-
-            case 'float': {
-                return is_float($other);
-            }
-
-            case 'string': {
-                return is_string($other);
-            }
-
-            case 'boolean':
-            case 'bool': {
-                return is_bool($other);
-            }
-
-            case 'null': {
-                return is_null($other);
-            }
-
-            case 'array': {
-                return is_array($other);
-            }
-
-            case 'object': {
-                return is_object($other);
-            }
-
-            case 'resource': {
-                return is_resource($other);
-            }
-
-            case 'scalar': {
-                return is_scalar($other);
-            }
-        }
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return sprintf(
-          'is of type "%s"',
-
-          $this->type
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/LessThan.php b/tests/PHPUnit/Framework/Constraint/LessThan.php
deleted file mode 100644
index c5e30c3..0000000
--- a/tests/PHPUnit/Framework/Constraint/LessThan.php
+++ /dev/null
@@ -1,95 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the value it is evaluated for is less than
- * a given value.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_LessThan extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var numeric
-     */
-    protected $value;
-
-    /**
-     * @param numeric $value
-     */
-    public function __construct($value)
-    {
-        $this->value = $value;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return $this->value > $other;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'is less than ' . PHPUnit_Util_Type::toString($this->value);
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/Not.php b/tests/PHPUnit/Framework/Constraint/Not.php
deleted file mode 100644
index 890d6cc..0000000
--- a/tests/PHPUnit/Framework/Constraint/Not.php
+++ /dev/null
@@ -1,141 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Logical NOT.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-
-class PHPUnit_Framework_Constraint_Not extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var PHPUnit_Framework_Constraint
-     */
-    protected $constraint;
-
-    /**
-     * @param PHPUnit_Framework_Constraint $constraint
-     */
-    public function __construct($constraint)
-    {
-        if (!($constraint instanceof PHPUnit_Framework_Constraint)) {
-            $constraint = new PHPUnit_Framework_Constraint_IsEqual($constraint);
-        }
-
-        $this->constraint = $constraint;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return !$this->constraint->evaluate($other);
-    }
-
-    /**
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        if (count($this->constraint) == 1 ||
-            $this->constraint instanceof PHPUnit_Framework_Constraint_Attribute) {
-            $this->constraint->fail($other, $description, TRUE);
-        } else {
-            parent::fail($other, $description, !$not);
-        }
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        switch (get_class($this->constraint)) {
-            case 'PHPUnit_Framework_Constraint_And':
-            case 'PHPUnit_Framework_Constraint_Not':
-            case 'PHPUnit_Framework_Constraint_Or': {
-                return 'not( ' . $this->constraint->toString() . ' )';
-            }
-            break;
-
-            default: {
-                return PHPUnit_Framework_Constraint::negate(
-                  $this->constraint->toString()
-                );
-            }
-        }
-    }
-
-    /**
-     * Counts the number of constraint elements.
-     *
-     * @return integer
-     * @since  Method available since Release 3.4.0
-     */
-    public function count()
-    {
-        return count($this->constraint);
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/ObjectHasAttribute.php b/tests/PHPUnit/Framework/Constraint/ObjectHasAttribute.php
deleted file mode 100644
index 162513d..0000000
--- a/tests/PHPUnit/Framework/Constraint/ObjectHasAttribute.php
+++ /dev/null
@@ -1,84 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the object it is evaluated for has a given
- * attribute.
- *
- * The attribute name is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_ObjectHasAttribute extends PHPUnit_Framework_Constraint_ClassHasAttribute
-{
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        $object = new ReflectionObject($other);
-
-        return $object->hasProperty($this->attributeName);
-    }
-
-    protected function customFailureDescription($other, $description, $not)
-    {
-        return sprintf(
-          'Failed asserting that object of class "%s" %s.',
-          get_class($other), $this->toString()
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/Or.php b/tests/PHPUnit/Framework/Constraint/Or.php
deleted file mode 100644
index 12070e4..0000000
--- a/tests/PHPUnit/Framework/Constraint/Or.php
+++ /dev/null
@@ -1,137 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Logical OR.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_Or extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var PHPUnit_Framework_Constraint[]
-     */
-    protected $constraints = array();
-
-    /**
-     * @param PHPUnit_Framework_Constraint[] $constraints
-     */
-    public function setConstraints(array $constraints)
-    {
-        $this->constraints = array();
-
-        foreach($constraints as $key => $constraint) {
-            if (!($constraint instanceof PHPUnit_Framework_Constraint)) {
-                $constraint = new PHPUnit_Framework_Constraint_IsEqual(
-                  $constraint
-                );
-            }
-
-            $this->constraints[] = $constraint;
-        }
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        foreach($this->constraints as $constraint) {
-            if ($constraint->evaluate($other)) {
-                return TRUE;
-            }
-        }
-
-        return FALSE;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        $text = '';
-
-        foreach($this->constraints as $key => $constraint) {
-            if ($key > 0) {
-                $text .= ' or ';
-            }
-
-            $text .= $constraint->toString();
-        }
-
-        return $text;
-    }
-
-    /**
-     * Counts the number of constraint elements.
-     *
-     * @return integer
-     * @since  Method available since Release 3.4.0
-     */
-    public function count()
-    {
-        $count = 0;
-
-        foreach ($this->constraints as $constraint) {
-            $count += count($constraint);
-        }
-
-        return $count;
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/PCREMatch.php b/tests/PHPUnit/Framework/Constraint/PCREMatch.php
deleted file mode 100644
index 59fca9d..0000000
--- a/tests/PHPUnit/Framework/Constraint/PCREMatch.php
+++ /dev/null
@@ -1,104 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the string it is evaluated for matches
- * a regular expression.
- *
- * Checks a given value using the Perl Compatible Regular Expression extension
- * in PHP. The pattern is matched by executing preg_match().
- *
- * The pattern string passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_PCREMatch extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var string
-     */
-    protected $pattern;
-
-    /**
-     * @param string $pattern
-     */
-    public function __construct($pattern)
-    {
-        $this->pattern = $pattern;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return preg_match($this->pattern, $other) > 0;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return sprintf(
-          'matches PCRE pattern "%s"',
-
-          $this->pattern
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/StringContains.php b/tests/PHPUnit/Framework/Constraint/StringContains.php
deleted file mode 100644
index 3fb24b4..0000000
--- a/tests/PHPUnit/Framework/Constraint/StringContains.php
+++ /dev/null
@@ -1,121 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the string it is evaluated for contains
- * a given string.
- *
- * Uses strpos() to find the position of the string in the input, if not found
- * the evaluaton fails.
- *
- * The sub-string is passed in the constructor.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_StringContains extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var string
-     */
-    protected $string;
-
-    /**
-     * @var boolean
-     */
-    protected $ignoreCase;
-
-    /**
-     * @param string  $string
-     * @param boolean $ignoreCase
-     */
-    public function __construct($string, $ignoreCase = FALSE)
-    {
-        $this->string     = $string;
-        $this->ignoreCase = $ignoreCase;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        if ($this->ignoreCase) {
-            return stripos($other, $this->string) !== FALSE;
-        } else {
-            return strpos($other, $this->string) !== FALSE;
-        }
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        if ($this->ignoreCase) {
-            $string = strtolower($this->string);
-        } else {
-            $string = $this->string;
-        }
-
-        return sprintf(
-          'contains "%s"',
-
-          $string
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/StringEndsWith.php b/tests/PHPUnit/Framework/Constraint/StringEndsWith.php
deleted file mode 100644
index 0c904f8..0000000
--- a/tests/PHPUnit/Framework/Constraint/StringEndsWith.php
+++ /dev/null
@@ -1,95 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- * Constraint that asserts that the string it is evaluated for ends with a given
- * suffix.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Framework_Constraint_StringEndsWith extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var string
-     */
-    protected $suffix;
-
-    /**
-     * @param string $suffix
-     */
-    public function __construct($suffix)
-    {
-        $this->suffix = $suffix;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return substr($other, 0 - strlen($this->suffix)) == $this->suffix;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'ends with "' . $this->suffix . '"';
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/StringMatches.php b/tests/PHPUnit/Framework/Constraint/StringMatches.php
deleted file mode 100644
index cd31839..0000000
--- a/tests/PHPUnit/Framework/Constraint/StringMatches.php
+++ /dev/null
@@ -1,140 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * ...
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.5.0
- */
-class PHPUnit_Framework_Constraint_StringMatches extends PHPUnit_Framework_Constraint_PCREMatch
-{
-    /**
-     * @var string
-     */
-    protected $string;
-
-    /**
-     * @param string $string
-     */
-    public function __construct($string)
-    {
-        $this->pattern = preg_quote(preg_replace('/\r\n/', "\n", $string), '/');
-        $this->pattern = str_replace(
-          array(
-            '%e',
-            '%s',
-            '%S',
-            '%a',
-            '%A',
-            '%w',
-            '%i',
-            '%d',
-            '%x',
-            '%f',
-            '%c'
-          ),
-          array(
-            '\\' . DIRECTORY_SEPARATOR,
-            '[^\r\n]+',
-            '[^\r\n]*',
-            '.+',
-            '.*',
-            '\s*',
-            '[+-]?\d+',
-            '\d+',
-            '[0-9a-fA-F]+',
-            '[+-]?\.?\d+\.?\d*(?:[Ee][+-]?\d+)?',
-            '.'
-          ),
-          $this->pattern
-        );
-
-        $this->pattern = '/^' . $this->pattern . '$/s';
-        $this->string  = $string;
-    }
-
-    /**
-     * Creates the appropriate exception for the constraint which can be caught
-     * by the unit test system. This can be called if a call to evaluate()
-     * fails.
-     *
-     * @param   mixed   $other The value passed to evaluate() which failed the
-     *                         constraint check.
-     * @param   string  $description A string with extra description of what was
-     *                               going on while the evaluation failed.
-     * @param   boolean $not Flag to indicate negation.
-     * @throws  PHPUnit_Framework_ExpectationFailedException
-     */
-    public function fail($other, $description, $not = FALSE)
-    {
-        $failureDescription = $this->failureDescription(
-          $other,
-          $description,
-          $not
-        );
-
-        if (!$not) {
-            throw new PHPUnit_Framework_ExpectationFailedException(
-              $failureDescription,
-              PHPUnit_Framework_ComparisonFailure::diffEqual(
-                $this->string, $other
-              ),
-              $description
-            );
-        } else {
-            throw new PHPUnit_Framework_ExpectationFailedException(
-              $failureDescription,
-              NULL
-            );
-        }
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/StringStartsWith.php b/tests/PHPUnit/Framework/Constraint/StringStartsWith.php
deleted file mode 100644
index 20fbc45..0000000
--- a/tests/PHPUnit/Framework/Constraint/StringStartsWith.php
+++ /dev/null
@@ -1,95 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- * Constraint that asserts that the string it is evaluated for begins with a
- * given prefix.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Framework_Constraint_StringStartsWith extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var string
-     */
-    protected $prefix;
-
-    /**
-     * @param string $prefix
-     */
-    public function __construct($prefix)
-    {
-        $this->prefix = $prefix;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        return strpos($other, $this->prefix) === 0;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'starts with "' . $this->prefix . '"';
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/TraversableContains.php b/tests/PHPUnit/Framework/Constraint/TraversableContains.php
deleted file mode 100644
index e048bd1..0000000
--- a/tests/PHPUnit/Framework/Constraint/TraversableContains.php
+++ /dev/null
@@ -1,127 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Constraint that asserts that the Traversable it is applied to contains
- * a given value.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_TraversableContains extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var mixed
-     */
-    protected $value;
-
-    /**
-     * @param mixed $value
-     */
-    public function __construct($value)
-    {
-        $this->value = $value;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        if ($other instanceof SplObjectStorage) {
-            return $other->contains($this->value);
-        }
-
-        if (is_object($this->value)) {
-            foreach ($other as $element) {
-                if ($element === $this->value) {
-                    return TRUE;
-                }
-            }
-        } else {
-            foreach ($other as $element) {
-                if ($element == $this->value) {
-                    return TRUE;
-                }
-            }
-        }
-
-        return FALSE;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        if (is_string($this->value) && strpos($this->value, "\n") !== FALSE) {
-            return 'contains "' . $this->value . '"';
-        } else {
-            return 'contains ' . PHPUnit_Util_Type::toString($this->value);
-        }
-    }
-
-    protected function customFailureDescription($other, $description, $not)
-    {
-        return sprintf(
-          'Failed asserting that an %s %s.',
-
-           is_array($other) ? 'array' : 'iterator',
-           $this->toString()
-        );
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/TraversableContainsOnly.php b/tests/PHPUnit/Framework/Constraint/TraversableContainsOnly.php
deleted file mode 100644
index 260a970..0000000
--- a/tests/PHPUnit/Framework/Constraint/TraversableContainsOnly.php
+++ /dev/null
@@ -1,115 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.4
- */
-
-/**
- * Constraint that asserts that the Traversable it is applied to contains
- * only values of a given type.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.4
- */
-class PHPUnit_Framework_Constraint_TraversableContainsOnly extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var PHPUnit_Framework_Constraint
-     */
-    protected $constraint;
-
-    /**
-     * @var string
-     */
-    protected $type;
-
-    /**
-     * @param string  $type
-     * @param boolean $isNativeType
-     */
-    public function __construct($type, $isNativeType = TRUE)
-    {
-        if ($isNativeType) {
-            $this->constraint = new PHPUnit_Framework_Constraint_IsType($type);
-        } else {
-            $this->constraint = new PHPUnit_Framework_Constraint_IsInstanceOf(
-              $type
-            );
-        }
-
-        $this->type = $type;
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        foreach ($other as $item) {
-            if (!$this->constraint->evaluate($item)) {
-                return FALSE;
-            }
-        }
-
-        return TRUE;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return 'contains only values of type "' . $this->type . '"';
-    }
-}
diff --git a/tests/PHPUnit/Framework/Constraint/Xor.php b/tests/PHPUnit/Framework/Constraint/Xor.php
deleted file mode 100644
index 285f3fe..0000000
--- a/tests/PHPUnit/Framework/Constraint/Xor.php
+++ /dev/null
@@ -1,144 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Logical XOR.
- *
- * @package    PHPUnit
- * @subpackage Framework_Constraint
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_Constraint_Xor extends PHPUnit_Framework_Constraint
-{
-    /**
-     * @var PHPUnit_Framework_Constraint[]
-     */
-    protected $constraints = array();
-
-    /**
-     * @param PHPUnit_Framework_Constraint[] $constraints
-     */
-    public function setConstraints(array $constraints)
-    {
-        $this->constraints = array();
-
-        foreach($constraints as $key => $constraint) {
-            if (!($constraint instanceof PHPUnit_Framework_Constraint)) {
-                $constraint = new PHPUnit_Framework_Constraint_IsEqual(
-                  $constraint
-                );
-            }
-
-            $this->constraints[] = $constraint;
-        }
-    }
-
-    /**
-     * Evaluates the constraint for parameter $other. Returns TRUE if the
-     * constraint is met, FALSE otherwise.
-     *
-     * @param mixed $other Value or object to evaluate.
-     * @return bool
-     */
-    public function evaluate($other)
-    {
-        $result = FALSE;
-
-        foreach($this->constraints as $constraint) {
-            if ($constraint->evaluate($other)) {
-                if ( $result )
-                {
-                    return FALSE;
-                }
-
-                $result = TRUE;
-            }
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns a string representation of the constraint.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        $text = '';
-
-        foreach($this->constraints as $key => $constraint) {
-            if ($key > 0) {
-                $text .= ' xor ';
-            }
-
-            $text .= $constraint->toString();
-        }
-
-        return $text;
-    }
-
-    /**
-     * Counts the number of constraint elements.
-     *
-     * @return integer
-     * @since  Method available since Release 3.4.0
-     */
-    public function count()
-    {
-        $count = 0;
-
-        foreach ($this->constraints as $constraint) {
-            $count += count($constraint);
-        }
-
-        return $count;
-    }
-}
diff --git a/tests/PHPUnit/Framework/Error.php b/tests/PHPUnit/Framework/Error.php
deleted file mode 100644
index e446f82..0000000
--- a/tests/PHPUnit/Framework/Error.php
+++ /dev/null
@@ -1,77 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.2.0
- */
-
-/**
- * Wrapper for PHP errors.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.2.0
- */
-class PHPUnit_Framework_Error extends Exception
-{
-    /**
-     * Constructor.
-     *
-     * @param  string  $message
-     * @param  integer $code
-     * @param  string  $file
-     * @param  integer $line
-     * @param  array   $trace
-     */
-    public function __construct($message, $code, $file, $line, $trace)
-    {
-        parent::__construct($message, $code);
-
-        $this->file  = $file;
-        $this->line  = $line;
-        $this->trace = $trace;
-    }
-}
diff --git a/tests/PHPUnit/Framework/Error/Notice.php b/tests/PHPUnit/Framework/Error/Notice.php
deleted file mode 100644
index dbbf6aa..0000000
--- a/tests/PHPUnit/Framework/Error/Notice.php
+++ /dev/null
@@ -1,66 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Error
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Wrapper for PHP notices.
- * You can disable notice-to-exception conversion by setting
- *
- * <code>
- * PHPUnit_Framework_Error_Notice::$enabled = FALSE;
- * </code>
- *
- * @package    PHPUnit
- * @subpackage Framework_Error
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Framework_Error_Notice extends PHPUnit_Framework_Error
-{
-    public static $enabled = TRUE;
-}
diff --git a/tests/PHPUnit/Framework/Error/Warning.php b/tests/PHPUnit/Framework/Error/Warning.php
deleted file mode 100644
index 2fe4450..0000000
--- a/tests/PHPUnit/Framework/Error/Warning.php
+++ /dev/null
@@ -1,66 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_Error
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Wrapper for PHP warnings.
- * You can disable notice-to-exception conversion by setting
- *
- * <code>
- * PHPUnit_Framework_Error_Warning::$enabled = FALSE;
- * </code>
- *
- * @package    PHPUnit
- * @subpackage Framework_Error
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Framework_Error_Warning extends PHPUnit_Framework_Error
-{
-    public static $enabled = TRUE;
-}
diff --git a/tests/PHPUnit/Framework/Exception.php b/tests/PHPUnit/Framework/Exception.php
deleted file mode 100644
index 76b6c4d..0000000
--- a/tests/PHPUnit/Framework/Exception.php
+++ /dev/null
@@ -1,60 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- * Exception for PHPUnit runtime errors.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Framework_Exception extends RuntimeException
-{
-}
diff --git a/tests/PHPUnit/Framework/ExpectationFailedException.php b/tests/PHPUnit/Framework/ExpectationFailedException.php
deleted file mode 100644
index 40ef0f3..0000000
--- a/tests/PHPUnit/Framework/ExpectationFailedException.php
+++ /dev/null
@@ -1,124 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Exception for expectations which failed their check.
- *
- * The exception contains the error message and optionally a
- * PHPUnit_Framework_ComparisonFailure which is used to
- * generate diff output of the failed expectations.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_ExpectationFailedException extends PHPUnit_Framework_AssertionFailedError
-{
-    /**
-     * @var PHPUnit_Framework_ComparisonFailure
-     */
-    protected $comparisonFailure;
-
-    /**
-     * @var string
-     */
-    protected $description;
-
-    /**
-     * @var string
-     */
-    protected $customMessage;
-
-    public function __construct($description, PHPUnit_Framework_ComparisonFailure $comparisonFailure = NULL, $message = '')
-    {
-        $this->description       = $description;
-        $this->comparisonFailure = $comparisonFailure;
-        $this->customMessage     = $message;
-
-        if (!empty($message)) {
-            $description .= "\n" . $message;
-        }
-
-        parent::__construct($description);
-    }
-
-    /**
-     * @return PHPUnit_Framework_ComparisonFailure
-     */
-    public function getComparisonFailure()
-    {
-        return $this->comparisonFailure;
-    }
-
-    /**
-     * @return string
-     */
-    public function getDescription()
-    {
-        return $this->description;
-    }
-
-    /**
-     * @return string
-     */
-    public function getCustomMessage()
-    {
-        return $this->customMessage;
-    }
-
-    /**
-     * @param string $customMessage
-     * @since Method available since Release 3.4.0
-     */
-    public function setCustomMessage($customMessage)
-    {
-        $this->customMessage = $customMessage;
-    }
-}
diff --git a/tests/PHPUnit/Framework/IncompleteTest.php b/tests/PHPUnit/Framework/IncompleteTest.php
deleted file mode 100644
index 1c267b6..0000000
--- a/tests/PHPUnit/Framework/IncompleteTest.php
+++ /dev/null
@@ -1,61 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A marker interface for marking any exception/error as result of an unit
- * test as incomplete implementation or currently not implemented.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 2.0.0
- */
-interface PHPUnit_Framework_IncompleteTest
-{
-}
diff --git a/tests/PHPUnit/Framework/IncompleteTestError.php b/tests/PHPUnit/Framework/IncompleteTestError.php
deleted file mode 100644
index 0834439..0000000
--- a/tests/PHPUnit/Framework/IncompleteTestError.php
+++ /dev/null
@@ -1,61 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * Extension to PHPUnit_Framework_AssertionFailedError to mark the special
- * case of an incomplete test.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Framework_IncompleteTestError extends PHPUnit_Framework_AssertionFailedError implements PHPUnit_Framework_IncompleteTest
-{
-}
diff --git a/tests/PHPUnit/Framework/Process/TestCaseMethod.tpl.dist b/tests/PHPUnit/Framework/Process/TestCaseMethod.tpl.dist
deleted file mode 100644
index 23ff804..0000000
--- a/tests/PHPUnit/Framework/Process/TestCaseMethod.tpl.dist
+++ /dev/null
@@ -1,48 +0,0 @@
-<?php
-set_include_path('{include_path}');
-require_once 'PHPUnit/Autoload.php';
-ob_start();
-
-function __phpunit_run_isolated_test()
-{
-    if (!class_exists('{className}')) {
-        require_once '{filename}';
-    }
-
-    $result = new PHPUnit_Framework_TestResult;
-    $result->collectRawCodeCoverageInformation({collectCodeCoverageInformation});
-
-    $test = new {className}('{methodName}', unserialize('{data}'), '{dataName}');
-    $test->setDependencyInput(unserialize('{dependencyInput}'));
-    $test->setInIsolation(TRUE);
-
-    ob_end_clean();
-    ob_start();
-    $test->run($result);
-    $output = ob_get_clean();
-
-    print serialize(
-      array(
-        'testResult'    => $test->getResult(),
-        'numAssertions' => $test->getNumAssertions(),
-        'result'        => $result,
-        'output'        => $output
-      )
-    );
-
-    ob_start();
-}
-
-{globals}
-
-if (isset($GLOBALS['__PHPUNIT_BOOTSTRAP'])) {
-    require_once $GLOBALS['__PHPUNIT_BOOTSTRAP'];
-    unset($GLOBALS['__PHPUNIT_BOOTSTRAP']);
-}
-
-{constants}
-{included_files}
-
-__phpunit_run_isolated_test();
-ob_end_clean();
-?>
diff --git a/tests/PHPUnit/Framework/SelfDescribing.php b/tests/PHPUnit/Framework/SelfDescribing.php
deleted file mode 100644
index c2c59ba..0000000
--- a/tests/PHPUnit/Framework/SelfDescribing.php
+++ /dev/null
@@ -1,66 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Interface for classes that can return a description of itself.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 3.0.0
- */
-interface PHPUnit_Framework_SelfDescribing
-{
-    /**
-     * Returns a string representation of the object.
-     *
-     * @return string
-     */
-    public function toString();
-}
diff --git a/tests/PHPUnit/Framework/SkippedTest.php b/tests/PHPUnit/Framework/SkippedTest.php
deleted file mode 100644
index 851d848..0000000
--- a/tests/PHPUnit/Framework/SkippedTest.php
+++ /dev/null
@@ -1,60 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * A marker interface for marking a unit test as being skipped.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 3.0.0
- */
-interface PHPUnit_Framework_SkippedTest
-{
-}
diff --git a/tests/PHPUnit/Framework/SkippedTestError.php b/tests/PHPUnit/Framework/SkippedTestError.php
deleted file mode 100644
index 2e627f4..0000000
--- a/tests/PHPUnit/Framework/SkippedTestError.php
+++ /dev/null
@@ -1,61 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Extension to PHPUnit_Framework_AssertionFailedError to mark the special
- * case of a skipped test.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Framework_SkippedTestError extends PHPUnit_Framework_AssertionFailedError implements PHPUnit_Framework_SkippedTest
-{
-}
diff --git a/tests/PHPUnit/Framework/SkippedTestSuiteError.php b/tests/PHPUnit/Framework/SkippedTestSuiteError.php
deleted file mode 100644
index ca256a2..0000000
--- a/tests/PHPUnit/Framework/SkippedTestSuiteError.php
+++ /dev/null
@@ -1,61 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.0
- */
-
-/**
- * Extension to PHPUnit_Framework_AssertionFailedError to mark the special
- * case of a skipped test suite.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.0
- */
-class PHPUnit_Framework_SkippedTestSuiteError extends PHPUnit_Framework_AssertionFailedError implements PHPUnit_Framework_SkippedTest
-{
-}
diff --git a/tests/PHPUnit/Framework/SyntheticError.php b/tests/PHPUnit/Framework/SyntheticError.php
deleted file mode 100644
index 88c7ea8..0000000
--- a/tests/PHPUnit/Framework/SyntheticError.php
+++ /dev/null
@@ -1,122 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * Creates a synthetic failed assertion.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.5.0
- */
-class PHPUnit_Framework_SyntheticError extends PHPUnit_Framework_AssertionFailedError
-{
-    /**
-     * The synthetic file.
-     *
-     * @var string
-     */
-    protected $syntheticFile = '';
-
-    /**
-     * The synthetic line number.
-     *
-     * @var integer
-     */
-    protected $syntheticLine = 0;
-
-    /**
-     * The synthetic trace.
-     *
-     * @var array
-     */
-    protected $syntheticTrace = array();
-
-    /**
-     * Constructor.
-     *
-     * @param string  $message
-     * @param integer $code
-     * @param string  $file
-     * @param integer $line
-     * @param array   $trace
-     */
-    public function __construct($message, $code, $file, $line, $trace)
-    {
-        parent::__construct($message, $code);
-
-        $this->syntheticFile  = $file;
-        $this->syntheticLine  = $line;
-        $this->syntheticTrace = $trace;
-    }
-
-    /**
-     * @return string
-     */
-    public function getSyntheticFile()
-    {
-        return $this->syntheticFile;
-    }
-
-    /**
-     * @return integer
-     */
-    public function getSyntheticLine()
-    {
-        return $this->syntheticLine;
-    }
-
-    /**
-     * @return array
-     */
-    public function getSyntheticTrace()
-    {
-        return $this->syntheticTrace;
-    }
-}
diff --git a/tests/PHPUnit/Framework/Test.php b/tests/PHPUnit/Framework/Test.php
deleted file mode 100644
index 9967356..0000000
--- a/tests/PHPUnit/Framework/Test.php
+++ /dev/null
@@ -1,67 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A Test can be run and collect its results.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 2.0.0
- */
-interface PHPUnit_Framework_Test extends Countable
-{
-    /**
-     * Runs a test and collects its result in a TestResult instance.
-     *
-     * @param  PHPUnit_Framework_TestResult $result
-     * @return PHPUnit_Framework_TestResult
-     */
-    public function run(PHPUnit_Framework_TestResult $result = NULL);
-}
diff --git a/tests/PHPUnit/Framework/TestCase.php b/tests/PHPUnit/Framework/TestCase.php
deleted file mode 100644
index 37e1bdd..0000000
--- a/tests/PHPUnit/Framework/TestCase.php
+++ /dev/null
@@ -1,1484 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-require_once 'Text/Template.php';
-
-/**
- * A TestCase defines the fixture to run multiple tests.
- *
- * To define a TestCase
- *
- *   1) Implement a subclass of PHPUnit_Framework_TestCase.
- *   2) Define instance variables that store the state of the fixture.
- *   3) Initialize the fixture state by overriding setUp().
- *   4) Clean-up after a test by overriding tearDown().
- *
- * Each test runs in its own fixture so there can be no side effects
- * among test runs.
- *
- * Here is an example:
- *
- * <code>
- * <?php
- * class MathTest extends PHPUnit_Framework_TestCase
- * {
- *     public $value1;
- *     public $value2;
- *
- *     protected function setUp()
- *     {
- *         $this->value1 = 2;
- *         $this->value2 = 3;
- *     }
- * }
- * ?>
- * </code>
- *
- * For each test implement a method which interacts with the fixture.
- * Verify the expected results with assertions specified by calling
- * assert with a boolean.
- *
- * <code>
- * <?php
- * public function testPass()
- * {
- *     $this->assertTrue($this->value1 + $this->value2 == 5);
- * }
- * ?>
- * </code>
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-abstract class PHPUnit_Framework_TestCase extends PHPUnit_Framework_Assert implements PHPUnit_Framework_Test, PHPUnit_Framework_SelfDescribing
-{
-    /**
-     * Enable or disable the backup and restoration of the $GLOBALS array.
-     * Overwrite this attribute in a child class of TestCase.
-     * Setting this attribute in setUp() has no effect!
-     *
-     * @var    boolean
-     */
-    protected $backupGlobals = NULL;
-
-    /**
-     * @var    array
-     */
-    protected $backupGlobalsBlacklist = array();
-
-    /**
-     * Enable or disable the backup and restoration of static attributes.
-     * Overwrite this attribute in a child class of TestCase.
-     * Setting this attribute in setUp() has no effect!
-     *
-     * @var    boolean
-     */
-    protected $backupStaticAttributes = NULL;
-
-    /**
-     * @var    array
-     */
-    protected $backupStaticAttributesBlacklist = array();
-
-    /**
-     * Whether or not this test is to be run in a separate PHP process.
-     *
-     * @var    boolean
-     */
-    protected $runTestInSeparateProcess = NULL;
-
-    /**
-     * Whether or not this test should preserve the global state when
-     * running in a separate PHP process.
-     *
-     * @var    boolean
-     */
-    protected $preserveGlobalState = TRUE;
-
-    /**
-     * Whether or not this test is running in a separate PHP process.
-     *
-     * @var    boolean
-     */
-    protected $inIsolation = FALSE;
-
-    /**
-     * @var    array
-     */
-    protected $data = array();
-
-    /**
-     * @var    string
-     */
-    protected $dataName = '';
-
-    /**
-     * @var    boolean
-     */
-    protected $useErrorHandler = NULL;
-
-    /**
-     * @var    boolean
-     */
-    protected $useOutputBuffering = NULL;
-
-    /**
-     * The name of the expected Exception.
-     *
-     * @var    mixed
-     */
-    protected $expectedException = NULL;
-
-    /**
-     * The message of the expected Exception.
-     *
-     * @var    string
-     */
-    protected $expectedExceptionMessage = '';
-
-    /**
-     * The code of the expected Exception.
-     *
-     * @var    integer
-     */
-    protected $expectedExceptionCode;
-
-    /**
-     * The stack trace to where the expected exception was set.
-     *
-     * @var    array
-     */
-    protected $expectedExceptionTrace = array();
-
-    /**
-     * The name of the test case.
-     *
-     * @var    string
-     */
-    protected $name = NULL;
-
-    /**
-     * @var    array
-     */
-    protected $dependencies = array();
-
-    /**
-     * @var    array
-     */
-    protected $dependencyInput = array();
-
-    /**
-     * @var    string
-     */
-    protected $exceptionMessage = NULL;
-
-    /**
-     * @var    integer
-     */
-    protected $exceptionCode = 0;
-
-    /**
-     * @var    Array
-     */
-    protected $iniSettings = array();
-
-    /**
-     * @var    Array
-     */
-    protected $locale = array();
-
-    /**
-     * @var    Array
-     */
-    protected $mockObjects = array();
-
-    /**
-     * @var    integer
-     */
-    protected $status;
-
-    /**
-     * @var    string
-     */
-    protected $statusMessage = '';
-
-    /**
-     * @var    integer
-     */
-    protected $numAssertions = 0;
-
-    /**
-     * @var PHPUnit_Framework_TestResult
-     */
-    protected $result;
-
-    /**
-     * @var mixed
-     */
-    protected $testResult;
-
-    /**
-     * Constructs a test case with the given name.
-     *
-     * @param  string $name
-     * @param  array  $data
-     * @param  string $dataName
-     */
-    public function __construct($name = NULL, array $data = array(), $dataName = '')
-    {
-        if ($name !== NULL) {
-            $this->setName($name);
-        }
-
-        $this->data     = $data;
-        $this->dataName = $dataName;
-    }
-
-    /**
-     * Returns a string representation of the test case.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        $class = new ReflectionClass($this);
-
-        $buffer = sprintf(
-          '%s::%s',
-
-          $class->name,
-          $this->getName(FALSE)
-        );
-
-        return $buffer . $this->getDataSetAsString();
-    }
-
-    /**
-     * Counts the number of test cases executed by run(TestResult result).
-     *
-     * @return integer
-     */
-    public function count()
-    {
-        return 1;
-    }
-
-    /**
-     * Returns the annotations for this test.
-     *
-     * @return array
-     * @since Method available since Release 3.4.0
-     */
-    public function getAnnotations()
-    {
-        return PHPUnit_Util_Test::parseTestMethodAnnotations(
-          get_class($this), $this->name
-        );
-    }
-
-    /**
-     * Gets the name of a TestCase.
-     *
-     * @param  boolean $withDataSet
-     * @return string
-     */
-    public function getName($withDataSet = TRUE)
-    {
-        if ($withDataSet) {
-            return $this->name . $this->getDataSetAsString(FALSE);
-        } else {
-            return $this->name;
-        }
-    }
-
-    /**
-     * @return string
-     * @since  Method available since Release 3.2.0
-     */
-    public function getExpectedException()
-    {
-        return $this->expectedException;
-    }
-
-    /**
-     * @param  mixed   $exceptionName
-     * @param  string  $exceptionMessage
-     * @param  integer $exceptionCode
-     * @since  Method available since Release 3.2.0
-     */
-    public function setExpectedException($exceptionName, $exceptionMessage = '', $exceptionCode = 0)
-    {
-        $this->expectedException        = $exceptionName;
-        $this->expectedExceptionMessage = $exceptionMessage;
-        $this->expectedExceptionCode    = $exceptionCode;
-        $this->expectedExceptionTrace   = debug_backtrace();
-    }
-
-    /**
-     * @since  Method available since Release 3.4.0
-     */
-    protected function setExpectedExceptionFromAnnotation()
-    {
-        try {
-            $expectedException = PHPUnit_Util_Test::getExpectedException(
-              get_class($this), $this->name
-            );
-
-            if ($expectedException !== FALSE) {
-                $this->setExpectedException(
-                  $expectedException['class'],
-                  $expectedException['message'],
-                  $expectedException['code']
-                );
-            }
-        }
-
-        catch (ReflectionException $e) {
-        }
-    }
-
-    /**
-     * @param boolean $useErrorHandler
-     * @since Method available since Release 3.4.0
-     */
-    public function setUseErrorHandler($useErrorHandler)
-    {
-        $this->useErrorHandler = $useErrorHandler;
-    }
-
-    /**
-     * @since Method available since Release 3.4.0
-     */
-    protected function setUseErrorHandlerFromAnnotation()
-    {
-        try {
-            $useErrorHandler = PHPUnit_Util_Test::getErrorHandlerSettings(
-              get_class($this), $this->name
-            );
-
-            if ($useErrorHandler !== NULL) {
-                $this->setUseErrorHandler($useErrorHandler);
-            }
-        }
-
-        catch (ReflectionException $e) {
-        }
-    }
-
-    /**
-     * @param boolean $useOutputBuffering
-     * @since Method available since Release 3.4.0
-     */
-    public function setUseOutputBuffering($useOutputBuffering)
-    {
-        $this->useOutputBuffering = $useOutputBuffering;
-    }
-
-    /**
-     * @since Method available since Release 3.4.0
-     */
-    protected function setUseOutputBufferingFromAnnotation()
-    {
-        try {
-            $useOutputBuffering = PHPUnit_Util_Test::getOutputBufferingSettings(
-              get_class($this), $this->name
-            );
-
-            if ($useOutputBuffering !== NULL) {
-                $this->setUseOutputBuffering($useOutputBuffering);
-            }
-        }
-
-        catch (ReflectionException $e) {
-        }
-    }
-
-    /**
-     * Returns the status of this test.
-     *
-     * @return integer
-     * @since  Method available since Release 3.1.0
-     */
-    public function getStatus()
-    {
-        return $this->status;
-    }
-
-    /**
-     * Returns the status message of this test.
-     *
-     * @return string
-     * @since  Method available since Release 3.3.0
-     */
-    public function getStatusMessage()
-    {
-        return $this->statusMessage;
-    }
-
-    /**
-     * Returns whether or not this test has failed.
-     *
-     * @return boolean
-     * @since  Method available since Release 3.0.0
-     */
-    public function hasFailed()
-    {
-        $status = $this->getStatus();
-
-        return $status == PHPUnit_Runner_BaseTestRunner::STATUS_FAILURE ||
-               $status == PHPUnit_Runner_BaseTestRunner::STATUS_ERROR;
-    }
-
-    /**
-     * Runs the test case and collects the results in a TestResult object.
-     * If no TestResult object is passed a new one will be created.
-     *
-     * @param  PHPUnit_Framework_TestResult $result
-     * @return PHPUnit_Framework_TestResult
-     * @throws InvalidArgumentException
-     */
-    public function run(PHPUnit_Framework_TestResult $result = NULL)
-    {
-        if ($result === NULL) {
-            $result = $this->createResult();
-        }
-
-        $this->setExpectedExceptionFromAnnotation();
-        $this->setUseErrorHandlerFromAnnotation();
-        $this->setUseOutputBufferingFromAnnotation();
-
-        if ($this->useErrorHandler !== NULL) {
-            $oldErrorHandlerSetting = $result->getConvertErrorsToExceptions();
-            $result->convertErrorsToExceptions($this->useErrorHandler);
-        }
-
-        $this->result = $result;
-
-        if (!empty($this->dependencies) && !$this->inIsolation) {
-            $className  = get_class($this);
-            $passed     = $this->result->passed();
-            $passedKeys = array_keys($passed);
-            $numKeys    = count($passedKeys);
-
-            for ($i = 0; $i < $numKeys; $i++) {
-                $pos = strpos($passedKeys[$i], ' with data set');
-
-                if ($pos !== FALSE) {
-                    $passedKeys[$i] = substr($passedKeys[$i], 0, $pos);
-                }
-            }
-
-            $passedKeys = array_flip(array_unique($passedKeys));
-
-            foreach ($this->dependencies as $dependency) {
-                if (strpos($dependency, '::') === FALSE) {
-                    $dependency = $className . '::' . $dependency;
-                }
-
-                if (!isset($passedKeys[$dependency])) {
-                    $result->addError(
-                      $this,
-                      new PHPUnit_Framework_SkippedTestError(
-                        sprintf(
-                          'This test depends on "%s" to pass.', $dependency
-                        )
-                      ),
-                      0
-                    );
-
-                    return;
-                } else {
-                    if (isset($passed[$dependency])) {
-                        $this->dependencyInput[] = $passed[$dependency];
-                    } else {
-                        $this->dependencyInput[] = NULL;
-                    }
-                }
-            }
-        }
-
-        if ($this->runTestInSeparateProcess === TRUE &&
-            $this->inIsolation !== TRUE &&
-            !$this instanceof PHPUnit_Extensions_SeleniumTestCase &&
-            !$this instanceof PHPUnit_Extensions_PhptTestCase) {
-            $class = new ReflectionClass($this);
-
-            $template = new Text_Template(
-              sprintf(
-                '%s%sProcess%sTestCaseMethod.tpl',
-
-                dirname(__FILE__),
-                DIRECTORY_SEPARATOR,
-                DIRECTORY_SEPARATOR,
-                DIRECTORY_SEPARATOR
-              )
-            );
-
-            if ($this->preserveGlobalState) {
-                $constants     = PHPUnit_Util_GlobalState::getConstantsAsString();
-                $globals       = PHPUnit_Util_GlobalState::getGlobalsAsString();
-                $includedFiles = PHPUnit_Util_GlobalState::getIncludedFilesAsString();
-            } else {
-                $constants     = '';
-                $globals       = '';
-                $includedFiles = '';
-            }
-
-            if ($result->getCollectCodeCoverageInformation()) {
-                $coverage = 'TRUE';
-            } else {
-                $coverage = 'FALSE';
-            }
-
-            $data            = addcslashes(serialize($this->data), "'");
-            $dependencyInput = addcslashes(
-              serialize($this->dependencyInput), "'"
-            );
-            $includePath     = addslashes(get_include_path());
-
-            $template->setVar(
-              array(
-                'filename'                       => $class->getFileName(),
-                'className'                      => $class->getName(),
-                'methodName'                     => $this->name,
-                'collectCodeCoverageInformation' => $coverage,
-                'data'                           => $data,
-                'dataName'                       => $this->dataName,
-                'dependencyInput'                => $dependencyInput,
-                'constants'                      => $constants,
-                'globals'                        => $globals,
-                'include_path'                   => $includePath,
-                'included_files'                 => $includedFiles
-              )
-            );
-
-            $this->prepareTemplate($template);
-
-            PHPUnit_Util_PHP::runJob($template->render(), $this, $result);
-        } else {
-            $result->run($this);
-        }
-
-        if ($this->useErrorHandler !== NULL) {
-            $result->convertErrorsToExceptions($oldErrorHandlerSetting);
-        }
-
-        $this->result = NULL;
-
-        return $result;
-    }
-
-    /**
-     * Runs the bare test sequence.
-     */
-    public function runBare()
-    {
-        $this->numAssertions = 0;
-
-        // Backup the $GLOBALS array and static attributes.
-        if ($this->runTestInSeparateProcess !== TRUE &&
-            $this->inIsolation !== TRUE) {
-            if ($this->backupGlobals === NULL ||
-                $this->backupGlobals === TRUE) {
-                PHPUnit_Util_GlobalState::backupGlobals(
-                  $this->backupGlobalsBlacklist
-                );
-            }
-
-            if (version_compare(PHP_VERSION, '5.3', '>') &&
-                $this->backupStaticAttributes === TRUE) {
-                PHPUnit_Util_GlobalState::backupStaticAttributes(
-                  $this->backupStaticAttributesBlacklist
-                );
-            }
-        }
-
-        // Start output buffering.
-        if ($this->useOutputBuffering === TRUE) {
-            ob_start();
-        }
-
-        // Clean up stat cache.
-        clearstatcache();
-
-        try {
-            if ($this->inIsolation) {
-                $this->setUpBeforeClass();
-            }
-
-            $this->setUp();
-            $this->assertPreConditions();
-            $this->testResult = $this->runTest();
-            $this->verifyMockObjects();
-            $this->assertPostConditions();
-            $this->status = PHPUnit_Runner_BaseTestRunner::STATUS_PASSED;
-        }
-
-        catch (PHPUnit_Framework_IncompleteTest $e) {
-            $this->status        = PHPUnit_Runner_BaseTestRunner::STATUS_INCOMPLETE;
-            $this->statusMessage = $e->getMessage();
-        }
-
-        catch (PHPUnit_Framework_SkippedTest $e) {
-            $this->status        = PHPUnit_Runner_BaseTestRunner::STATUS_SKIPPED;
-            $this->statusMessage = $e->getMessage();
-        }
-
-        catch (PHPUnit_Framework_AssertionFailedError $e) {
-            $this->status        = PHPUnit_Runner_BaseTestRunner::STATUS_FAILURE;
-            $this->statusMessage = $e->getMessage();
-        }
-
-        catch (Exception $e) {
-            $this->status        = PHPUnit_Runner_BaseTestRunner::STATUS_ERROR;
-            $this->statusMessage = $e->getMessage();
-        }
-
-        // Tear down the fixture. An exception raised in tearDown() will be
-        // caught and passed on when no exception was raised before.
-        try {
-            $this->tearDown();
-
-            if ($this->inIsolation) {
-                $this->tearDownAfterClass();
-            }
-        }
-
-        catch (Exception $_e) {
-            if (!isset($e)) {
-                $e = $_e;
-            }
-        }
-
-        // Stop output buffering.
-        if ($this->useOutputBuffering === TRUE) {
-            ob_end_clean();
-        }
-
-        // Clean up stat cache.
-        clearstatcache();
-
-        // Restore the $GLOBALS array and static attributes.
-        if ($this->runTestInSeparateProcess !== TRUE &&
-            $this->inIsolation !== TRUE) {
-            if ($this->backupGlobals === NULL ||
-                $this->backupGlobals === TRUE) {
-                PHPUnit_Util_GlobalState::restoreGlobals(
-                   $this->backupGlobalsBlacklist
-                );
-            }
-
-            if (version_compare(PHP_VERSION, '5.3', '>') &&
-                $this->backupStaticAttributes === TRUE) {
-                PHPUnit_Util_GlobalState::restoreStaticAttributes();
-            }
-        }
-
-        // Clean up INI settings.
-        foreach ($this->iniSettings as $varName => $oldValue) {
-            ini_set($varName, $oldValue);
-        }
-
-        $this->iniSettings = array();
-
-        // Clean up locale settings.
-        foreach ($this->locale as $category => $locale) {
-            setlocale($category, $locale);
-        }
-
-        // Workaround for missing "finally".
-        if (isset($e)) {
-            $this->onNotSuccessfulTest($e);
-        }
-    }
-
-    /**
-     * Override to run the test and assert its state.
-     *
-     * @return mixed
-     * @throws RuntimeException
-     */
-    protected function runTest()
-    {
-        if ($this->name === NULL) {
-            throw new PHPUnit_Framework_Exception(
-              'PHPUnit_Framework_TestCase::$name must not be NULL.'
-            );
-        }
-
-        try {
-            $class  = new ReflectionClass($this);
-            $method = $class->getMethod($this->name);
-        }
-
-        catch (ReflectionException $e) {
-            $this->fail($e->getMessage());
-        }
-
-        try {
-            $testResult = $method->invokeArgs(
-              $this, array_merge($this->data, $this->dependencyInput)
-            );
-        }
-
-        catch (Exception $e) {
-            if (!$e instanceof PHPUnit_Framework_IncompleteTest &&
-                !$e instanceof PHPUnit_Framework_SkippedTest &&
-                is_string($this->expectedException) &&
-                $e instanceof $this->expectedException) {
-                if (is_string($this->expectedExceptionMessage) &&
-                    !empty($this->expectedExceptionMessage)) {
-                    $this->assertContains(
-                      $this->expectedExceptionMessage,
-                      $e->getMessage()
-                    );
-                }
-
-                if (is_int($this->expectedExceptionCode) &&
-                    $this->expectedExceptionCode !== 0) {
-                    $this->assertEquals(
-                      $this->expectedExceptionCode, $e->getCode()
-                    );
-                }
-
-                $this->numAssertions++;
-
-                return;
-            } else {
-                throw $e;
-            }
-        }
-
-        if ($this->expectedException !== NULL) {
-            $this->numAssertions++;
-
-            $this->syntheticFail(
-              'Expected exception ' . $this->expectedException,
-              '',
-              0,
-              $this->expectedExceptionTrace
-            );
-        }
-
-        return $testResult;
-    }
-
-    /**
-     * Verifies the mock object expectations.
-     *
-     * @since Method available since Release 3.5.0
-     */
-    protected function verifyMockObjects()
-    {
-        foreach ($this->mockObjects as $mockObject) {
-            $this->numAssertions++;
-            $mockObject->__phpunit_verify();
-            $mockObject->__phpunit_cleanup();
-        }
-
-        $this->mockObjects = array();
-    }
-
-    /**
-     * Sets the name of a TestCase.
-     *
-     * @param  string
-     */
-    public function setName($name)
-    {
-        $this->name = $name;
-    }
-
-    /**
-     * Sets the dependencies of a TestCase.
-     *
-     * @param  array $dependencies
-     * @since  Method available since Release 3.4.0
-     */
-    public function setDependencies(array $dependencies)
-    {
-        $this->dependencies = $dependencies;
-    }
-
-    /**
-     * Sets
-     *
-     * @param  array $dependencyInput
-     * @since  Method available since Release 3.4.0
-     */
-    public function setDependencyInput(array $dependencyInput)
-    {
-        $this->dependencyInput = $dependencyInput;
-    }
-
-    /**
-     * Calling this method in setUp() has no effect!
-     *
-     * @param  boolean $backupGlobals
-     * @since  Method available since Release 3.3.0
-     */
-    public function setBackupGlobals($backupGlobals)
-    {
-        if (is_null($this->backupGlobals) && is_bool($backupGlobals)) {
-            $this->backupGlobals = $backupGlobals;
-        }
-    }
-
-    /**
-     * Calling this method in setUp() has no effect!
-     *
-     * @param  boolean $backupStaticAttributes
-     * @since  Method available since Release 3.4.0
-     */
-    public function setBackupStaticAttributes($backupStaticAttributes)
-    {
-        if (is_null($this->backupStaticAttributes) &&
-            is_bool($backupStaticAttributes)) {
-            $this->backupStaticAttributes = $backupStaticAttributes;
-        }
-    }
-
-    /**
-     * @param  boolean $runTestInSeparateProcess
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.4.0
-     */
-    public function setRunTestInSeparateProcess($runTestInSeparateProcess)
-    {
-        if (is_bool($runTestInSeparateProcess)) {
-            if ($this->runTestInSeparateProcess === NULL) {
-                $this->runTestInSeparateProcess = $runTestInSeparateProcess;
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * @param  boolean $preserveGlobalState
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.4.0
-     */
-    public function setPreserveGlobalState($preserveGlobalState)
-    {
-        if (is_bool($preserveGlobalState)) {
-            $this->preserveGlobalState = $preserveGlobalState;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * @param  boolean $inIsolation
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.4.0
-     */
-    public function setInIsolation($inIsolation)
-    {
-        if (is_bool($inIsolation)) {
-            $this->inIsolation = $inIsolation;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * @return mixed
-     * @since  Method available since Release 3.4.0
-     */
-    public function getResult()
-    {
-        return $this->testResult;
-    }
-
-    /**
-     * @param  mixed $result
-     * @since  Method available since Release 3.4.0
-     */
-    public function setResult($result)
-    {
-        $this->testResult = $result;
-    }
-
-    /**
-     * This method is a wrapper for the ini_set() function that automatically
-     * resets the modified php.ini setting to its original value after the
-     * test is run.
-     *
-     * @param  string  $varName
-     * @param  string  $newValue
-     * @throws InvalidArgumentException
-     * @throws RuntimeException
-     * @since  Method available since Release 3.0.0
-     */
-    protected function iniSet($varName, $newValue)
-    {
-        if (!is_string($varName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        $currentValue = ini_set($varName, $newValue);
-
-        if ($currentValue !== FALSE) {
-            $this->iniSettings[$varName] = $currentValue;
-        } else {
-            throw new PHPUnit_Framework_Exception(
-              sprintf(
-                'INI setting "%s" could not be set to "%s".',
-                $varName,
-                $newValue
-              )
-            );
-        }
-    }
-
-    /**
-     * This method is a wrapper for the setlocale() function that automatically
-     * resets the locale to its original value after the test is run.
-     *
-     * @param  integer $category
-     * @param  string  $locale
-     * @throws InvalidArgumentException
-     * @throws RuntimeException
-     * @since  Method available since Release 3.1.0
-     */
-    protected function setLocale()
-    {
-        $args = func_get_args();
-
-        if (count($args) < 2) {
-            throw new InvalidArgumentException;
-        }
-
-        $category = $args[0];
-        $locale   = $args[1];
-
-        $categories = array(
-          LC_ALL, LC_COLLATE, LC_CTYPE, LC_MONETARY, LC_NUMERIC, LC_TIME
-        );
-
-        if (defined('LC_MESSAGES')) {
-            $categories[] = LC_MESSAGES;
-        }
-
-        if (!in_array($category, $categories)) {
-            throw new InvalidArgumentException;
-        }
-
-        if (!is_array($locale) && !is_string($locale)) {
-            throw new InvalidArgumentException;
-        }
-
-        $this->locale[$category] = setlocale($category, NULL);
-
-        $result = call_user_func_array( 'setlocale', $args );
-
-        if ($result === FALSE) {
-            throw new PHPUnit_Framework_Exception(
-              'The locale functionality is not implemented on your platform, ' .
-              'the specified locale does not exist or the category name is ' .
-              'invalid.'
-            );
-        }
-    }
-
-    /**
-     * Returns a mock object for the specified class.
-     *
-     * @param  string  $originalClassName
-     * @param  array   $methods
-     * @param  array   $arguments
-     * @param  string  $mockClassName
-     * @param  boolean $callOriginalConstructor
-     * @param  boolean $callOriginalClone
-     * @param  boolean $callAutoload
-     * @return PHPUnit_Framework_MockObject_MockObject
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.0.0
-     */
-    public function getMock($originalClassName, $methods = array(), array $arguments = array(), $mockClassName = '', $callOriginalConstructor = TRUE, $callOriginalClone = TRUE, $callAutoload = TRUE)
-    {
-        $mockObject = PHPUnit_Framework_MockObject_Generator::getMock(
-          $originalClassName,
-          $methods,
-          $arguments,
-          $mockClassName,
-          $callOriginalConstructor,
-          $callOriginalClone,
-          $callAutoload
-        );
-
-        $this->mockObjects[] = $mockObject;
-
-        return $mockObject;
-    }
-
-    /**
-     * Returns a builder object to create mock objects using a fluent interface.
-     *
-     * @param  string $className
-     * @return PHPUnit_Framework_MockObject_MockBuilder
-     * @since  Method available since Release 3.5.0
-     */
-    public function getMockBuilder($className)
-    {
-        return new PHPUnit_Framework_MockObject_MockBuilder(
-          $this, $className
-        );
-    }
-
-    /**
-     * Mocks the specified class and returns the name of the mocked class.
-     *
-     * @param  string  $originalClassName
-     * @param  array   $methods
-     * @param  array   $arguments
-     * @param  string  $mockClassName
-     * @param  boolean $callOriginalConstructor
-     * @param  boolean $callOriginalClone
-     * @param  boolean $callAutoload
-     * @return string
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.5.0
-     */
-    protected function getMockClass($originalClassName, $methods = array(), array $arguments = array(), $mockClassName = '', $callOriginalConstructor = FALSE, $callOriginalClone = TRUE, $callAutoload = TRUE)
-    {
-        $mock = $this->getMock(
-          $originalClassName,
-          $methods,
-          $arguments,
-          $mockClassName,
-          $callOriginalConstructor,
-          $callOriginalClone,
-          $callAutoload
-        );
-
-        return get_class($mock);
-    }
-
-    /**
-     * Returns a mock object for the specified abstract class with all abstract
-     * methods of the class mocked. Concrete methods are not mocked.
-     *
-     * @param  string  $originalClassName
-     * @param  array   $arguments
-     * @param  string  $mockClassName
-     * @param  boolean $callOriginalConstructor
-     * @param  boolean $callOriginalClone
-     * @param  boolean $callAutoload
-     * @return PHPUnit_Framework_MockObject_MockObject
-     * @since  Method available since Release 3.4.0
-     * @throws InvalidArgumentException
-     */
-    protected function getMockForAbstractClass($originalClassName, array $arguments = array(), $mockClassName = '', $callOriginalConstructor = TRUE, $callOriginalClone = TRUE, $callAutoload = TRUE)
-    {
-        $mockObject = PHPUnit_Framework_MockObject_Generator::getMockForAbstractClass(
-          $originalClassName,
-          $arguments,
-          $mockClassName,
-          $callOriginalConstructor,
-          $callOriginalClone,
-          $callAutoload
-        );
-
-        $this->mockObjects[] = $mockObject;
-
-        return $mockObject;
-    }
-
-    /**
-     * Returns a mock object based on the given WSDL file.
-     *
-     * @param  string  $wsdlFile
-     * @param  string  $originalClassName
-     * @param  string  $mockClassName
-     * @param  array   $methods
-     * @param  boolean $callOriginalConstructor
-     * @return PHPUnit_Framework_MockObject_MockObject
-     * @since  Method available since Release 3.4.0
-     */
-    protected function getMockFromWsdl($wsdlFile, $originalClassName = '', $mockClassName = '', array $methods = array(), $callOriginalConstructor = TRUE)
-    {
-        if ($originalClassName === '') {
-            $originalClassName = str_replace(
-              '.wsdl', '', basename($wsdlFile)
-            );
-        }
-
-        eval(
-          PHPUnit_Framework_MockObject_Generator::generateClassFromWsdl(
-            $wsdlFile, $originalClassName, $methods
-          )
-        );
-
-        return $this->getMock(
-          $originalClassName,
-          $methods,
-          array('', array()),
-          $mockClassName,
-          $callOriginalConstructor,
-          FALSE,
-          FALSE
-        );
-    }
-
-    /**
-     * Adds a value to the assertion counter.
-     *
-     * @param integer $count
-     * @since Method available since Release 3.3.3
-     */
-    public function addToAssertionCount($count)
-    {
-        $this->numAssertions += $count;
-    }
-
-    /**
-     * Returns the number of assertions performed by this test.
-     *
-     * @return integer
-     * @since  Method available since Release 3.3.0
-     */
-    public function getNumAssertions()
-    {
-        return $this->numAssertions;
-    }
-
-    /**
-     * Returns a matcher that matches when the method it is evaluated for
-     * is executed zero or more times.
-     *
-     * @return PHPUnit_Framework_MockObject_Matcher_AnyInvokedCount
-     * @since  Method available since Release 3.0.0
-     */
-    public static function any()
-    {
-        return new PHPUnit_Framework_MockObject_Matcher_AnyInvokedCount;
-    }
-
-    /**
-     * Returns a matcher that matches when the method it is evaluated for
-     * is never executed.
-     *
-     * @return PHPUnit_Framework_MockObject_Matcher_InvokedCount
-     * @since  Method available since Release 3.0.0
-     */
-    public static function never()
-    {
-        return new PHPUnit_Framework_MockObject_Matcher_InvokedCount(0);
-    }
-
-    /**
-     * Returns a matcher that matches when the method it is evaluated for
-     * is executed at least once.
-     *
-     * @return PHPUnit_Framework_MockObject_Matcher_InvokedAtLeastOnce
-     * @since  Method available since Release 3.0.0
-     */
-    public static function atLeastOnce()
-    {
-        return new PHPUnit_Framework_MockObject_Matcher_InvokedAtLeastOnce;
-    }
-
-    /**
-     * Returns a matcher that matches when the method it is evaluated for
-     * is executed exactly once.
-     *
-     * @return PHPUnit_Framework_MockObject_Matcher_InvokedCount
-     * @since  Method available since Release 3.0.0
-     */
-    public static function once()
-    {
-        return new PHPUnit_Framework_MockObject_Matcher_InvokedCount(1);
-    }
-
-    /**
-     * Returns a matcher that matches when the method it is evaluated for
-     * is executed exactly $count times.
-     *
-     * @param  integer $count
-     * @return PHPUnit_Framework_MockObject_Matcher_InvokedCount
-     * @since  Method available since Release 3.0.0
-     */
-    public static function exactly($count)
-    {
-        return new PHPUnit_Framework_MockObject_Matcher_InvokedCount($count);
-    }
-
-    /**
-     * Returns a matcher that matches when the method it is evaluated for
-     * is invoked at the given $index.
-     *
-     * @param  integer $index
-     * @return PHPUnit_Framework_MockObject_Matcher_InvokedAtIndex
-     * @since  Method available since Release 3.0.0
-     */
-    public static function at($index)
-    {
-        return new PHPUnit_Framework_MockObject_Matcher_InvokedAtIndex($index);
-    }
-
-    /**
-     *
-     *
-     * @param  mixed $value
-     * @return PHPUnit_Framework_MockObject_Stub_Return
-     * @since  Method available since Release 3.0.0
-     */
-    public static function returnValue($value)
-    {
-        return new PHPUnit_Framework_MockObject_Stub_Return($value);
-    }
-
-    /**
-     *
-     *
-     * @param  integer $argumentIndex
-     * @return PHPUnit_Framework_MockObject_Stub_ReturnArgument
-     * @since  Method available since Release 3.3.0
-     */
-    public static function returnArgument($argumentIndex)
-    {
-        return new PHPUnit_Framework_MockObject_Stub_ReturnArgument(
-          $argumentIndex
-        );
-    }
-
-    /**
-     *
-     *
-     * @param  mixed $callback
-     * @return PHPUnit_Framework_MockObject_Stub_ReturnCallback
-     * @since  Method available since Release 3.3.0
-     */
-    public static function returnCallback($callback)
-    {
-        return new PHPUnit_Framework_MockObject_Stub_ReturnCallback($callback);
-    }
-
-    /**
-     *
-     *
-     * @param  Exception $exception
-     * @return PHPUnit_Framework_MockObject_Stub_Exception
-     * @since  Method available since Release 3.1.0
-     */
-    public static function throwException(Exception $exception)
-    {
-        return new PHPUnit_Framework_MockObject_Stub_Exception($exception);
-    }
-
-    /**
-     *
-     *
-     * @param  mixed $value, ...
-     * @return PHPUnit_Framework_MockObject_Stub_ConsecutiveCalls
-     * @since  Method available since Release 3.0.0
-     */
-    public static function onConsecutiveCalls()
-    {
-        $args = func_get_args();
-
-        return new PHPUnit_Framework_MockObject_Stub_ConsecutiveCalls($args);
-    }
-
-    /**
-     * @param  mixed $data
-     * @return string
-     * @since  Method available since Release 3.2.1
-     */
-    protected function dataToString($data)
-    {
-        $result = array();
-
-        foreach ($data as $_data) {
-            if (is_array($_data)) {
-                $result[] = 'array(' . $this->dataToString($_data) . ')';
-            }
-
-            else if (is_object($_data)) {
-                $object = new ReflectionObject($_data);
-
-                if ($object->hasMethod('__toString')) {
-                    $result[] = (string)$_data;
-                } else {
-                    $result[] = get_class($_data);
-                }
-            }
-
-            else if (is_resource($_data)) {
-                $result[] = '<resource>';
-            }
-
-            else {
-                $result[] = var_export($_data, TRUE);
-            }
-        }
-
-        return join(', ', $result);
-    }
-
-    /**
-     * Gets the data set description of a TestCase.
-     *
-     * @param  boolean $includeData
-     * @return string
-     * @since  Method available since Release 3.3.0
-     */
-    protected function getDataSetAsString($includeData = TRUE)
-    {
-        $buffer = '';
-
-        if (!empty($this->data)) {
-            if (is_int($this->dataName)) {
-                $buffer .= sprintf(' with data set #%d', $this->dataName);
-            } else {
-                $buffer .= sprintf(' with data set "%s"', $this->dataName);
-            }
-
-            if ($includeData) {
-                $buffer .= sprintf(' (%s)', $this->dataToString($this->data));
-            }
-        }
-
-        return $buffer;
-    }
-
-    /**
-     * Creates a default TestResult object.
-     *
-     * @return PHPUnit_Framework_TestResult
-     */
-    protected function createResult()
-    {
-        return new PHPUnit_Framework_TestResult;
-    }
-
-    /**
-     * This method is called before the first test of this test class is run.
-     *
-     * @since Method available since Release 3.4.0
-     */
-    public static function setUpBeforeClass()
-    {
-    }
-
-    /**
-     * Sets up the fixture, for example, open a network connection.
-     * This method is called before a test is executed.
-     *
-     */
-    protected function setUp()
-    {
-    }
-
-    /**
-     * Performs assertions shared by all tests of a test case.
-     *
-     * This method is called before the execution of a test starts
-     * and after setUp() is called.
-     *
-     * @since  Method available since Release 3.2.8
-     */
-    protected function assertPreConditions()
-    {
-    }
-
-    /**
-     * Performs assertions shared by all tests of a test case.
-     *
-     * This method is called before the execution of a test ends
-     * and before tearDown() is called.
-     *
-     * @since  Method available since Release 3.2.8
-     */
-    protected function assertPostConditions()
-    {
-    }
-
-    /**
-     * Tears down the fixture, for example, close a network connection.
-     * This method is called after a test is executed.
-     */
-    protected function tearDown()
-    {
-    }
-
-    /**
-     * This method is called after the last test of this test class is run.
-     *
-     * @since Method available since Release 3.4.0
-     */
-    public static function tearDownAfterClass()
-    {
-    }
-
-    /**
-     * This method is called when a test method did not execute successfully.
-     *
-     * @param Exception $e
-     * @since Method available since Release 3.4.0
-     */
-    protected function onNotSuccessfulTest(Exception $e)
-    {
-        throw $e;
-    }
-
-    /**
-     * Performs custom preparations on the process isolation template.
-     *
-     * @param Text_Template $template
-     * @since Method available since Release 3.4.0
-     */
-    protected function prepareTemplate(Text_Template $template)
-    {
-    }
-}
diff --git a/tests/PHPUnit/Framework/TestFailure.php b/tests/PHPUnit/Framework/TestFailure.php
deleted file mode 100644
index dab7a4c..0000000
--- a/tests/PHPUnit/Framework/TestFailure.php
+++ /dev/null
@@ -1,228 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A TestFailure collects a failed test together with the caught exception.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Framework_TestFailure
-{
-    /**
-     * @var    PHPUnit_Framework_Test
-     */
-    protected $failedTest;
-
-    /**
-     * @var    Exception
-     */
-    protected $thrownException;
-
-    /**
-     * Constructs a TestFailure with the given test and exception.
-     *
-     * @param  PHPUnit_Framework_Test $failedTest
-     * @param  Exception               $thrownException
-     */
-    public function __construct(PHPUnit_Framework_Test $failedTest, Exception $thrownException)
-    {
-        $this->failedTest      = $failedTest;
-        $this->thrownException = $thrownException;
-    }
-
-    /**
-     * Returns a short description of the failure.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return sprintf(
-          '%s: %s',
-
-          $this->failedTest,
-          $this->thrownException->getMessage()
-        );
-    }
-
-    /**
-     * Returns a description for the thrown exception.
-     *
-     * @return string
-     * @since  Method available since Release 3.4.0
-     */
-    public function getExceptionAsString()
-    {
-        return self::exceptionToString($this->thrownException);
-    }
-
-    /**
-     * Returns a description for an exception.
-     *
-     * @param  Exception $e
-     * @return string
-     * @since  Method available since Release 3.2.0
-     */
-    public static function exceptionToString(Exception $e)
-    {
-        if ($e instanceof PHPUnit_Framework_SelfDescribing) {
-            if ($e instanceof PHPUnit_Framework_ExpectationFailedException) {
-                $comparisonFailure = $e->getComparisonFailure();
-                $description       = $e->getDescription();
-                $message           = $e->getCustomMessage();
-
-                if ($message == '') {
-                    $buffer = '';
-                } else {
-                    $buffer = $message . "\n";
-                }
-
-                if ($comparisonFailure !== NULL) {
-                    if ($comparisonFailure->identical()) {
-                        if ($comparisonFailure instanceof PHPUnit_Framework_ComparisonFailure_Object) {
-                            $buffer .= 'Failed asserting that two variables ' .
-                                       "reference the same object.\n";
-                        } else {
-                            $buffer .= $comparisonFailure->toString() . "\n";
-                        }
-                    } else {
-                        if ($comparisonFailure instanceof PHPUnit_Framework_ComparisonFailure_Scalar) {
-                            $buffer .= $comparisonFailure->toString() . "\n";
-                        }
-
-                        else if ($comparisonFailure instanceof PHPUnit_Framework_ComparisonFailure_Array ||
-                                 $comparisonFailure instanceof PHPUnit_Framework_ComparisonFailure_Object ||
-                                 $comparisonFailure instanceof PHPUnit_Framework_ComparisonFailure_String) {
-                            $buffer .= sprintf(
-                              "Failed asserting that two %ss are equal.\n%s\n",
-
-                              strtolower(
-                                substr(get_class($comparisonFailure), 36)
-                              ),
-                              $comparisonFailure->toString()
-                            );
-                        }
-                    }
-                } else {
-                    $buffer .= $e->toString();
-
-                    if (!empty($buffer)) {
-                        $buffer .= "\n";
-                    }
-
-                    if (strpos($buffer, $description) === FALSE) {
-                        $buffer .= $description . "\n";
-                    }
-                }
-            }
-
-            else {
-                $buffer = $e->toString();
-
-                if (!empty($buffer)) {
-                    $buffer .= "\n";
-                }
-            }
-        }
-
-        else if ($e instanceof PHPUnit_Framework_Error) {
-            $buffer = $e->getMessage() . "\n";
-        }
-
-        else {
-            $buffer = get_class($e) . ': ' . $e->getMessage() . "\n";
-        }
-
-        return $buffer;
-    }
-
-    /**
-     * Gets the failed test.
-     *
-     * @return Test
-     */
-    public function failedTest()
-    {
-        return $this->failedTest;
-    }
-
-    /**
-     * Gets the thrown exception.
-     *
-     * @return Exception
-     */
-    public function thrownException()
-    {
-        return $this->thrownException;
-    }
-
-    /**
-     * Returns the exception's message.
-     *
-     * @return string
-     */
-    public function exceptionMessage()
-    {
-        return $this->thrownException()->getMessage();
-    }
-
-    /**
-     * Returns TRUE if the thrown exception
-     * is of type AssertionFailedError.
-     *
-     * @return boolean
-     */
-    public function isFailure()
-    {
-        return ($this->thrownException() instanceof PHPUnit_Framework_AssertionFailedError);
-    }
-}
diff --git a/tests/PHPUnit/Framework/TestListener.php b/tests/PHPUnit/Framework/TestListener.php
deleted file mode 100644
index 04b786d..0000000
--- a/tests/PHPUnit/Framework/TestListener.php
+++ /dev/null
@@ -1,127 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A Listener for test progress.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 2.0.0
- */
-interface PHPUnit_Framework_TestListener
-{
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time);
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time);
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time);
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     * @since  Method available since Release 3.0.0
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time);
-
-    /**
-     * A test suite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite);
-
-    /**
-     * A test suite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite);
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test);
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time);
-}
diff --git a/tests/PHPUnit/Framework/TestResult.php b/tests/PHPUnit/Framework/TestResult.php
deleted file mode 100644
index d5e26cc..0000000
--- a/tests/PHPUnit/Framework/TestResult.php
+++ /dev/null
@@ -1,840 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-require_once 'PHP/CodeCoverage.php';
-require_once 'PHP/Timer.php';
-
-/**
- * A TestResult collects the results of executing a test case.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Framework_TestResult implements Countable
-{
-    /**
-     * @var boolean
-     */
-    protected static $xdebugLoaded = NULL;
-
-    /**
-     * @var boolean
-     */
-    protected static $useXdebug = NULL;
-
-    /**
-     * @var array
-     */
-    protected $passed = array();
-
-    /**
-     * @var array
-     */
-    protected $errors = array();
-
-    /**
-     * @var array
-     */
-    protected $failures = array();
-
-    /**
-     * @var array
-     */
-    protected $notImplemented = array();
-
-    /**
-     * @var array
-     */
-    protected $skipped = array();
-
-    /**
-     * @var array
-     */
-    protected $listeners = array();
-
-    /**
-     * @var integer
-     */
-    protected $runTests = 0;
-
-    /**
-     * @var float
-     */
-    protected $time = 0;
-
-    /**
-     * @var PHPUnit_Framework_TestSuite
-     */
-    protected $topTestSuite = NULL;
-
-    /**
-     * Code Coverage information.
-     *
-     * @var array
-     */
-    protected $codeCoverage;
-
-    /**
-     * @var boolean
-     */
-    protected $collectCodeCoverageInformation = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $collectRawCodeCoverageInformation = FALSE;
-
-    /**
-     * @var array
-     */
-    protected $rawCodeCoverageInformation = array();
-
-    /**
-     * @var boolean
-     */
-    protected $convertErrorsToExceptions = TRUE;
-
-    /**
-     * @var boolean
-     */
-    protected $stop = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $stopOnError = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $stopOnFailure = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $strictAssertions = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $stopOnIncomplete = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $stopOnSkipped = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $lastTestFailed = FALSE;
-
-    /**
-     * @param PHP_CodeCoverage $codeCoverage
-     */
-    public function __construct(PHP_CodeCoverage $codeCoverage = NULL)
-    {
-        if ($codeCoverage === NULL) {
-            $codeCoverage = PHP_CodeCoverage::getInstance();
-        }
-
-        $this->codeCoverage = $codeCoverage;
-    }
-
-    /**
-     * Registers a TestListener.
-     *
-     * @param  PHPUnit_Framework_TestListener
-     */
-    public function addListener(PHPUnit_Framework_TestListener $listener)
-    {
-        $this->listeners[] = $listener;
-    }
-
-    /**
-     * Unregisters a TestListener.
-     *
-     * @param  PHPUnit_Framework_TestListener $listener
-     */
-    public function removeListener(PHPUnit_Framework_TestListener $listener)
-    {
-        foreach ($this->listeners as $key => $_listener) {
-            if ($listener === $_listener) {
-                unset($this->listeners[$key]);
-            }
-        }
-    }
-
-    /**
-     * Flushes all flushable TestListeners.
-     *
-     * @since  Method available since Release 3.0.0
-     */
-    public function flushListeners()
-    {
-        foreach ($this->listeners as $listener) {
-            if ($listener instanceof PHPUnit_Util_Printer) {
-                $listener->flush();
-            }
-        }
-    }
-
-    /**
-     * Adds an error to the list of errors.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        if ($e instanceof PHPUnit_Framework_IncompleteTest) {
-            $this->notImplemented[] = new PHPUnit_Framework_TestFailure(
-              $test, $e
-            );
-
-            $notifyMethod = 'addIncompleteTest';
-
-            if ($this->stopOnIncomplete) {
-                $this->stop();
-            }
-        }
-
-        else if ($e instanceof PHPUnit_Framework_SkippedTest) {
-            $this->skipped[] = new PHPUnit_Framework_TestFailure($test, $e);
-            $notifyMethod    = 'addSkippedTest';
-
-            if ($this->stopOnSkipped) {
-                $this->stop();
-            }
-        }
-
-        else {
-            $this->errors[] = new PHPUnit_Framework_TestFailure($test, $e);
-            $notifyMethod   = 'addError';
-
-            if ($this->stopOnError) {
-                $this->stop();
-            }
-        }
-
-        foreach ($this->listeners as $listener) {
-            $listener->$notifyMethod($test, $e, $time);
-        }
-
-        $this->lastTestFailed = TRUE;
-        $this->time          += $time;
-    }
-
-    /**
-     * Adds a failure to the list of failures.
-     * The passed in exception caused the failure.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-        if ($e instanceof PHPUnit_Framework_IncompleteTest) {
-            $this->notImplemented[] = new PHPUnit_Framework_TestFailure(
-              $test, $e
-            );
-
-            $notifyMethod = 'addIncompleteTest';
-
-            if ($this->stopOnIncomplete) {
-                $this->stop();
-            }
-        }
-
-        else if ($e instanceof PHPUnit_Framework_SkippedTest) {
-            $this->skipped[] = new PHPUnit_Framework_TestFailure($test, $e);
-            $notifyMethod    = 'addSkippedTest';
-
-            if ($this->stopOnSkipped) {
-                $this->stop();
-            }
-        }
-
-        else {
-            $this->failures[] = new PHPUnit_Framework_TestFailure($test, $e);
-            $notifyMethod     = 'addFailure';
-
-            if ($this->stopOnFailure || $this->stopOnError) {
-                $this->stop();
-            }
-        }
-
-        foreach ($this->listeners as $listener) {
-            $listener->$notifyMethod($test, $e, $time);
-        }
-
-        $this->lastTestFailed = TRUE;
-        $this->time          += $time;
-    }
-
-    /**
-     * Informs the result that a testsuite will be started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        if ($this->topTestSuite === NULL) {
-            $this->topTestSuite = $suite;
-        }
-
-        foreach ($this->listeners as $listener) {
-            $listener->startTestSuite($suite);
-        }
-    }
-
-    /**
-     * Informs the result that a testsuite was completed.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        foreach ($this->listeners as $listener) {
-            $listener->endTestSuite($suite);
-        }
-    }
-
-    /**
-     * Informs the result that a test will be started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        $this->lastTestFailed = FALSE;
-        $this->runTests      += count($test);
-
-        foreach ($this->listeners as $listener) {
-            $listener->startTest($test);
-        }
-    }
-
-    /**
-     * Informs the result that a test was completed.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        foreach ($this->listeners as $listener) {
-            $listener->endTest($test, $time);
-        }
-
-        if (!$this->lastTestFailed && $test instanceof PHPUnit_Framework_TestCase) {
-            $this->passed[get_class($test) . '::' . $test->getName()] = $test->getResult();
-            $this->time                                              += $time;
-        }
-    }
-
-    /**
-     * Returns TRUE if no incomplete test occured.
-     *
-     * @return boolean
-     */
-    public function allCompletlyImplemented()
-    {
-        return $this->notImplementedCount() == 0;
-    }
-
-    /**
-     * Gets the number of incomplete tests.
-     *
-     * @return integer
-     */
-    public function notImplementedCount()
-    {
-        return count($this->notImplemented);
-    }
-
-    /**
-     * Returns an Enumeration for the incomplete tests.
-     *
-     * @return array
-     */
-    public function notImplemented()
-    {
-        return $this->notImplemented;
-    }
-
-    /**
-     * Returns TRUE if no test has been skipped.
-     *
-     * @return boolean
-     * @since  Method available since Release 3.0.0
-     */
-    public function noneSkipped()
-    {
-        return $this->skippedCount() == 0;
-    }
-
-    /**
-     * Gets the number of skipped tests.
-     *
-     * @return integer
-     * @since  Method available since Release 3.0.0
-     */
-    public function skippedCount()
-    {
-        return count($this->skipped);
-    }
-
-    /**
-     * Returns an Enumeration for the skipped tests.
-     *
-     * @return array
-     * @since  Method available since Release 3.0.0
-     */
-    public function skipped()
-    {
-        return $this->skipped;
-    }
-
-    /**
-     * Gets the number of detected errors.
-     *
-     * @return integer
-     */
-    public function errorCount()
-    {
-        return count($this->errors);
-    }
-
-    /**
-     * Returns an Enumeration for the errors.
-     *
-     * @return array
-     */
-    public function errors()
-    {
-        return $this->errors;
-    }
-
-    /**
-     * Gets the number of detected failures.
-     *
-     * @return integer
-     */
-    public function failureCount()
-    {
-        return count($this->failures);
-    }
-
-    /**
-     * Returns an Enumeration for the failures.
-     *
-     * @return array
-     */
-    public function failures()
-    {
-        return $this->failures;
-    }
-
-    /**
-     * Returns the names of the tests that have passed.
-     *
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    public function passed()
-    {
-        return $this->passed;
-    }
-
-    /**
-     * Returns the (top) test suite.
-     *
-     * @return PHPUnit_Framework_TestSuite
-     * @since  Method available since Release 3.0.0
-     */
-    public function topTestSuite()
-    {
-        return $this->topTestSuite;
-    }
-
-    /**
-     * Enables or disables the collection of Code Coverage information.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 2.3.0
-     */
-    public function collectCodeCoverageInformation($flag)
-    {
-        if (is_bool($flag)) {
-            $this->collectCodeCoverageInformation = $flag;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Enables or disables the collection of raw Code Coverage information.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.4.0
-     */
-    public function collectRawCodeCoverageInformation($flag)
-    {
-        if (is_bool($flag)) {
-            $this->collectRawCodeCoverageInformation = $flag;
-
-            if ($flag === TRUE) {
-                $this->collectCodeCoverageInformation = $flag;
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Returns whether code coverage information should be collected.
-     *
-     * @return boolean If code coverage should be collected
-     * @since  Method available since Release 3.2.0
-     */
-    public function getCollectCodeCoverageInformation()
-    {
-        return $this->collectCodeCoverageInformation;
-    }
-
-    /**
-     * Returns the raw Code Coverage information.
-     *
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    public function getRawCodeCoverageInformation()
-    {
-        return $this->rawCodeCoverageInformation;
-    }
-
-    /**
-     * Runs a TestCase.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function run(PHPUnit_Framework_Test $test)
-    {
-        PHPUnit_Framework_Assert::resetCount();
-
-        $error   = FALSE;
-        $failure = FALSE;
-
-        $this->startTest($test);
-
-        $errorHandlerSet = FALSE;
-
-        if ($this->convertErrorsToExceptions) {
-            $oldErrorHandler = set_error_handler(
-              array('PHPUnit_Util_ErrorHandler', 'handleError'),
-              E_ALL | E_STRICT
-            );
-
-            if ($oldErrorHandler === NULL) {
-                $errorHandlerSet = TRUE;
-            } else {
-                restore_error_handler();
-            }
-        }
-
-        if (self::$xdebugLoaded === NULL) {
-            self::$xdebugLoaded = extension_loaded('xdebug');
-            self::$useXdebug    = self::$xdebugLoaded;
-        }
-
-        $useXdebug = self::$useXdebug &&
-                     $this->collectCodeCoverageInformation &&
-                     !$test instanceof PHPUnit_Extensions_SeleniumTestCase &&
-                     !$test instanceof PHPUnit_Framework_Warning;
-
-        if ($useXdebug) {
-            $this->codeCoverage->start($test);
-        }
-
-        PHP_Timer::start();
-
-        try {
-            $test->runBare();
-        }
-
-        catch (PHPUnit_Framework_AssertionFailedError $e) {
-            $failure = TRUE;
-        }
-
-        catch (Exception $e) {
-            $error = TRUE;
-        }
-
-        $time = PHP_Timer::stop();
-
-        if ($useXdebug) {
-            $data = $this->codeCoverage->stop(FALSE);
-
-            if ($this->collectRawCodeCoverageInformation) {
-                $this->rawCodeCoverageInformation[] = $data;
-            } else {
-                $filterGroups = array('DEFAULT', 'TESTS');
-
-                if (!defined('PHPUNIT_TESTSUITE')) {
-                    $filterGroups[] = 'PHPUNIT';
-                }
-
-                $this->codeCoverage->append($data, $test, $filterGroups);
-            }
-        }
-
-        if ($errorHandlerSet === TRUE) {
-            restore_error_handler();
-        }
-
-        $test->addToAssertionCount(PHPUnit_Framework_Assert::getCount());
-
-        if ($this->strictAssertions && $test->getNumAssertions() == 0) {
-            $this->addFailure(
-              $test,
-              new PHPUnit_Framework_IncompleteTestError(
-                'This test did not perform any assertions'
-              ),
-              $time
-            );
-        }
-
-        if ($error === TRUE) {
-            $this->addError($test, $e, $time);
-        }
-
-        else if ($failure === TRUE) {
-            $this->addFailure($test, $e, $time);
-        }
-
-        $this->endTest($test, $time);
-    }
-
-    /**
-     * Gets the number of run tests.
-     *
-     * @return integer
-     */
-    public function count()
-    {
-        return $this->runTests;
-    }
-
-    /**
-     * Checks whether the test run should stop.
-     *
-     * @return boolean
-     */
-    public function shouldStop()
-    {
-        return $this->stop;
-    }
-
-    /**
-     * Marks that the test run should stop.
-     *
-     */
-    public function stop()
-    {
-        $this->stop = TRUE;
-    }
-
-    /**
-     * Returns the PHP_CodeCoverage object.
-     *
-     * @return PHP_CodeCoverage
-     * @since  Method available since Release 3.5.0
-     */
-    public function getCodeCoverage()
-    {
-        return $this->codeCoverage;
-    }
-
-    /**
-     * Enables or disables the error-to-exception conversion.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.2.14
-     */
-    public function convertErrorsToExceptions($flag)
-    {
-        if (is_bool($flag)) {
-            $this->convertErrorsToExceptions = $flag;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Returns the error-to-exception conversion setting.
-     *
-     * @return boolean
-     * @since  Method available since Release 3.4.0
-     */
-    public function getConvertErrorsToExceptions()
-    {
-        return $this->convertErrorsToExceptions;
-    }
-
-    /**
-     * Enables or disables the stopping when an error occurs.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.5.0
-     */
-    public function stopOnError($flag)
-    {
-        if (is_bool($flag)) {
-            $this->stopOnError = $flag;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Enables or disables the stopping when a failure occurs.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.1.0
-     */
-    public function stopOnFailure($flag)
-    {
-        if (is_bool($flag)) {
-            $this->stopOnFailure = $flag;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Enables or disables the marking of a test as incomplete if no assertions
-     * are made.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.5.0
-     */
-    public function strictAssertions($flag)
-    {
-        if (is_bool($flag)) {
-            $this->strictAssertions = $flag;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Enables or disables the stopping for incomplete tests.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.5.0
-     */
-    public function stopOnIncomplete($flag)
-    {
-        if (is_bool($flag)) {
-            $this->stopOnIncomplete = $flag;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Enables or disables the stopping for skipped tests.
-     *
-     * @param  boolean $flag
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.1.0
-     */
-    public function stopOnSkipped($flag)
-    {
-        if (is_bool($flag)) {
-            $this->stopOnSkipped = $flag;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-
-    /**
-     * Returns the time spent running the tests.
-     *
-     * @return float
-     */
-    public function time()
-    {
-        return $this->time;
-    }
-
-    /**
-     * Returns whether the entire test was successful or not.
-     *
-     * @return boolean
-     */
-    public function wasSuccessful()
-    {
-        return empty($this->errors) && empty($this->failures);
-    }
-}
diff --git a/tests/PHPUnit/Framework/TestSuite.php b/tests/PHPUnit/Framework/TestSuite.php
deleted file mode 100644
index 453cfd6..0000000
--- a/tests/PHPUnit/Framework/TestSuite.php
+++ /dev/null
@@ -1,926 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-require_once 'PHP/CodeCoverage.php';
-
-/**
- * A TestSuite is a composite of Tests. It runs a collection of test cases.
- *
- * Here is an example using the dynamic test definition.
- *
- * <code>
- * <?php
- * $suite = new PHPUnit_Framework_TestSuite;
- * $suite->addTest(new MathTest('testPass'));
- * ?>
- * </code>
- *
- * Alternatively, a TestSuite can extract the tests to be run automatically.
- * To do so you pass a ReflectionClass instance for your
- * PHPUnit_Framework_TestCase class to the PHPUnit_Framework_TestSuite
- * constructor.
- *
- * <code>
- * <?php
- * $suite = new PHPUnit_Framework_TestSuite(
- *   new ReflectionClass('MathTest')
- * );
- * ?>
- * </code>
- *
- * This constructor creates a suite with all the methods starting with
- * "test" that take no arguments.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Framework_TestSuite implements PHPUnit_Framework_Test, PHPUnit_Framework_SelfDescribing, IteratorAggregate
-{
-    /**
-     * Enable or disable the backup and restoration of the $GLOBALS array.
-     *
-     * @var    boolean
-     */
-    protected $backupGlobals = NULL;
-
-    /**
-     * Enable or disable the backup and restoration of static attributes.
-     *
-     * @var    boolean
-     */
-    protected $backupStaticAttributes = NULL;
-
-    /**
-     * The name of the test suite.
-     *
-     * @var    string
-     */
-    protected $name = '';
-
-    /**
-     * The test groups of the test suite.
-     *
-     * @var    array
-     */
-    protected $groups = array();
-
-    /**
-     * The tests in the test suite.
-     *
-     * @var    array
-     */
-    protected $tests = array();
-
-    /**
-     * The number of tests in the test suite.
-     *
-     * @var    integer
-     */
-    protected $numTests = -1;
-
-    /**
-     * @var boolean
-     */
-    protected $testCase = FALSE;
-
-    /**
-     * Constructs a new TestSuite:
-     *
-     *   - PHPUnit_Framework_TestSuite() constructs an empty TestSuite.
-     *
-     *   - PHPUnit_Framework_TestSuite(ReflectionClass) constructs a
-     *     TestSuite from the given class.
-     *
-     *   - PHPUnit_Framework_TestSuite(ReflectionClass, String)
-     *     constructs a TestSuite from the given class with the given
-     *     name.
-     *
-     *   - PHPUnit_Framework_TestSuite(String) either constructs a
-     *     TestSuite from the given class (if the passed string is the
-     *     name of an existing class) or constructs an empty TestSuite
-     *     with the given name.
-     *
-     * @param  mixed  $theClass
-     * @param  string $name
-     * @throws InvalidArgumentException
-     */
-    public function __construct($theClass = '', $name = '')
-    {
-        $argumentsValid = FALSE;
-
-        if (is_object($theClass) &&
-            $theClass instanceof ReflectionClass) {
-            $argumentsValid = TRUE;
-        }
-
-        else if (is_string($theClass) &&
-                 $theClass !== '' &&
-                 class_exists($theClass, FALSE)) {
-            $argumentsValid = TRUE;
-
-            if ($name == '') {
-                $name = $theClass;
-            }
-
-            $theClass = new ReflectionClass($theClass);
-        }
-
-        else if (is_string($theClass)) {
-            $this->setName($theClass);
-            return;
-        }
-
-        if (!$argumentsValid) {
-            throw new InvalidArgumentException;
-        }
-
-        if (!$theClass->isSubclassOf('PHPUnit_Framework_TestCase')) {
-            throw new InvalidArgumentException(
-              'Class does not extend PHPUnit_Framework_TestCase.'
-            );
-        }
-
-        $filename = $theClass->getFilename();
-
-        if (strpos($filename, 'eval()') === FALSE) {
-            PHP_CodeCoverage::getInstance()->filter()->addFileToBlacklist(
-              realpath($filename), 'TESTS'
-            );
-        }
-
-        if ($name != '') {
-            $this->setName($name);
-        } else {
-            $this->setName($theClass->getName());
-        }
-
-        $constructor = $theClass->getConstructor();
-
-        if ($constructor !== NULL &&
-            !$constructor->isPublic()) {
-            $this->addTest(
-              self::warning(
-                sprintf(
-                  'Class "%s" has no public constructor.',
-
-                  $theClass->getName()
-                )
-              )
-            );
-
-            return;
-        }
-
-        foreach ($theClass->getMethods() as $method) {
-            if (strpos($method->getDeclaringClass()->getName(), 'PHPUnit_') !== 0) {
-                $this->addTestMethod($theClass, $method);
-            }
-        }
-
-        if (empty($this->tests)) {
-            $this->addTest(
-              self::warning(
-                sprintf(
-                  'No tests found in class "%s".',
-
-                  $theClass->getName()
-                )
-              )
-            );
-        }
-
-        $this->testCase = TRUE;
-    }
-
-    /**
-     * Returns a string representation of the test suite.
-     *
-     * @return string
-     */
-    public function toString()
-    {
-        return $this->getName();
-    }
-
-    /**
-     * Adds a test to the suite.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  array                  $groups
-     */
-    public function addTest(PHPUnit_Framework_Test $test, $groups = array())
-    {
-        $class = new ReflectionClass($test);
-
-        if (!$class->isAbstract()) {
-            $this->tests[]  = $test;
-            $this->numTests = -1;
-
-            if ($test instanceof PHPUnit_Framework_TestSuite &&
-                empty($groups)) {
-                $groups = $test->getGroups();
-            }
-
-            if (empty($groups)) {
-                $groups = array('__nogroup__');
-            }
-
-            foreach ($groups as $group) {
-                if (!isset($this->groups[$group])) {
-                    $this->groups[$group] = array($test);
-                } else {
-                    $this->groups[$group][] = $test;
-                }
-            }
-        }
-    }
-
-    /**
-     * Adds the tests from the given class to the suite.
-     *
-     * @param  mixed $testClass
-     * @throws InvalidArgumentException
-     */
-    public function addTestSuite($testClass)
-    {
-        if (is_string($testClass) && class_exists($testClass)) {
-            $testClass = new ReflectionClass($testClass);
-        }
-
-        if (!is_object($testClass)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              1, 'class name or object'
-            );
-        }
-
-        if ($testClass instanceof PHPUnit_Framework_TestSuite) {
-            $this->addTest($testClass);
-        }
-
-        else if ($testClass instanceof ReflectionClass) {
-            $suiteMethod = FALSE;
-
-            if (!$testClass->isAbstract()) {
-                if ($testClass->hasMethod(PHPUnit_Runner_BaseTestRunner::SUITE_METHODNAME)) {
-                    $method = $testClass->getMethod(
-                      PHPUnit_Runner_BaseTestRunner::SUITE_METHODNAME
-                    );
-
-                    if ($method->isStatic()) {
-                        $this->addTest(
-                          $method->invoke(NULL, $testClass->getName())
-                        );
-
-                        $suiteMethod = TRUE;
-                    }
-                }
-            }
-
-            if (!$suiteMethod && !$testClass->isAbstract()) {
-                $this->addTest(new PHPUnit_Framework_TestSuite($testClass));
-            }
-        }
-
-        else {
-            throw new InvalidArgumentException;
-        }
-    }
-
-    /**
-     * Wraps both <code>addTest()</code> and <code>addTestSuite</code>
-     * as well as the separate import statements for the user's convenience.
-     *
-     * If the named file cannot be read or there are no new tests that can be
-     * added, a <code>PHPUnit_Framework_Warning</code> will be created instead,
-     * leaving the current test run untouched.
-     *
-     * @param  string  $filename
-     * @param  boolean $syntaxCheck
-     * @param  array   $phptOptions Array with ini settings for the php instance
-     *                              run, key being the name if the setting,
-     *                              value the ini value.
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 2.3.0
-     * @author Stefano F. Rausch <stefano@rausch-e.net>
-     */
-    public function addTestFile($filename, $syntaxCheck = FALSE, $phptOptions = array())
-    {
-        if (!is_string($filename)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (file_exists($filename) && substr($filename, -5) == '.phpt') {
-            $this->addTest(
-              new PHPUnit_Extensions_PhptTestCase($filename, $phptOptions)
-            );
-
-            return;
-        }
-
-        if (!file_exists($filename)) {
-            $includePaths = explode(PATH_SEPARATOR, get_include_path());
-
-            foreach ($includePaths as $includePath) {
-                $file = $includePath . DIRECTORY_SEPARATOR . $filename;
-
-                if (file_exists($file)) {
-                    $filename = $file;
-                    break;
-                }
-            }
-        }
-
-        PHPUnit_Util_Class::collectStart();
-        PHPUnit_Util_Fileloader::checkAndLoad($filename, $syntaxCheck);
-        $newClasses = PHPUnit_Util_Class::collectEnd();
-        $baseName   = str_replace('.php', '', basename($filename));
-
-        foreach ($newClasses as $className) {
-            if (substr($className, 0 - strlen($baseName)) == $baseName) {
-                $newClasses = array($className);
-                break;
-            }
-        }
-
-        $testsFound = FALSE;
-
-        foreach ($newClasses as $className) {
-            $class = new ReflectionClass($className);
-
-            if (!$class->isAbstract()) {
-                if ($class->hasMethod(PHPUnit_Runner_BaseTestRunner::SUITE_METHODNAME)) {
-                    $method = $class->getMethod(
-                      PHPUnit_Runner_BaseTestRunner::SUITE_METHODNAME
-                    );
-
-                    if ($method->isStatic()) {
-                        $this->addTest($method->invoke(NULL, $className));
-
-                        $testsFound = TRUE;
-                    }
-                }
-
-                else if ($class->implementsInterface('PHPUnit_Framework_Test')) {
-                    $this->addTestSuite($class);
-
-                    $testsFound = TRUE;
-                }
-            }
-        }
-
-        $this->numTests = -1;
-    }
-
-    /**
-     * Wrapper for addTestFile() that adds multiple test files.
-     *
-     * @param  array|Iterator $filenames
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 2.3.0
-     */
-    public function addTestFiles($filenames, $syntaxCheck = FALSE)
-    {
-        if (!(is_array($filenames) ||
-             (is_object($filenames) && $filenames instanceof Iterator))) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(
-              1, 'array or iterator'
-            );
-        }
-
-        foreach ($filenames as $filename) {
-            $this->addTestFile((string)$filename, $syntaxCheck);
-        }
-    }
-
-    /**
-     * Counts the number of test cases that will be run by this test.
-     *
-     * @return integer
-     */
-    public function count()
-    {
-        if ($this->numTests > -1) {
-            return $this->numTests;
-        }
-
-        $this->numTests = 0;
-
-        foreach ($this->tests as $test) {
-            $this->numTests += count($test);
-        }
-
-        return $this->numTests;
-    }
-
-    /**
-     * @param  ReflectionClass $theClass
-     * @param  string          $name
-     * @return PHPUnit_Framework_Test
-     * @throws RuntimeException
-     */
-    public static function createTest(ReflectionClass $theClass, $name)
-    {
-        $className = $theClass->getName();
-
-        if (!$theClass->isInstantiable()) {
-            return self::warning(
-              sprintf('Cannot instantiate class "%s".', $className)
-            );
-        }
-
-        $backupSettings           = PHPUnit_Util_Test::getBackupSettings(
-                                      $className, $name
-                                    );
-        $preserveGlobalState      = PHPUnit_Util_Test::getPreserveGlobalStateSettings(
-                                      $className, $name
-                                    );
-        $runTestInSeparateProcess = PHPUnit_Util_Test::getProcessIsolationSettings(
-                                      $className, $name
-                                    );
-
-        $constructor = $theClass->getConstructor();
-
-        if ($constructor !== NULL) {
-            $parameters = $constructor->getParameters();
-
-            // TestCase() or TestCase($name)
-            if (count($parameters) < 2) {
-                $test = new $className;
-            }
-
-            // TestCase($name, $data)
-            else {
-                try {
-                    $data = PHPUnit_Util_Test::getProvidedData(
-                      $className, $name
-                    );
-                }
-
-                catch (Exception $e) {
-                    $message = sprintf(
-                      'The data provider specified for %s::%s is invalid.',
-                      $className,
-                      $name
-                    );
-
-                    $_message = $e->getMessage();
-
-                    if (!empty($_message)) {
-                        $message .= "\n" . $_message;
-                    }
-
-                    return new PHPUnit_Framework_Warning($message);
-                }
-
-                $groups = PHPUnit_Util_Test::getGroups($className, $name);
-
-                // Test method with @dataProvider.
-                if (isset($data)) {
-                    $test = new PHPUnit_Framework_TestSuite_DataProvider(
-                      $className . '::' . $name
-                    );
-
-                    foreach ($data as $_dataName => $_data) {
-                        $_test = new $className($name, $_data, $_dataName);
-
-                        if ($runTestInSeparateProcess) {
-                            $_test->setRunTestInSeparateProcess(TRUE);
-
-                            if ($preserveGlobalState !== NULL) {
-                                $_test->setPreserveGlobalState($preserveGlobalState);
-                            }
-                        }
-
-                        if ($backupSettings['backupGlobals'] !== NULL) {
-                            $_test->setBackupGlobals(
-                              $backupSettings['backupGlobals']
-                            );
-                        }
-
-                        if ($backupSettings['backupStaticAttributes'] !== NULL) {
-                            $_test->setBackupStaticAttributes(
-                              $backupSettings['backupStaticAttributes']
-                            );
-                        }
-
-                        $test->addTest($_test, $groups);
-                    }
-                }
-
-                else {
-                    $test = new $className;
-                }
-            }
-        }
-
-        if (!isset($test)) {
-            throw new RuntimeException('No valid test provided.');
-        }
-
-        if ($test instanceof PHPUnit_Framework_TestCase) {
-            $test->setName($name);
-
-            if ($runTestInSeparateProcess) {
-                $test->setRunTestInSeparateProcess(TRUE);
-
-                if ($preserveGlobalState !== NULL) {
-                    $test->setPreserveGlobalState($preserveGlobalState);
-                }
-            }
-
-            if ($backupSettings['backupGlobals'] !== NULL) {
-                $test->setBackupGlobals($backupSettings['backupGlobals']);
-            }
-
-            if ($backupSettings['backupStaticAttributes'] !== NULL) {
-                $test->setBackupStaticAttributes(
-                  $backupSettings['backupStaticAttributes']
-                );
-            }
-        }
-
-        return $test;
-    }
-
-    /**
-     * Creates a default TestResult object.
-     *
-     * @return PHPUnit_Framework_TestResult
-     */
-    protected function createResult()
-    {
-        return new PHPUnit_Framework_TestResult;
-    }
-
-    /**
-     * Returns the name of the suite.
-     *
-     * @return string
-     */
-    public function getName()
-    {
-        return $this->name;
-    }
-
-    /**
-     * Returns the test groups of the suite.
-     *
-     * @return array
-     * @since  Method available since Release 3.2.0
-     */
-    public function getGroups()
-    {
-        return array_keys($this->groups);
-    }
-
-    /**
-     * Runs the tests and collects their result in a TestResult.
-     *
-     * @param  PHPUnit_Framework_TestResult $result
-     * @param  mixed                        $filter
-     * @param  array                        $groups
-     * @param  array                        $excludeGroups
-     * @param  boolean                      $processIsolation
-     * @return PHPUnit_Framework_TestResult
-     * @throws InvalidArgumentException
-     */
-    public function run(PHPUnit_Framework_TestResult $result = NULL, $filter = FALSE, array $groups = array(), array $excludeGroups = array(), $processIsolation = FALSE)
-    {
-        if ($result === NULL) {
-            $result = $this->createResult();
-        }
-
-        $result->startTestSuite($this);
-
-        try {
-            $this->setUp();
-
-            if ($this->testCase &&
-                method_exists($this->name, 'setUpBeforeClass')) {
-                call_user_func(array($this->name, 'setUpBeforeClass'));
-            }
-        }
-
-        catch (PHPUnit_Framework_SkippedTestSuiteError $e) {
-            $numTests = count($this);
-
-            for ($i = 0; $i < $numTests; $i++) {
-                $result->addFailure($this, $e, 0);
-            }
-
-            return $result;
-        }
-
-        if (empty($groups)) {
-            $tests = $this->tests;
-        } else {
-            $tests = new SplObjectStorage;
-
-            foreach ($groups as $group) {
-                if (isset($this->groups[$group])) {
-                    foreach ($this->groups[$group] as $test) {
-                        $tests->attach($test);
-                    }
-                }
-            }
-        }
-
-        foreach ($tests as $test) {
-            if ($result->shouldStop()) {
-                break;
-            }
-
-            if ($test instanceof PHPUnit_Framework_TestSuite) {
-                $test->setBackupGlobals($this->backupGlobals);
-                $test->setBackupStaticAttributes($this->backupStaticAttributes);
-
-                $test->run(
-                  $result, $filter, $groups, $excludeGroups, $processIsolation
-                );
-            } else {
-                $runTest = TRUE;
-
-                if ($filter !== FALSE ) {
-                    $tmp = PHPUnit_Util_Test::describe($test, FALSE);
-
-                    if ($tmp[0] != '') {
-                        $name = join('::', $tmp);
-                    } else {
-                        $name = $tmp[1];
-                    }
-
-                    if (preg_match($filter, $name) == 0) {
-                        $runTest = FALSE;
-                    }
-                }
-
-                if ($runTest && !empty($excludeGroups)) {
-                    foreach ($this->groups as $_group => $_tests) {
-                        if (in_array($_group, $excludeGroups)) {
-                            foreach ($_tests as $_test) {
-                                if ($test === $_test) {
-                                    $runTest = FALSE;
-                                    break 2;
-                                }
-                            }
-                        }
-                    }
-                }
-
-                if ($runTest) {
-                    if ($test instanceof PHPUnit_Framework_TestCase) {
-                        $test->setBackupGlobals($this->backupGlobals);
-                        $test->setBackupStaticAttributes(
-                          $this->backupStaticAttributes
-                        );
-                        $test->setRunTestInSeparateProcess($processIsolation);
-                    }
-
-                    $this->runTest($test, $result);
-                }
-            }
-        }
-
-        if ($this->testCase &&
-            method_exists($this->name, 'tearDownAfterClass')) {
-            call_user_func(array($this->name, 'tearDownAfterClass'));
-        }
-
-        $this->tearDown();
-        $result->endTestSuite($this);
-
-        return $result;
-    }
-
-    /**
-     * Runs a test.
-     *
-     * @param  PHPUnit_Framework_Test        $test
-     * @param  PHPUnit_Framework_TestResult  $testResult
-     */
-    public function runTest(PHPUnit_Framework_Test $test, PHPUnit_Framework_TestResult $result)
-    {
-        $test->run($result);
-    }
-
-    /**
-     * Sets the name of the suite.
-     *
-     * @param  string
-     */
-    public function setName($name)
-    {
-        $this->name = $name;
-    }
-
-    /**
-     * Returns the test at the given index.
-     *
-     * @param  integer
-     * @return PHPUnit_Framework_Test
-     */
-    public function testAt($index)
-    {
-        if (isset($this->tests[$index])) {
-            return $this->tests[$index];
-        } else {
-            return FALSE;
-        }
-    }
-
-    /**
-     * Returns the tests as an enumeration.
-     *
-     * @return array
-     */
-    public function tests()
-    {
-        return $this->tests;
-    }
-
-    /**
-     * Mark the test suite as skipped.
-     *
-     * @param  string  $message
-     * @throws PHPUnit_Framework_SkippedTestSuiteError
-     * @since  Method available since Release 3.0.0
-     */
-    public function markTestSuiteSkipped($message = '')
-    {
-        throw new PHPUnit_Framework_SkippedTestSuiteError($message);
-    }
-
-    /**
-     * @param ReflectionClass  $class
-     * @param ReflectionMethod $method
-     */
-    protected function addTestMethod(ReflectionClass $class, ReflectionMethod $method)
-    {
-        $name = $method->getName();
-
-        if ($this->isPublicTestMethod($method)) {
-            $test = self::createTest($class, $name);
-
-            if ($test instanceof PHPUnit_Framework_TestCase ||
-                $test instanceof PHPUnit_Framework_TestSuite_DataProvider) {
-                $test->setDependencies(
-                  PHPUnit_Util_Test::getDependencies($class->getName(), $name)
-                );
-            }
-
-            $this->addTest($test, PHPUnit_Util_Test::getGroups(
-              $class->getName(), $name)
-            );
-        }
-
-        else if ($this->isTestMethod($method)) {
-            $this->addTest(
-              self::warning(
-                sprintf(
-                  'Test method "%s" is not public.',
-
-                  $name
-                )
-              )
-            );
-        }
-    }
-
-    /**
-     * @param  ReflectionMethod $method
-     * @return boolean
-     */
-    public static function isPublicTestMethod(ReflectionMethod $method)
-    {
-        return (self::isTestMethod($method) && $method->isPublic());
-    }
-
-    /**
-     * @param  ReflectionMethod $method
-     * @return boolean
-     */
-    public static function isTestMethod(ReflectionMethod $method)
-    {
-        if (strpos($method->name, 'test') === 0) {
-            return TRUE;
-        }
-
-        // @scenario on TestCase::testMethod()
-        // @test     on TestCase::testMethod()
-        return strpos($method->getDocComment(), '@test')     !== FALSE ||
-               strpos($method->getDocComment(), '@scenario') !== FALSE;
-    }
-
-    /**
-     * @param  string  $message
-     * @return PHPUnit_Framework_Warning
-     */
-    protected static function warning($message)
-    {
-        return new PHPUnit_Framework_Warning($message);
-    }
-
-    /**
-     * @param  boolean $backupGlobals
-     * @since  Method available since Release 3.3.0
-     */
-    public function setBackupGlobals($backupGlobals)
-    {
-        if (is_null($this->backupGlobals) && is_bool($backupGlobals)) {
-            $this->backupGlobals = $backupGlobals;
-        }
-    }
-
-    /**
-     * @param  boolean $backupStaticAttributes
-     * @since  Method available since Release 3.4.0
-     */
-    public function setBackupStaticAttributes($backupStaticAttributes)
-    {
-        if (is_null($this->backupStaticAttributes) &&
-            is_bool($backupStaticAttributes)) {
-            $this->backupStaticAttributes = $backupStaticAttributes;
-        }
-    }
-
-    /**
-     * Returns an iterator for this test suite.
-     *
-     * @return RecursiveIteratorIterator
-     * @since  Method available since Release 3.1.0
-     */
-    public function getIterator()
-    {
-        return new RecursiveIteratorIterator(
-          new PHPUnit_Util_TestSuiteIterator($this)
-        );
-    }
-
-    /**
-     * Template Method that is called before the tests
-     * of this test suite are run.
-     *
-     * @since  Method available since Release 3.1.0
-     */
-    protected function setUp()
-    {
-    }
-
-    /**
-     * Template Method that is called after the tests
-     * of this test suite have finished running.
-     *
-     * @since  Method available since Release 3.1.0
-     */
-    protected function tearDown()
-    {
-    }
-}
diff --git a/tests/PHPUnit/Framework/TestSuite/DataProvider.php b/tests/PHPUnit/Framework/TestSuite/DataProvider.php
deleted file mode 100644
index 3ea32e0..0000000
--- a/tests/PHPUnit/Framework/TestSuite/DataProvider.php
+++ /dev/null
@@ -1,71 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework_TestSuite
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- *
- *
- * @package    PHPUnit
- * @subpackage Framework_TestSuite
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Framework_TestSuite_DataProvider extends PHPUnit_Framework_TestSuite
-{
-    /**
-     * Sets the dependencies of a TestCase.
-     *
-     * @param array $dependencies
-     */
-    public function setDependencies(array $dependencies)
-    {
-        foreach ($this->tests as $test) {
-            $test->setDependencies($dependencies);
-        }
-    }
-}
diff --git a/tests/PHPUnit/Framework/Warning.php b/tests/PHPUnit/Framework/Warning.php
deleted file mode 100644
index 3a3a901..0000000
--- a/tests/PHPUnit/Framework/Warning.php
+++ /dev/null
@@ -1,126 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A warning.
- *
- * @package    PHPUnit
- * @subpackage Framework
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Framework_Warning extends PHPUnit_Framework_TestCase
-{
-    /**
-     * @var string
-     */
-    protected $message = '';
-
-    /**
-     * @var boolean
-     */
-    protected $backupGlobals = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $backupStaticAttributes = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $runTestInSeparateProcess = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $useErrorHandler = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $useOutputBuffering = FALSE;
-
-    /**
-     * @param string $message
-     */
-    public function __construct($message = '')
-    {
-        $this->message = $message;
-        parent::__construct('Warning');
-    }
-
-    /**
-     * @throws RuntimeException
-     */
-    protected function runTest()
-    {
-        $this->fail($this->message);
-    }
-
-    /**
-     * @return string
-     * @since  Method available since Release 3.0.0
-     */
-    public function getMessage()
-    {
-        return $this->message;
-    }
-
-    /**
-     * Returns a string representation of the test case.
-     *
-     * @return string
-     * @since  Method available since Release 3.4.0
-     */
-    public function toString()
-    {
-        return 'Warning';
-    }
-}
diff --git a/tests/PHPUnit/Runner/BaseTestRunner.php b/tests/PHPUnit/Runner/BaseTestRunner.php
deleted file mode 100644
index 4880bfc..0000000
--- a/tests/PHPUnit/Runner/BaseTestRunner.php
+++ /dev/null
@@ -1,190 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * Base class for all test runners.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-abstract class PHPUnit_Runner_BaseTestRunner
-{
-    const STATUS_PASSED     = 0;
-    const STATUS_SKIPPED    = 1;
-    const STATUS_INCOMPLETE = 2;
-    const STATUS_FAILURE    = 3;
-    const STATUS_ERROR      = 4;
-    const SUITE_METHODNAME  = 'suite';
-
-    /**
-     * Returns the loader to be used.
-     *
-     * @return PHPUnit_Runner_TestSuiteLoader
-     */
-    public function getLoader()
-    {
-        return new PHPUnit_Runner_StandardTestSuiteLoader;
-    }
-
-    /**
-     * Returns the Test corresponding to the given suite.
-     * This is a template method, subclasses override
-     * the runFailed() and clearStatus() methods.
-     *
-     * @param  string  $suiteClassName
-     * @param  string  $suiteClassFile
-     * @param  boolean $syntaxCheck
-     * @return PHPUnit_Framework_Test
-     */
-    public function getTest($suiteClassName, $suiteClassFile = '', $syntaxCheck = FALSE)
-    {
-        if (is_dir($suiteClassName) &&
-            !is_file($suiteClassName . '.php') && empty($suiteClassFile)) {
-            $testCollector = new PHPUnit_Runner_IncludePathTestCollector(
-              array($suiteClassName)
-            );
-
-            $suite = new PHPUnit_Framework_TestSuite($suiteClassName);
-            $suite->addTestFiles($testCollector->collectTests(), $syntaxCheck);
-
-            return $suite;
-        }
-
-        try {
-            $testClass = $this->loadSuiteClass(
-              $suiteClassName, $suiteClassFile, $syntaxCheck
-            );
-        }
-
-        catch (Exception $e) {
-            $this->runFailed($e->getMessage());
-            return NULL;
-        }
-
-        try {
-            $suiteMethod = $testClass->getMethod(self::SUITE_METHODNAME);
-
-            if (!$suiteMethod->isStatic()) {
-                $this->runFailed(
-                  'suite() method must be static.'
-                );
-
-                return NULL;
-            }
-
-            try {
-                $test = $suiteMethod->invoke(NULL, $testClass->getName());
-            }
-
-            catch (ReflectionException $e) {
-                $this->runFailed(
-                  sprintf(
-                    "Failed to invoke suite() method.\n%s",
-
-                    $e->getMessage()
-                  )
-                );
-
-                return NULL;
-            }
-        }
-
-        catch (ReflectionException $e) {
-            try {
-                $test = new PHPUnit_Framework_TestSuite($testClass);
-            }
-
-            catch (InvalidArgumentException $e) {
-                $test = new PHPUnit_Framework_TestSuite;
-                $test->setName($suiteClassName);
-            }
-        }
-
-        $this->clearStatus();
-
-        return $test;
-    }
-
-    /**
-     * Returns the loaded ReflectionClass for a suite name.
-     *
-     * @param  string  $suiteClassName
-     * @param  string  $suiteClassFile
-     * @param  boolean $syntaxCheck
-     * @return ReflectionClass
-     */
-    protected function loadSuiteClass($suiteClassName, $suiteClassFile = '', $syntaxCheck = FALSE)
-    {
-        $loader = $this->getLoader();
-
-        if ($loader instanceof PHPUnit_Runner_StandardTestSuiteLoader) {
-            return $loader->load($suiteClassName, $suiteClassFile, $syntaxCheck);
-        } else {
-            return $loader->load($suiteClassName, $suiteClassFile);
-        }
-    }
-
-    /**
-     * Clears the status message.
-     *
-     */
-    protected function clearStatus()
-    {
-    }
-
-    /**
-     * Override to define how to handle a failed loading of
-     * a test suite.
-     *
-     * @param  string  $message
-     */
-    abstract protected function runFailed($message);
-}
diff --git a/tests/PHPUnit/Runner/IncludePathTestCollector.php b/tests/PHPUnit/Runner/IncludePathTestCollector.php
deleted file mode 100644
index 72e6f9f..0000000
--- a/tests/PHPUnit/Runner/IncludePathTestCollector.php
+++ /dev/null
@@ -1,144 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.1.0
- */
-
-require_once 'File/Iterator/Factory.php';
-
-/**
- * A test collector that collects tests from one or more directories
- * recursively. If no directories are specified, the include_path is searched.
- *
- * <code>
- * $testCollector = new PHPUnit_Runner_IncludePathTestCollector(
- *   array('/path/to/*Test.php files')
- * );
- *
- * $suite = new PHPUnit_Framework_TestSuite('My Test Suite');
- * $suite->addTestFiles($testCollector->collectTests());
- * </code>
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.1.0
- */
-class PHPUnit_Runner_IncludePathTestCollector implements PHPUnit_Runner_TestCollector
-{
-    /**
-     * @var string
-     */
-    protected $filterIterator;
-
-    /**
-     * @var array
-     */
-    protected $paths;
-
-    /**
-     * @var mixed
-     */
-    protected $suffixes;
-
-    /**
-     * @var mixed
-     */
-    protected $prefixes;
-
-    /**
-     * @param array $paths
-     * @param mixed $suffixes
-     * @param mixed $prefixes
-     */
-    public function __construct(array $paths = array(), $suffixes = array('Test.php', '.phpt'), $prefixes = array())
-    {
-        if (!empty($paths)) {
-            $this->paths = $paths;
-        } else {
-            $this->paths = explode(PATH_SEPARATOR, get_include_path());
-        }
-
-        $this->suffixes = $suffixes;
-        $this->prefixes = $prefixes;
-    }
-
-    /**
-     * @return File_Iterator
-     */
-    public function collectTests()
-    {
-        $iterator = File_Iterator_Factory::getFileIterator(
-          $this->paths, $this->suffixes, $this->prefixes
-        );
-
-        if ($this->filterIterator !== NULL) {
-            $class    = new ReflectionClass($this->filterIterator);
-            $iterator = $class->newInstance($iterator);
-        }
-
-        return $iterator;
-    }
-
-    /**
-     * Adds a FilterIterator to filter the source files to be collected.
-     *
-     * @param  string $filterIterator
-     * @throws InvalidArgumentException
-     */
-    public function setFilterIterator($filterIterator)
-    {
-        if (is_string($filterIterator) && class_exists($filterIterator)) {
-            $class = new ReflectionClass($filterIterator);
-
-            if ($class->isSubclassOf('FilterIterator')) {
-                $this->filterIterator = $filterIterator;
-            }
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'class name');
-        }
-    }
-}
diff --git a/tests/PHPUnit/Runner/StandardTestSuiteLoader.php b/tests/PHPUnit/Runner/StandardTestSuiteLoader.php
deleted file mode 100644
index 67a6f8f..0000000
--- a/tests/PHPUnit/Runner/StandardTestSuiteLoader.php
+++ /dev/null
@@ -1,167 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * The standard test suite loader.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Runner_StandardTestSuiteLoader implements PHPUnit_Runner_TestSuiteLoader
-{
-    /**
-     * @param  string  $suiteClassName
-     * @param  string  $suiteClassFile
-     * @param  boolean $syntaxCheck
-     * @return ReflectionClass
-     * @throws RuntimeException
-     */
-    public function load($suiteClassName, $suiteClassFile = '', $syntaxCheck = FALSE)
-    {
-        $suiteClassName = str_replace('.php', '', $suiteClassName);
-
-        if (empty($suiteClassFile)) {
-            $suiteClassFile = PHPUnit_Util_Filesystem::classNameToFilename(
-              $suiteClassName
-            );
-        }
-
-        if (!class_exists($suiteClassName, FALSE)) {
-            if (!file_exists($suiteClassFile)) {
-                $includePaths = explode(PATH_SEPARATOR, get_include_path());
-
-                foreach ($includePaths as $includePath) {
-                    $file = $includePath . DIRECTORY_SEPARATOR .
-                            $suiteClassFile;
-
-                    if (file_exists($file)) {
-                        $suiteClassFile = $file;
-                        break;
-                    }
-                }
-            }
-
-            PHPUnit_Util_Class::collectStart();
-            PHPUnit_Util_Fileloader::checkAndLoad($suiteClassFile, $syntaxCheck);
-            $loadedClasses = PHPUnit_Util_Class::collectEnd();
-        }
-
-        if (!class_exists($suiteClassName, FALSE) && !empty($loadedClasses)) {
-            $offset = 0 - strlen($suiteClassName);
-
-            foreach ($loadedClasses as $loadedClass) {
-                if (substr($loadedClass, $offset) === $suiteClassName) {
-                    $suiteClassName = $loadedClass;
-                    break;
-                }
-            }
-        }
-
-        if (!class_exists($suiteClassName, FALSE) && !empty($loadedClasses)) {
-            $testCaseClass = 'PHPUnit_Framework_TestCase';
-
-            foreach ($loadedClasses as $loadedClass) {
-                $class     = new ReflectionClass($loadedClass);
-                $classFile = $class->getFileName();
-
-                if ($class->isSubclassOf($testCaseClass) &&
-                    !$class->isAbstract()) {
-                    $suiteClassName = $loadedClass;
-                    $testCaseClass  = $loadedClass;
-
-                    if ($classFile == realpath($suiteClassFile)) {
-                        break;
-                    }
-                }
-
-                if ($class->hasMethod('suite')) {
-                    $method = $class->getMethod('suite');
-
-                    if (!$method->isAbstract() &&
-                        $method->isPublic() &&
-                        $method->isStatic()) {
-                        $suiteClassName = $loadedClass;
-
-                        if ($classFile == realpath($suiteClassFile)) {
-                            break;
-                        }
-                    }
-                }
-            }
-        }
-
-        if (class_exists($suiteClassName, FALSE)) {
-            $class = new ReflectionClass($suiteClassName);
-
-            if ($class->getFileName() == realpath($suiteClassFile)) {
-                return $class;
-            }
-        }
-
-        throw new PHPUnit_Framework_Exception(
-          sprintf(
-            'Class %s could not be found in %s.',
-
-            $suiteClassName,
-            $suiteClassFile
-          )
-        );
-    }
-
-    /**
-     * @param  ReflectionClass  $aClass
-     * @return ReflectionClass
-     */
-    public function reload(ReflectionClass $aClass)
-    {
-        return $aClass;
-    }
-}
diff --git a/tests/PHPUnit/Runner/TestCollector.php b/tests/PHPUnit/Runner/TestCollector.php
deleted file mode 100644
index 8251e01..0000000
--- a/tests/PHPUnit/Runner/TestCollector.php
+++ /dev/null
@@ -1,65 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * Collects Test class names to be presented
- * by the TestSelector.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 2.0.0
- */
-interface PHPUnit_Runner_TestCollector
-{
-    /**
-     * @return array
-     */
-    public function collectTests();
-}
diff --git a/tests/PHPUnit/Runner/TestSuiteLoader.php b/tests/PHPUnit/Runner/TestSuiteLoader.php
deleted file mode 100644
index 0f44cda..0000000
--- a/tests/PHPUnit/Runner/TestSuiteLoader.php
+++ /dev/null
@@ -1,72 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * An interface to define how a test suite should be loaded.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Interface available since Release 2.0.0
- */
-interface PHPUnit_Runner_TestSuiteLoader
-{
-    /**
-     * @param  string  $suiteClassName
-     * @param  string  $suiteClassFile
-     * @return ReflectionClass
-     */
-    public function load($suiteClassName, $suiteClassFile = '');
-
-    /**
-     * @param  ReflectionClass $aClass
-     * @return ReflectionClass
-     */
-    public function reload(ReflectionClass $aClass);
-}
diff --git a/tests/PHPUnit/Runner/Version.php b/tests/PHPUnit/Runner/Version.php
deleted file mode 100644
index e5193c6..0000000
--- a/tests/PHPUnit/Runner/Version.php
+++ /dev/null
@@ -1,77 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * This class defines the current version of PHPUnit.
- *
- * @package    PHPUnit
- * @subpackage Runner
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Runner_Version
-{
-    /**
-     * Returns the current version of PHPUnit.
-     *
-     * @return string
-     */
-    public static function id()
-    {
-        return '@package_version@';
-    }
-
-    /**
-     * @return string
-     */
-    public static function getVersionString()
-    {
-        return 'PHPUnit @package_version@ by Sebastian Bergmann.';
-    }
-}
diff --git a/tests/PHPUnit/TextUI/Command.php b/tests/PHPUnit/TextUI/Command.php
deleted file mode 100644
index 0f679a3..0000000
--- a/tests/PHPUnit/TextUI/Command.php
+++ /dev/null
@@ -1,860 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage TextUI
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * A TestRunner for the Command Line Interface (CLI)
- * PHP SAPI Module.
- *
- * @package    PHPUnit
- * @subpackage TextUI
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_TextUI_Command
-{
-    /**
-     * @var array
-     */
-    protected $arguments = array(
-      'listGroups'              => FALSE,
-      'loader'                  => NULL,
-      'syntaxCheck'             => FALSE,
-      'useDefaultConfiguration' => TRUE
-    );
-
-    /**
-     * @var array
-     */
-    protected $options = array();
-
-    /**
-     * @var array
-     */
-    protected $longOptions = array(
-      'colors' => NULL,
-      'bootstrap=' => NULL,
-      'configuration=' => NULL,
-      'coverage-html=' => NULL,
-      'coverage-clover=' => NULL,
-      'debug' => NULL,
-      'exclude-group=' => NULL,
-      'filter=' => NULL,
-      'group=' => NULL,
-      'help' => NULL,
-      'include-path=' => NULL,
-      'list-groups' => NULL,
-      'loader=' => NULL,
-      'log-dbus' => NULL,
-      'log-json=' => NULL,
-      'log-junit=' => NULL,
-      'log-tap=' => NULL,
-      'process-isolation' => NULL,
-      'repeat=' => NULL,
-      'skeleton-class' => NULL,
-      'skeleton-test' => NULL,
-      'stderr' => NULL,
-      'stop-on-error' => NULL,
-      'stop-on-failure' => NULL,
-      'stop-on-incomplete' => NULL,
-      'stop-on-skipped' => NULL,
-      'story' => NULL,
-      'story-html=' => NULL,
-      'story-text=' => NULL,
-      'strict' => NULL,
-      'syntax-check' => NULL,
-      'tap' => NULL,
-      'testdox' => NULL,
-      'testdox-html=' => NULL,
-      'testdox-text=' => NULL,
-      'no-configuration' => NULL,
-      'no-globals-backup' => NULL,
-      'static-backup' => NULL,
-      'verbose' => NULL,
-      'version' => NULL,
-      'wait' => NULL
-    );
-
-    /**
-     * @param boolean $exit
-     */
-    public static function main($exit = TRUE)
-    {
-        $command = new PHPUnit_TextUI_Command;
-        $command->run($_SERVER['argv'], $exit);
-    }
-
-    /**
-     * @param array   $argv
-     * @param boolean $exit
-     */
-    public function run(array $argv, $exit = TRUE)
-    {
-        $this->handleArguments($argv);
-
-        $runner = new PHPUnit_TextUI_TestRunner($this->arguments['loader']);
-
-        if (is_object($this->arguments['test']) &&
-            $this->arguments['test'] instanceof PHPUnit_Framework_Test) {
-            $suite = $this->arguments['test'];
-        } else {
-            $suite = $runner->getTest(
-              $this->arguments['test'],
-              $this->arguments['testFile'],
-              $this->arguments['syntaxCheck']
-            );
-        }
-
-        if (count($suite) == 0) {
-            $skeleton = new PHPUnit_Util_Skeleton_Test(
-              $suite->getName(),
-              $this->arguments['testFile']
-            );
-
-            $result = $skeleton->generate(TRUE);
-
-            if (!$result['incomplete']) {
-                eval(str_replace(array('<?php', '?>'), '', $result['code']));
-                $suite = new PHPUnit_Framework_TestSuite(
-                  $this->arguments['test'] . 'Test'
-                );
-            }
-        }
-
-        if ($this->arguments['listGroups']) {
-            PHPUnit_TextUI_TestRunner::printVersionString();
-
-            print "Available test group(s):\n";
-
-            $groups = $suite->getGroups();
-            sort($groups);
-
-            foreach ($groups as $group) {
-                print " - $group\n";
-            }
-
-            exit(PHPUnit_TextUI_TestRunner::SUCCESS_EXIT);
-        }
-
-        unset($this->arguments['test']);
-        unset($this->arguments['testFile']);
-
-        try {
-            $result = $runner->doRun($suite, $this->arguments);
-        }
-
-        catch (PHPUnit_Framework_Exception $e) {
-            print $e->getMessage() . "\n";
-        }
-
-        if ($exit) {
-            if (isset($result) && $result->wasSuccessful()) {
-                exit(PHPUnit_TextUI_TestRunner::SUCCESS_EXIT);
-            }
-
-            else if (!isset($result) || $result->errorCount() > 0) {
-                exit(PHPUnit_TextUI_TestRunner::EXCEPTION_EXIT);
-            }
-
-            else {
-                exit(PHPUnit_TextUI_TestRunner::FAILURE_EXIT);
-            }
-        }
-    }
-
-    /**
-     * Handles the command-line arguments.
-     *
-     * A child class of PHPUnit_TextUI_Command can hook into the argument
-     * parsing by adding the switch(es) to the $longOptions array and point to a
-     * callback method that handles the switch(es) in the child class like this
-     *
-     * <code>
-     * <?php
-     * class MyCommand extends PHPUnit_TextUI_Command
-     * {
-     *     public function __construct()
-     *     {
-     *         $this->longOptions['--my-switch'] = 'myHandler';
-     *     }
-     *
-     *     // --my-switch foo -> myHandler('foo')
-     *     protected function myHandler($value)
-     *     {
-     *     }
-     * }
-     * </code>
-     *
-     * @param array $argv
-     */
-    protected function handleArguments(array $argv)
-    {
-        try {
-            $this->options = PHPUnit_Util_Getopt::getopt(
-              $argv,
-              'd:c:',
-              array_keys($this->longOptions)
-            );
-        }
-
-        catch (RuntimeException $e) {
-            PHPUnit_TextUI_TestRunner::showError($e->getMessage());
-        }
-
-        $skeletonClass = FALSE;
-        $skeletonTest  = FALSE;
-
-        foreach ($this->options[0] as $option) {
-            switch ($option[0]) {
-                case '--colors': {
-                    $this->arguments['colors'] = TRUE;
-                }
-                break;
-
-                case '--bootstrap': {
-                    $this->arguments['bootstrap'] = $option[1];
-                }
-                break;
-
-                case 'c':
-                case '--configuration': {
-                    $this->arguments['configuration'] = $option[1];
-                }
-                break;
-
-                case '--coverage-clover': {
-                    if (extension_loaded('tokenizer') &&
-                        extension_loaded('xdebug')) {
-                        $this->arguments['coverageClover'] = $option[1];
-                    } else {
-                        if (!extension_loaded('tokenizer')) {
-                            $this->showMessage(
-                              'The tokenizer extension is not loaded.'
-                            );
-                        } else {
-                            $this->showMessage(
-                              'The Xdebug extension is not loaded.'
-                            );
-                        }
-                    }
-                }
-                break;
-
-                case '--coverage-html': {
-                    if (extension_loaded('tokenizer') &&
-                        extension_loaded('xdebug')) {
-                        $this->arguments['reportDirectory'] = $option[1];
-                    } else {
-                        if (!extension_loaded('tokenizer')) {
-                            $this->showMessage(
-                              'The tokenizer extension is not loaded.'
-                            );
-                        } else {
-                            $this->showMessage(
-                              'The Xdebug extension is not loaded.'
-                            );
-                        }
-                    }
-                }
-                break;
-
-                case 'd': {
-                    $ini = explode('=', $option[1]);
-
-                    if (isset($ini[0])) {
-                        if (isset($ini[1])) {
-                            ini_set($ini[0], $ini[1]);
-                        } else {
-                            ini_set($ini[0], TRUE);
-                        }
-                    }
-                }
-                break;
-
-                case '--debug': {
-                    $this->arguments['debug'] = TRUE;
-                }
-                break;
-
-                case '--help': {
-                    $this->showHelp();
-                    exit(PHPUnit_TextUI_TestRunner::SUCCESS_EXIT);
-                }
-                break;
-
-                case '--filter': {
-                    $this->arguments['filter'] = $option[1];
-                }
-                break;
-
-                case '--group': {
-                    $this->arguments['groups'] = explode(',', $option[1]);
-                }
-                break;
-
-                case '--exclude-group': {
-                    $this->arguments['excludeGroups'] = explode(
-                      ',', $option[1]
-                    );
-                }
-                break;
-
-                case '--include-path': {
-                    $includePath = $option[1];
-                }
-                break;
-
-                case '--list-groups': {
-                    $this->arguments['listGroups'] = TRUE;
-                }
-                break;
-
-                case '--loader': {
-                    $this->arguments['loader'] = $option[1];
-                }
-                break;
-
-                case '--log-dbus': {
-                    $this->arguments['logDbus'] = TRUE;
-                }
-                break;
-
-                case '--log-json': {
-                    $this->arguments['jsonLogfile'] = $option[1];
-                }
-                break;
-
-                case '--log-junit': {
-                    $this->arguments['junitLogfile'] = $option[1];
-                }
-                break;
-
-                case '--log-tap': {
-                    $this->arguments['tapLogfile'] = $option[1];
-                }
-                break;
-
-                case '--process-isolation': {
-                    $this->arguments['processIsolation'] = TRUE;
-                    $this->arguments['syntaxCheck']      = FALSE;
-                }
-                break;
-
-                case '--repeat': {
-                    $this->arguments['repeat'] = (int)$option[1];
-                }
-                break;
-
-                case '--stderr': {
-                    $this->arguments['printer'] = new PHPUnit_TextUI_ResultPrinter(
-                      'php://stderr',
-                      isset($this->arguments['verbose']) ? $this->arguments['verbose'] : FALSE
-                    );
-                }
-                break;
-
-                case '--stop-on-error': {
-                    $this->arguments['stopOnError'] = TRUE;
-                }
-                break;
-
-                case '--stop-on-failure': {
-                    $this->arguments['stopOnFailure'] = TRUE;
-                }
-                break;
-
-                case '--stop-on-incomplete': {
-                    $this->arguments['stopOnIncomplete'] = TRUE;
-                }
-                break;
-
-                case '--stop-on-skipped': {
-                    $this->arguments['stopOnSkipped'] = TRUE;
-                }
-                break;
-
-                case '--skeleton-test': {
-                    $skeletonTest  = TRUE;
-                    $skeletonClass = FALSE;
-                }
-                break;
-
-                case '--skeleton-class': {
-                    $skeletonClass = TRUE;
-                    $skeletonTest  = FALSE;
-                }
-                break;
-
-                case '--tap': {
-                    $this->arguments['printer'] = new PHPUnit_Util_Log_TAP;
-                }
-                break;
-
-                case '--story': {
-                    $this->showMessage(
-                      'The --story functionality is deprecated and ' .
-                      'will be removed in the future.',
-                      FALSE
-                    );
-
-                    $this->arguments['printer'] = new PHPUnit_Extensions_Story_ResultPrinter_Text;
-                }
-                break;
-
-                case '--story-html': {
-                    $this->showMessage(
-                      'The --story-html functionality is deprecated and ' .
-                      'will be removed in the future.',
-                      FALSE
-                    );
-
-                    $this->arguments['storyHTMLFile'] = $option[1];
-                }
-                break;
-
-                case '--story-text': {
-                    $this->showMessage(
-                      'The --story-text functionality is deprecated and ' .
-                      'will be removed in the future.',
-                      FALSE
-                    );
-
-                    $this->arguments['storyTextFile'] = $option[1];
-                }
-                break;
-
-                case '--syntax-check': {
-                    $this->arguments['syntaxCheck'] = TRUE;
-                }
-                break;
-
-                case '--testdox': {
-                    $this->arguments['printer'] = new PHPUnit_Util_TestDox_ResultPrinter_Text;
-                }
-                break;
-
-                case '--testdox-html': {
-                    $this->arguments['testdoxHTMLFile'] = $option[1];
-                }
-                break;
-
-                case '--testdox-text': {
-                    $this->arguments['testdoxTextFile'] = $option[1];
-                }
-                break;
-
-                case '--no-configuration': {
-                    $this->arguments['useDefaultConfiguration'] = FALSE;
-                }
-                break;
-
-                case '--no-globals-backup': {
-                    $this->arguments['backupGlobals'] = FALSE;
-                }
-                break;
-
-                case '--static-backup': {
-                    $this->arguments['backupStaticAttributes'] = TRUE;
-                }
-                break;
-
-                case '--verbose': {
-                    $this->arguments['verbose'] = TRUE;
-                }
-                break;
-
-                case '--version': {
-                    PHPUnit_TextUI_TestRunner::printVersionString();
-                    exit(PHPUnit_TextUI_TestRunner::SUCCESS_EXIT);
-                }
-                break;
-
-                case '--wait': {
-                    $this->arguments['wait'] = TRUE;
-                }
-                break;
-
-                case '--strict': {
-                    $this->arguments['strict'] = TRUE;
-                }
-                break;
-
-                default: {
-                    $optionName = str_replace('--', '', $option[0]);
-
-                    if (isset($this->longOptions[$optionName])) {
-                        $handler = $this->longOptions[$optionName];
-                    }
-
-                    else if (isset($this->longOptions[$optionName . '='])) {
-                        $handler = $this->longOptions[$optionName . '='];
-                    }
-
-                    if (isset($handler) && is_callable(array($this, $handler))) {
-                        $this->$handler($option[1]);
-                    }
-                }
-            }
-        }
-
-        if (isset($this->arguments['printer']) &&
-            $this->arguments['printer'] instanceof PHPUnit_Extensions_Story_ResultPrinter_Text &&
-            isset($this->arguments['processIsolation']) &&
-            $this->arguments['processIsolation']) {
-            $this->showMessage(
-              'The story result printer cannot be used in process isolation.'
-            );
-        }
-
-        $this->handleCustomTestSuite();
-
-        if (!isset($this->arguments['test'])) {
-            if (isset($this->options[1][0])) {
-                $this->arguments['test'] = $this->options[1][0];
-            }
-
-            if (isset($this->options[1][1])) {
-                $this->arguments['testFile'] = $this->options[1][1];
-            } else {
-                $this->arguments['testFile'] = '';
-            }
-
-            if (isset($this->arguments['test']) && is_file($this->arguments['test'])) {
-                $this->arguments['testFile'] = realpath($this->arguments['test']);
-                $this->arguments['test']     = substr($this->arguments['test'], 0, strrpos($this->arguments['test'], '.'));
-            }
-        }
-
-        if (isset($includePath)) {
-            ini_set(
-              'include_path',
-              $includePath . PATH_SEPARATOR . ini_get('include_path')
-            );
-        }
-
-        if (isset($this->arguments['bootstrap'])) {
-            PHPUnit_Util_Fileloader::load($this->arguments['bootstrap']);
-        }
-
-        if ($this->arguments['loader'] !== NULL) {
-            $this->arguments['loader'] = $this->handleLoader($this->arguments['loader']);
-        }
-
-        if (isset($this->arguments['configuration']) &&
-            is_dir($this->arguments['configuration'])) {
-            $configurationFile = $this->arguments['configuration'] .
-                                 '/phpunit.xml';
-
-            if (file_exists($configurationFile)) {
-                $this->arguments['configuration'] = realpath(
-                  $configurationFile
-                );
-            }
-
-            else if (file_exists($configurationFile . '.dist')) {
-                $this->arguments['configuration'] = realpath(
-                  $configurationFile . '.dist'
-                );
-            }
-        }
-
-        else if (!isset($this->arguments['configuration']) &&
-                 $this->arguments['useDefaultConfiguration']) {
-            if (file_exists('phpunit.xml')) {
-                $this->arguments['configuration'] = realpath('phpunit.xml');
-            } else if (file_exists('phpunit.xml.dist')) {
-                $this->arguments['configuration'] = realpath(
-                  'phpunit.xml.dist'
-                );
-            }
-        }
-
-        if (isset($this->arguments['configuration'])) {
-            $configuration = PHPUnit_Util_Configuration::getInstance(
-              $this->arguments['configuration']
-            );
-
-            $phpunit = $configuration->getPHPUnitConfiguration();
-
-            if (isset($phpunit['syntaxCheck'])) {
-                $this->arguments['syntaxCheck'] = $phpunit['syntaxCheck'];
-            }
-
-            if (isset($phpunit['testSuiteLoaderClass'])) {
-                if (isset($phpunit['testSuiteLoaderFile'])) {
-                    $file = $phpunit['testSuiteLoaderFile'];
-                } else {
-                    $file = '';
-                }
-
-                $this->arguments['loader'] = $this->handleLoader(
-                  $phpunit['testSuiteLoaderClass'], $file
-                );
-            }
-
-            $configuration->handlePHPConfiguration();
-
-            if (!isset($this->arguments['bootstrap'])) {
-                $phpunitConfiguration = $configuration->getPHPUnitConfiguration();
-
-                if (isset($phpunitConfiguration['bootstrap'])) {
-                    PHPUnit_Util_Fileloader::load($phpunitConfiguration['bootstrap']);
-                }
-            }
-
-            $browsers = $configuration->getSeleniumBrowserConfiguration();
-
-            if (!empty($browsers)) {
-                PHPUnit_Extensions_SeleniumTestCase::$browsers = $browsers;
-            }
-
-            if (!isset($this->arguments['test'])) {
-                $testSuite = $configuration->getTestSuiteConfiguration(
-                  $this->arguments['syntaxCheck']
-                );
-
-                if ($testSuite !== NULL) {
-                    $this->arguments['test'] = $testSuite;
-                }
-            }
-        }
-
-        if (isset($this->arguments['test']) && is_string($this->arguments['test']) && substr($this->arguments['test'], -5, 5) == '.phpt') {
-            $test = new PHPUnit_Extensions_PhptTestCase($this->arguments['test']);
-
-            $this->arguments['test'] = new PHPUnit_Framework_TestSuite;
-            $this->arguments['test']->addTest($test);
-        }
-
-        if (!isset($this->arguments['test']) ||
-            (isset($this->arguments['testDatabaseLogRevision']) && !isset($this->arguments['testDatabaseDSN']))) {
-            $this->showHelp();
-            exit(PHPUnit_TextUI_TestRunner::EXCEPTION_EXIT);
-        }
-
-        if (!isset($this->arguments['syntaxCheck'])) {
-            $this->arguments['syntaxCheck'] = FALSE;
-        }
-
-        if ($skeletonClass || $skeletonTest) {
-            if (isset($this->arguments['test']) && $this->arguments['test'] !== FALSE) {
-                PHPUnit_TextUI_TestRunner::printVersionString();
-
-                if ($skeletonClass) {
-                    $class = 'PHPUnit_Util_Skeleton_Class';
-                } else {
-                    $class = 'PHPUnit_Util_Skeleton_Test';
-                }
-
-                try {
-                    $args      = array();
-                    $reflector = new ReflectionClass($class);
-
-                    for ($i = 0; $i <= 3; $i++) {
-                        if (isset($this->options[1][$i])) {
-                            $args[] = $this->options[1][$i];
-                        }
-                    }
-
-                    $skeleton = $reflector->newInstanceArgs($args);
-                    $skeleton->write();
-                }
-
-                catch (Exception $e) {
-                    print $e->getMessage() . "\n";
-                    exit(PHPUnit_TextUI_TestRunner::FAILURE_EXIT);
-                }
-
-                printf(
-                  'Wrote skeleton for "%s" to "%s".' . "\n",
-                  $skeleton->getOutClassName(),
-                  $skeleton->getOutSourceFile()
-                );
-
-                exit(PHPUnit_TextUI_TestRunner::SUCCESS_EXIT);
-            } else {
-                $this->showHelp();
-                exit(PHPUnit_TextUI_TestRunner::EXCEPTION_EXIT);
-            }
-        }
-    }
-
-    /**
-     * Handles the loading of the PHPUnit_Runner_TestSuiteLoader implementation.
-     *
-     * @param  string  $loaderClass
-     * @param  string  $loaderFile
-     */
-    protected function handleLoader($loaderClass, $loaderFile = '')
-    {
-        if (!class_exists($loaderClass, FALSE)) {
-            if ($loaderFile == '') {
-                $loaderFile = PHPUnit_Util_Filesystem::classNameToFilename(
-                  $loaderClass
-                );
-            }
-
-            $loaderFile = PHPUnit_Util_Filesystem::fileExistsInIncludePath(
-              $loaderFile
-            );
-
-            if ($loaderFile !== FALSE) {
-                require $loaderFile;
-            }
-        }
-
-        if (class_exists($loaderClass, FALSE)) {
-            $class = new ReflectionClass($loaderClass);
-
-            if ($class->implementsInterface('PHPUnit_Runner_TestSuiteLoader') &&
-                $class->isInstantiable()) {
-                $loader = $class->newInstance();
-            }
-        }
-
-        if (!isset($loader)) {
-            PHPUnit_TextUI_TestRunner::showError(
-              sprintf(
-                'Could not use "%s" as loader.',
-
-                $loaderClass
-              )
-            );
-        }
-
-        return $loader;
-    }
-
-    /**
-     * Shows a message.
-     *
-     * @param string  $message
-     * @param boolean $exit
-     */
-    protected function showMessage($message, $exit = TRUE)
-    {
-        PHPUnit_TextUI_TestRunner::printVersionString();
-        print $message . "\n";
-
-        if ($exit) {
-            exit(PHPUnit_TextUI_TestRunner::EXCEPTION_EXIT);
-        } else {
-            print "\n";
-        }
-    }
-
-    /**
-     * Show the help message.
-     */
-    protected function showHelp()
-    {
-        PHPUnit_TextUI_TestRunner::printVersionString();
-
-        print <<<EOT
-Usage: phpunit [switches] UnitTest [UnitTest.php]
-       phpunit [switches] <directory>
-
-  --log-junit <file>       Log test execution in JUnit XML format to file.
-  --log-tap <file>         Log test execution in TAP format to file.
-  --log-dbus               Log test execution to DBUS.
-  --log-json <file>        Log test execution in JSON format.
-
-  --coverage-html <dir>    Generate code coverage report in HTML format.
-  --coverage-clover <file> Write code coverage data in Clover XML format.
-
-  --testdox-html <file>    Write agile documentation in HTML format to file.
-  --testdox-text <file>    Write agile documentation in Text format to file.
-
-  --filter <pattern>       Filter which tests to run.
-  --group ...              Only runs tests from the specified group(s).
-  --exclude-group ...      Exclude tests from the specified group(s).
-  --list-groups            List available test groups.
-
-  --loader <loader>        TestSuiteLoader implementation to use.
-  --repeat <times>         Runs the test(s) repeatedly.
-
-  --tap                    Report test execution progress in TAP format.
-  --testdox                Report test execution progress in TestDox format.
-
-  --colors                 Use colors in output.
-  --stderr                 Write to STDERR instead of STDOUT.
-  --stop-on-error          Stop execution upon first error.
-  --stop-on-failure        Stop execution upon first error or failure.
-  --stop-on-skipped        Stop execution upon first skipped test.
-  --stop-on-incomplete     Stop execution upon first incomplete test.
-  --strict                 Mark a test as incomplete if no assertions are made.
-  --verbose                Output more verbose information.
-  --wait                   Waits for a keystroke after each test.
-
-  --skeleton-class         Generate Unit class for UnitTest in UnitTest.php.
-  --skeleton-test          Generate UnitTest class for Unit in Unit.php.
-
-  --process-isolation      Run each test in a separate PHP process.
-  --no-globals-backup      Do not backup and restore \$GLOBALS for each test.
-  --static-backup          Backup and restore static attributes for each test.
-  --syntax-check           Try to check source files for syntax errors.
-
-  --bootstrap <file>       A "bootstrap" PHP file that is run before the tests.
-  --configuration <file>   Read configuration from XML file.
-  --no-configuration       Ignore default configuration file (phpunit.xml).
-  --include-path <path(s)> Prepend PHP's include_path with given path(s).
-  -d key[=value]           Sets a php.ini value.
-
-  --help                   Prints this usage information.
-  --version                Prints the version and exits.
-
-EOT;
-    }
-
-    /**
-     * Custom callback for test suite discovery.
-     */
-    protected function handleCustomTestSuite()
-    {
-    }
-}
diff --git a/tests/PHPUnit/TextUI/ResultPrinter.php b/tests/PHPUnit/TextUI/ResultPrinter.php
deleted file mode 100644
index 2469ea1..0000000
--- a/tests/PHPUnit/TextUI/ResultPrinter.php
+++ /dev/null
@@ -1,639 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage TextUI
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-require_once 'PHP/Timer.php';
-
-/**
- * Prints the result of a TextUI TestRunner run.
- *
- * @package    PHPUnit
- * @subpackage TextUI
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_TextUI_ResultPrinter extends PHPUnit_Util_Printer implements PHPUnit_Framework_TestListener
-{
-    const EVENT_TEST_START      = 0;
-    const EVENT_TEST_END        = 1;
-    const EVENT_TESTSUITE_START = 2;
-    const EVENT_TESTSUITE_END   = 3;
-
-    /**
-     * @var integer
-     */
-    protected $column = 0;
-
-    /**
-     * @var integer
-     */
-    protected $indent = 0;
-
-    /**
-     * @var integer
-     */
-    protected $lastEvent = -1;
-
-    /**
-     * @var boolean
-     */
-    protected $lastTestFailed = FALSE;
-
-    /**
-     * @var integer
-     */
-    protected $numAssertions = 0;
-
-    /**
-     * @var integer
-     */
-    protected $numTests = -1;
-
-    /**
-     * @var integer
-     */
-    protected $numTestsRun = 0;
-
-    /**
-     * @var integer
-     */
-    protected $numTestsWidth;
-
-    /**
-     * @var boolean
-     */
-    protected $colors = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $debug = FALSE;
-
-    /**
-     * @var boolean
-     */
-    protected $verbose = FALSE;
-
-    /**
-     * Constructor.
-     *
-     * @param  mixed   $out
-     * @param  boolean $verbose
-     * @param  boolean $colors
-     * @param  boolean $debug
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.0.0
-     */
-    public function __construct($out = NULL, $verbose = FALSE, $colors = FALSE, $debug = FALSE)
-    {
-        parent::__construct($out);
-
-        if (is_bool($verbose)) {
-            $this->verbose = $verbose;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'boolean');
-        }
-
-        if (is_bool($colors)) {
-            $this->colors = $colors;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(3, 'boolean');
-        }
-
-        if (is_bool($debug)) {
-            $this->debug = $debug;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(4, 'boolean');
-        }
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestResult $result
-     */
-    public function printResult(PHPUnit_Framework_TestResult $result)
-    {
-        $this->printHeader();
-
-        if ($result->errorCount() > 0) {
-            $this->printErrors($result);
-        }
-
-        if ($result->failureCount() > 0) {
-            if ($result->errorCount() > 0) {
-                print "\n--\n\n";
-            }
-
-            $this->printFailures($result);
-        }
-
-        if ($this->verbose) {
-            if ($result->notImplementedCount() > 0) {
-                if ($result->failureCount() > 0) {
-                    print "\n--\n\n";
-                }
-
-                $this->printIncompletes($result);
-            }
-
-            if ($result->skippedCount() > 0) {
-                if ($result->notImplementedCount() > 0) {
-                    print "\n--\n\n";
-                }
-
-                $this->printSkipped($result);
-            }
-        }
-
-        $this->printFooter($result);
-    }
-
-    /**
-     * @param  array   $defects
-     * @param  integer $count
-     * @param  string  $type
-     */
-    protected function printDefects(array $defects, $count, $type)
-    {
-        static $called = FALSE;
-
-        if ($count == 0) {
-            return;
-        }
-
-        $this->write(
-          sprintf(
-            "%sThere %s %d %s%s:\n",
-
-            $called ? "\n" : '',
-            ($count == 1) ? 'was' : 'were',
-            $count,
-            $type,
-            ($count == 1) ? '' : 's'
-          )
-        );
-
-        $i = 1;
-
-        foreach ($defects as $defect) {
-            $this->printDefect($defect, $i++);
-        }
-
-        $called = TRUE;
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestFailure $defect
-     * @param  integer                       $count
-     */
-    protected function printDefect(PHPUnit_Framework_TestFailure $defect, $count)
-    {
-        $this->printDefectHeader($defect, $count);
-        $this->printDefectTrace($defect);
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestFailure $defect
-     * @param  integer                       $count
-     */
-    protected function printDefectHeader(PHPUnit_Framework_TestFailure $defect, $count)
-    {
-        $failedTest = $defect->failedTest();
-
-        if ($failedTest instanceof PHPUnit_Framework_SelfDescribing) {
-            $testName = $failedTest->toString();
-        } else {
-            $testName = get_class($failedTest);
-        }
-
-        $this->write(
-          sprintf(
-            "\n%d) %s\n",
-
-            $count,
-            $testName
-          )
-        );
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestFailure $defect
-     */
-    protected function printDefectTrace(PHPUnit_Framework_TestFailure $defect)
-    {
-        $this->write(
-          $defect->getExceptionAsString() . "\n" .
-          PHPUnit_Util_Filter::getFilteredStacktrace(
-            $defect->thrownException(),
-            FALSE
-          )
-        );
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestResult  $result
-     */
-    protected function printErrors(PHPUnit_Framework_TestResult $result)
-    {
-        $this->printDefects($result->errors(), $result->errorCount(), 'error');
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestResult  $result
-     */
-    protected function printFailures(PHPUnit_Framework_TestResult $result)
-    {
-        $this->printDefects(
-          $result->failures(),
-          $result->failureCount(),
-          'failure'
-        );
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestResult  $result
-     */
-    protected function printIncompletes(PHPUnit_Framework_TestResult $result)
-    {
-        $this->printDefects(
-          $result->notImplemented(),
-          $result->notImplementedCount(),
-          'incomplete test'
-        );
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestResult  $result
-     * @since  Method available since Release 3.0.0
-     */
-    protected function printSkipped(PHPUnit_Framework_TestResult $result)
-    {
-        $this->printDefects(
-          $result->skipped(),
-          $result->skippedCount(),
-          'skipped test'
-        );
-    }
-
-    protected function printHeader()
-    {
-        $this->write($this->verbose ? "\n" : "\n\n");
-        $this->write(PHP_Timer::resourceUsage() . "\n\n");
-    }
-
-    /**
-     * @param  PHPUnit_Framework_TestResult  $result
-     */
-    protected function printFooter(PHPUnit_Framework_TestResult $result)
-    {
-        if ($result->wasSuccessful() &&
-            $result->allCompletlyImplemented() &&
-            $result->noneSkipped()) {
-            if ($this->colors) {
-                $this->write("\x1b[30;42m\x1b[2K");
-            }
-
-            $this->write(
-              sprintf(
-                "OK (%d test%s, %d assertion%s)\n",
-
-                count($result),
-                (count($result) == 1) ? '' : 's',
-                $this->numAssertions,
-                ($this->numAssertions == 1) ? '' : 's'
-              )
-            );
-
-            if ($this->colors) {
-                $this->write("\x1b[0m\x1b[2K");
-            }
-        }
-
-        else if ((!$result->allCompletlyImplemented() ||
-                  !$result->noneSkipped())&&
-                 $result->wasSuccessful()) {
-            if ($this->colors) {
-                $this->write(
-                  "\x1b[30;43m\x1b[2KOK, but incomplete or skipped tests!\n" .
-                  "\x1b[0m\x1b[30;43m\x1b[2K"
-                );
-            } else {
-                $this->write("OK, but incomplete or skipped tests!\n");
-            }
-
-            $this->write(
-              sprintf(
-                "Tests: %d, Assertions: %d%s%s.\n",
-
-                count($result),
-                $this->numAssertions,
-                $this->getCountString(
-                  $result->notImplementedCount(), 'Incomplete'
-                ),
-                $this->getCountString(
-                  $result->skippedCount(), 'Skipped'
-                )
-              )
-            );
-
-            if ($this->colors) {
-                $this->write("\x1b[0m\x1b[2K");
-            }
-        }
-
-        else {
-            $this->write("\n");
-
-            if ($this->colors) {
-                $this->write(
-                  "\x1b[37;41m\x1b[2KFAILURES!\n\x1b[0m\x1b[37;41m\x1b[2K"
-                );
-            } else {
-                $this->write("FAILURES!\n");
-            }
-
-            $this->write(
-              sprintf(
-                "Tests: %d, Assertions: %s%s%s%s%s.\n",
-
-                count($result),
-                $this->numAssertions,
-                $this->getCountString($result->failureCount(), 'Failures'),
-                $this->getCountString($result->errorCount(), 'Errors'),
-                $this->getCountString(
-                  $result->notImplementedCount(), 'Incomplete'
-                ),
-                $this->getCountString($result->skippedCount(), 'Skipped')
-              )
-            );
-
-            if ($this->colors) {
-                $this->write("\x1b[0m\x1b[2K");
-            }
-        }
-    }
-
-    /**
-     * @param  integer $count
-     * @param  string  $name
-     * @return string
-     * @since  Method available since Release 3.0.0
-     */
-    protected function getCountString($count, $name)
-    {
-        $string = '';
-
-        if ($count > 0) {
-            $string = sprintf(
-              ', %s: %d',
-
-              $name,
-              $count
-            );
-        }
-
-        return $string;
-    }
-
-    /**
-     */
-    public function printWaitPrompt()
-    {
-        $this->write("\n<RETURN> to continue\n");
-    }
-
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeProgress('E');
-        $this->lastTestFailed = TRUE;
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-        $this->writeProgress('F');
-        $this->lastTestFailed = TRUE;
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeProgress('I');
-        $this->lastTestFailed = TRUE;
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     * @since  Method available since Release 3.0.0
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeProgress('S');
-        $this->lastTestFailed = TRUE;
-    }
-
-    /**
-     * A testsuite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        if ($this->numTests == -1) {
-            $this->numTests      = count($suite);
-            $this->numTestsWidth = strlen((string)$this->numTests);
-        } else {
-            $this->indent++;
-        }
-
-        if ($this->verbose) {
-            $name = $suite->getName();
-
-            if (empty($name)) {
-                $name = 'Test Suite';
-            } else {
-                $name = preg_replace( '(^.*::(.*?)$)', '\\1', $name );
-            }
-
-            $this->write(
-              sprintf(
-                "%s%s%s",
-
-                $this->lastEvent == self::EVENT_TESTSUITE_END ||
-                $suite instanceof PHPUnit_Framework_TestSuite_DataProvider ?
-                "\n" :
-                '',
-                str_repeat(' ', $this->indent),
-                $name
-              )
-            );
-
-            $this->writeNewLine();
-        }
-
-        $this->lastEvent = self::EVENT_TESTSUITE_START;
-    }
-
-    /**
-     * A testsuite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->indent--;
-
-        if ($this->verbose) {
-            if ($this->lastEvent != self::EVENT_TESTSUITE_END) {
-                $this->writeNewLine();
-            }
-        }
-
-        $this->lastEvent = self::EVENT_TESTSUITE_END;
-    }
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        $this->lastEvent = self::EVENT_TEST_START;
-
-        if ($this->debug) {
-            $this->write(
-              sprintf(
-                "\nStarting test '%s'.\n", PHPUnit_Util_Test::describe($test)
-              )
-            );
-        }
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        if (!$this->lastTestFailed) {
-            $this->writeProgress('.');
-        }
-
-        if ($test instanceof PHPUnit_Framework_TestCase) {
-            $this->numAssertions += $test->getNumAssertions();
-        }
-
-        $this->lastEvent      = self::EVENT_TEST_END;
-        $this->lastTestFailed = FALSE;
-    }
-
-    /**
-     * @param  string $progress
-     */
-    protected function writeProgress($progress)
-    {
-        $this->write($progress);
-        $this->column++;
-        $this->numTestsRun++;
-
-        if ($this->column == 60) {
-            if (!$this->verbose) {
-                $this->write(
-                  sprintf(
-                    ' %' . $this->numTestsWidth . 'd / %' .
-                           $this->numTestsWidth . "d",
-
-                    $this->numTestsRun,
-                    $this->numTests
-                  )
-                );
-            }
-
-            $this->writeNewLine();
-        }
-    }
-
-    protected function writeNewLine()
-    {
-        $this->write("\n");
-
-        if ($this->verbose) {
-            $this->column = $this->indent;
-            $this->write(str_repeat(' ', max(0, $this->indent)));
-        } else {
-            $this->column = 0;
-        }
-    }
-}
diff --git a/tests/PHPUnit/TextUI/TestRunner.php b/tests/PHPUnit/TextUI/TestRunner.php
deleted file mode 100644
index 9829ecb..0000000
--- a/tests/PHPUnit/TextUI/TestRunner.php
+++ /dev/null
@@ -1,774 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage TextUI
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * A TestRunner for the Command Line Interface (CLI)
- * PHP SAPI Module.
- *
- * @package    PHPUnit
- * @subpackage TextUI
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_TextUI_TestRunner extends PHPUnit_Runner_BaseTestRunner
-{
-    const SUCCESS_EXIT   = 0;
-    const FAILURE_EXIT   = 1;
-    const EXCEPTION_EXIT = 2;
-
-    /**
-     * @var    PHPUnit_Runner_TestSuiteLoader
-     */
-    protected $loader = NULL;
-
-    /**
-     * @var    PHPUnit_TextUI_ResultPrinter
-     */
-    protected $printer = NULL;
-
-    /**
-     * @var    boolean
-     */
-    protected static $versionStringPrinted = FALSE;
-
-    /**
-     * @param  PHPUnit_Runner_TestSuiteLoader $loader
-     * @since  Method available since Release 3.4.0
-     */
-    public function __construct(PHPUnit_Runner_TestSuiteLoader $loader = NULL)
-    {
-        $this->loader = $loader;
-    }
-
-    /**
-     * @param  mixed $test
-     * @param  array $arguments
-     * @throws InvalidArgumentException
-     */
-    public static function run($test, array $arguments = array())
-    {
-        if ($test instanceof ReflectionClass) {
-            $test = new PHPUnit_Framework_TestSuite($test);
-        }
-
-        if ($test instanceof PHPUnit_Framework_Test) {
-            $aTestRunner = new PHPUnit_TextUI_TestRunner;
-
-            return $aTestRunner->doRun(
-              $test,
-              $arguments
-            );
-        } else {
-            throw new InvalidArgumentException(
-              'No test case or test suite found.'
-            );
-        }
-    }
-
-    /**
-     * Runs a single test and waits until the user types RETURN.
-     *
-     * @param  PHPUnit_Framework_Test $suite
-     */
-    public static function runAndWait(PHPUnit_Framework_Test $suite)
-    {
-        $aTestRunner = new PHPUnit_TextUI_TestRunner;
-
-        $aTestRunner->doRun(
-          $suite,
-          array(
-            'wait' => TRUE
-          )
-        );
-
-    }
-
-    /**
-     * @return PHPUnit_Framework_TestResult
-     */
-    protected function createTestResult()
-    {
-        return new PHPUnit_Framework_TestResult;
-    }
-
-    /**
-     * @param  PHPUnit_Framework_Test $suite
-     * @param  array                  $arguments
-     * @return PHPUnit_Framework_TestResult
-     */
-    public function doRun(PHPUnit_Framework_Test $suite, array $arguments = array())
-    {
-        $this->handleConfiguration($arguments);
-
-        if (isset($arguments['bootstrap'])) {
-            $bootstrap = PHPUnit_Util_Fileloader::load($arguments['bootstrap']);
-
-            if ($bootstrap) {
-                $GLOBALS['__PHPUNIT_BOOTSTRAP'] = $bootstrap;
-            }
-        }
-
-        if ($arguments['backupGlobals'] === FALSE) {
-            $suite->setBackupGlobals(FALSE);
-        }
-
-        if ($arguments['backupStaticAttributes'] === TRUE) {
-            $suite->setBackupStaticAttributes(TRUE);
-        }
-
-        if (is_integer($arguments['repeat'])) {
-            $suite = new PHPUnit_Extensions_RepeatedTest(
-              $suite,
-              $arguments['repeat'],
-              $arguments['filter'],
-              $arguments['groups'],
-              $arguments['excludeGroups'],
-              $arguments['processIsolation']
-            );
-        }
-
-        $result = $this->createTestResult();
-
-        if (!$arguments['convertErrorsToExceptions']) {
-            $result->convertErrorsToExceptions(FALSE);
-        }
-
-        if (!$arguments['convertNoticesToExceptions']) {
-            PHPUnit_Framework_Error_Notice::$enabled = FALSE;
-        }
-
-        if (!$arguments['convertWarningsToExceptions']) {
-            PHPUnit_Framework_Error_Warning::$enabled = FALSE;
-        }
-
-        if ($arguments['stopOnError']) {
-            $result->stopOnError(TRUE);
-        }
-
-        if ($arguments['stopOnFailure']) {
-            $result->stopOnFailure(TRUE);
-        }
-
-        if ($arguments['stopOnIncomplete']) {
-            $result->stopOnIncomplete(TRUE);
-        }
-
-        if ($arguments['stopOnSkipped']) {
-            $result->stopOnSkipped(TRUE);
-        }
-
-        if ($this->printer === NULL) {
-            if (isset($arguments['printer']) &&
-                $arguments['printer'] instanceof PHPUnit_Util_Printer) {
-                $this->printer = $arguments['printer'];
-            } else {
-                $this->printer = new PHPUnit_TextUI_ResultPrinter(
-                  NULL,
-                  $arguments['verbose'],
-                  $arguments['colors'],
-                  $arguments['debug']
-                );
-            }
-        }
-
-        if (!$this->printer instanceof PHPUnit_Util_Log_TAP &&
-            !self::$versionStringPrinted) {
-            $this->printer->write(
-              PHPUnit_Runner_Version::getVersionString() . "\n\n"
-            );
-        }
-
-        foreach ($arguments['listeners'] as $listener) {
-            $result->addListener($listener);
-        }
-
-        $result->addListener($this->printer);
-
-        if (isset($arguments['storyHTMLFile'])) {
-            $result->addListener(
-              new PHPUnit_Extensions_Story_ResultPrinter_HTML(
-                $arguments['storyHTMLFile']
-              )
-            );
-        }
-
-        if (isset($arguments['storyTextFile'])) {
-            $result->addListener(
-              new PHPUnit_Extensions_Story_ResultPrinter_Text(
-                $arguments['storyTextFile']
-              )
-            );
-        }
-
-        if (isset($arguments['testdoxHTMLFile'])) {
-            $result->addListener(
-              new PHPUnit_Util_TestDox_ResultPrinter_HTML(
-                $arguments['testdoxHTMLFile']
-              )
-            );
-        }
-
-        if (isset($arguments['testdoxTextFile'])) {
-            $result->addListener(
-              new PHPUnit_Util_TestDox_ResultPrinter_Text(
-                $arguments['testdoxTextFile']
-              )
-            );
-        }
-
-        if ((isset($arguments['coverageClover']) ||
-             isset($arguments['reportDirectory'])) &&
-             extension_loaded('xdebug')) {
-            $result->collectCodeCoverageInformation(TRUE);
-        }
-
-        if (isset($arguments['logDbus'])) {
-            $result->addListener(new PHPUnit_Util_Log_DBUS);
-        }
-
-        if (isset($arguments['jsonLogfile'])) {
-            $result->addListener(
-              new PHPUnit_Util_Log_JSON($arguments['jsonLogfile'])
-            );
-        }
-
-        if (isset($arguments['tapLogfile'])) {
-            $result->addListener(
-              new PHPUnit_Util_Log_TAP($arguments['tapLogfile'])
-            );
-        }
-
-        if (isset($arguments['junitLogfile'])) {
-            $result->addListener(
-              new PHPUnit_Util_Log_JUnit(
-                $arguments['junitLogfile'], $arguments['logIncompleteSkipped']
-              )
-            );
-        }
-
-        if ($arguments['strict']) {
-            $result->strictAssertions(TRUE);
-        }
-
-        $suite->run(
-          $result,
-          $arguments['filter'],
-          $arguments['groups'],
-          $arguments['excludeGroups'],
-          $arguments['processIsolation']
-        );
-
-        unset($suite);
-        $result->flushListeners();
-
-        if ($this->printer instanceof PHPUnit_TextUI_ResultPrinter) {
-            $this->printer->printResult($result);
-        }
-
-        if (extension_loaded('tokenizer') && extension_loaded('xdebug')) {
-            if (isset($arguments['coverageClover'])) {
-                $this->printer->write(
-                  "\nWriting code coverage data to XML file, this may take " .
-                  'a moment.'
-                );
-
-                require_once 'PHP/CodeCoverage/Report/Clover.php';
-
-                $writer = new PHP_CodeCoverage_Report_Clover;
-                $writer->process(
-                  $result->getCodeCoverage(), $arguments['coverageClover']
-                );
-
-                $this->printer->write("\n");
-                unset($writer);
-            }
-
-            if (isset($arguments['reportDirectory'])) {
-                $this->printer->write(
-                  "\nGenerating code coverage report, this may take a moment."
-                );
-
-                $title = '';
-
-                if (isset($arguments['configuration'])) {
-                    $loggingConfiguration = $arguments['configuration']->getLoggingConfiguration();
-
-                    if (isset($loggingConfiguration['title'])) {
-                        $title = $loggingConfiguration['title'];
-                    }
-                }
-
-                require_once 'PHP/CodeCoverage/Report/HTML.php';
-
-                $writer = new PHP_CodeCoverage_Report_HTML(
-                  array(
-                    'title'          => $title,
-                    'charset'        => $arguments['reportCharset'],
-                    'yui'            => $arguments['reportYUI'],
-                    'highlight'      => $arguments['reportHighlight'],
-                    'lowUpperBound'  => $arguments['reportLowUpperBound'],
-                    'highLowerBound' => $arguments['reportHighLowerBound'],
-                    'generator'      => ' and PHPUnit ' . PHPUnit_Runner_Version::id()
-                  )
-                );
-
-                $writer->process(
-                  $result->getCodeCoverage(), $arguments['reportDirectory']
-                );
-
-                $this->printer->write("\n");
-                unset($writer);
-            }
-        }
-
-        $this->pause($arguments['wait']);
-
-        return $result;
-    }
-
-    /**
-     * @param  boolean $wait
-     */
-    protected function pause($wait)
-    {
-        if (!$wait) {
-            return;
-        }
-
-        if ($this->printer instanceof PHPUnit_TextUI_ResultPrinter) {
-            $this->printer->printWaitPrompt();
-        }
-
-        fgets(STDIN);
-    }
-
-    /**
-     * @param  PHPUnit_TextUI_ResultPrinter $resultPrinter
-     */
-    public function setPrinter(PHPUnit_TextUI_ResultPrinter $resultPrinter)
-    {
-        $this->printer = $resultPrinter;
-    }
-
-    /**
-     * Override to define how to handle a failed loading of
-     * a test suite.
-     *
-     * @param  string  $message
-     */
-    protected function runFailed($message)
-    {
-        self::printVersionString();
-        self::write($message);
-        exit(self::FAILURE_EXIT);
-    }
-
-    /**
-     * @param  string $buffer
-     * @since  Method available since Release 3.1.0
-     */
-    protected static function write($buffer)
-    {
-        if (PHP_SAPI != 'cli') {
-            $buffer = htmlspecialchars($buffer);
-        }
-
-        print $buffer;
-    }
-
-    /**
-     * Returns the loader to be used.
-     *
-     * @return PHPUnit_Runner_TestSuiteLoader
-     * @since  Method available since Release 2.2.0
-     */
-    public function getLoader()
-    {
-        if ($this->loader === NULL) {
-            $this->loader = new PHPUnit_Runner_StandardTestSuiteLoader;
-        }
-
-        return $this->loader;
-    }
-
-    /**
-     */
-    public static function showError($message)
-    {
-        self::printVersionString();
-        self::write($message . "\n");
-
-        exit(self::FAILURE_EXIT);
-    }
-
-    /**
-     */
-    public static function printVersionString()
-    {
-        if (!self::$versionStringPrinted) {
-            self::write(PHPUnit_Runner_Version::getVersionString() . "\n\n");
-            self::$versionStringPrinted = TRUE;
-        }
-    }
-
-    /**
-     * @param  array $arguments
-     * @since  Method available since Release 3.2.1
-     */
-    protected function handleConfiguration(array &$arguments)
-    {
-        if (isset($arguments['configuration']) &&
-            !$arguments['configuration'] instanceof PHPUnit_Util_Configuration) {
-            $arguments['configuration'] = PHPUnit_Util_Configuration::getInstance(
-              $arguments['configuration']
-            );
-        }
-
-        $arguments['debug']     = isset($arguments['debug'])     ? $arguments['debug']     : FALSE;
-        $arguments['filter']    = isset($arguments['filter'])    ? $arguments['filter']    : FALSE;
-        $arguments['listeners'] = isset($arguments['listeners']) ? $arguments['listeners'] : array();
-        $arguments['wait']      = isset($arguments['wait'])      ? $arguments['wait']      : FALSE;
-
-        if (isset($arguments['configuration'])) {
-            $arguments['configuration']->handlePHPConfiguration();
-
-            $phpunitConfiguration = $arguments['configuration']->getPHPUnitConfiguration();
-
-            if (isset($phpunitConfiguration['backupGlobals']) &&
-                !isset($arguments['backupGlobals'])) {
-                $arguments['backupGlobals'] = $phpunitConfiguration['backupGlobals'];
-            }
-
-            if (isset($phpunitConfiguration['backupStaticAttributes']) &&
-                !isset($arguments['backupStaticAttributes'])) {
-                $arguments['backupStaticAttributes'] = $phpunitConfiguration['backupStaticAttributes'];
-            }
-
-            if (isset($phpunitConfiguration['bootstrap']) &&
-                !isset($arguments['bootstrap'])) {
-                $arguments['bootstrap'] = $phpunitConfiguration['bootstrap'];
-            }
-
-            if (isset($phpunitConfiguration['colors']) &&
-                !isset($arguments['colors'])) {
-                $arguments['colors'] = $phpunitConfiguration['colors'];
-            }
-
-            if (isset($phpunitConfiguration['convertErrorsToExceptions']) &&
-                !isset($arguments['convertErrorsToExceptions'])) {
-                $arguments['convertErrorsToExceptions'] = $phpunitConfiguration['convertErrorsToExceptions'];
-            }
-
-            if (isset($phpunitConfiguration['convertNoticesToExceptions']) &&
-                !isset($arguments['convertNoticesToExceptions'])) {
-                $arguments['convertNoticesToExceptions'] = $phpunitConfiguration['convertNoticesToExceptions'];
-            }
-
-            if (isset($phpunitConfiguration['convertWarningsToExceptions']) &&
-                !isset($arguments['convertWarningsToExceptions'])) {
-                $arguments['convertWarningsToExceptions'] = $phpunitConfiguration['convertWarningsToExceptions'];
-            }
-
-            if (isset($phpunitConfiguration['processIsolation']) &&
-                !isset($arguments['processIsolation'])) {
-                $arguments['processIsolation'] = $phpunitConfiguration['processIsolation'];
-            }
-
-            if (isset($phpunitConfiguration['stopOnFailure']) &&
-                !isset($arguments['stopOnFailure'])) {
-                $arguments['stopOnFailure'] = $phpunitConfiguration['stopOnFailure'];
-            }
-
-            if (isset($phpunitConfiguration['strict']) &&
-                !isset($arguments['strict'])) {
-                $arguments['strict'] = $phpunitConfiguration['strict'];
-            }
-
-            if (isset($phpunitConfiguration['verbose']) &&
-                !isset($arguments['verbose'])) {
-                $arguments['verbose'] = $phpunitConfiguration['verbose'];
-            }
-
-            if (isset($phpunitConfiguration['forceCoversAnnotation']) &&
-                !isset($arguments['forceCoversAnnotation'])) {
-                $arguments['forceCoversAnnotation'] = $phpunitConfiguration['forceCoversAnnotation'];
-            }
-
-            if (isset($phpunitConfiguration['mapTestClassNameToCoveredClassName']) &&
-                !isset($arguments['mapTestClassNameToCoveredClassName'])) {
-                $arguments['mapTestClassNameToCoveredClassName'] = $phpunitConfiguration['mapTestClassNameToCoveredClassName'];
-            }
-
-            $groupConfiguration = $arguments['configuration']->getGroupConfiguration();
-
-            if (!empty($groupConfiguration['include']) &&
-                !isset($arguments['groups'])) {
-                $arguments['groups'] = $groupConfiguration['include'];
-            }
-
-            if (!empty($groupConfiguration['exclude']) &&
-                !isset($arguments['excludeGroups'])) {
-                $arguments['excludeGroups'] = $groupConfiguration['exclude'];
-            }
-
-            foreach ($arguments['configuration']->getListenerConfiguration() as $listener) {
-                if (!class_exists($listener['class'], FALSE) &&
-                    $listener['file'] !== '') {
-                    $file = PHPUnit_Util_Filesystem::fileExistsInIncludePath(
-                      $listener['file']
-                    );
-
-                    if ($file !== FALSE) {
-                        require $file;
-                    }
-                }
-
-                if (class_exists($listener['class'], FALSE)) {
-                    if (count($listener['arguments']) == 0) {
-                        $listener = new $listener['class'];
-                    } else {
-                        $listenerClass = new ReflectionClass(
-                                           $listener['class']
-                                         );
-                        $listener      = $listenerClass->newInstanceArgs(
-                                           $listener['arguments']
-                                         );
-                    }
-
-                    if ($listener instanceof PHPUnit_Framework_TestListener) {
-                        $arguments['listeners'][] = $listener;
-                    }
-                }
-            }
-
-            $loggingConfiguration = $arguments['configuration']->getLoggingConfiguration();
-
-            if (isset($loggingConfiguration['coverage-html']) &&
-                !isset($arguments['reportDirectory'])) {
-                if (isset($loggingConfiguration['charset']) &&
-                    !isset($arguments['reportCharset'])) {
-                    $arguments['reportCharset'] = $loggingConfiguration['charset'];
-                }
-
-                if (isset($loggingConfiguration['yui']) &&
-                    !isset($arguments['reportYUI'])) {
-                    $arguments['reportYUI'] = $loggingConfiguration['yui'];
-                }
-
-                if (isset($loggingConfiguration['highlight']) &&
-                    !isset($arguments['reportHighlight'])) {
-                    $arguments['reportHighlight'] = $loggingConfiguration['highlight'];
-                }
-
-                if (isset($loggingConfiguration['lowUpperBound']) &&
-                    !isset($arguments['reportLowUpperBound'])) {
-                    $arguments['reportLowUpperBound'] = $loggingConfiguration['lowUpperBound'];
-                }
-
-                if (isset($loggingConfiguration['highLowerBound']) &&
-                    !isset($arguments['reportHighLowerBound'])) {
-                    $arguments['reportHighLowerBound'] = $loggingConfiguration['highLowerBound'];
-                }
-
-                $arguments['reportDirectory'] = $loggingConfiguration['coverage-html'];
-            }
-
-            if (isset($loggingConfiguration['coverage-clover']) &&
-                !isset($arguments['coverageClover'])) {
-                $arguments['coverageClover'] = $loggingConfiguration['coverage-clover'];
-            }
-
-            if (isset($loggingConfiguration['json']) &&
-                !isset($arguments['jsonLogfile'])) {
-                $arguments['jsonLogfile'] = $loggingConfiguration['json'];
-            }
-
-            if (isset($loggingConfiguration['plain'])) {
-                $arguments['listeners'][] = new PHPUnit_TextUI_ResultPrinter(
-                  $loggingConfiguration['plain'], TRUE
-                );
-            }
-
-            if (isset($loggingConfiguration['tap']) &&
-                !isset($arguments['tapLogfile'])) {
-                $arguments['tapLogfile'] = $loggingConfiguration['tap'];
-            }
-
-            if (isset($loggingConfiguration['junit']) &&
-                !isset($arguments['junitLogfile'])) {
-                $arguments['junitLogfile'] = $loggingConfiguration['junit'];
-
-                if (isset($loggingConfiguration['logIncompleteSkipped']) &&
-                    !isset($arguments['logIncompleteSkipped'])) {
-                    $arguments['logIncompleteSkipped'] = $loggingConfiguration['logIncompleteSkipped'];
-                }
-            }
-
-            if (isset($loggingConfiguration['story-html']) &&
-                !isset($arguments['storyHTMLFile'])) {
-                $arguments['storyHTMLFile'] = $loggingConfiguration['story-html'];
-            }
-
-            if (isset($loggingConfiguration['story-text']) &&
-                !isset($arguments['storyTextFile'])) {
-                $arguments['storsTextFile'] = $loggingConfiguration['story-text'];
-            }
-
-            if (isset($loggingConfiguration['testdox-html']) &&
-                !isset($arguments['testdoxHTMLFile'])) {
-                $arguments['testdoxHTMLFile'] = $loggingConfiguration['testdox-html'];
-            }
-
-            if (isset($loggingConfiguration['testdox-text']) &&
-                !isset($arguments['testdoxTextFile'])) {
-                $arguments['testdoxTextFile'] = $loggingConfiguration['testdox-text'];
-            }
-        }
-
-        if (isset($arguments['configuration'])) {
-            $filterConfiguration = $arguments['configuration']->getFilterConfiguration();
-
-            $filter = PHP_CodeCoverage_Filter::getInstance();
-
-            foreach ($filterConfiguration['blacklist']['include']['directory'] as $dir) {
-                $filter->addDirectoryToBlacklist(
-                  $dir['path'], $dir['suffix'], $dir['prefix'], $dir['group']
-                );
-            }
-
-            foreach ($filterConfiguration['blacklist']['include']['file'] as $file) {
-                $filter->addFileToBlacklist($file);
-            }
-
-            foreach ($filterConfiguration['blacklist']['exclude']['directory'] as $dir) {
-                $filter->removeDirectoryFromBlacklist(
-                  $dir['path'], $dir['suffix'], $dir['prefix'], $dir['group']
-                );
-            }
-
-            foreach ($filterConfiguration['blacklist']['exclude']['file'] as $file) {
-                $filter->removeFileFromBlacklist($file);
-            }
-
-            if ((isset($arguments['coverageClover']) ||
-                isset($arguments['reportDirectory'])) &&
-                extension_loaded('xdebug')) {
-                $coverage = PHP_CodeCoverage::getInstance();
-
-                $coverage->setProcessUncoveredFilesFromWhitelist(
-                  $filterConfiguration['whitelist']['addUncoveredFilesFromWhitelist']
-                );
-
-                if (isset($arguments['forceCoversAnnotation'])) {
-                    $coverage->setForceCoversAnnotation(
-                      $arguments['forceCoversAnnotation']
-                    );
-                }
-
-                if (isset($arguments['mapTestClassNameToCoveredClassName'])) {
-                    $coverage->setMapTestClassNameToCoveredClassName(
-                      $arguments['mapTestClassNameToCoveredClassName']
-                    );
-                }
-
-                foreach ($filterConfiguration['whitelist']['include']['directory'] as $dir) {
-                    $filter->addDirectoryToWhitelist(
-                      $dir['path'], $dir['suffix'], $dir['prefix']
-                    );
-                }
-
-                foreach ($filterConfiguration['whitelist']['include']['file'] as $file) {
-                    $filter->addFileToWhitelist($file);
-                }
-
-                foreach ($filterConfiguration['whitelist']['exclude']['directory'] as $dir) {
-                    $filter->removeDirectoryFromWhitelist(
-                      $dir['path'], $dir['suffix'], $dir['prefix']
-                    );
-                }
-
-                foreach ($filterConfiguration['whitelist']['exclude']['file'] as $file) {
-                    $filter->removeFileFromWhitelist($file);
-                }
-            }
-        }
-
-        $arguments['backupGlobals']               = isset($arguments['backupGlobals'])               ? $arguments['backupGlobals']               : NULL;
-        $arguments['backupStaticAttributes']      = isset($arguments['backupStaticAttributes'])      ? $arguments['backupStaticAttributes']      : NULL;
-        $arguments['colors']                      = isset($arguments['colors'])                      ? $arguments['colors']                      : FALSE;
-        $arguments['convertErrorsToExceptions']   = isset($arguments['convertErrorsToExceptions'])   ? $arguments['convertErrorsToExceptions']   : TRUE;
-        $arguments['convertNoticesToExceptions']  = isset($arguments['convertNoticesToExceptions'])  ? $arguments['convertNoticesToExceptions']  : TRUE;
-        $arguments['convertWarningsToExceptions'] = isset($arguments['convertWarningsToExceptions']) ? $arguments['convertWarningsToExceptions'] : TRUE;
-        $arguments['excludeGroups']               = isset($arguments['excludeGroups'])               ? $arguments['excludeGroups']               : array();
-        $arguments['groups']                      = isset($arguments['groups'])                      ? $arguments['groups']                      : array();
-        $arguments['logIncompleteSkipped']        = isset($arguments['logIncompleteSkipped'])        ? $arguments['logIncompleteSkipped']        : FALSE;
-        $arguments['processIsolation']            = isset($arguments['processIsolation'])            ? $arguments['processIsolation']            : FALSE;
-        $arguments['repeat']                      = isset($arguments['repeat'])                      ? $arguments['repeat']                      : FALSE;
-        $arguments['reportCharset']               = isset($arguments['reportCharset'])               ? $arguments['reportCharset']               : 'UTF-8';
-        $arguments['reportHighlight']             = isset($arguments['reportHighlight'])             ? $arguments['reportHighlight']             : FALSE;
-        $arguments['reportHighLowerBound']        = isset($arguments['reportHighLowerBound'])        ? $arguments['reportHighLowerBound']        : 70;
-        $arguments['reportLowUpperBound']         = isset($arguments['reportLowUpperBound'])         ? $arguments['reportLowUpperBound']         : 35;
-        $arguments['reportYUI']                   = isset($arguments['reportYUI'])                   ? $arguments['reportYUI']                   : TRUE;
-        $arguments['stopOnError']                 = isset($arguments['stopOnError'])                 ? $arguments['stopOnError']                 : FALSE;
-        $arguments['stopOnFailure']               = isset($arguments['stopOnFailure'])               ? $arguments['stopOnFailure']               : FALSE;
-        $arguments['stopOnIncomplete']            = isset($arguments['stopOnIncomplete'])            ? $arguments['stopOnIncomplete']            : FALSE;
-        $arguments['stopOnSkipped']               = isset($arguments['stopOnSkipped'])               ? $arguments['stopOnSkipped']               : FALSE;
-        $arguments['strict']                      = isset($arguments['strict'])                      ? $arguments['strict']                      : FALSE;
-        $arguments['verbose']                     = isset($arguments['verbose'])                     ? $arguments['verbose']                     : FALSE;
-
-        if ($arguments['filter'] !== FALSE &&
-            preg_match('/^[a-zA-Z0-9_]/', $arguments['filter'])) {
-            // Escape delimiters in regular expression. Do NOT use preg_quote,
-            // to keep magic characters.
-            $arguments['filter'] = '/' . str_replace(
-              '/', '\\/', $arguments['filter']
-            ) . '/';
-        }
-    }
-}
diff --git a/tests/PHPUnit/Util/Class.php b/tests/PHPUnit/Util/Class.php
deleted file mode 100644
index cef8302..0000000
--- a/tests/PHPUnit/Util/Class.php
+++ /dev/null
@@ -1,403 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.0
- */
-
-if (!defined('T_NAMESPACE')) {
-    define('T_NAMESPACE', 377);
-}
-
-/**
- * Class helpers.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.0
- */
-class PHPUnit_Util_Class
-{
-    protected static $buffer = array();
-
-    /**
-     * Starts the collection of loaded classes.
-     *
-     */
-    public static function collectStart()
-    {
-        self::$buffer = get_declared_classes();
-    }
-
-    /**
-     * Stops the collection of loaded classes and
-     * returns the names of the loaded classes.
-     *
-     * @return array
-     */
-    public static function collectEnd()
-    {
-        return array_values(
-          array_diff(get_declared_classes(), self::$buffer)
-        );
-    }
-
-    /**
-     * Returns the class hierarchy for a given class.
-     *
-     * @param  string  $className
-     * @param  boolean $asReflectionObjects
-     * @return array
-     */
-    public static function getHierarchy($className, $asReflectionObjects = FALSE)
-    {
-        if ($asReflectionObjects) {
-            $classes = array(new ReflectionClass($className));
-        } else {
-            $classes = array($className);
-        }
-
-        $done = FALSE;
-
-        while (!$done) {
-            if ($asReflectionObjects) {
-                $class = new ReflectionClass(
-                  $classes[count($classes)-1]->getName()
-                );
-            } else {
-                $class = new ReflectionClass($classes[count($classes)-1]);
-            }
-
-            $parent = $class->getParentClass();
-
-            if ($parent !== FALSE) {
-                if ($asReflectionObjects) {
-                    $classes[] = $parent;
-                } else {
-                    $classes[] = $parent->getName();
-                }
-            } else {
-                $done = TRUE;
-            }
-        }
-
-        return $classes;
-    }
-
-    /**
-     * Returns the parameters of a function or method.
-     *
-     * @param  ReflectionFunction|ReflectionMethod $method
-     * @param  boolean                             $forCall
-     * @return string
-     * @since  Method available since Release 3.2.0
-     */
-    public static function getMethodParameters($method, $forCall = FALSE)
-    {
-        $parameters = array();
-
-        foreach ($method->getParameters() as $i => $parameter) {
-            $name = '$' . $parameter->getName();
-
-            if ($name === '$') {
-                $name .= 'arg' . $i;
-            }
-
-            $default  = '';
-            $typeHint = '';
-
-            if (!$forCall) {
-                if ($parameter->isArray()) {
-                    $typeHint = 'array ';
-                } else {
-                    try {
-                        $class = $parameter->getClass();
-                    }
-
-                    catch (ReflectionException $e) {
-                        $class = FALSE;
-                    }
-
-                    if ($class) {
-                        $typeHint = $class->getName() . ' ';
-                    }
-                }
-
-                if ($parameter->isDefaultValueAvailable()) {
-                    $value   = $parameter->getDefaultValue();
-                    $default = ' = ' . var_export($value, TRUE);
-                }
-
-                else if ($parameter->isOptional()) {
-                    $default = ' = null';
-                }
-            }
-
-            $ref = '';
-
-            if ($parameter->isPassedByReference()) {
-                $ref = '&';
-            }
-
-            $parameters[] = $typeHint . $ref . $name . $default;
-        }
-
-        return join(', ', $parameters);
-    }
-
-    /**
-     * Returns the package information of a user-defined class.
-     *
-     * @param  string $className
-     * @param  string $docComment
-     * @return array
-     */
-    public static function getPackageInformation($className, $docComment)
-    {
-        $result = array(
-          'namespace'   => '',
-          'fullPackage' => '',
-          'category'    => '',
-          'package'     => '',
-          'subpackage'  => ''
-        );
-
-        if (strpos($className, '\\') !== FALSE) {
-            $result['namespace'] = self::arrayToName(
-              explode('\\', $className)
-            );
-        }
-
-        if (preg_match('/@category[\s]+([\.\w]+)/', $docComment, $matches)) {
-            $result['category'] = $matches[1];
-        }
-
-        if (preg_match('/@package[\s]+([\.\w]+)/', $docComment, $matches)) {
-            $result['package']     = $matches[1];
-            $result['fullPackage'] = $matches[1];
-        }
-
-        if (preg_match('/@subpackage[\s]+([\.\w]+)/', $docComment, $matches)) {
-            $result['subpackage']   = $matches[1];
-            $result['fullPackage'] .= '.' . $matches[1];
-        }
-
-        if (empty($result['fullPackage'])) {
-            $result['fullPackage'] = self::arrayToName(
-              explode('_', str_replace('\\', '_', $className)), '.'
-            );
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns the value of a static attribute.
-     * This also works for attributes that are declared protected or private.
-     *
-     * @param  string  $className
-     * @param  string  $attributeName
-     * @return mixed
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getStaticAttribute($className, $attributeName)
-    {
-        if (!is_string($className)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'string');
-        }
-
-        if (!class_exists($className)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'class name');
-        }
-
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        $class = new ReflectionClass($className);
-
-        while ($class) {
-            $attributes = $class->getStaticProperties();
-
-            if (array_key_exists($attributeName, $attributes)) {
-                return $attributes[$attributeName];
-            }
-
-            $class = $class->getParentClass();
-        }
-
-        throw new PHPUnit_Framework_Exception(
-          sprintf(
-            'Attribute "%s" not found in class.',
-
-            $attributeName
-          )
-        );
-    }
-
-    /**
-     * Returns the value of an object's attribute.
-     * This also works for attributes that are declared protected or private.
-     *
-     * @param  object  $object
-     * @param  string  $attributeName
-     * @return mixed
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getObjectAttribute($object, $attributeName)
-    {
-        if (!is_object($object)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'object');
-        }
-
-        if (!is_string($attributeName)) {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(2, 'string');
-        }
-
-        PHPUnit_Framework_Assert::assertObjectHasAttribute(
-          $attributeName, $object
-        );
-
-        try {
-            $attribute = new ReflectionProperty($object, $attributeName);
-        }
-
-        catch (ReflectionException $e) {
-            $reflector = new ReflectionObject($object);
-
-            while ($reflector = $reflector->getParentClass()) {
-                try {
-                    $attribute = $reflector->getProperty($attributeName);
-                    break;
-                }
-
-                catch(ReflectionException $e) {
-                }
-            }
-        }
-
-        if ($attribute->isPublic()) {
-            return $object->$attributeName;
-        } else {
-            $array         = (array)$object;
-            $protectedName = "\0*\0" . $attributeName;
-
-            if (array_key_exists($protectedName, $array)) {
-                return $array[$protectedName];
-            } else {
-                $classes = self::getHierarchy(get_class($object));
-
-                foreach ($classes as $class) {
-                    $privateName = sprintf(
-                      "\0%s\0%s",
-
-                      $class,
-                      $attributeName
-                    );
-
-                    if (array_key_exists($privateName, $array)) {
-                        return $array[$privateName];
-                    }
-                }
-            }
-        }
-
-        throw new PHPUnit_Framework_Exception(
-          sprintf(
-            'Attribute "%s" not found in object.',
-
-            $attributeName
-          )
-        );
-    }
-
-    /**
-     *
-     *
-     * @param  string $className
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    public static function parseFullyQualifiedClassName($className)
-    {
-        $result = array(
-          'namespace'               => '',
-          'className'               => $className,
-          'fullyQualifiedClassName' => $className
-        );
-
-        if (strpos($className, '\\') !== FALSE) {
-            $tmp                 = explode('\\', $className);
-            $result['className'] = $tmp[count($tmp)-1];
-            $result['namespace'] = self::arrayToName($tmp);
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns the package information of a user-defined class.
-     *
-     * @param  array  $parts
-     * @param  string $join
-     * @return string
-     * @since  Method available since Release 3.2.12
-     */
-    protected static function arrayToName(array $parts, $join = '\\')
-    {
-        $result = '';
-
-        if (count($parts) > 1) {
-            array_pop($parts);
-
-            $result = join($join, $parts);
-        }
-
-        return $result;
-    }
-}
diff --git a/tests/PHPUnit/Util/Configuration.php b/tests/PHPUnit/Util/Configuration.php
deleted file mode 100644
index ff5477c..0000000
--- a/tests/PHPUnit/Util/Configuration.php
+++ /dev/null
@@ -1,868 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.2.0
- */
-
-/**
- * Wrapper for the PHPUnit XML configuration file.
- *
- * Example XML configuration file:
- * <code>
- * <?xml version="1.0" encoding="utf-8" ?>
- *
- * <phpunit backupGlobals="true"
- *          backupStaticAttributes="false"
- *          bootstrap="/path/to/bootstrap.php"
- *          colors="false"
- *          convertErrorsToExceptions="true"
- *          convertNoticesToExceptions="true"
- *          convertWarningsToExceptions="true"
- *          forceCoversAnnotation="false"
- *          mapTestClassNameToCoveredClassName="false"
- *          processIsolation="false"
- *          stopOnError="false"
- *          stopOnFailure="false"
- *          stopOnIncomplete="false"
- *          stopOnSkipped="false"
- *          syntaxCheck="false"
- *          testSuiteLoaderClass="PHPUnit_Runner_StandardTestSuiteLoader"
- *          strict="false"
- *          verbose="false">
- *   <testsuites>
- *     <testsuite name="My Test Suite">
- *       <directory suffix="Test.php">/path/to/files</directory>
- *       <file>/path/to/MyTest.php</file>
- *     </testsuite>
- *   </testsuites>
- *
- *   <groups>
- *     <include>
- *       <group>name</group>
- *     </include>
- *     <exclude>
- *       <group>name</group>
- *     </exclude>
- *   </groups>
- *
- *   <filter>
- *     <blacklist>
- *       <directory suffix=".php">/path/to/files</directory>
- *       <file>/path/to/file</file>
- *       <exclude>
- *         <directory suffix=".php">/path/to/files</directory>
- *         <file>/path/to/file</file>
- *       </exclude>
- *     </blacklist>
- *     <whitelist addUncoveredFilesFromWhitelist="true">
- *       <directory suffix=".php">/path/to/files</directory>
- *       <file>/path/to/file</file>
- *       <exclude>
- *         <directory suffix=".php">/path/to/files</directory>
- *         <file>/path/to/file</file>
- *       </exclude>
- *     </whitelist>
- *   </filter>
- *
- *   <listeners>
- *     <listener class="MyListener" file="/optional/path/to/MyListener.php">
- *       <arguments>
- *         <array>
- *           <element key="0">
- *             <string>Sebastian</string>
- *           </element>
- *         </array>
- *         <integer>22</integer>
- *         <string>April</string>
- *         <double>19.78</double>
- *         <null/>
- *         <object class="stdClass"/>
- *         <file>MyRelativeFile.php</file>
- *         <directory>MyRelativeDir</directory>
- *       </arguments>
- *     </listener>
- *   </listeners>
- *
- *   <logging>
- *     <log type="coverage-html" target="/tmp/report" title="My Project"
-            charset="UTF-8" yui="true" highlight="false"
- *          lowUpperBound="35" highLowerBound="70"/>
- *     <log type="coverage-clover" target="/tmp/clover.xml"/>
- *     <log type="json" target="/tmp/logfile.json"/>
- *     <log type="plain" target="/tmp/logfile.txt"/>
- *     <log type="tap" target="/tmp/logfile.tap"/>
- *     <log type="junit" target="/tmp/logfile.xml" logIncompleteSkipped="false"/>
- *     <log type="story-html" target="/tmp/story.html"/>
- *     <log type="story-text" target="/tmp/story.txt"/>
- *     <log type="testdox-html" target="/tmp/testdox.html"/>
- *     <log type="testdox-text" target="/tmp/testdox.txt"/>
- *   </logging>
- *
- *   <php>
- *     <includePath>.</includePath>
- *     <ini name="foo" value="bar"/>
- *     <const name="foo" value="bar"/>
- *     <var name="foo" value="bar"/>
- *     <env name="foo" value="bar"/>
- *     <post name="foo" value="bar"/>
- *     <get name="foo" value="bar"/>
- *     <cookie name="foo" value="bar"/>
- *     <server name="foo" value="bar"/>
- *     <files name="foo" value="bar"/>
- *     <request name="foo" value="bar"/>
- *   </php>
- *
- *   <selenium>
- *     <browser name="Firefox on Linux"
- *              browser="*firefox /usr/lib/firefox/firefox-bin"
- *              host="my.linux.box"
- *              port="4444"
- *              timeout="30000"/>
- *   </selenium>
- * </phpunit>
- * </code>
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.2.0
- */
-class PHPUnit_Util_Configuration
-{
-    private static $instances = array();
-
-    protected $document;
-    protected $xpath;
-    protected $filename;
-
-    /**
-     * Loads a PHPUnit configuration file.
-     *
-     * @param  string $filename
-     */
-    protected function __construct($filename)
-    {
-        $this->filename = $filename;
-        $this->document = PHPUnit_Util_XML::loadFile($filename);
-        $this->xpath    = new DOMXPath($this->document);
-    }
-
-    /**
-     * @since  Method available since Release 3.4.0
-     */
-    private final function __clone()
-    {
-    }
-
-    /**
-     * Returns a PHPUnit configuration object.
-     *
-     * @param  string $filename
-     * @return PHPUnit_Util_Configuration
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getInstance($filename)
-    {
-        $realpath = realpath($filename);
-
-        if ($realpath === FALSE) {
-            throw new PHPUnit_Framework_Exception(
-              sprintf(
-                'Could not read "%s".',
-                $filename
-              )
-            );
-        }
-
-        if (!isset(self::$instances[$realpath])) {
-            self::$instances[$realpath] = new PHPUnit_Util_Configuration($realpath);
-        }
-
-        return self::$instances[$realpath];
-    }
-
-    /**
-     * Returns the configuration for SUT filtering.
-     *
-     * @return array
-     * @since  Method available since Release 3.2.1
-     */
-    public function getFilterConfiguration()
-    {
-        $addUncoveredFilesFromWhitelist = TRUE;
-
-        $tmp = $this->xpath->query('filter/whitelist');
-
-        if ($tmp->length == 1 &&
-            $tmp->item(0)->hasAttribute('addUncoveredFilesFromWhitelist')) {
-            $addUncoveredFilesFromWhitelist = $this->getBoolean(
-              (string)$tmp->item(0)->getAttribute('addUncoveredFilesFromWhitelist'),
-              TRUE
-            );
-        }
-
-        return array(
-          'blacklist' => array(
-            'include' => array(
-              'directory' => $this->readFilterDirectories(
-                'filter/blacklist/directory'
-              ),
-              'file' => $this->readFilterFiles(
-                'filter/blacklist/file'
-              )
-            ),
-            'exclude' => array(
-              'directory' => $this->readFilterDirectories(
-                'filter/blacklist/exclude/directory'
-               ),
-              'file' => $this->readFilterFiles(
-                'filter/blacklist/exclude/file'
-              )
-            )
-          ),
-          'whitelist' => array(
-            'addUncoveredFilesFromWhitelist' => $addUncoveredFilesFromWhitelist,
-            'include' => array(
-              'directory' => $this->readFilterDirectories(
-                'filter/whitelist/directory'
-              ),
-              'file' => $this->readFilterFiles(
-                'filter/whitelist/file'
-              )
-            ),
-            'exclude' => array(
-              'directory' => $this->readFilterDirectories(
-                'filter/whitelist/exclude/directory'
-              ),
-              'file' => $this->readFilterFiles(
-                'filter/whitelist/exclude/file'
-              )
-            )
-          )
-        );
-    }
-
-    /**
-     * Returns the configuration for groups.
-     *
-     * @return array
-     * @since  Method available since Release 3.2.1
-     */
-    public function getGroupConfiguration()
-    {
-        $groups = array(
-          'include' => array(),
-          'exclude' => array()
-        );
-
-        foreach ($this->xpath->query('groups/include/group') as $group) {
-            $groups['include'][] = (string)$group->nodeValue;
-        }
-
-        foreach ($this->xpath->query('groups/exclude/group') as $group) {
-            $groups['exclude'][] = (string)$group->nodeValue;
-        }
-
-        return $groups;
-    }
-
-    /**
-     * Returns the configuration for listeners.
-     *
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    public function getListenerConfiguration()
-    {
-        $result = array();
-
-        foreach ($this->xpath->query('listeners/listener') as $listener) {
-            $class     = (string)$listener->getAttribute('class');
-            $file      = '';
-            $arguments = array();
-
-            if ($listener->hasAttribute('file')) {
-                $file = $this->toAbsolutePath((string)$listener->getAttribute('file'));
-            }
-
-            if ($listener->childNodes->item(1) instanceof DOMElement &&
-                $listener->childNodes->item(1)->tagName == 'arguments') {
-                foreach ($listener->childNodes->item(1)->childNodes as $argument) {
-                    if ($argument instanceof DOMElement) {
-                        if($argument->tagName == 'file' || $argument->tagName == 'directory') {
-                            $arguments[] = $this->toAbsolutePath((string)$argument->nodeValue);
-                        } else {
-                            $arguments[] = PHPUnit_Util_XML::xmlToVariable($argument);
-                        }
-                    }
-                }
-            }
-
-            $result[] = array(
-              'class'     => $class,
-              'file'      => $file,
-              'arguments' => $arguments
-            );
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns the logging configuration.
-     *
-     * @return array
-     */
-    public function getLoggingConfiguration()
-    {
-        $result = array();
-
-        foreach ($this->xpath->query('logging/log') as $log) {
-            $type   = (string)$log->getAttribute('type');
-            $target = $this->toAbsolutePath((string)$log->getAttribute('target'));
-
-            if ($type == 'coverage-html') {
-                if ($log->hasAttribute('title')) {
-                    $result['title'] = (string)$log->getAttribute('title');
-                }
-
-                if ($log->hasAttribute('charset')) {
-                    $result['charset'] = (string)$log->getAttribute('charset');
-                }
-
-                if ($log->hasAttribute('lowUpperBound')) {
-                    $result['lowUpperBound'] = (string)$log->getAttribute('lowUpperBound');
-                }
-
-                if ($log->hasAttribute('highLowerBound')) {
-                    $result['highLowerBound'] = (string)$log->getAttribute('highLowerBound');
-                }
-
-                if ($log->hasAttribute('yui')) {
-                    $result['yui'] = $this->getBoolean(
-                      (string)$log->getAttribute('yui'),
-                      FALSE
-                    );
-                }
-
-                if ($log->hasAttribute('highlight')) {
-                    $result['highlight'] = $this->getBoolean(
-                      (string)$log->getAttribute('highlight'),
-                      FALSE
-                    );
-                }
-            }
-
-            else if ($type == 'junit') {
-                if ($log->hasAttribute('logIncompleteSkipped')) {
-                    $result['logIncompleteSkipped'] = $this->getBoolean(
-                      (string)$log->getAttribute('logIncompleteSkipped'),
-                      FALSE
-                    );
-                }
-            }
-
-            $result[$type] = $target;
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns the PHP configuration.
-     *
-     * @return array
-     * @since  Method available since Release 3.2.1
-     */
-    public function getPHPConfiguration()
-    {
-        $result = array(
-          'include_path' => '',
-          'ini'          => array(),
-          'const'        => array(),
-          'var'          => array(),
-          'env'          => array(),
-          'post'         => array(),
-          'get'          => array(),
-          'cookie'       => array(),
-          'server'       => array(),
-          'files'        => array(),
-          'request'      => array()
-        );
-
-        $nl = $this->xpath->query('php/includePath');
-
-        if ($nl->length == 1) {
-            $result['include_path'] = $this->toAbsolutePath((string)$nl->item(0)->nodeValue);
-        }
-
-        foreach ($this->xpath->query('php/ini') as $ini) {
-            $name  = (string)$ini->getAttribute('name');
-            $value = (string)$ini->getAttribute('value');
-
-            $result['ini'][$name] = $value;
-        }
-
-        foreach ($this->xpath->query('php/const') as $const) {
-            $name  = (string)$const->getAttribute('name');
-            $value = (string)$const->getAttribute('value');
-
-            $result['const'][$name] = $this->getBoolean($value, $value);
-        }
-
-        foreach (array('var', 'env', 'post', 'get', 'cookie', 'server', 'files', 'request') as $array) {
-            foreach ($this->xpath->query('php/' . $array) as $var) {
-                $name  = (string)$var->getAttribute('name');
-                $value = (string)$var->getAttribute('value');
-
-                $result[$array][$name] = $this->getBoolean($value, $value);
-            }
-        }
-
-        return $result;
-    }
-
-    /**
-     * Handles the PHP configuration.
-     *
-     * @since  Method available since Release 3.2.20
-     */
-    public function handlePHPConfiguration()
-    {
-        $configuration = $this->getPHPConfiguration();
-
-        if ($configuration['include_path'] != '') {
-            ini_set(
-              'include_path',
-              $configuration['include_path'] . PATH_SEPARATOR .
-              ini_get('include_path')
-            );
-        }
-
-        foreach ($configuration['ini'] as $name => $value) {
-            if (defined($value)) {
-                $value = constant($value);
-            }
-
-            ini_set($name, $value);
-        }
-
-        foreach ($configuration['const'] as $name => $value) {
-            if (!defined($name)) {
-                define($name, $value);
-            }
-        }
-
-        foreach (array('var', 'env', 'post', 'get', 'cookie', 'server', 'files', 'request') as $array) {
-            if ($array == 'var') {
-                $target = &$GLOBALS;
-            } else {
-                $target = &$GLOBALS['_' . strtoupper($array)];
-            }
-
-            foreach ($configuration[$array] as $name => $value) {
-                $target[$name] = $value;
-            }
-        }
-    }
-
-    /**
-     * Returns the PHPUnit configuration.
-     *
-     * @return array
-     * @since  Method available since Release 3.2.14
-     */
-    public function getPHPUnitConfiguration()
-    {
-        $result = array();
-        $root   = $this->document->documentElement;
-
-        if ($root->hasAttribute('colors')) {
-            $result['colors'] = $this->getBoolean(
-              (string)$root->getAttribute('colors'), FALSE
-            );
-        }
-
-        else if ($root->hasAttribute('ansi')) {
-            $result['colors'] = $this->getBoolean(
-              (string)$root->getAttribute('ansi'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('backupGlobals')) {
-            $result['backupGlobals'] = $this->getBoolean(
-              (string)$root->getAttribute('backupGlobals'), TRUE
-            );
-        }
-
-        if ($root->hasAttribute('backupStaticAttributes')) {
-            $result['backupStaticAttributes'] = $this->getBoolean(
-              (string)$root->getAttribute('backupStaticAttributes'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('bootstrap')) {
-            $result['bootstrap'] = $this->toAbsolutePath(
-              (string)$root->getAttribute('bootstrap')
-            );
-        }
-
-        if ($root->hasAttribute('convertErrorsToExceptions')) {
-            $result['convertErrorsToExceptions'] = $this->getBoolean(
-              (string)$root->getAttribute('convertErrorsToExceptions'), TRUE
-            );
-        }
-
-        if ($root->hasAttribute('convertNoticesToExceptions')) {
-            $result['convertNoticesToExceptions'] = $this->getBoolean(
-              (string)$root->getAttribute('convertNoticesToExceptions'), TRUE
-            );
-        }
-
-        if ($root->hasAttribute('convertWarningsToExceptions')) {
-            $result['convertWarningsToExceptions'] = $this->getBoolean(
-              (string)$root->getAttribute('convertWarningsToExceptions'), TRUE
-            );
-        }
-
-        if ($root->hasAttribute('forceCoversAnnotation')) {
-            $result['forceCoversAnnotation'] = $this->getBoolean(
-              (string)$root->getAttribute('forceCoversAnnotation'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('mapTestClassNameToCoveredClassName')) {
-            $result['mapTestClassNameToCoveredClassName'] = $this->getBoolean(
-              (string)$root->getAttribute('mapTestClassNameToCoveredClassName'),
-              FALSE
-            );
-        }
-
-        if ($root->hasAttribute('processIsolation')) {
-            $result['processIsolation'] = $this->getBoolean(
-              (string)$root->getAttribute('processIsolation'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('stopOnError')) {
-            $result['stopOnError'] = $this->getBoolean(
-              (string)$root->getAttribute('stopOnError'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('stopOnFailure')) {
-            $result['stopOnFailure'] = $this->getBoolean(
-              (string)$root->getAttribute('stopOnFailure'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('stopOnIncomplete')) {
-            $result['stopOnIncomplete'] = $this->getBoolean(
-              (string)$root->getAttribute('stopOnIncomplete'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('stopOnSkipped')) {
-            $result['stopOnSkipped'] = $this->getBoolean(
-              (string)$root->getAttribute('stopOnSkipped'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('syntaxCheck')) {
-            $result['syntaxCheck'] = $this->getBoolean(
-              (string)$root->getAttribute('syntaxCheck'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('testSuiteLoaderClass')) {
-            $result['testSuiteLoaderClass'] = (string)$root->getAttribute(
-              'testSuiteLoaderClass'
-            );
-        }
-
-        if ($root->hasAttribute('testSuiteLoaderFile')) {
-            $result['testSuiteLoaderFile'] = (string)$root->getAttribute(
-              'testSuiteLoaderFile'
-            );
-        }
-
-        if ($root->hasAttribute('strict')) {
-            $result['strict'] = $this->getBoolean(
-              (string)$root->getAttribute('strict'), FALSE
-            );
-        }
-
-        if ($root->hasAttribute('verbose')) {
-            $result['verbose'] = $this->getBoolean(
-              (string)$root->getAttribute('verbose'), FALSE
-            );
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns the SeleniumTestCase browser configuration.
-     *
-     * @return array
-     * @since  Method available since Release 3.2.9
-     */
-    public function getSeleniumBrowserConfiguration()
-    {
-        $result = array();
-
-        foreach ($this->xpath->query('selenium/browser') as $config) {
-            $name    = (string)$config->getAttribute('name');
-            $browser = (string)$config->getAttribute('browser');
-
-            if ($config->hasAttribute('host')) {
-                $host = (string)$config->getAttribute('host');
-            } else {
-                $host = 'localhost';
-            }
-
-            if ($config->hasAttribute('port')) {
-                $port = (int)$config->getAttribute('port');
-            } else {
-                $port = 4444;
-            }
-
-            if ($config->hasAttribute('timeout')) {
-                $timeout = (int)$config->getAttribute('timeout');
-            } else {
-                $timeout = 30000;
-            }
-
-            $result[] = array(
-              'name'    => $name,
-              'browser' => $browser,
-              'host'    => $host,
-              'port'    => $port,
-              'timeout' => $timeout
-            );
-        }
-
-        return $result;
-    }
-
-    /**
-     * Returns the test suite configuration.
-     *
-     * @param  boolean $syntaxCheck
-     * @return PHPUnit_Framework_TestSuite
-     * @since  Method available since Release 3.2.1
-     */
-    public function getTestSuiteConfiguration($syntaxCheck = FALSE)
-    {
-        $testSuiteNodes = $this->xpath->query('testsuites/testsuite');
-
-        if ($testSuiteNodes->length == 0) {
-            $testSuiteNodes = $this->xpath->query('testsuite');
-        }
-
-        if ($testSuiteNodes->length == 1) {
-            return $this->getTestSuite($testSuiteNodes->item(0), $syntaxCheck);
-        }
-
-        if ($testSuiteNodes->length > 1) {
-            $suite = new PHPUnit_Framework_TestSuite;
-
-            foreach ($testSuiteNodes as $testSuiteNode) {
-                $suite->addTestSuite(
-                  $this->getTestSuite($testSuiteNode, $syntaxCheck)
-                );
-            }
-
-            return $suite;
-        }
-    }
-
-    /**
-     * @param  DOMElement $testSuiteNode
-     * @param  boolean    $syntaxCheck
-     * @return PHPUnit_Framework_TestSuite
-     * @since  Method available since Release 3.4.0
-     */
-    protected function getTestSuite(DOMElement $testSuiteNode, $syntaxCheck)
-    {
-        if ($testSuiteNode->hasAttribute('name')) {
-            $suite = new PHPUnit_Framework_TestSuite(
-              (string)$testSuiteNode->getAttribute('name')
-            );
-        } else {
-            $suite = new PHPUnit_Framework_TestSuite;
-        }
-
-        foreach ($testSuiteNode->getElementsByTagName('directory') as $directoryNode) {
-            $directory = (string)$directoryNode->nodeValue;
-
-            if (empty($directory)) {
-                continue;
-            }
-
-            if ($directoryNode->hasAttribute('prefix')) {
-                $prefix = (string)$directoryNode->getAttribute('prefix');
-            } else {
-                $prefix = '';
-            }
-
-            if ($directoryNode->hasAttribute('suffix')) {
-                $suffix = (string)$directoryNode->getAttribute('suffix');
-            } else {
-                $suffix = 'Test.php';
-            }
-
-            $testCollector = new PHPUnit_Runner_IncludePathTestCollector(
-              array($this->toAbsolutePath($directory)), $suffix, $prefix
-            );
-
-            $suite->addTestFiles($testCollector->collectTests(), $syntaxCheck);
-        }
-
-        foreach ($testSuiteNode->getElementsByTagName('file') as $fileNode) {
-            $file = (string)$fileNode->nodeValue;
-
-            if (empty($file)) {
-                continue;
-            }
-
-            $suite->addTestFile($file, $syntaxCheck);
-        }
-
-        return $suite;
-    }
-
-    /**
-     * @param  string  $value
-     * @param  boolean $default
-     * @return boolean
-     * @since  Method available since Release 3.2.3
-     */
-    protected function getBoolean($value, $default)
-    {
-        if (strtolower($value) == 'false') {
-            return FALSE;
-        }
-
-        else if (strtolower($value) == 'true') {
-            return TRUE;
-        }
-
-        return $default;
-    }
-
-    /**
-     * @param  string $query
-     * @return array
-     * @since  Method available since Release 3.2.3
-     */
-    protected function readFilterDirectories($query)
-    {
-        $directories = array();
-
-        foreach ($this->xpath->query($query) as $directory) {
-            if ($directory->hasAttribute('prefix')) {
-                $prefix = (string)$directory->getAttribute('prefix');
-            } else {
-                $prefix = '';
-            }
-
-            if ($directory->hasAttribute('suffix')) {
-                $suffix = (string)$directory->getAttribute('suffix');
-            } else {
-                $suffix = '.php';
-            }
-
-            if ($directory->hasAttribute('group')) {
-                $group = (string)$directory->getAttribute('group');
-            } else {
-                $group = 'DEFAULT';
-            }
-
-            $directories[] = array(
-              'path'   => $this->toAbsolutePath((string)$directory->nodeValue),
-              'prefix' => $prefix,
-              'suffix' => $suffix,
-              'group'  => $group
-            );
-        }
-
-        return $directories;
-    }
-
-    /**
-     * @param  string $query
-     * @return array
-     * @since  Method available since Release 3.2.3
-     */
-    protected function readFilterFiles($query)
-    {
-        $files = array();
-
-        foreach ($this->xpath->query($query) as $file) {
-            $files[] = $this->toAbsolutePath((string)$file->nodeValue);
-        }
-
-        return $files;
-    }
-
-    /**
-     * @param  string $path
-     * @return string
-     * @since  Method available since Release 3.5.0
-     */
-    protected function toAbsolutePath($path)
-    {
-        // is the path already an absolute path?
-        if ($path[0] === '/' || $path[0] === '\\' ||
-            (strlen($path) > 3 && ctype_alpha($path[0]) &&
-             $path[1] === ':' && ($path[2] === '\\' || $path[2] === '/'))) {
-            return $path;
-        }
-
-        return dirname($this->filename) . DIRECTORY_SEPARATOR . $path;
-    }
-}
diff --git a/tests/PHPUnit/Util/Diff.php b/tests/PHPUnit/Util/Diff.php
deleted file mode 100644
index 56813c6..0000000
--- a/tests/PHPUnit/Util/Diff.php
+++ /dev/null
@@ -1,261 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @author     Kore Nordmann <mail@kore-nordmann.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- * Diff implementation.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @author     Kore Nordmann <mail@kore-nordmann.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Util_Diff
-{
-    /**
-     * Returns the diff between two arrays or strings.
-     *
-     * @param  array|string $from
-     * @param  array|string $to
-     * @return string
-     */
-    public static function diff($from, $to)
-    {
-        if (is_string($from)) {
-            $from = preg_split('(\r\n|\r|\n)', $from);
-        }
-
-        if (is_string($to)) {
-            $to = preg_split('(\r\n|\r|\n)', $to);
-        }
-
-        $buffer     = "--- Expected\n+++ Actual\n";
-        $start      = array();
-        $end        = array();
-        $fromLength = count($from);
-        $toLength   = count($to);
-        $length     = min($fromLength, $toLength);
-
-        for ($i = 0; $i < $length; ++$i) {
-            if ($from[$i] === $to[$i]) {
-                $start[] = $from[$i];
-                unset($from[$i], $to[$i]);
-            } else {
-                break;
-            }
-        }
-
-        $length -= $i;
-
-        for ($i = 1; $i < $length; ++$i) {
-            if ($from[$fromLength - $i] === $to[$toLength - $i]) {
-                array_unshift($end, $from[$fromLength - $i]);
-                unset($from[$fromLength - $i], $to[$toLength - $i]);
-            } else {
-                break;
-            }
-        }
-
-        $common = self::longestCommonSubsequence(
-          array_values($from), array_values($to)
-        );
-
-        $diff = array();
-        $line = 0;
-
-        foreach ($start as $token) {
-            $diff[] = array($token, 0 /* OLD */);
-        }
-
-        reset($from);
-        reset($to);
-
-        foreach ($common as $token) {
-            while ((($fromToken = reset($from)) !== $token)) {
-                $diff[] = array(array_shift($from), 2 /* REMOVED */);
-            }
-
-            while ((($toToken = reset($to)) !== $token)) {
-                $diff[] = array(array_shift($to), 1 /* ADDED */);
-            }
-
-            $diff[] = array($token, 0 /* OLD */);
-
-            array_shift($from);
-            array_shift($to);
-        }
-
-        while (($token = array_shift($from)) !== NULL) {
-            $diff[] = array($token, 2 /* REMOVED */);
-        }
-
-        while (($token = array_shift($to)) !== NULL) {
-            $diff[] = array($token, 1 /* ADDED */);
-        }
-
-        foreach ($end as $token) {
-            $diff[] = array($token, 0 /* OLD */);
-        }
-
-        $inOld = FALSE;
-        $i     = 0;
-        $old   = array();
-
-        foreach ($diff as $line) {
-            if ($line[1] === 0 /* OLD */) {
-                if ($inOld === FALSE) {
-                    $inOld = $i;
-                }
-            }
-
-            else if ($inOld !== FALSE) {
-                if (($i - $inOld) > 5) {
-                    $old[$inOld] = $i - 1;
-                }
-
-                $inOld = FALSE;
-            }
-
-            ++$i;
-        }
-
-        $start = isset($old[0]) ? $old[0] : 0;
-        $end   = count($diff);
-        $i     = 0;
-
-        if ($tmp = array_search($end, $old)) {
-            $end = $tmp;
-        }
-
-        $newChunk = TRUE;
-
-        for ($i = $start; $i < $end; $i++) {
-            if (isset($old[$i])) {
-                $buffer  .= "\n";
-                $newChunk = TRUE;
-                $i        = $old[$i];
-            }
-
-            if ($newChunk) {
-                
-                $buffer  .= "@@ @@\n";
-                $newChunk = FALSE;
-            }
-
-            if ($diff[$i][1] === 1 /* ADDED */) {
-                $buffer .= '+' . $diff[$i][0] . "\n";
-            }
-
-            else if ($diff[$i][1] === 2 /* REMOVED */) {
-                $buffer .= '-' . $diff[$i][0] . "\n";
-            }
-
-            else {
-                $buffer .= ' ' . $diff[$i][0] . "\n";
-            }
-        }
-
-        return $buffer;
-    }
-
-    /**
-     * Calculates the longest common subsequence of two arrays.
-     *
-     * @param  array $from
-     * @param  array $to
-     * @return array
-     */
-    protected static function longestCommonSubsequence(array $from, array $to)
-    {
-        $common     = array();
-        $matrix     = array();
-        $fromLength = count($from);
-        $toLength   = count($to);
-
-        for ($i = 0; $i <= $fromLength; ++$i) {
-            $matrix[$i][0] = 0;
-        }
-
-        for ($j = 0; $j <= $toLength; ++$j) {
-            $matrix[0][$j] = 0;
-        }
-
-        for ($i = 1; $i <= $fromLength; ++$i) {
-            for ($j = 1; $j <= $toLength; ++$j) {
-                $matrix[$i][$j] = max(
-                  $matrix[$i-1][$j],
-                  $matrix[$i][$j-1],
-                  $from[$i-1] === $to[$j-1] ? $matrix[$i-1][$j-1] + 1 : 0
-                );
-            }
-        }
-
-        $i = $fromLength;
-        $j = $toLength;
-
-        while ($i > 0 && $j > 0) {
-            if ($from[$i-1] === $to[$j-1]) {
-                array_unshift($common, $from[$i-1]);
-                --$i;
-                --$j;
-            }
-
-            else if ($matrix[$i][$j-1] > $matrix[$i-1][$j]) {
-                --$j;
-            }
-
-            else {
-                --$i;
-            }
-        }
-
-        return $common;
-    }
-}
diff --git a/tests/PHPUnit/Util/ErrorHandler.php b/tests/PHPUnit/Util/ErrorHandler.php
deleted file mode 100644
index 45d4965..0000000
--- a/tests/PHPUnit/Util/ErrorHandler.php
+++ /dev/null
@@ -1,118 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.3.0
- */
-
-/**
- * Error handler that converts PHP errors and warnings to exceptions.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Util_ErrorHandler
-{
-    protected static $errorStack = array();
-
-    /**
-     * Returns the error stack.
-     *
-     * @return array
-     */
-    public static function getErrorStack()
-    {
-        return self::$errorStack;
-    }
-
-    /**
-     * @param  integer $errno
-     * @param  string  $errstr
-     * @param  string  $errfile
-     * @param  integer $errline
-     * @throws PHPUnit_Framework_Error
-     */
-    public static function handleError($errno, $errstr, $errfile, $errline)
-    {
-        if (!($errno & error_reporting())) {
-            return FALSE;
-        }
-
-        self::$errorStack[] = array($errno, $errstr, $errfile, $errline);
-
-        $trace = debug_backtrace(FALSE);
-        array_shift($trace);
-
-        foreach ($trace as $frame) {
-            if ($frame['function'] == '__toString') {
-                return FALSE;
-            }
-        }
-
-        if ($errno == E_NOTICE || $errno == E_STRICT) {
-            if (PHPUnit_Framework_Error_Notice::$enabled !== TRUE) {
-                return FALSE;
-            }
-
-            $exception = 'PHPUnit_Framework_Error_Notice';
-        }
-
-        else if ($errno == E_WARNING) {
-            if (PHPUnit_Framework_Error_Warning::$enabled !== TRUE) {
-                return FALSE;
-            }
-
-            $exception = 'PHPUnit_Framework_Error_Warning';
-        }
-
-        else {
-            $exception = 'PHPUnit_Framework_Error';
-        }
-
-        throw new $exception($errstr, $errno, $errfile, $errline, $trace);
-    }
-}
diff --git a/tests/PHPUnit/Util/File.php b/tests/PHPUnit/Util/File.php
deleted file mode 100644
index 82eda04..0000000
--- a/tests/PHPUnit/Util/File.php
+++ /dev/null
@@ -1,305 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-if (!defined('T_NAMESPACE')) {
-    define('T_NAMESPACE', 377);
-}
-
-/**
- * File helpers.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Util_File
-{
-    /**
-     * @var array
-     */
-    protected static $cache = array();
-
-    /**
-     * Returns information on the classes declared in a sourcefile.
-     *
-     * @param  string $filename
-     * @return array
-     */
-    public static function getClassesInFile($filename)
-    {
-        if (!isset(self::$cache[$filename])) {
-            self::$cache[$filename] = self::parseFile($filename);
-        }
-
-        return self::$cache[$filename];
-    }
-
-    /**
-     * Parses a file for class and method information.
-     *
-     * @param  string $filename
-     * @return array
-     */
-    protected static function parseFile($filename)
-    {
-        $result = array();
-
-        $tokens                     = token_get_all(
-                                        file_get_contents($filename)
-                                      );
-        $numTokens                  = count($tokens);
-        $blocks                     = array();
-        $line                       = 1;
-        $currentBlock               = FALSE;
-        $currentNamespace           = FALSE;
-        $currentClass               = FALSE;
-        $currentFunction            = FALSE;
-        $currentFunctionStartLine   = FALSE;
-        $currentFunctionTokens      = array();
-        $currentDocComment          = FALSE;
-        $currentSignature           = FALSE;
-        $currentSignatureStartToken = FALSE;
-
-        for ($i = 0; $i < $numTokens; $i++) {
-            if ($currentFunction !== FALSE) {
-                $currentFunctionTokens[] = $tokens[$i];
-            }
-
-            if (is_string($tokens[$i])) {
-                if ($tokens[$i] == '{') {
-                    if ($currentBlock == T_CLASS) {
-                        $block = $currentClass;
-                    }
-
-                    else if ($currentBlock == T_FUNCTION) {
-                        $currentSignature = '';
-
-                        for ($j = $currentSignatureStartToken; $j < $i; $j++) {
-                            if (is_string($tokens[$j])) {
-                                $currentSignature .= $tokens[$j];
-                            } else {
-                                $currentSignature .= $tokens[$j][1];
-                            }
-                        }
-
-                        $currentSignature = trim($currentSignature);
-
-                        $block                      = $currentFunction;
-                        $currentSignatureStartToken = FALSE;
-                    }
-
-                    else {
-                        $block = FALSE;
-                    }
-
-                    array_push($blocks, $block);
-
-                    $currentBlock = FALSE;
-                }
-
-                else if ($tokens[$i] == '}') {
-                    $block = array_pop($blocks);
-
-                    if ($block !== FALSE && $block !== NULL) {
-                        if ($block == $currentFunction) {
-                            if ($currentDocComment !== FALSE) {
-                                $docComment        = $currentDocComment;
-                                $currentDocComment = FALSE;
-                            } else {
-                                $docComment = '';
-                            }
-
-                            $tmp = array(
-                              'docComment' => $docComment,
-                              'signature'  => $currentSignature,
-                              'startLine'  => $currentFunctionStartLine,
-                              'endLine'    => $line,
-                              'tokens'     => $currentFunctionTokens
-                            );
-
-                            if ($currentClass !== FALSE) {
-                                $result[$currentClass]['methods'][$currentFunction] = $tmp;
-                            }
-
-                            $currentFunction          = FALSE;
-                            $currentFunctionStartLine = FALSE;
-                            $currentFunctionTokens    = array();
-                            $currentSignature         = FALSE;
-                        }
-
-                        else if ($block == $currentClass) {
-                            $result[$currentClass]['endLine'] = $line;
-
-                            $currentClass          = FALSE;
-                            $currentClassStartLine = FALSE;
-                        }
-                    }
-                }
-
-                continue;
-            }
-
-            switch ($tokens[$i][0]) {
-                case T_NAMESPACE: {
-                    $currentNamespace = $tokens[$i+2][1];
-
-                    for ($j = $i+3; $j < $numTokens; $j += 2) {
-                        if ($tokens[$j][0] == T_NS_SEPARATOR) {
-                            $currentNamespace .= '\\' . $tokens[$j+1][1];
-                        } else {
-                            break;
-                        }
-                    }
-                }
-                break;
-
-                case T_CURLY_OPEN: {
-                    $currentBlock = T_CURLY_OPEN;
-                    array_push($blocks, $currentBlock);
-                }
-                break;
-
-                case T_DOLLAR_OPEN_CURLY_BRACES: {
-                    $currentBlock = T_DOLLAR_OPEN_CURLY_BRACES;
-                    array_push($blocks, $currentBlock);
-                }
-                break;
-
-                case T_CLASS: {
-                    $currentBlock = T_CLASS;
-
-                    if ($currentNamespace === FALSE) {
-                        $currentClass = $tokens[$i+2][1];
-                    } else {
-                        $currentClass = $currentNamespace . '\\' .
-                                        $tokens[$i+2][1];
-                    }
-
-                    if ($currentDocComment !== FALSE) {
-                        $docComment        = $currentDocComment;
-                        $currentDocComment = FALSE;
-                    } else {
-                        $docComment = '';
-                    }
-
-                    $result[$currentClass] = array(
-                      'methods'    => array(),
-                      'docComment' => $docComment,
-                      'startLine'  => $line
-                    );
-                }
-                break;
-
-                case T_FUNCTION: {
-                    if (!((is_array($tokens[$i+2]) &&
-                          $tokens[$i+2][0] == T_STRING) ||
-                         (is_string($tokens[$i+2]) &&
-                          $tokens[$i+2] == '&' &&
-                          is_array($tokens[$i+3]) &&
-                          $tokens[$i+3][0] == T_STRING))) {
-                        continue;
-                    }
-
-                    $currentBlock             = T_FUNCTION;
-                    $currentFunctionStartLine = $line;
-
-                    $done                       = FALSE;
-                    $currentSignatureStartToken = $i - 1;
-
-                    do {
-                        switch ($tokens[$currentSignatureStartToken][0]) {
-                            case T_ABSTRACT:
-                            case T_FINAL:
-                            case T_PRIVATE:
-                            case T_PUBLIC:
-                            case T_PROTECTED:
-                            case T_STATIC:
-                            case T_WHITESPACE: {
-                                $currentSignatureStartToken--;
-                            }
-                            break;
-
-                            default: {
-                                $currentSignatureStartToken++;
-                                $done = TRUE;
-                            }
-                        }
-                    }
-                    while (!$done);
-
-                    if (isset($tokens[$i+2][1])) {
-                        $functionName = $tokens[$i+2][1];
-                    }
-
-                    else if (isset($tokens[$i+3][1])) {
-                        $functionName = $tokens[$i+3][1];
-                    }
-
-                    if ($currentNamespace === FALSE) {
-                        $currentFunction = $functionName;
-                    } else {
-                        $currentFunction = $currentNamespace . '\\' .
-                                           $functionName;
-                    }
-                }
-                break;
-
-                case T_DOC_COMMENT: {
-                    $currentDocComment = $tokens[$i][1];
-                }
-                break;
-            }
-
-            $line += substr_count($tokens[$i][1], "\n");
-        }
-
-        return $result;
-    }
-}
diff --git a/tests/PHPUnit/Util/Fileloader.php b/tests/PHPUnit/Util/Fileloader.php
deleted file mode 100644
index e9b754c..0000000
--- a/tests/PHPUnit/Util/Fileloader.php
+++ /dev/null
@@ -1,141 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.3.0
- */
-
-/**
- * Utility methods to load PHP sourcefiles.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.3.0
- */
-class PHPUnit_Util_Fileloader
-{
-    /**
-     * Checks if a PHP sourcefile is readable and is optionally checked for
-     * syntax errors through the syntaxCheck() method. The sourcefile is
-     * loaded through the load() method.
-     *
-     * @param  string  $filename
-     * @param  boolean $syntaxCheck
-     * @throws RuntimeException
-     */
-    public static function checkAndLoad($filename, $syntaxCheck = FALSE)
-    {
-        if (!is_readable($filename)) {
-            $filename = './' . $filename;
-        }
-
-        if (!is_readable($filename)) {
-            throw new RuntimeException(
-              sprintf('Cannot open file "%s".' . "\n", $filename)
-            );
-        }
-
-        if ($syntaxCheck) {
-            self::syntaxCheck($filename);
-        }
-
-        self::load($filename);
-    }
-
-    /**
-     * Loads a PHP sourcefile.
-     *
-     * @param  string $filename
-     * @return mixed
-     * @since  Method available since Release 3.0.0
-     */
-    public static function load($filename)
-    {
-        $filename = PHPUnit_Util_Filesystem::fileExistsInIncludePath(
-          $filename
-        );
-
-        $oldVariableNames = array_keys(get_defined_vars());
-
-        include_once $filename;
-
-        $newVariables     = get_defined_vars();
-        $newVariableNames = array_diff(
-                              array_keys($newVariables), $oldVariableNames
-                            );
-
-        foreach ($newVariableNames as $variableName) {
-            if ($variableName != 'oldVariableNames') {
-                $GLOBALS[$variableName] = $newVariables[$variableName];
-            }
-        }
-
-        return $filename;
-    }
-
-    /**
-     * Uses a separate process to perform a syntax check on a PHP sourcefile.
-     *
-     * @param  string $filename
-     * @throws RuntimeException
-     * @since  Method available since Release 3.0.0
-     */
-    protected static function syntaxCheck($filename)
-    {
-        $command = PHPUnit_Util_PHP::getPhpBinary();
-
-        if (DIRECTORY_SEPARATOR == '\\') {
-            $command = escapeshellarg($command);
-        }
-
-        $command .= ' -l ' . escapeshellarg($filename);
-        $output   = shell_exec($command);
-
-        if (strpos($output, 'Errors parsing') !== FALSE) {
-            throw new RuntimeException($output);
-        }
-    }
-}
diff --git a/tests/PHPUnit/Util/Filesystem.php b/tests/PHPUnit/Util/Filesystem.php
deleted file mode 100644
index b36ad35..0000000
--- a/tests/PHPUnit/Util/Filesystem.php
+++ /dev/null
@@ -1,149 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Filesystem helpers.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Util_Filesystem
-{
-    /**
-     * @var array
-     */
-    protected static $buffer = array();
-
-    /**
-     * Maps class names to source file names:
-     *   - PEAR CS:   Foo_Bar_Baz -> Foo/Bar/Baz.php
-     *   - Namespace: Foo\Bar\Baz -> Foo/Bar/Baz.php
-     *
-     * @param  string $className
-     * @return string
-     * @since  Method available since Release 3.4.0
-     */
-    public static function classNameToFilename($className)
-    {
-        return str_replace(
-          array('_', '\\'),
-          DIRECTORY_SEPARATOR,
-          $className
-        ) . '.php';
-    }
-
-    /**
-     * Starts the collection of loaded files.
-     *
-     * @since  Method available since Release 3.3.0
-     */
-    public static function collectStart()
-    {
-        self::$buffer = get_included_files();
-    }
-
-    /**
-     * Stops the collection of loaded files and
-     * returns the names of the loaded files.
-     *
-     * @return array
-     * @since  Method available since Release 3.3.0
-     */
-    public static function collectEnd()
-    {
-        return array_values(
-          array_diff(get_included_files(), self::$buffer)
-        );
-    }
-
-    /**
-     * Stops the collection of loaded files and adds
-     * the names of the loaded files to the blacklist.
-     *
-     * @return array
-     * @since  Method available since Release 3.4.6
-     */
-    public static function collectEndAndAddToBlacklist()
-    {
-        foreach (self::collectEnd() as $blacklistedFile) {
-            PHP_CodeCoverage_Filter::getInstance()->addFileToBlacklist(
-              $blacklistedFile, 'PHPUNIT'
-            );
-        }
-    }
-
-    /**
-     * Wrapper for file_exists() that searches the include_path.
-     *
-     * @param  string $file
-     * @return mixed
-     * @author Mattis Stordalen Flister <mattis@xait.no>
-     * @since  Method available since Release 3.2.9
-     */
-    public static function fileExistsInIncludePath($file)
-    {
-        if (file_exists($file)) {
-            return realpath($file);
-        }
-
-        $paths = explode(PATH_SEPARATOR, get_include_path());
-
-        foreach ($paths as $path) {
-            $fullpath = $path . DIRECTORY_SEPARATOR . $file;
-
-            if (file_exists($fullpath)) {
-                return realpath($fullpath);
-            }
-        }
-
-        return FALSE;
-    }
-}
diff --git a/tests/PHPUnit/Util/Filter.php b/tests/PHPUnit/Util/Filter.php
deleted file mode 100644
index c80321f..0000000
--- a/tests/PHPUnit/Util/Filter.php
+++ /dev/null
@@ -1,138 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-require_once 'File/Iterator/Factory.php';
-
-/**
- * Utility class for code filtering.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-class PHPUnit_Util_Filter
-{
-    /**
-     * Filters stack frames from PHPUnit classes.
-     *
-     * @param  Exception $e
-     * @param  boolean   $filterTests
-     * @param  boolean   $asString
-     * @return string
-     */
-    public static function getFilteredStacktrace(Exception $e, $filterTests = TRUE, $asString = TRUE)
-    {
-        if ($asString === TRUE) {
-            $filteredStacktrace = '';
-        } else {
-            $filteredStacktrace = array();
-        }
-
-        $groups = array('DEFAULT');
-
-        if (!defined('PHPUNIT_TESTSUITE')) {
-            $groups[] = 'PHPUNIT';
-        }
-
-        if ($filterTests) {
-            $groups[] = 'TESTS';
-        }
-
-        if ($e instanceof PHPUnit_Framework_SyntheticError) {
-            $eTrace = $e->getSyntheticTrace();
-        } else {
-            $eTrace = $e->getTrace();
-        }
-
-        if (!self::frameExists($eTrace, $e->getFile(), $e->getLine())) {
-            array_unshift(
-              $eTrace, array('file' => $e->getFile(), 'line' => $e->getLine())
-            );
-        }
-
-        foreach ($eTrace as $frame) {
-            if (isset($frame['file']) && is_file($frame['file']) &&
-                !PHP_CodeCoverage::getInstance()->filter()->isFiltered(
-                  $frame['file'], $groups, TRUE)) {
-                if ($asString === TRUE) {
-                    $filteredStacktrace .= sprintf(
-                      "%s:%s\n",
-
-                      $frame['file'],
-                      isset($frame['line']) ? $frame['line'] : '?'
-                    );
-                } else {
-                    $filteredStacktrace[] = $frame;
-                }
-            }
-        }
-
-        return $filteredStacktrace;
-    }
-
-    /**
-     * @param  array  $trace
-     * @param  string $file
-     * @param  int    $line
-     * @return boolean
-     * @since  Method available since Release 3.3.2
-     */
-    public static function frameExists(array $trace, $file, $line)
-    {
-        foreach ($trace as $frame) {
-            if (isset($frame['file']) && $frame['file'] == $file &&
-                isset($frame['line']) && $frame['line'] == $line) {
-                return TRUE;
-            }
-        }
-
-        return FALSE;
-    }
-}
diff --git a/tests/PHPUnit/Util/Getopt.php b/tests/PHPUnit/Util/Getopt.php
deleted file mode 100644
index 6ba821d..0000000
--- a/tests/PHPUnit/Util/Getopt.php
+++ /dev/null
@@ -1,208 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Command-line options parsing class.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Andrei Zmievski <andrei@php.net>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Util_Getopt
-{
-    public static function getopt(array $args, $short_options, $long_options = NULL)
-    {
-        if (empty($args)) {
-            return array(array(), array());
-        }
-
-        $opts     = array();
-        $non_opts = array();
-
-        if ($long_options) {
-            sort($long_options);
-        }
-
-        if (isset($args[0][0]) && $args[0][0] != '-') {
-            array_shift($args);
-        }
-
-        reset($args);
-        array_map('trim', $args);
-
-        while (list($i, $arg) = each($args)) {
-            if ($arg == '') {
-                continue;
-            }
-
-            if ($arg == '--') {
-                $non_opts = array_merge($non_opts, array_slice($args, $i + 1));
-                break;
-            }
-
-            if ($arg[0] != '-' ||
-                (strlen($arg) > 1 && $arg[1] == '-' && !$long_options)) {
-                $non_opts = array_merge($non_opts, array_slice($args, $i));
-                break;
-            }
-
-            elseif (strlen($arg) > 1 && $arg[1] == '-') {
-                self::parseLongOption(
-                  substr($arg, 2), $long_options, $opts, $args
-                );
-            }
-
-            else {
-                self::parseShortOption(
-                  substr($arg, 1), $short_options, $opts, $args
-                );
-            }
-        }
-
-        return array($opts, $non_opts);
-    }
-
-    protected static function parseShortOption($arg, $short_options, &$opts, &$args)
-    {
-        $argLen = strlen($arg);
-
-        for ($i = 0; $i < $argLen; $i++) {
-            $opt     = $arg[$i];
-            $opt_arg = NULL;
-
-            if (($spec = strstr($short_options, $opt)) === FALSE ||
-                $arg[$i] == ':') {
-                throw new PHPUnit_Framework_Exception(
-                  "unrecognized option -- $opt"
-                );
-            }
-
-            if (strlen($spec) > 1 && $spec[1] == ':') {
-                if (strlen($spec) > 2 && $spec[2] == ':') {
-                    if ($i + 1 < $argLen) {
-                        $opts[] = array($opt, substr($arg, $i + 1));
-                        break;
-                    }
-                } else {
-                    if ($i + 1 < $argLen) {
-                        $opts[] = array($opt, substr($arg, $i + 1));
-                        break;
-                    }
-
-                    else if (list(, $opt_arg) = each($args)) {
-                    }
-
-                    else {
-                        throw new PHPUnit_Framework_Exception(
-                          "option requires an argument -- $opt"
-                        );
-                    }
-                }
-            }
-
-            $opts[] = array($opt, $opt_arg);
-        }
-    }
-
-    protected static function parseLongOption($arg, $long_options, &$opts, &$args)
-    {
-        $count   = count($long_options);
-        $list    = explode('=', $arg);
-        $opt     = $list[0];
-        $opt_arg = NULL;
-
-        if (count($list) > 1) {
-            $opt_arg = $list[1];
-        }
-
-        $opt_len = strlen($opt);
-
-        for ($i = 0; $i < $count; $i++) {
-            $long_opt  = $long_options[$i];
-            $opt_start = substr($long_opt, 0, $opt_len);
-
-            if ($opt_start != $opt) {
-                continue;
-            }
-
-            $opt_rest = substr($long_opt, $opt_len);
-
-            if ($opt_rest != '' && $opt[0] != '=' && $i + 1 < $count &&
-                $opt == substr($long_options[$i+1], 0, $opt_len)) {
-                throw new PHPUnit_Framework_Exception(
-                  "option --$opt is ambiguous"
-                );
-            }
-
-            if (substr($long_opt, -1) == '=') {
-                if (substr($long_opt, -2) != '==') {
-                    if (!strlen($opt_arg) &&
-                        !(list(, $opt_arg) = each($args))) {
-                        throw new PHPUnit_Framework_Exception(
-                          "option --$opt requires an argument"
-                        );
-                    }
-                }
-            }
-
-            else if ($opt_arg) {
-                throw new PHPUnit_Framework_Exception(
-                  "option --$opt doesn't allow an argument"
-                );
-            }
-
-            $opts[] = array('--' . $opt, $opt_arg);
-            return;
-        }
-
-        throw new PHPUnit_Framework_Exception("unrecognized option --$opt");
-    }
-}
diff --git a/tests/PHPUnit/Util/GlobalState.php b/tests/PHPUnit/Util/GlobalState.php
deleted file mode 100644
index 3f27cee..0000000
--- a/tests/PHPUnit/Util/GlobalState.php
+++ /dev/null
@@ -1,348 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- *
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Util_GlobalState
-{
-    /**
-     * @var array
-     */
-    protected static $globals = array();
-
-    /**
-     * @var array
-     */
-    protected static $staticAttributes = array();
-
-    /**
-     * @var array
-     */
-    protected static $superGlobalArrays = array(
-      '_ENV',
-      '_POST',
-      '_GET',
-      '_COOKIE',
-      '_SERVER',
-      '_FILES',
-      '_REQUEST'
-    );
-
-    /**
-     * @var array
-     */
-    protected static $superGlobalArraysLong = array(
-      'HTTP_ENV_VARS',
-      'HTTP_POST_VARS',
-      'HTTP_GET_VARS',
-      'HTTP_COOKIE_VARS',
-      'HTTP_SERVER_VARS',
-      'HTTP_POST_FILES'
-    );
-
-    public static function backupGlobals(array $blacklist)
-    {
-        self::$globals     = array();
-        $superGlobalArrays = self::getSuperGlobalArrays();
-
-        foreach ($superGlobalArrays as $superGlobalArray) {
-            if (!in_array($superGlobalArray, $blacklist)) {
-                self::backupSuperGlobalArray($superGlobalArray);
-            }
-        }
-
-        foreach (array_keys($GLOBALS) as $key) {
-            if ($key != 'GLOBALS' &&
-                !in_array($key, $superGlobalArrays) &&
-                !in_array($key, $blacklist)) {
-                self::$globals['GLOBALS'][$key] = serialize($GLOBALS[$key]);
-            }
-        }
-    }
-
-    public static function restoreGlobals(array $blacklist)
-    {
-        if (ini_get('register_long_arrays') == '1') {
-            $superGlobalArrays = array_merge(
-              self::$superGlobalArrays, self::$superGlobalArraysLong
-            );
-        } else {
-            $superGlobalArrays = self::$superGlobalArrays;
-        }
-
-        foreach ($superGlobalArrays as $superGlobalArray) {
-            if (!in_array($superGlobalArray, $blacklist)) {
-                self::restoreSuperGlobalArray($superGlobalArray);
-            }
-        }
-
-        foreach (array_keys($GLOBALS) as $key) {
-            if ($key != 'GLOBALS' &&
-                !in_array($key, $superGlobalArrays) &&
-                !in_array($key, $blacklist)) {
-                if (isset(self::$globals['GLOBALS'][$key])) {
-                    $GLOBALS[$key] = unserialize(
-                      self::$globals['GLOBALS'][$key]
-                    );
-                } else {
-                    unset($GLOBALS[$key]);
-                }
-            }
-        }
-
-        self::$globals = array();
-    }
-
-    protected static function backupSuperGlobalArray($superGlobalArray)
-    {
-        self::$globals[$superGlobalArray] = array();
-
-        if (isset($GLOBALS[$superGlobalArray]) &&
-            is_array($GLOBALS[$superGlobalArray])) {
-            foreach ($GLOBALS[$superGlobalArray] as $key => $value) {
-                self::$globals[$superGlobalArray][$key] = serialize($value);
-            }
-        }
-    }
-
-    protected static function restoreSuperGlobalArray($superGlobalArray)
-    {
-        if (isset($GLOBALS[$superGlobalArray]) &&
-            is_array($GLOBALS[$superGlobalArray]) &&
-            isset(self::$globals[$superGlobalArray])) {
-            $keys = array_keys(
-              array_merge(
-                $GLOBALS[$superGlobalArray], self::$globals[$superGlobalArray]
-              )
-            );
-
-            foreach ($keys as $key) {
-                if (isset(self::$globals[$superGlobalArray][$key])) {
-                    $GLOBALS[$superGlobalArray][$key] = unserialize(
-                      self::$globals[$superGlobalArray][$key]
-                    );
-                } else {
-                    unset($GLOBALS[$superGlobalArray][$key]);
-                }
-            }
-        }
-
-        self::$globals[$superGlobalArray] = array();
-    }
-
-    public static function getIncludedFilesAsString()
-    {
-        $blacklist = PHP_CodeCoverage::getInstance()->filter()->getBlacklist();
-        $blacklist = array_flip($blacklist['PHPUNIT']);
-        $files     = get_included_files();
-        $result    = '';
-
-        for ($i = count($files) - 1; $i > 0; $i--) {
-            if (!isset($blacklist[$files[$i]]) && is_file($files[$i])) {
-                $result = 'require_once \'' . $files[$i] . "';\n" . $result;
-            }
-        }
-
-        return $result;
-    }
-
-    public static function getConstantsAsString()
-    {
-        $constants = get_defined_constants(TRUE);
-        $result    = '';
-
-        if (isset($constants['user'])) {
-            foreach ($constants['user'] as $name => $value) {
-                $result .= sprintf(
-                  'if (!defined(\'%s\')) define(\'%s\', %s);' . "\n",
-                  $name,
-                  $name,
-                  self::exportVariable($value)
-                );
-            }
-        }
-
-        return $result;
-    }
-
-    public static function getGlobalsAsString()
-    {
-        $result            = '';
-        $superGlobalArrays = self::getSuperGlobalArrays();
-
-        foreach ($superGlobalArrays as $superGlobalArray) {
-            if (isset($GLOBALS[$superGlobalArray]) &&
-                is_array($GLOBALS[$superGlobalArray])) {
-                foreach (array_keys($GLOBALS[$superGlobalArray]) as $key) {
-                    $result .= sprintf(
-                      '$GLOBALS[\'%s\'][\'%s\'] = %s;' . "\n",
-                      $superGlobalArray,
-                      $key,
-                      self::exportVariable($GLOBALS[$superGlobalArray][$key])
-                    );
-                }
-            }
-        }
-
-        $blacklist   = $superGlobalArrays;
-        $blacklist[] = 'GLOBALS';
-        $blacklist[] = '_PEAR_Config_instance';
-
-        foreach (array_keys($GLOBALS) as $key) {
-            if (!in_array($key, $blacklist)) {
-                $result .= sprintf(
-                  '$GLOBALS[\'%s\'] = %s;' . "\n",
-                  $key,
-                  self::exportVariable($GLOBALS[$key])
-                );
-            }
-        }
-
-        return $result;
-    }
-
-    protected static function getSuperGlobalArrays()
-    {
-        if (ini_get('register_long_arrays') == '1') {
-            return array_merge(
-              self::$superGlobalArrays, self::$superGlobalArraysLong
-            );
-        } else {
-            return self::$superGlobalArrays;
-        }
-    }
-
-    public static function backupStaticAttributes(array $blacklist)
-    {
-        self::$staticAttributes = array();
-        $declaredClasses        = get_declared_classes();
-        $declaredClassesNum     = count($declaredClasses);
-
-        for ($i = $declaredClassesNum - 1; $i >= 0; $i--) {
-            if (strpos($declaredClasses[$i], 'PHPUnit') !== 0 &&
-                !$declaredClasses[$i] instanceof PHPUnit_Framework_Test) {
-                $class = new ReflectionClass($declaredClasses[$i]);
-
-                if (!$class->isUserDefined()) {
-                    break;
-                }
-
-                $backup = array();
-
-                foreach ($class->getProperties() as $attribute) {
-                    if ($attribute->isStatic()) {
-                        $name = $attribute->getName();
-
-                        if (!isset($blacklist[$declaredClasses[$i]]) ||
-                           !in_array($name, $blacklist[$declaredClasses[$i]])) {
-                            $attribute->setAccessible(TRUE);
-                            $backup[$name] = serialize($attribute->getValue());
-                        }
-                    }
-                }
-
-                if (!empty($backup)) {
-                    self::$staticAttributes[$declaredClasses[$i]] = $backup;
-                }
-            }
-        }
-    }
-
-    public static function restoreStaticAttributes()
-    {
-        foreach (self::$staticAttributes as $className => $staticAttributes) {
-            foreach ($staticAttributes as $name => $value) {
-                $reflector = new ReflectionProperty($className, $name);
-                $reflector->setAccessible(TRUE);
-                $reflector->setValue(unserialize($value));
-            }
-        }
-
-        self::$staticAttributes = array();
-    }
-
-    protected static function exportVariable($variable)
-    {
-        if (is_scalar($variable) || is_null($variable) ||
-           (is_array($variable) && self::arrayOnlyContainsScalars($variable))) {
-            return var_export($variable, TRUE);
-        }
-
-        return 'unserialize(\'' .
-                str_replace("'", "\'", serialize($variable)) .
-                '\')';
-    }
-
-    protected static function arrayOnlyContainsScalars(array $array)
-    {
-        $result = TRUE;
-
-        foreach ($array as $element) {
-            if (is_array($element)) {
-                $result = self::arrayOnlyContainsScalars($element);
-            }
-
-            else if (!is_scalar($element) && !is_null($element)) {
-                $result = FALSE;
-            }
-
-            if ($result === FALSE) {
-                break;
-            }
-        }
-
-        return $result;
-    }
-}
diff --git a/tests/PHPUnit/Util/InvalidArgumentHelper.php b/tests/PHPUnit/Util/InvalidArgumentHelper.php
deleted file mode 100644
index 9f7528c..0000000
--- a/tests/PHPUnit/Util/InvalidArgumentHelper.php
+++ /dev/null
@@ -1,80 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- * Factory for InvalidArgumentException objects.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Util_InvalidArgumentHelper
-{
-    /**
-     * @param integer $argument
-     * @param string  $type
-     * @param mixed   $value
-     */
-    public static function factory($argument, $type, $value = NULL)
-    {
-        $stack = debug_backtrace(FALSE);
-
-        return new InvalidArgumentException(
-          sprintf(
-            'Argument #%d%sof %s::%s() must be a %s',
-            $argument,
-            $value !== NULL ? ' (' . $value . ')' : ' ',
-            $stack[1]['class'],
-            $stack[1]['function'],
-            $type
-          )
-        );
-    }
-}
diff --git a/tests/PHPUnit/Util/Log/DBUS.php b/tests/PHPUnit/Util/Log/DBUS.php
deleted file mode 100644
index f1185fd..0000000
--- a/tests/PHPUnit/Util/Log/DBUS.php
+++ /dev/null
@@ -1,226 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Benjamin Eberlei <kontakt@beberlei.de>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * A TestListener that integrates with DBUS.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Benjamin Eberlei <kontakt@beberlei.de>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.5.0
- */
-class PHPUnit_Util_Log_DBUS implements PHPUnit_Framework_TestListener
-{
-    /**
-     * @var integer
-     */
-    protected $errors = 0;
-
-    /**
-     * @var integer
-     */
-    protected $failures = 0;
-
-    /**
-     * @var integer
-     */
-    protected $startTime = NULL;
-
-    /**
-     * @var string
-     */
-    protected $suiteName = '';
-
-    /**
-     * @var integer
-     */
-    protected $tests = 0;
-
-    /**
-     * @var integer
-     */
-    protected $startedSuites = 0;
-
-    /**
-     * @var integer
-     */
-    protected $endedSuites = 0;
-
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->errors++;
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-        $this->failures++;
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     * @since  Method available since Release 3.0.0
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * A test suite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        if($this->startedSuites == 0) {
-            $this->startTime = time();
-            $this->suiteName = $suite->getName();
-        }
-
-        $this->startedSuites++;
-    }
-
-    /**
-     * A test suite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->endedSuites++;
-
-        if($this->startedSuites <= $this->endedSuites) {
-            $this->notify();
-        }
-    }
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        $this->tests++;
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-    }
-
-    /**
-     *
-     */
-    protected function notify()
-    {
-        $d = new Dbus(Dbus::BUS_SESSION);
-
-        $n = $d->createProxy(
-          'org.freedesktop.Notifications',
-          '/org/freedesktop/Notifications',
-          'org.freedesktop.Notifications'
-        );
-
-        $n->Notify(
-          'PHPUnit_Util_Log_DBUS',
-          new DBusUInt32(0),
-          'phpunit',
-          'PHPUnit Test Report',
-          sprintf(
-            "Suite: %s\n%d tests run in %s minutes.\n%d errors, %d failures",
-            $this->suiteName,
-            $this->tests,
-            (date('i:s', time() - $this->startTime)),
-            $this->errors,
-            $this->failures
-          ),
-          new DBusArray(DBus::STRING, array()),
-          new DBusDict(DBus::VARIANT, array()),
-          1000
-        );
-    }
-}
diff --git a/tests/PHPUnit/Util/Log/JSON.php b/tests/PHPUnit/Util/Log/JSON.php
deleted file mode 100644
index 9edb1d3..0000000
--- a/tests/PHPUnit/Util/Log/JSON.php
+++ /dev/null
@@ -1,240 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * A TestListener that generates JSON messages.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Util_Log_JSON extends PHPUnit_Util_Printer implements PHPUnit_Framework_TestListener
-{
-    /**
-     * @var    string
-     */
-    protected $currentTestSuiteName = '';
-
-    /**
-     * @var    string
-     */
-    protected $currentTestName = '';
-
-    /**
-     * @var     boolean
-     * @access  private
-     */
-    protected $currentTestPass = TRUE;
-
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeCase(
-          'error',
-          $time,
-          PHPUnit_Util_Filter::getFilteredStacktrace(
-            $e,
-            TRUE,
-            FALSE
-          ),
-          $e->getMessage()
-        );
-
-        $this->currentTestPass = FALSE;
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-        $this->writeCase(
-          'fail',
-          $time,
-          PHPUnit_Util_Filter::getFilteredStacktrace(
-            $e,
-            TRUE,
-            FALSE
-          ),
-          $e->getMessage()
-        );
-
-        $this->currentTestPass = FALSE;
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeCase('error', $time, array(), 'Incomplete Test');
-
-        $this->currentTestPass = FALSE;
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeCase('error', $time, array(), 'Skipped Test');
-
-        $this->currentTestPass = FALSE;
-    }
-
-    /**
-     * A testsuite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->currentTestSuiteName = $suite->getName();
-        $this->currentTestName      = '';
-
-        $this->write(
-          array(
-            'event' => 'suiteStart',
-            'suite' => $this->currentTestSuiteName,
-            'tests' => count($suite)
-          )
-        );
-    }
-
-    /**
-     * A testsuite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->currentTestSuiteName = '';
-        $this->currentTestName      = '';
-    }
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        $this->currentTestName = PHPUnit_Util_Test::describe($test);
-        $this->currentTestPass = TRUE;
-
-        $this->write(
-          array(
-            'event' => 'testStart',
-            'suite' => $this->currentTestSuiteName,
-            'test'  => $this->currentTestName
-          )
-        );
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        if ($this->currentTestPass) {
-            $this->writeCase('pass', $time);
-        }
-    }
-
-    /**
-     * @param string $status
-     * @param float  $time
-     * @param array  $trace
-     * @param string $message
-     */
-    protected function writeCase($status, $time, array $trace = array(), $message = '')
-    {
-        $this->write(
-          array(
-            'event'   => 'test',
-            'suite'   => $this->currentTestSuiteName,
-            'test'    => $this->currentTestName,
-            'status'  => $status,
-            'time'    => $time,
-            'trace'   => $trace,
-            'message' => $message
-          )
-        );
-    }
-
-    /**
-     * @param string $buffer
-     */
-    public function write($buffer)
-    {
-        parent::write(json_encode($buffer));
-    }
-}
diff --git a/tests/PHPUnit/Util/Log/JUnit.php b/tests/PHPUnit/Util/Log/JUnit.php
deleted file mode 100644
index fb9adfe..0000000
--- a/tests/PHPUnit/Util/Log/JUnit.php
+++ /dev/null
@@ -1,485 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.3.0
- */
-
-/**
- * A TestListener that generates a logfile of the test execution in XML markup.
- *
- * The XML markup used is the same as the one that is used by the JUnit Ant task.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.1.0
- */
-class PHPUnit_Util_Log_JUnit extends PHPUnit_Util_Printer implements PHPUnit_Framework_TestListener
-{
-    /**
-     * @var    DOMDocument
-     */
-    protected $document;
-
-    /**
-     * @var    DOMElement
-     */
-    protected $root;
-
-    /**
-     * @var    boolean
-     */
-    protected $logIncompleteSkipped = FALSE;
-
-    /**
-     * @var    boolean
-     */
-    protected $writeDocument = TRUE;
-
-    /**
-     * @var    DOMElement[]
-     */
-    protected $testSuites = array();
-
-    /**
-     * @var    integer[]
-     */
-    protected $testSuiteTests = array(0);
-
-    /**
-     * @var    integer[]
-     */
-    protected $testSuiteAssertions = array(0);
-
-    /**
-     * @var    integer[]
-     */
-    protected $testSuiteErrors = array(0);
-
-    /**
-     * @var    integer[]
-     */
-    protected $testSuiteFailures = array(0);
-
-    /**
-     * @var    integer[]
-     */
-    protected $testSuiteTimes = array(0);
-
-    /**
-     * @var    integer
-     */
-    protected $testSuiteLevel = 0;
-
-    /**
-     * @var    DOMElement
-     */
-    protected $currentTestCase = NULL;
-
-    /**
-     * @var    boolean
-     */
-    protected $attachCurrentTestCase = TRUE;
-
-    /**
-     * Constructor.
-     *
-     * @param  mixed   $out
-     * @param  boolean $logIncompleteSkipped
-     */
-    public function __construct($out = NULL, $logIncompleteSkipped = FALSE)
-    {
-        $this->document = new DOMDocument('1.0', 'UTF-8');
-        $this->document->formatOutput = TRUE;
-
-        $this->root = $this->document->createElement('testsuites');
-        $this->document->appendChild($this->root);
-
-        parent::__construct($out);
-
-        $this->logIncompleteSkipped = $logIncompleteSkipped;
-    }
-
-    /**
-     * Flush buffer and close output.
-     *
-     */
-    public function flush()
-    {
-        if ($this->writeDocument === TRUE) {
-            $this->write($this->getXML());
-        }
-
-        parent::flush();
-    }
-
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        if ($this->currentTestCase !== NULL) {
-            if ($test instanceof PHPUnit_Framework_SelfDescribing) {
-                $buffer = $test->toString() . "\n";
-            } else {
-                $buffer = '';
-            }
-
-            $buffer .= PHPUnit_Framework_TestFailure::exceptionToString($e) .
-                       "\n" .
-                       PHPUnit_Util_Filter::getFilteredStacktrace($e, FALSE);
-
-            $error = $this->document->createElement(
-              'error', PHPUnit_Util_XML::prepareString($buffer)
-            );
-
-            $error->setAttribute('type', get_class($e));
-
-            $this->currentTestCase->appendChild($error);
-
-            $this->testSuiteErrors[$this->testSuiteLevel]++;
-        }
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-        if ($this->currentTestCase !== NULL) {
-            if (!$test instanceof PHPUnit_Framework_Warning) {
-                if ($test instanceof PHPUnit_Framework_SelfDescribing) {
-                    $buffer = $test->toString() . "\n";
-                } else {
-                    $buffer = '';
-                }
-
-                $buffer .= PHPUnit_Framework_TestFailure::exceptionToString($e).
-                           "\n" .
-                           PHPUnit_Util_Filter::getFilteredStacktrace(
-                             $e, FALSE
-                           );
-
-                $failure = $this->document->createElement(
-                  'failure', PHPUnit_Util_XML::prepareString($buffer)
-                );
-
-                $failure->setAttribute('type', get_class($e));
-
-                $this->currentTestCase->appendChild($failure);
-
-                $this->testSuiteFailures[$this->testSuiteLevel]++;
-            }
-        }
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        if ($this->logIncompleteSkipped && $this->currentTestCase !== NULL) {
-            $error = $this->document->createElement(
-              'error',
-              PHPUnit_Util_XML::prepareString(
-                "Incomplete Test\n" .
-                PHPUnit_Util_Filter::getFilteredStacktrace($e, FALSE)
-              )
-            );
-
-            $error->setAttribute('type', get_class($e));
-
-            $this->currentTestCase->appendChild($error);
-
-            $this->testSuiteErrors[$this->testSuiteLevel]++;
-        } else {
-            $this->attachCurrentTestCase = FALSE;
-        }
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     * @since  Method available since Release 3.0.0
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        if ($this->logIncompleteSkipped && $this->currentTestCase !== NULL) {
-            $error = $this->document->createElement(
-              'error',
-              PHPUnit_Util_XML::prepareString(
-                "Skipped Test\n" .
-                PHPUnit_Util_Filter::getFilteredStacktrace($e, FALSE)
-              )
-            );
-
-            $error->setAttribute('type', get_class($e));
-
-            $this->currentTestCase->appendChild($error);
-
-            $this->testSuiteErrors[$this->testSuiteLevel]++;
-        } else {
-            $this->attachCurrentTestCase = FALSE;
-        }
-    }
-
-    /**
-     * A testsuite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $testSuite = $this->document->createElement('testsuite');
-        $testSuite->setAttribute('name', $suite->getName());
-
-        if (class_exists($suite->getName(), FALSE)) {
-            try {
-                $class = new ReflectionClass($suite->getName());
-
-                $testSuite->setAttribute('file', $class->getFileName());
-
-                $packageInformation = PHPUnit_Util_Class::getPackageInformation(
-                  $suite->getName(), $class->getDocComment()
-                );
-
-                if (!empty($packageInformation['namespace'])) {
-                    $testSuite->setAttribute(
-                      'namespace', $packageInformation['namespace']
-                    );
-                }
-
-                if (!empty($packageInformation['fullPackage'])) {
-                    $testSuite->setAttribute(
-                      'fullPackage', $packageInformation['fullPackage']
-                    );
-                }
-
-                if (!empty($packageInformation['category'])) {
-                    $testSuite->setAttribute(
-                      'category', $packageInformation['category']
-                    );
-                }
-
-                if (!empty($packageInformation['package'])) {
-                    $testSuite->setAttribute(
-                      'package', $packageInformation['package']
-                    );
-                }
-
-                if (!empty($packageInformation['subpackage'])) {
-                    $testSuite->setAttribute(
-                      'subpackage', $packageInformation['subpackage']
-                    );
-                }
-            }
-
-            catch (ReflectionException $e) {
-            }
-        }
-
-        if ($this->testSuiteLevel > 0) {
-            $this->testSuites[$this->testSuiteLevel]->appendChild($testSuite);
-        } else {
-            $this->root->appendChild($testSuite);
-        }
-
-        $this->testSuiteLevel++;
-        $this->testSuites[$this->testSuiteLevel]          = $testSuite;
-        $this->testSuiteTests[$this->testSuiteLevel]      = 0;
-        $this->testSuiteAssertions[$this->testSuiteLevel] = 0;
-        $this->testSuiteErrors[$this->testSuiteLevel]     = 0;
-        $this->testSuiteFailures[$this->testSuiteLevel]   = 0;
-        $this->testSuiteTimes[$this->testSuiteLevel]      = 0;
-    }
-
-    /**
-     * A testsuite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->testSuites[$this->testSuiteLevel]->setAttribute(
-          'tests', $this->testSuiteTests[$this->testSuiteLevel]
-        );
-
-        $this->testSuites[$this->testSuiteLevel]->setAttribute(
-          'assertions', $this->testSuiteAssertions[$this->testSuiteLevel]
-        );
-
-        $this->testSuites[$this->testSuiteLevel]->setAttribute(
-          'failures', $this->testSuiteFailures[$this->testSuiteLevel]
-        );
-
-        $this->testSuites[$this->testSuiteLevel]->setAttribute(
-          'errors', $this->testSuiteErrors[$this->testSuiteLevel]
-        );
-
-        $this->testSuites[$this->testSuiteLevel]->setAttribute(
-          'time', sprintf('%F', $this->testSuiteTimes[$this->testSuiteLevel])
-        );
-
-        if ($this->testSuiteLevel > 1) {
-            $this->testSuiteTests[$this->testSuiteLevel - 1]      += $this->testSuiteTests[$this->testSuiteLevel];
-            $this->testSuiteAssertions[$this->testSuiteLevel - 1] += $this->testSuiteAssertions[$this->testSuiteLevel];
-            $this->testSuiteErrors[$this->testSuiteLevel - 1]     += $this->testSuiteErrors[$this->testSuiteLevel];
-            $this->testSuiteFailures[$this->testSuiteLevel - 1]   += $this->testSuiteFailures[$this->testSuiteLevel];
-            $this->testSuiteTimes[$this->testSuiteLevel - 1]      += $this->testSuiteTimes[$this->testSuiteLevel];
-        }
-
-        $this->testSuiteLevel--;
-    }
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        if (!$test instanceof PHPUnit_Framework_Warning) {
-            $testCase = $this->document->createElement('testcase');
-            $testCase->setAttribute('name', $test->getName());
-
-            if ($test instanceof PHPUnit_Framework_TestCase) {
-                $class      = new ReflectionClass($test);
-                $methodName = $test->getName();
-
-                if ($class->hasMethod($methodName)) {
-                    $method = $class->getMethod($test->getName());
-
-                    $testCase->setAttribute('class', $class->getName());
-                    $testCase->setAttribute('file', $class->getFileName());
-                    $testCase->setAttribute('line', $method->getStartLine());
-                }
-            }
-
-            $this->currentTestCase = $testCase;
-        }
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        if (!$test instanceof PHPUnit_Framework_Warning) {
-            if ($this->attachCurrentTestCase) {
-                if ($test instanceof PHPUnit_Framework_TestCase) {
-                    $numAssertions = $test->getNumAssertions();
-                    $this->testSuiteAssertions[$this->testSuiteLevel] += $numAssertions;
-
-                    $this->currentTestCase->setAttribute(
-                      'assertions', $numAssertions
-                    );
-                }
-
-                $this->currentTestCase->setAttribute(
-                  'time', sprintf('%F', $time)
-                );
-
-                $this->testSuites[$this->testSuiteLevel]->appendChild(
-                  $this->currentTestCase
-                );
-
-                $this->testSuiteTests[$this->testSuiteLevel]++;
-                $this->testSuiteTimes[$this->testSuiteLevel] += $time;
-            }
-        }
-
-        $this->attachCurrentTestCase = TRUE;
-        $this->currentTestCase       = NULL;
-    }
-
-    /**
-     * Returns the XML as a string.
-     *
-     * @return string
-     * @since  Method available since Release 2.2.0
-     */
-    public function getXML()
-    {
-        return $this->document->saveXML();
-    }
-
-    /**
-     * Enables or disables the writing of the document
-     * in flush().
-     *
-     * This is a "hack" needed for the integration of
-     * PHPUnit with Phing.
-     *
-     * @return string
-     * @since  Method available since Release 2.2.0
-     */
-    public function setWriteDocument($flag)
-    {
-        if (is_bool($flag)) {
-            $this->writeDocument = $flag;
-        }
-    }
-}
diff --git a/tests/PHPUnit/Util/Log/TAP.php b/tests/PHPUnit/Util/Log/TAP.php
deleted file mode 100644
index 02216b1..0000000
--- a/tests/PHPUnit/Util/Log/TAP.php
+++ /dev/null
@@ -1,253 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-require_once 'SymfonyComponents/YAML/sfYamlDumper.php';
-
-/**
- * A TestListener that generates a logfile of the
- * test execution using the Test Anything Protocol (TAP).
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Util_Log_TAP extends PHPUnit_Util_Printer implements PHPUnit_Framework_TestListener
-{
-    /**
-     * @var    integer
-     */
-    protected $testNumber = 0;
-
-    /**
-     * @var    integer
-     */
-    protected $testSuiteLevel = 0;
-
-    /**
-     * @var    boolean
-     */
-    protected $testSuccessful = TRUE;
-
-    /**
-     * Constructor.
-     *
-     * @param  mixed $out
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.3.4
-     */
-    public function __construct($out = NULL)
-    {
-        parent::__construct($out);
-        $this->write("TAP version 13\n");
-    }
-
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeNotOk($test, 'Error');
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-        $this->writeNotOk($test, 'Failure');
-
-        $message = explode(
-          "\n", PHPUnit_Framework_TestFailure::exceptionToString($e)
-        );
-
-        $diagnostic = array(
-          'message'  => $message[0],
-          'severity' => 'fail'
-        );
-
-        if ($e instanceof PHPUnit_Framework_ExpectationFailedException) {
-            $cf = $e->getComparisonFailure();
-
-            if ($cf !== NULL) {
-                $diagnostic['data'] = array(
-                  'got'      => $cf->getActual(),
-                  'expected' => $cf->getExpected()
-                );
-            }
-        }
-
-        $yaml = new sfYamlDumper();
-
-        $this->write(
-          sprintf(
-            "  ---\n%s  ...\n",
-            $yaml->dump($diagnostic, 2, 2)
-          )
-        );
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->writeNotOk($test, '', 'TODO Incomplete Test');
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     * @since  Method available since Release 3.0.0
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        $this->write(
-          sprintf(
-            "ok %d - # SKIP%s\n",
-
-            $this->testNumber,
-            $e->getMessage() != '' ? ' ' . $e->getMessage() : ''
-          )
-        );
-
-        $this->testSuccessful = FALSE;
-    }
-
-    /**
-     * A testsuite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->testSuiteLevel++;
-    }
-
-    /**
-     * A testsuite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->testSuiteLevel--;
-
-        if ($this->testSuiteLevel == 0) {
-            $this->write(sprintf("1..%d\n", $this->testNumber));
-        }
-    }
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        $this->testNumber++;
-        $this->testSuccessful = TRUE;
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        if ($this->testSuccessful === TRUE) {
-            $this->write(
-              sprintf(
-                "ok %d - %s\n",
-
-                $this->testNumber,
-                PHPUnit_Util_Test::describe($test)
-              )
-            );
-        }
-    }
-
-    /**
-     * @param  PHPUnit_Framework_Test $test
-     * @param  string                 $prefix
-     * @param  string                 $directive
-     */
-    protected function writeNotOk(PHPUnit_Framework_Test $test, $prefix = '', $directive = '')
-    {
-        $this->write(
-          sprintf(
-            "not ok %d - %s%s%s\n",
-
-            $this->testNumber,
-            $prefix != '' ? $prefix . ': ' : '',
-            PHPUnit_Util_Test::describe($test),
-            $directive != '' ? ' # ' . $directive : ''
-          )
-        );
-
-        $this->testSuccessful = FALSE;
-    }
-}
diff --git a/tests/PHPUnit/Util/Log/XHProf.php b/tests/PHPUnit/Util/Log/XHProf.php
deleted file mode 100644
index 22994cf..0000000
--- a/tests/PHPUnit/Util/Log/XHProf.php
+++ /dev/null
@@ -1,252 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Benjamin Eberlei <kontakt@beberlei.de>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.5.0
- */
-
-/**
- * A TestListener that integrates with XHProf.
- *
- * Here is an example XML configuration for activating this listener:
- *
- * <code>
- * <listeners>
- *  <listener class="PHPUnit_Util_Log_XHProf" file="PHPUnit/Util/Log/XHProf.php">
- *   <arguments>
- *    <array>
- *     <element key="xhprofLibFile">
- *      <string>/var/www/xhprof_lib/utils/xhprof_lib.php</string>
- *     </element>
- *     <element key="xhprofRunsFile">
- *      <string>/var/www/xhprof_lib/utils/xhprof_runs.php</string>
- *     </element>
- *     <element key="xhprofWeb">
- *      <string>http://localhost/xhprof_html/index.php</string>
- *     </element>
- *     <element key="appNamespace">
- *      <string>Doctrine2</string>
- *     </element>
- *     <element key="xhprofFlags">
- *      <string>XHPROF_FLAGS_CPU,XHPROF_FLAGS_MEMORY</string>
- *     </element>
- *    </array>
- *   </arguments>
- *  </listener>
- * </listeners>
- * </code>
- *
- * @package    PHPUnit
- * @subpackage Util_Log
- * @author     Benjamin Eberlei <kontakt@beberlei.de>
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.5.0
- */
-class PHPUnit_Util_Log_XHProf implements PHPUnit_Framework_TestListener
-{
-    /**
-     * @var array
-     */
-    protected $runs = array();
-
-    /**
-     * @var array
-     */
-    protected $options = array();
-
-    /**
-     * @var integer
-     */
-    protected $suites = 0;
-
-    /**
-     * Constructor.
-     *
-     * @param array $options
-     */
-    public function __construct(array $options = array())
-    {
-        if (!extension_loaded('xhprof')) {
-            throw new RuntimeException(
-              'The XHProf extension is required for this listener to work.'
-            );
-        }
-
-        if (!isset($options['appNamespace'])) {
-            throw new InvalidArgumentException(
-              'The "appNamespace" option is not set.'
-            );
-        }
-
-        if (!isset($options['xhprofLibFile']) ||
-            !file_exists($options['xhprofLibFile'])) {
-            throw new InvalidArgumentException(
-              'The "xhprofLibFile" option is not set or the configured file does not exist'
-            );
-        }
-
-        if (!isset($options['xhprofRunsFile']) ||
-            !file_exists($options['xhprofRunsFile'])) {
-            throw new InvalidArgumentException(
-              'The "xhprofRunsFile" option is not set or the configured file does not exist'
-            );
-        }
-
-        require_once $options['xhprofLibFile'];
-        require_once $options['xhprofRunsFile'];
-
-        $this->options = $options;
-    }
-
-    /**
-     * An error occurred.
-     *
-     * @param PHPUnit_Framework_Test $test
-     * @param Exception              $e
-     * @param float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param PHPUnit_Framework_Test                 $test
-     * @param PHPUnit_Framework_AssertionFailedError $e
-     * @param float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param PHPUnit_Framework_Test $test
-     * @param Exception              $e
-     * @param float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param PHPUnit_Framework_Test $test
-     * @param Exception              $e
-     * @param float                  $time
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-    }
-
-    /**
-     * A test started.
-     *
-     * @param PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        if (!isset($this->options['xhprofFlags'])) {
-            $flags = XHPROF_FLAGS_CPU + XHPROF_FLAGS_MEMORY;
-        } else {
-            $flags = 0;
-
-            foreach (explode(',', $this->options['xhprofFlags']) as $flag) {
-                $flags += constant($flag);
-            }
-        }
-
-        xhprof_enable($flags);
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param PHPUnit_Framework_Test $test
-     * @param float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        $data         = xhprof_disable();
-        $runs         = new XHProfRuns_Default;
-        $run          = $runs->save_run($data, $this->options['appNamespace']);
-        $this->runs[] = $this->options['xhprofWeb'] . '?run=' . $run .
-                        '&source=' . $this->options['appNamespace'];
-    }
-
-    /**
-     * A test suite started.
-     *
-     * @param PHPUnit_Framework_TestSuite $suite
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->suites++;
-    }
-
-    /**
-     * A test suite ended.
-     *
-     * @param PHPUnit_Framework_TestSuite $suite
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-        $this->suites--;
-
-        if ($this->suites == 0) {
-            print "\n\nXHProf runs: " . count($this->runs) . "\n";
-
-            foreach ($this->runs as $run) {
-                print ' * ' . $run . "\n";
-            }
-
-            print "\n";
-        }
-    }
-}
diff --git a/tests/PHPUnit/Util/PHP.php b/tests/PHPUnit/Util/PHP.php
deleted file mode 100644
index c70e099..0000000
--- a/tests/PHPUnit/Util/PHP.php
+++ /dev/null
@@ -1,249 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.4.0
- */
-
-/**
- * Utility methods for PHP sub-processes.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.4.0
- */
-class PHPUnit_Util_PHP
-{
-    /**
-     * Path to the PHP interpreter that is to be used.
-     *
-     * @var    string $phpBinary
-     */
-    protected static $phpBinary = NULL;
-
-    /**
-     * Descriptor specification for proc_open().
-     *
-     * @var    array
-     */
-    protected static $descriptorSpec = array(
-      0 => array('pipe', 'r'),
-      1 => array('pipe', 'w'),
-      2 => array('pipe', 'w')
-    );
-
-    /**
-     * Returns the path to a PHP interpreter.
-     *
-     * PHPUnit_Util_PHP::$phpBinary contains the path to the PHP
-     * interpreter.
-     *
-     * When not set, the following assumptions will be made:
-     *
-     *   1. When the PHP CLI/CGI binary configured with the PEAR Installer
-     *      (php_bin configuration value) is readable, it will be used.
-     *
-     *   2. When PHPUnit is run using the CLI SAPI and the $_SERVER['_']
-     *      variable does not contain the string "PHPUnit", $_SERVER['_']
-     *      is assumed to contain the path to the current PHP interpreter
-     *      and that will be used.
-     *
-     *   3. When PHPUnit is run using the CLI SAPI and the $_SERVER['_']
-     *      variable contains the string "PHPUnit", the file that $_SERVER['_']
-     *      points to is assumed to be the PHPUnit TextUI CLI wrapper script
-     *      "phpunit" and the binary set up using #! on that file's first
-     *      line of code is assumed to contain the path to the current PHP
-     *      interpreter and that will be used.
-     *
-     *   4. The current PHP interpreter is assumed to be in the $PATH and
-     *      to be invokable through "php".
-     *
-     * @return string
-     */
-    public static function getPhpBinary()
-    {
-        if (self::$phpBinary === NULL) {
-            if (is_readable('@php_bin@')) {
-                self::$phpBinary = '@php_bin@';
-            }
-
-            else if (PHP_SAPI == 'cli' && isset($_SERVER['_']) &&
-                     strpos($_SERVER['_'], 'phpunit') !== FALSE) {
-                $file            = file($_SERVER['_']);
-                $tmp             = explode(' ', $file[0]);
-                self::$phpBinary = trim($tmp[1]);
-            }
-
-            if (!is_readable(self::$phpBinary)) {
-                self::$phpBinary = 'php';
-            } else {
-                self::$phpBinary = escapeshellarg(self::$phpBinary);
-            }
-        }
-
-        return self::$phpBinary;
-    }
-
-    /**
-     * Runs a single job (PHP code) using a separate PHP process.
-     *
-     * @param  string                       $job
-     * @param  PHPUnit_Framework_TestCase   $test
-     * @param  PHPUnit_Framework_TestResult $result
-     * @return array|null
-     */
-    public static function runJob($job, PHPUnit_Framework_Test $test = NULL, PHPUnit_Framework_TestResult $result = NULL)
-    {
-        $process = proc_open(
-          self::getPhpBinary(), self::$descriptorSpec, $pipes
-        );
-
-        if (is_resource($process)) {
-            if ($result !== NULL) {
-                $result->startTest($test);
-            }
-
-            fwrite($pipes[0], $job);
-            fclose($pipes[0]);
-
-            $stdout = stream_get_contents($pipes[1]);
-            fclose($pipes[1]);
-
-            $stderr = stream_get_contents($pipes[2]);
-            fclose($pipes[2]);
-
-            proc_close($process);
-
-            if ($result !== NULL) {
-                self::processChildResult($test, $result, $stdout, $stderr);
-            } else {
-                return array('stdout' => $stdout, 'stderr' => $stderr);
-            }
-        }
-    }
-
-    /**
-     * Runs a single job (PHP code) using a separate PHP process.
-     *
-     * @param PHPUnit_Framework_TestCase   $test
-     * @param PHPUnit_Framework_TestResult $result
-     * @param string                       $stdout
-     * @param string                       $stderr
-     * @since Method available since Release 3.5.0
-     */
-    protected static function processChildResult(PHPUnit_Framework_Test $test, PHPUnit_Framework_TestResult $result, $stdout, $stderr)
-    {
-        if (!empty($stderr)) {
-            $time = 0;
-            $result->addError(
-              $test,
-              new RuntimeException(trim($stderr)), $time
-            );
-        } else {
-            $childResult = @unserialize($stdout);
-
-            if ($childResult !== FALSE) {
-                if (!empty($childResult['output'])) {
-                    print $childResult['output'];
-                }
-
-                $test->setResult($childResult['testResult']);
-                $test->addToAssertionCount($childResult['numAssertions']);
-
-                $childResult = $childResult['result'];
-
-                if ($result->getCollectCodeCoverageInformation()) {
-                    $codeCoverageInformation = $childResult->getRawCodeCoverageInformation();
-
-                    if (isset($codeCoverageInformation[0]) &&
-                         is_array($codeCoverageInformation[0])) {
-                        $result->getCodeCoverage()->append(
-                          $codeCoverageInformation[0], $test
-                        );
-                    }
-                }
-
-                $time           = $childResult->time();
-                $notImplemented = $childResult->notImplemented();
-                $skipped        = $childResult->skipped();
-                $errors         = $childResult->errors();
-                $failures       = $childResult->failures();
-
-                if (!empty($notImplemented)) {
-                    $result->addError(
-                      $test, $notImplemented[0]->thrownException(), $time
-                    );
-                }
-
-                else if (!empty($skipped)) {
-                    $result->addError(
-                      $test, $skipped[0]->thrownException(), $time
-                    );
-                }
-
-                else if (!empty($errors)) {
-                    $result->addError(
-                      $test, $errors[0]->thrownException(), $time
-                    );
-                }
-
-                else if (!empty($failures)) {
-                    $result->addFailure(
-                      $test, $failures[0]->thrownException(), $time
-                    );
-                }
-            } else {
-                $time = 0;
-
-                $result->addError(
-                  $test, new RuntimeException(trim($stdout)), $time
-                );
-            }
-        }
-
-        $result->endTest($test, $time);
-    }
-}
diff --git a/tests/PHPUnit/Util/Printer.php b/tests/PHPUnit/Util/Printer.php
deleted file mode 100644
index fa6d011..0000000
--- a/tests/PHPUnit/Util/Printer.php
+++ /dev/null
@@ -1,203 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.0.0
- */
-
-/**
- * Utility class that can print to STDOUT or write to a file.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.0.0
- */
-abstract class PHPUnit_Util_Printer
-{
-    /**
-     * If TRUE, flush output after every write.
-     *
-     * @var boolean
-     */
-    protected $autoFlush = FALSE;
-
-    /**
-     * @var    resource
-     */
-    protected $out;
-
-    /**
-     * @var    string
-     */
-    protected $outTarget;
-
-    /**
-     * @var    boolean
-     */
-    protected $printsHTML = FALSE;
-
-    /**
-     * Constructor.
-     *
-     * @param  mixed $out
-     * @throws InvalidArgumentException
-     */
-    public function __construct($out = NULL)
-    {
-        if ($out !== NULL) {
-            if (is_string($out)) {
-                if (strpos($out, 'socket://') === 0) {
-                    $out = explode(':', str_replace('socket://', '', $out));
-
-                    if (sizeof($out) != 2) {
-                        throw new InvalidArgumentException;
-                    }
-
-                    $this->out = fsockopen($out[0], $out[1]);
-                } else {
-                    $this->out = fopen($out, 'wt');
-                }
-
-                $this->outTarget = $out;
-            } else {
-                $this->out = $out;
-            }
-        }
-    }
-
-    /**
-     * Flush buffer, optionally tidy up HTML, and close output.
-     */
-    public function flush()
-    {
-        if ($this->out !== NULL && $this->outTarget !== 'php://stderr') {
-            fclose($this->out);
-        }
-
-        if ($this->printsHTML === TRUE && $this->outTarget !== NULL &&
-            strpos($this->outTarget, 'php://') !== 0 &&
-            strpos($this->outTarget, 'socket://') !== 0 &&
-            extension_loaded('tidy')) {
-            file_put_contents(
-              $this->outTarget,
-              tidy_repair_file(
-                $this->outTarget, array('indent' => TRUE, 'wrap' => 0), 'utf8'
-              )
-            );
-        }
-    }
-
-    /**
-     * Performs a safe, incremental flush.
-     *
-     * Do not confuse this function with the flush() function of this class,
-     * since the flush() function may close the file being written to, rendering
-     * the current object no longer usable.
-     *
-     * @since  Method available since Release 3.3.0
-     */
-    public function incrementalFlush()
-    {
-        if ($this->out !== NULL) {
-            fflush($this->out);
-        } else {
-            flush();
-        }
-    }
-
-    /**
-     * @param  string $buffer
-     */
-    public function write($buffer)
-    {
-        if ($this->out !== NULL) {
-            fwrite($this->out, $buffer);
-
-            if ($this->autoFlush) {
-                $this->incrementalFlush();
-            }
-        } else {
-            if (PHP_SAPI != 'cli') {
-                $buffer = htmlspecialchars($buffer);
-            }
-
-            print $buffer;
-
-            if ($this->autoFlush) {
-                $this->incrementalFlush();
-            }
-        }
-    }
-
-    /**
-     * Check auto-flush mode.
-     *
-     * @return boolean
-     * @since  Method available since Release 3.3.0
-     */
-    public function getAutoFlush()
-    {
-        return $this->autoFlush;
-    }
-
-    /**
-     * Set auto-flushing mode.
-     *
-     * If set, *incremental* flushes will be done after each write. This should
-     * not be confused with the different effects of this class' flush() method.
-     *
-     * @param boolean $autoFlush
-     * @since  Method available since Release 3.3.0
-     */
-    public function setAutoFlush($autoFlush)
-    {
-        if (is_bool($autoFlush)) {
-            $this->autoFlush = $autoFlush;
-        } else {
-            throw PHPUnit_Util_InvalidArgumentHelper::factory(1, 'boolean');
-        }
-    }
-}
diff --git a/tests/PHPUnit/Util/Skeleton.php b/tests/PHPUnit/Util/Skeleton.php
deleted file mode 100644
index 98db865..0000000
--- a/tests/PHPUnit/Util/Skeleton.php
+++ /dev/null
@@ -1,146 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.1.0
- */
-
-/**
- * Generator for skeletons.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.1.0
- */
-abstract class PHPUnit_Util_Skeleton
-{
-    /**
-     * @var array
-     */
-    protected $inClassName;
-
-    /**
-     * @var string
-     */
-    protected $inSourceFile;
-
-    /**
-     * @var array
-     */
-    protected $outClassName;
-
-    /**
-     * @var string
-     */
-    protected $outSourceFile;
-
-    /**
-     * Constructor.
-     *
-     * @param string $inClassName
-     * @param string $inSourceFile
-     * @param string $outClassName
-     * @param string $outSourceFile
-     * @since Method available since Release 3.4.0
-     */
-    public function __construct($inClassName, $inSourceFile = '', $outClassName = '', $outSourceFile = '')
-    {
-        $this->inClassName = PHPUnit_Util_Class::parseFullyQualifiedClassName(
-          $inClassName
-        );
-
-        $this->outClassName = PHPUnit_Util_Class::parseFullyQualifiedClassName(
-          $outClassName
-        );
-
-        $this->inSourceFile = str_replace(
-          $this->inClassName['fullyQualifiedClassName'],
-          $this->inClassName['className'],
-          $inSourceFile
-        );
-
-        $this->outSourceFile = str_replace(
-          $this->outClassName['fullyQualifiedClassName'],
-          $this->outClassName['className'],
-          $outSourceFile
-        );
-    }
-
-    /**
-     * @return string
-     */
-    public function getOutClassName()
-    {
-        return $this->outClassName['fullyQualifiedClassName'];
-    }
-
-    /**
-     * @return string
-     */
-    public function getOutSourceFile()
-    {
-        return $this->outSourceFile;
-    }
-
-    /**
-     * Generates the code and writes it to a source file.
-     *
-     * @param  string  $file
-     */
-    public function write($file = '')
-    {
-        if ($file == '') {
-            $file = $this->outSourceFile;
-        }
-
-        if ($fp = @fopen($file, 'wt')) {
-            @fwrite($fp, $this->generate());
-            @fclose($fp);
-        }
-    }
-
-    abstract public function generate();
-}
diff --git a/tests/PHPUnit/Util/Skeleton/Class.php b/tests/PHPUnit/Util/Skeleton/Class.php
deleted file mode 100644
index 17c4d05..0000000
--- a/tests/PHPUnit/Util/Skeleton/Class.php
+++ /dev/null
@@ -1,317 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_Skeleton
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-/**
- * Generator for class skeletons from test classes.
- *
- * @package    PHPUnit
- * @subpackage Util_Skeleton
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Util_Skeleton_Class extends PHPUnit_Util_Skeleton
-{
-    /**
-     * Constructor.
-     *
-     * @param string $inClassName
-     * @param string $inSourceFile
-     * @param string $outClassName
-     * @param string $outSourceFile
-     * @throws RuntimeException
-     */
-    public function __construct($inClassName, $inSourceFile = '', $outClassName = '', $outSourceFile = '')
-    {
-        if (empty($inSourceFile)) {
-            $inSourceFile = $inClassName . '.php';
-        }
-
-        if (!is_file($inSourceFile)) {
-            throw new PHPUnit_Framework_Exception(
-              sprintf(
-                '"%s" could not be opened.',
-
-                $inSourceFile
-              )
-            );
-        }
-
-        if (empty($outClassName)) {
-            $outClassName = substr($inClassName, 0, strlen($inClassName) - 4);
-        }
-
-        if (empty($outSourceFile)) {
-            $outSourceFile = dirname($inSourceFile) . DIRECTORY_SEPARATOR .
-                             $outClassName . '.php';
-        }
-
-        parent::__construct(
-          $inClassName, $inSourceFile, $outClassName, $outSourceFile
-        );
-    }
-
-    /**
-     * Generates the class' source.
-     *
-     * @return mixed
-     */
-    public function generate()
-    {
-        $methods = '';
-
-        foreach ($this->findTestedMethods() as $method) {
-            $methodTemplate = new Text_Template(
-              sprintf(
-                '%s%sTemplate%sMethod.tpl',
-
-                dirname(__FILE__),
-                DIRECTORY_SEPARATOR,
-                DIRECTORY_SEPARATOR
-              )
-            );
-
-            $methodTemplate->setVar(
-              array(
-                'methodName' => $method,
-              )
-            );
-
-            $methods .= $methodTemplate->render();
-        }
-
-        $classTemplate = new Text_Template(
-          sprintf(
-            '%s%sTemplate%sClass.tpl',
-
-            dirname(__FILE__),
-            DIRECTORY_SEPARATOR,
-            DIRECTORY_SEPARATOR
-          )
-        );
-
-        $classTemplate->setVar(
-          array(
-            'className' => $this->outClassName['fullyQualifiedClassName'],
-            'methods'   => $methods,
-            'date'      => date('Y-m-d'),
-            'time'      => date('H:i:s')
-          )
-        );
-
-        return $classTemplate->render();
-    }
-
-    /**
-     * Returns the methods of the class under test
-     * that are called from the test methods.
-     *
-     * @return array
-     */
-    protected function findTestedMethods()
-    {
-        $setUpVariables = array();
-        $testedMethods  = array();
-        $classes        = PHPUnit_Util_File::getClassesInFile(
-                            $this->inSourceFile
-                          );
-        $testMethods    = $classes[$this->inClassName['fullyQualifiedClassName']]['methods'];
-        unset($classes);
-
-        foreach ($testMethods as $name => $testMethod) {
-            if (strtolower($name) == 'setup') {
-                $setUpVariables = $this->findVariablesThatReferenceClass(
-                  $testMethod['tokens']
-                );
-
-                break;
-            }
-        }
-
-        foreach ($testMethods as $name => $testMethod) {
-            $argVariables = array();
-
-            if (strtolower($name) == 'setup') {
-                continue;
-            }
-
-            $start = strpos($testMethod['signature'], '(') + 1;
-            $end   = strlen($testMethod['signature']) - $start - 1;
-            $args  = substr($testMethod['signature'], $start, $end);
-
-            foreach (explode(',', $args) as $arg) {
-                list($type, $var) = explode(' ', $arg);
-
-                if ($type == $this->outClassName['fullyQualifiedClassName']) {
-                    $argVariables[] = $var;
-                }
-            }
-
-            $variables = array_unique(
-              array_merge(
-                $setUpVariables,
-                $argVariables,
-                $this->findVariablesThatReferenceClass($testMethod['tokens'])
-              )
-            );
-
-            foreach ($testMethod['tokens'] as $i => $token) {
-                // Class::method()
-                if (is_array($token) && $token[0] == T_DOUBLE_COLON &&
-                    is_array($testMethod['tokens'][$i-1]) &&
-                    $testMethod['tokens'][$i-1][0] == T_STRING &&
-                    $testMethod['tokens'][$i-1][1] == $this->outClassName['fullyQualifiedClassName'] &&
-                    is_array($testMethod['tokens'][$i+1]) &&
-                    $testMethod['tokens'][$i+1][0] == T_STRING &&
-                    $testMethod['tokens'][$i+2] == '(') {
-                    $testedMethods[] = $testMethod['tokens'][$i+1][1];
-                }
-
-                // $this->object->method()
-                else if (is_array($token) && $token[0] == T_OBJECT_OPERATOR &&
-                    in_array($this->findVariableName($testMethod['tokens'], $i), $variables) &&
-                    is_array($testMethod['tokens'][$i+2]) &&
-                    $testMethod['tokens'][$i+2][0] == T_OBJECT_OPERATOR &&
-                    is_array($testMethod['tokens'][$i+3]) &&
-                    $testMethod['tokens'][$i+3][0] == T_STRING &&
-                    $testMethod['tokens'][$i+4] == '(') {
-                    $testedMethods[] = $testMethod['tokens'][$i+3][1];
-                }
-
-                // $object->method()
-                else if (is_array($token) && $token[0] == T_OBJECT_OPERATOR &&
-                    in_array($this->findVariableName($testMethod['tokens'], $i), $variables) &&
-                    is_array($testMethod['tokens'][$i+1]) &&
-                    $testMethod['tokens'][$i+1][0] == T_STRING &&
-                    $testMethod['tokens'][$i+2] == '(') {
-                    $testedMethods[] = $testMethod['tokens'][$i+1][1];
-                }
-            }
-        }
-
-        $testedMethods = array_unique($testedMethods);
-        sort($testedMethods);
-
-        return $testedMethods;
-    }
-
-    /**
-     * Returns the variables used in test methods
-     * that reference the class under test.
-     *
-     * @param  array $tokens
-     * @return array
-     */
-    protected function findVariablesThatReferenceClass(array $tokens)
-    {
-        $inNew     = FALSE;
-        $variables = array();
-
-        foreach ($tokens as $i => $token) {
-            if (is_string($token)) {
-                if (trim($token) == ';') {
-                    $inNew = FALSE;
-                }
-
-                continue;
-            }
-
-            list ($token, $value) = $token;
-
-            switch ($token) {
-                case T_NEW: {
-                    $inNew = TRUE;
-                }
-                break;
-
-                case T_STRING: {
-                    if ($inNew) {
-                        if ($value == $this->outClassName['fullyQualifiedClassName']) {
-                            $variables[] = $this->findVariableName(
-                              $tokens, $i
-                            );
-                        }
-                    }
-
-                    $inNew = FALSE;
-                }
-                break;
-            }
-        }
-
-        return $variables;
-    }
-
-    /**
-     * Finds the variable name of the object for the method call
-     * that is currently being processed.
-     *
-     * @param  array   $tokens
-     * @param  integer $start
-     * @return mixed
-     */
-    protected function findVariableName(array $tokens, $start)
-    {
-        for ($i = $start - 1; $i >= 0; $i--) {
-            if (is_array($tokens[$i]) && $tokens[$i][0] == T_VARIABLE) {
-                $variable = $tokens[$i][1];
-
-                if (is_array($tokens[$i+1]) &&
-                    $tokens[$i+1][0] == T_OBJECT_OPERATOR &&
-                    $tokens[$i+2] != '(' &&
-                    $tokens[$i+3] != '(') {
-                    $variable .= '->' . $tokens[$i+2][1];
-                }
-
-                return $variable;
-            }
-        }
-
-        return FALSE;
-    }
-}
diff --git a/tests/PHPUnit/Util/Skeleton/Template/Class.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/Class.tpl.dist
deleted file mode 100644
index 2a29e5e..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/Class.tpl.dist
+++ /dev/null
@@ -1,7 +0,0 @@
-<?php
-/**
- * Generated by PHPUnit on {date} at {time}.
- */
-class {className}
-{{methods}}
-?>
diff --git a/tests/PHPUnit/Util/Skeleton/Template/IncompleteTestMethod.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/IncompleteTestMethod.tpl.dist
deleted file mode 100644
index d89f90e..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/IncompleteTestMethod.tpl.dist
+++ /dev/null
@@ -1,11 +0,0 @@
-
-    /**
-     * @todo Implement test{methodName}().
-     */
-    public function test{methodName}()
-    {
-        // Remove the following lines when you implement this test.
-        $this->markTestIncomplete(
-          'This test has not been implemented yet.'
-        );
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Template/Method.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/Method.tpl.dist
deleted file mode 100644
index dd3b044..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/Method.tpl.dist
+++ /dev/null
@@ -1,9 +0,0 @@
-
-    /**
-     * @todo Implement {methodName}().
-     */
-    public function {methodName}()
-    {
-        // Remove the following line when you implement this method.
-        throw new RuntimeException('Not yet implemented.');
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Template/TestClass.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/TestClass.tpl.dist
deleted file mode 100644
index 68e10e3..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/TestClass.tpl.dist
+++ /dev/null
@@ -1,31 +0,0 @@
-<?php{namespace}{requireClassFile}
-
-/**
- * Test class for {className}.
- * Generated by PHPUnit on {date} at {time}.
- */
-class {testClassName} extends {namespaceSeparator}PHPUnit_Framework_TestCase
-{
-    /**
-     * @var {className}
-     */
-    protected $object;
-
-    /**
-     * Sets up the fixture, for example, opens a network connection.
-     * This method is called before a test is executed.
-     */
-    protected function setUp()
-    {
-        $this->object = new {className};
-    }
-
-    /**
-     * Tears down the fixture, for example, closes a network connection.
-     * This method is called after a test is executed.
-     */
-    protected function tearDown()
-    {
-    }
-{methods}}
-?>
diff --git a/tests/PHPUnit/Util/Skeleton/Template/TestMethod.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/TestMethod.tpl.dist
deleted file mode 100644
index 68acf2b..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/TestMethod.tpl.dist
+++ /dev/null
@@ -1,11 +0,0 @@
-
-    /**
-     * Generated from @assert {annotation}.
-     */
-    public function test{methodName}()
-    {
-        $this->assert{assertion}(
-          {expected},
-          $this->object->{origMethodName}({arguments})
-        );
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Template/TestMethodBool.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/TestMethodBool.tpl.dist
deleted file mode 100644
index 483a272..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/TestMethodBool.tpl.dist
+++ /dev/null
@@ -1,10 +0,0 @@
-
-    /**
-     * Generated from @assert {annotation}.
-     */
-    public function test{methodName}()
-    {
-        $this->assert{assertion}(
-          $this->object->{origMethodName}({arguments})
-        );
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Template/TestMethodBoolStatic.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/TestMethodBoolStatic.tpl.dist
deleted file mode 100644
index f46d84d..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/TestMethodBoolStatic.tpl.dist
+++ /dev/null
@@ -1,10 +0,0 @@
-
-    /**
-     * Generated from @assert {annotation}.
-     */
-    public function test{methodName}()
-    {
-        $this->assert{assertion}(
-          {className}::{origMethodName}({arguments})
-        );
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Template/TestMethodException.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/TestMethodException.tpl.dist
deleted file mode 100644
index 75c02b0..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/TestMethodException.tpl.dist
+++ /dev/null
@@ -1,9 +0,0 @@
-
-    /**
-     * Generated from @assert {annotation}.
-     * @expectedException {expected}
-     */
-    public function test{methodName}()
-    {
-        $this->object->{origMethodName}({arguments});
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Template/TestMethodExceptionStatic.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/TestMethodExceptionStatic.tpl.dist
deleted file mode 100644
index 5f27729..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/TestMethodExceptionStatic.tpl.dist
+++ /dev/null
@@ -1,9 +0,0 @@
-
-    /**
-     * Generated from @assert {annotation}.
-     * @expectedException {expected}
-     */
-    public function test{methodName}()
-    {
-        {className}::{origMethodName}({arguments});
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Template/TestMethodStatic.tpl.dist b/tests/PHPUnit/Util/Skeleton/Template/TestMethodStatic.tpl.dist
deleted file mode 100644
index b4fe571..0000000
--- a/tests/PHPUnit/Util/Skeleton/Template/TestMethodStatic.tpl.dist
+++ /dev/null
@@ -1,11 +0,0 @@
-
-    /**
-     * Generated from @assert {annotation}.
-     */
-    public function test{methodName}()
-    {
-        $this->assert{assertion}(
-          {expected},
-          {className}::{origMethodName}({arguments})
-        );
-    }
diff --git a/tests/PHPUnit/Util/Skeleton/Test.php b/tests/PHPUnit/Util/Skeleton/Test.php
deleted file mode 100644
index a925ef3..0000000
--- a/tests/PHPUnit/Util/Skeleton/Test.php
+++ /dev/null
@@ -1,379 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_Skeleton
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.3.0
- */
-
-require_once 'Text/Template.php';
-
-/**
- * Generator for test class skeletons from classes.
- *
- * @package    PHPUnit
- * @subpackage Util_Skeleton
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.3.0
- */
-class PHPUnit_Util_Skeleton_Test extends PHPUnit_Util_Skeleton
-{
-    /**
-     * @var    array
-     */
-    protected $methodNameCounter = array();
-
-    /**
-     * Constructor.
-     *
-     * @param string $inClassName
-     * @param string $inSourceFile
-     * @param string $outClassName
-     * @param string $outSourceFile
-     * @throws RuntimeException
-     */
-    public function __construct($inClassName, $inSourceFile = '', $outClassName = '', $outSourceFile = '')
-    {
-        if (class_exists($inClassName)) {
-            $reflector    = new ReflectionClass($inClassName);
-            $inSourceFile = $reflector->getFileName();
-
-            if ($inSourceFile === FALSE) {
-                $inSourceFile = '<internal>';
-            }
-
-            unset($reflector);
-        } else {
-            if (empty($inSourceFile)) {
-                $possibleFilenames = array(
-                  $inClassName . '.php',
-                  PHPUnit_Util_Filesystem::classNameToFilename($inClassName)
-                );
-
-                foreach ($possibleFilenames as $possibleFilename) {
-                    if (is_file($possibleFilename)) {
-                        $inSourceFile = $possibleFilename;
-                    }
-                }
-            }
-
-            if (empty($inSourceFile)) {
-                throw new PHPUnit_Framework_Exception(
-                  sprintf(
-                    'Neither "%s" nor "%s" could be opened.',
-                    $possibleFilenames[0],
-                    $possibleFilenames[1]
-                  )
-                );
-            }
-
-            if (!is_file($inSourceFile)) {
-                throw new PHPUnit_Framework_Exception(
-                  sprintf(
-                    '"%s" could not be opened.',
-
-                    $inSourceFile
-                  )
-                );
-            }
-
-            $inSourceFile = realpath($inSourceFile);
-            include_once $inSourceFile;
-
-            if (!class_exists($inClassName)) {
-                throw new PHPUnit_Framework_Exception(
-                  sprintf(
-                    'Could not find class "%s" in "%s".',
-
-                    $inClassName,
-                    $inSourceFile
-                  )
-                );
-            }
-        }
-
-        if (empty($outClassName)) {
-            $outClassName = $inClassName . 'Test';
-        }
-
-        if (empty($outSourceFile)) {
-            $outSourceFile = dirname($inSourceFile) . DIRECTORY_SEPARATOR . $outClassName . '.php';
-        }
-
-        parent::__construct(
-          $inClassName, $inSourceFile, $outClassName, $outSourceFile
-        );
-    }
-
-    /**
-     * Generates the test class' source.
-     *
-     * @param  boolean $verbose
-     * @return mixed
-     */
-    public function generate($verbose = FALSE)
-    {
-        $class             = new ReflectionClass(
-                               $this->inClassName['fullyQualifiedClassName']
-                             );
-        $methods           = '';
-        $incompleteMethods = '';
-
-        foreach ($class->getMethods() as $method) {
-            if (!$method->isConstructor() &&
-                !$method->isAbstract() &&
-                 $method->isPublic() &&
-                 $method->getDeclaringClass()->getName() == $this->inClassName['fullyQualifiedClassName']) {
-                $assertAnnotationFound = FALSE;
-
-                if (preg_match_all('/@assert(.*)$/Um', $method->getDocComment(), $annotations)) {
-                    foreach ($annotations[1] as $annotation) {
-                        if (preg_match('/\((.*)\)\s+([^\s]*)\s+(.*)/', $annotation, $matches)) {
-                            switch ($matches[2]) {
-                                case '==': {
-                                    $assertion = 'Equals';
-                                }
-                                break;
-
-                                case '!=': {
-                                    $assertion = 'NotEquals';
-                                }
-                                break;
-
-                                case '===': {
-                                    $assertion = 'Same';
-                                }
-                                break;
-
-                                case '!==': {
-                                    $assertion = 'NotSame';
-                                }
-                                break;
-
-                                case '>': {
-                                    $assertion = 'GreaterThan';
-                                }
-                                break;
-
-                                case '>=': {
-                                    $assertion = 'GreaterThanOrEqual';
-                                }
-                                break;
-
-                                case '<': {
-                                    $assertion = 'LessThan';
-                                }
-                                break;
-
-                                case '<=': {
-                                    $assertion = 'LessThanOrEqual';
-                                }
-                                break;
-
-                                case 'throws': {
-                                    $assertion = 'exception';
-                                }
-                                break;
-
-                                default: {
-                                    throw new PHPUnit_Framework_Exception(
-                                      sprintf(
-                                        'Token "%s" could not be parsed in @assert annotation.',
-                                        $matches[2]
-                                      )
-                                    );
-                                }
-                            }
-
-                            if ($assertion == 'exception') {
-                                $template = 'TestMethodException';
-                            }
-
-                            else if ($assertion == 'Equals' &&
-                                     strtolower($matches[3]) == 'true') {
-                                $assertion = 'True';
-                                $template  = 'TestMethodBool';
-                            }
-
-                            else if ($assertion == 'NotEquals' &&
-                                     strtolower($matches[3]) == 'true') {
-                                $assertion = 'False';
-                                $template  = 'TestMethodBool';
-                            }
-
-                            else if ($assertion == 'Equals' &&
-                                     strtolower($matches[3]) == 'false') {
-                                $assertion = 'False';
-                                $template  = 'TestMethodBool';
-                            }
-
-                            else if ($assertion == 'NotEquals' &&
-                                     strtolower($matches[3]) == 'false') {
-                                $assertion = 'True';
-                                $template  = 'TestMethodBool';
-                            }
-
-                            else {
-                                $template = 'TestMethod';
-                            }
-
-                            if ($method->isStatic()) {
-                                $template .= 'Static';
-                            }
-
-                            $methodTemplate = new Text_Template(
-                              sprintf(
-                                '%s%sTemplate%s%s.tpl',
-
-                                dirname(__FILE__),
-                                DIRECTORY_SEPARATOR,
-                                DIRECTORY_SEPARATOR,
-                                $template
-                              )
-                            );
-
-                            $origMethodName = $method->getName();
-                            $methodName     = ucfirst($origMethodName);
-
-                            if (isset($this->methodNameCounter[$methodName])) {
-                                $this->methodNameCounter[$methodName]++;
-                            } else {
-                                $this->methodNameCounter[$methodName] = 1;
-                            }
-
-                            if ($this->methodNameCounter[$methodName] > 1) {
-                                $methodName .= $this->methodNameCounter[$methodName];
-                            }
-
-                            $methodTemplate->setVar(
-                              array(
-                                'annotation'     => trim($annotation),
-                                'arguments'      => $matches[1],
-                                'assertion'      => isset($assertion) ? $assertion : '',
-                                'expected'       => $matches[3],
-                                'origMethodName' => $origMethodName,
-                                'className'      => $this->inClassName['fullyQualifiedClassName'],
-                                'methodName'     => $methodName
-                              )
-                            );
-
-                            $methods .= $methodTemplate->render();
-
-                            $assertAnnotationFound = TRUE;
-                        }
-                    }
-                }
-
-                if (!$assertAnnotationFound) {
-                    $methodTemplate = new Text_Template(
-                      sprintf(
-                        '%s%sTemplate%sIncompleteTestMethod.tpl',
-
-                        dirname(__FILE__),
-                        DIRECTORY_SEPARATOR,
-                        DIRECTORY_SEPARATOR
-                      )
-                    );
-
-                    $methodTemplate->setVar(
-                      array(
-                        'methodName' => ucfirst($method->getName())
-                      )
-                    );
-
-                    $incompleteMethods .= $methodTemplate->render();
-                }
-            }
-        }
-
-        $classTemplate = new Text_Template(
-          sprintf(
-            '%s%sTemplate%sTestClass.tpl',
-
-            dirname(__FILE__),
-            DIRECTORY_SEPARATOR,
-            DIRECTORY_SEPARATOR
-          )
-        );
-
-        if ($this->inSourceFile != '<internal>') {
-            $requireClassFile = sprintf(
-              "\n\nrequire_once '%s';",
-
-              $this->inSourceFile
-            );
-        } else {
-            $requireClassFile = '';
-        }
-
-        if ($this->outClassName['namespace'] != '') {
-            $namespace = "\nnamespace " .
-                         $this->outClassName['namespace'] . ";\n";
-        } else {
-            $namespace = '';
-        }
-
-        $classTemplate->setVar(
-          array(
-            'namespace'          => $namespace,
-            'namespaceSeparator' => !empty($namespace) ? '\\' : '',
-            'className'          => $this->inClassName['className'],
-            'testClassName'      => $this->outClassName['className'],
-            'requireClassFile'   => $requireClassFile,
-            'methods'            => $methods . $incompleteMethods,
-            'date'               => date('Y-m-d'),
-            'time'               => date('H:i:s')
-          )
-        );
-
-        if (!$verbose) {
-            return $classTemplate->render();
-        } else {
-            return array(
-              'code'       => $classTemplate->render(),
-              'incomplete' => empty($methods)
-            );
-        }
-    }
-}
diff --git a/tests/PHPUnit/Util/Test.php b/tests/PHPUnit/Util/Test.php
deleted file mode 100644
index 0cbb611..0000000
--- a/tests/PHPUnit/Util/Test.php
+++ /dev/null
@@ -1,473 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Test helpers.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Util_Test
-{
-    const REGEX_DATA_PROVIDER      = '/@dataProvider\s+([a-zA-Z0-9._:-\\\\x7f-\xff]+)/';
-    const REGEX_EXPECTED_EXCEPTION = '(@expectedException\s+([:.\w\\\\x7f-\xff]+)(?:[\t ]+(\S*))?(?:[\t ]+(\S*))?\s*$)m';
-
-    private static $annotationCache = array();
-
-    protected static $templateMethods = array(
-      'setUp', 'assertPreConditions', 'assertPostConditions', 'tearDown'
-    );
-
-    /**
-     * @param  PHPUnit_Framework_Test $test
-     * @param  boolean                $asString
-     * @return mixed
-     */
-    public static function describe(PHPUnit_Framework_Test $test, $asString = TRUE)
-    {
-        if ($asString) {
-            if ($test instanceof PHPUnit_Framework_SelfDescribing) {
-                return $test->toString();
-            } else {
-                return get_class($test);
-            }
-        } else {
-            if ($test instanceof PHPUnit_Framework_TestCase) {
-                return array(
-                  get_class($test), $test->getName()
-                );
-            }
-
-            else if ($test instanceof PHPUnit_Framework_SelfDescribing) {
-                return array('', $test->toString());
-            }
-
-            else {
-                return array('', get_class($test));
-            }
-        }
-    }
-
-    /**
-     * Returns the expected exception for a test.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return array
-     * @since  Method available since Release 3.3.6
-     */
-    public static function getExpectedException($className, $methodName)
-    {
-        $reflector  = new ReflectionMethod($className, $methodName);
-        $docComment = $reflector->getDocComment();
-
-        if (preg_match(self::REGEX_EXPECTED_EXCEPTION, $docComment, $matches)) {
-            $annotations = self::parseTestMethodAnnotations(
-              $className, $methodName
-            );
-
-            $class   = $matches[1];
-            $code    = 0;
-            $message = '';
-
-            if (isset($matches[2])) {
-                $message = trim($matches[2]);
-            }
-
-            else if (isset($annotations['method']['expectedExceptionMessage'])) {
-                $message = $annotations['method']['expectedExceptionMessage'][0];
-            }
-
-            if (isset($matches[3])) {
-                $code = (int)$matches[3];
-            }
-
-            else if (isset($annotations['method']['expectedExceptionCode'])) {
-                $code = (int)$annotations['method']['expectedExceptionCode'][0];
-            }
-
-            return array(
-              'class' => $class, 'code' => $code, 'message' => $message
-            );
-        }
-
-        return FALSE;
-    }
-
-    /**
-     * Returns the provided data for a method.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @param  string $docComment
-     * @return mixed  array|Iterator when a data provider is specified and exists
-     *                false          when a data provider is specified and does not exist
-     *                null           when no data provider is specified
-     * @since  Method available since Release 3.2.0
-     */
-    public static function getProvidedData($className, $methodName)
-    {
-        $reflector  = new ReflectionMethod($className, $methodName);
-        $docComment = $reflector->getDocComment();
-        $data       = NULL;
-
-        if (preg_match(self::REGEX_DATA_PROVIDER, $docComment, $matches)) {
-            $dataProviderMethodNameNamespace = explode('\\', $matches[1]);
-            $leaf                            = explode('::', array_pop($dataProviderMethodNameNamespace));
-            $dataProviderMethodName          = array_pop($leaf);
-
-            if (!empty($dataProviderMethodNameNamespace)) {
-                $dataProviderMethodNameNamespace = join('\\', $dataProviderMethodNameNamespace) . '\\';
-            } else {
-                $dataProviderMethodNameNamespace = '';
-            }
-
-            if (!empty($leaf)) {
-                $dataProviderClassName = $dataProviderMethodNameNamespace . array_pop($leaf);
-            } else {
-                $dataProviderClassName = $className;
-            }
-
-            $dataProviderClass  = new ReflectionClass($dataProviderClassName);
-            $dataProviderMethod = $dataProviderClass->getMethod(
-              $dataProviderMethodName
-            );
-
-            if ($dataProviderMethod->isStatic()) {
-                $object = NULL;
-            } else {
-                $object = $dataProviderClass->newInstance();
-            }
-
-            if ($dataProviderMethod->getNumberOfParameters() == 0) {
-                $data = $dataProviderMethod->invoke($object);
-            } else {
-                $data = $dataProviderMethod->invoke($object, $methodName);
-            }
-        }
-
-        if ($data !== NULL) {
-            foreach ($data as $key => $value) {
-                if (!is_array($value)) {
-                    throw new InvalidArgumentException(
-                      sprintf(
-                        'Data set %s is invalid.',
-                        is_int($key) ? '#' . $key : '"' . $key . '"'
-                      )
-                    );
-                }
-            }
-        }
-
-        return $data;
-    }
-
-    /**
-     * @param  string $className
-     * @param  string $methodName
-     * @return array
-     * @throws ReflectionException
-     * @since  Method available since Release 3.4.0
-     */
-    public static function parseTestMethodAnnotations($className, $methodName = '')
-    {
-        if (!isset(self::$annotationCache[$className])) {
-            $class = new ReflectionClass($className);
-            self::$annotationCache[$className] = self::parseAnnotations($class->getDocComment());
-        }
-
-        if (!empty($methodName) && !isset(self::$annotationCache[$className . '::' . $methodName])) {
-            $method = new ReflectionMethod($className, $methodName);
-            self::$annotationCache[$className . '::' . $methodName] = self::parseAnnotations($method->getDocComment());
-        }
-
-        return array(
-          'class'  => self::$annotationCache[$className],
-          'method' => !empty($methodName) ? self::$annotationCache[$className . '::' . $methodName] : array()
-        );
-    }
-
-    /**
-     * @param  string $docblock
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    private static function parseAnnotations($docblock)
-    {
-        $annotations = array();
-
-        if (preg_match_all('/@(?P<name>[A-Za-z_-]+)(?:[ \t]+(?P<value>.*?))?[ \t]*\r?$/m', $docblock, $matches)) {
-            $numMatches = count($matches[0]);
-
-            for ($i = 0; $i < $numMatches; ++$i) {
-                $annotations[$matches['name'][$i]][] = $matches['value'][$i];
-            }
-        }
-
-        return $annotations;
-    }
-
-    /**
-     * Returns the backup settings for a test.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getBackupSettings($className, $methodName)
-    {
-        return array(
-          'backupGlobals' => self::getBooleanAnnotationSetting(
-            $className, $methodName, 'backupGlobals'
-          ),
-          'backupStaticAttributes' => self::getBooleanAnnotationSetting(
-            $className, $methodName, 'backupStaticAttributes'
-          )
-        );
-    }
-
-    /**
-     * Returns the dependencies for a test class or method.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getDependencies($className, $methodName)
-    {
-        $annotations = self::parseTestMethodAnnotations(
-          $className, $methodName
-        );
-
-        $dependencies = array();
-
-        if (isset($annotations['class']['depends'])) {
-            $dependencies = $annotations['class']['depends'];
-        }
-
-        if (isset($annotations['method']['depends'])) {
-            $dependencies = array_merge(
-              $dependencies, $annotations['method']['depends']
-            );
-        }
-
-        return array_unique($dependencies);
-    }
-
-    /**
-     * Returns the error handler settings for a test.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return boolean
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getErrorHandlerSettings($className, $methodName)
-    {
-        return self::getBooleanAnnotationSetting(
-          $className, $methodName, 'errorHandler'
-        );
-    }
-
-    /**
-     * Returns the groups for a test class or method.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return array
-     * @since  Method available since Release 3.2.0
-     */
-    public static function getGroups($className, $methodName = '')
-    {
-        $annotations = self::parseTestMethodAnnotations(
-          $className, $methodName
-        );
-
-        $groups = array();
-
-        if (isset($annotations['method']['author'])) {
-            $groups = $annotations['method']['author'];
-        }
-
-        else if (isset($annotations['class']['author'])) {
-            $groups = $annotations['class']['author'];
-        }
-
-        if (isset($annotations['class']['group'])) {
-            $groups = array_merge($groups, $annotations['class']['group']);
-        }
-
-        if (isset($annotations['method']['group'])) {
-            $groups = array_merge($groups, $annotations['method']['group']);
-        }
-
-        return array_unique($groups);
-    }
-
-    /**
-     * Returns the tickets for a test class or method.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return array
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getTickets($className, $methodName)
-    {
-        $annotations = self::parseTestMethodAnnotations(
-          $className, $methodName
-        );
-
-        $tickets = array();
-
-        if (isset($annotations['class']['ticket'])) {
-            $tickets = $annotations['class']['ticket'];
-        }
-
-        if (isset($annotations['method']['ticket'])) {
-            $tickets = array_merge($tickets, $annotations['method']['ticket']);
-        }
-
-        return array_unique($tickets);
-    }
-
-    /**
-     * Returns the output buffering settings for a test.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return boolean
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getOutputBufferingSettings($className, $methodName)
-    {
-        return self::getBooleanAnnotationSetting(
-          $className, $methodName, 'outputBuffering'
-        );
-    }
-
-    /**
-     * Returns the process isolation settings for a test.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return boolean
-     * @since  Method available since Release 3.4.1
-     */
-    public static function getProcessIsolationSettings($className, $methodName)
-    {
-        $annotations = self::parseTestMethodAnnotations(
-          $className, $methodName
-        );
-
-        if (isset($annotations['class']['runTestsInSeparateProcesses']) ||
-            isset($annotations['method']['runInSeparateProcess'])) {
-            return TRUE;
-        } else {
-            return FALSE;
-        }
-    }
-
-    /**
-     * Returns the preserve global state settings for a test.
-     *
-     * @param  string $className
-     * @param  string $methodName
-     * @return boolean
-     * @since  Method available since Release 3.4.0
-     */
-    public static function getPreserveGlobalStateSettings($className, $methodName)
-    {
-        return self::getBooleanAnnotationSetting(
-          $className, $methodName, 'preserveGlobalState'
-        );
-    }
-
-    /**
-     * @param  string $className
-     * @param  string $methodName
-     * @param  string $settingName
-     * @return boolean
-     * @since  Method available since Release 3.4.0
-     */
-    private static function getBooleanAnnotationSetting($className, $methodName, $settingName)
-    {
-        $annotations = self::parseTestMethodAnnotations(
-          $className, $methodName
-        );
-
-        $result = NULL;
-
-        if (isset($annotations['class'][$settingName])) {
-            if ($annotations['class'][$settingName][0] == 'enabled') {
-                $result = TRUE;
-            }
-
-            else if ($annotations['class'][$settingName][0] == 'disabled') {
-                $result = FALSE;
-            }
-        }
-
-        if (isset($annotations['method'][$settingName])) {
-            if ($annotations['method'][$settingName][0] == 'enabled') {
-                $result = TRUE;
-            }
-
-            else if ($annotations['method'][$settingName][0] == 'disabled') {
-                $result = FALSE;
-            }
-        }
-
-        return $result;
-    }
-}
diff --git a/tests/PHPUnit/Util/TestDox/NamePrettifier.php b/tests/PHPUnit/Util/TestDox/NamePrettifier.php
deleted file mode 100644
index 6d5464a..0000000
--- a/tests/PHPUnit/Util/TestDox/NamePrettifier.php
+++ /dev/null
@@ -1,178 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.3.0
- */
-
-/**
- * Prettifies class and method names for use in TestDox documentation.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.1.0
- */
-class PHPUnit_Util_TestDox_NamePrettifier
-{
-    /**
-     * @var    string
-     */
-    protected $prefix = 'Test';
-
-    /**
-     * @var    string
-     */
-    protected $suffix = 'Test';
-
-    /**
-     * @var    array
-     */
-    protected $strings = array();
-
-    /**
-     * Prettifies the name of a test class.
-     *
-     * @param  string  $name
-     * @return string
-     */
-    public function prettifyTestClass($name)
-    {
-        $title = $name;
-
-        if ($this->suffix !== NULL &&
-            $this->suffix == substr($name, -1 * strlen($this->suffix))) {
-            $title = substr($title, 0, strripos($title, $this->suffix));
-        }
-
-        if ($this->prefix !== NULL &&
-            $this->prefix == substr($name, 0, strlen($this->prefix))) {
-            $title = substr($title, strlen($this->prefix));
-        }
-
-        return $title;
-    }
-
-    /**
-     * Prettifies the name of a test method.
-     *
-     * @param  string  $name
-     * @return string
-     */
-    public function prettifyTestMethod($name)
-    {
-        $buffer = '';
-
-        if (!is_string($name) || strlen($name) == 0) {
-            return $buffer;
-        }
-
-        $string = preg_replace('#\d+$#', '', $name);
-
-        if (in_array($string, $this->strings)) {
-            $name = $string;
-        } else {
-            $this->strings[] = $string;
-        }
-
-        if (strpos($name, '_') !== FALSE) {
-            return str_replace('_', ' ', $name);
-        }
-
-        $max = strlen($name);
-
-        if (substr($name, 0, 4) == 'test') {
-            $offset = 4;
-        } else {
-            $offset  = 0;
-            $name[0] = strtoupper($name[0]);
-        }
-
-        $wasNumeric = FALSE;
-
-        for ($i = $offset; $i < $max; $i++) {
-            if ($i > $offset &&
-                ord($name[$i]) >= 65 &&
-                ord($name[$i]) <= 90) {
-                $buffer .= ' ' . strtolower($name[$i]);
-            } else {
-                $isNumeric = is_numeric($name[$i]);
-
-                if (!$wasNumeric && $isNumeric) {
-                    $buffer    .= ' ';
-                    $wasNumeric = TRUE;
-                }
-
-                if ($wasNumeric && !$isNumeric) {
-                    $wasNumeric = FALSE;
-                }
-
-                $buffer .= $name[$i];
-            }
-        }
-
-        return $buffer;
-    }
-
-    /**
-     * Sets the prefix of test names.
-     *
-     * @param  string  $prefix
-     */
-    public function setPrefix($prefix)
-    {
-        $this->prefix = $prefix;
-    }
-
-    /**
-     * Sets the suffix of test names.
-     *
-     * @param  string  $prefix
-     */
-    public function setSuffix($suffix)
-    {
-        $this->suffix = $suffix;
-    }
-}
diff --git a/tests/PHPUnit/Util/TestDox/ResultPrinter.php b/tests/PHPUnit/Util/TestDox/ResultPrinter.php
deleted file mode 100644
index a4be5ac..0000000
--- a/tests/PHPUnit/Util/TestDox/ResultPrinter.php
+++ /dev/null
@@ -1,348 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.3.0
- */
-
-/**
- * Base class for printers of TestDox documentation.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.1.0
- */
-abstract class PHPUnit_Util_TestDox_ResultPrinter extends PHPUnit_Util_Printer implements PHPUnit_Framework_TestListener
-{
-    /**
-     * @var PHPUnit_Util_TestDox_NamePrettifier
-     */
-    protected $prettifier;
-
-    /**
-     * @var string
-     */
-    protected $testClass = '';
-
-    /**
-     * @var integer
-     */
-    protected $testStatus = FALSE;
-
-    /**
-     * @var array
-     */
-    protected $tests = array();
-
-    /**
-     * @var integer
-     */
-    protected $successful = 0;
-
-    /**
-     * @var integer
-     */
-    protected $failed = 0;
-
-    /**
-     * @var integer
-     */
-    protected $skipped = 0;
-
-    /**
-     * @var integer
-     */
-    protected $incomplete = 0;
-
-    /**
-     * @var string
-     */
-    protected $testTypeOfInterest = 'PHPUnit_Framework_TestCase';
-
-    /**
-     * @var string
-     */
-    protected $currentTestClassPrettified;
-
-    /**
-     * @var string
-     */
-    protected $currentTestMethodPrettified;
-
-    /**
-     * Constructor.
-     *
-     * @param  resource  $out
-     */
-    public function __construct($out = NULL)
-    {
-        parent::__construct($out);
-
-        $this->prettifier = new PHPUnit_Util_TestDox_NamePrettifier;
-        $this->startRun();
-    }
-
-    /**
-     * Flush buffer and close output.
-     *
-     */
-    public function flush()
-    {
-        $this->doEndClass();
-        $this->endRun();
-
-        parent::flush();
-    }
-
-    /**
-     * An error occurred.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        if ($test instanceof $this->testTypeOfInterest) {
-            $this->testStatus = PHPUnit_Runner_BaseTestRunner::STATUS_ERROR;
-            $this->failed++;
-        }
-    }
-
-    /**
-     * A failure occurred.
-     *
-     * @param  PHPUnit_Framework_Test                 $test
-     * @param  PHPUnit_Framework_AssertionFailedError $e
-     * @param  float                                  $time
-     */
-    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
-    {
-        if ($test instanceof $this->testTypeOfInterest) {
-            $this->testStatus = PHPUnit_Runner_BaseTestRunner::STATUS_FAILURE;
-            $this->failed++;
-        }
-    }
-
-    /**
-     * Incomplete test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     */
-    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        if ($test instanceof $this->testTypeOfInterest) {
-            $this->testStatus = PHPUnit_Runner_BaseTestRunner::STATUS_INCOMPLETE;
-            $this->incomplete++;
-        }
-    }
-
-    /**
-     * Skipped test.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  Exception              $e
-     * @param  float                  $time
-     * @since  Method available since Release 3.0.0
-     */
-    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
-    {
-        if ($test instanceof $this->testTypeOfInterest) {
-            $this->testStatus = PHPUnit_Runner_BaseTestRunner::STATUS_SKIPPED;
-            $this->skipped++;
-        }
-    }
-
-    /**
-     * A testsuite started.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-    }
-
-    /**
-     * A testsuite ended.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     * @since  Method available since Release 2.2.0
-     */
-    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
-    {
-    }
-
-    /**
-     * A test started.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     */
-    public function startTest(PHPUnit_Framework_Test $test)
-    {
-        if ($test instanceof $this->testTypeOfInterest) {
-            $class = get_class($test);
-
-            if ($this->testClass != $class) {
-                if ($this->testClass != '') {
-                    $this->doEndClass();
-                }
-
-                $this->currentTestClassPrettified = $this->prettifier->prettifyTestClass($class);
-                $this->startClass($class);
-
-                $this->testClass = $class;
-                $this->tests     = array();
-            }
-
-            $prettified = FALSE;
-
-            if ($test instanceof PHPUnit_Framework_TestCase &&
-               !$test instanceof PHPUnit_Framework_Warning) {
-                $annotations = $test->getAnnotations();
-
-                if (isset($annotations['method']['testdox'][0])) {
-                    $this->currentTestMethodPrettified = $annotations['method']['testdox'][0];
-                    $prettified                        = TRUE;
-                }
-            }
-
-            if (!$prettified) {
-                $this->currentTestMethodPrettified = $this->prettifier->prettifyTestMethod($test->getName(FALSE));
-            }
-
-            $this->testStatus = PHPUnit_Runner_BaseTestRunner::STATUS_PASSED;
-        }
-    }
-
-    /**
-     * A test ended.
-     *
-     * @param  PHPUnit_Framework_Test $test
-     * @param  float                  $time
-     */
-    public function endTest(PHPUnit_Framework_Test $test, $time)
-    {
-        if ($test instanceof $this->testTypeOfInterest) {
-            if (!isset($this->tests[$this->currentTestMethodPrettified])) {
-                if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_PASSED) {
-                    $this->tests[$this->currentTestMethodPrettified]['success'] = 1;
-                    $this->tests[$this->currentTestMethodPrettified]['failure'] = 0;
-                } else {
-                    $this->tests[$this->currentTestMethodPrettified]['success'] = 0;
-                    $this->tests[$this->currentTestMethodPrettified]['failure'] = 1;
-                }
-            } else {
-                if ($this->testStatus == PHPUnit_Runner_BaseTestRunner::STATUS_PASSED) {
-                    $this->tests[$this->currentTestMethodPrettified]['success']++;
-                } else {
-                    $this->tests[$this->currentTestMethodPrettified]['failure']++;
-                }
-            }
-
-            $this->currentTestClassPrettified  = NULL;
-            $this->currentTestMethodPrettified = NULL;
-        }
-    }
-
-    /**
-     * @since  Method available since Release 2.3.0
-     */
-    protected function doEndClass()
-    {
-        foreach ($this->tests as $name => $data) {
-            $this->onTest($name, $data['failure'] == 0);
-        }
-
-        $this->endClass($this->testClass);
-    }
-
-    /**
-     * Handler for 'start run' event.
-     *
-     */
-    protected function startRun()
-    {
-    }
-
-    /**
-     * Handler for 'start class' event.
-     *
-     * @param  string $name
-     */
-    protected function startClass($name)
-    {
-    }
-
-    /**
-     * Handler for 'on test' event.
-     *
-     * @param  string  $name
-     * @param  boolean $success
-     */
-    protected function onTest($name, $success = TRUE)
-    {
-    }
-
-    /**
-     * Handler for 'end class' event.
-     *
-     * @param  string $name
-     */
-    protected function endClass($name)
-    {
-    }
-
-    /**
-     * Handler for 'end run' event.
-     *
-     */
-    protected function endRun()
-    {
-    }
-}
diff --git a/tests/PHPUnit/Util/TestDox/ResultPrinter/HTML.php b/tests/PHPUnit/Util/TestDox/ResultPrinter/HTML.php
deleted file mode 100644
index e2dd9b1..0000000
--- a/tests/PHPUnit/Util/TestDox/ResultPrinter/HTML.php
+++ /dev/null
@@ -1,124 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.3.0
- */
-
-/**
- * Prints TestDox documentation in HTML format.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.1.0
- */
-class PHPUnit_Util_TestDox_ResultPrinter_HTML extends PHPUnit_Util_TestDox_ResultPrinter
-{
-    /**
-     * @var    boolean
-     */
-    protected $printsHTML = TRUE;
-
-    /**
-     * Handler for 'start run' event.
-     *
-     */
-    protected function startRun()
-    {
-        $this->write('<html><body>');
-    }
-
-    /**
-     * Handler for 'start class' event.
-     *
-     * @param  string $name
-     */
-    protected function startClass($name)
-    {
-        $this->write(
-          '<h2 id="' . $name . '">' . $this->currentTestClassPrettified .
-          '</h2><ul>'
-        );
-    }
-
-    /**
-     * Handler for 'on test' event.
-     *
-     * @param  string  $name
-     * @param  boolean $success
-     */
-    protected function onTest($name, $success = TRUE)
-    {
-        if (!$success) {
-            $strikeOpen  = '<strike>';
-            $strikeClose = '</strike>';
-        } else {
-            $strikeOpen  = '';
-            $strikeClose = '';
-        }
-
-        $this->write('<li>' . $strikeOpen . $name . $strikeClose . '</li>');
-    }
-
-    /**
-     * Handler for 'end class' event.
-     *
-     * @param  string $name
-     */
-    protected function endClass($name)
-    {
-        $this->write('</ul>');
-    }
-
-    /**
-     * Handler for 'end run' event.
-     *
-     */
-    protected function endRun()
-    {
-        $this->write('</body></html>');
-    }
-}
diff --git a/tests/PHPUnit/Util/TestDox/ResultPrinter/Text.php b/tests/PHPUnit/Util/TestDox/ResultPrinter/Text.php
deleted file mode 100644
index f6c34a5..0000000
--- a/tests/PHPUnit/Util/TestDox/ResultPrinter/Text.php
+++ /dev/null
@@ -1,96 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 2.3.0
- */
-
-/**
- * Prints TestDox documentation in text format.
- *
- * @package    PHPUnit
- * @subpackage Util_TestDox
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 2.1.0
- */
-class PHPUnit_Util_TestDox_ResultPrinter_Text extends PHPUnit_Util_TestDox_ResultPrinter
-{
-    /**
-     * Handler for 'start class' event.
-     *
-     * @param  string $name
-     */
-    protected function startClass($name)
-    {
-        $this->write($this->currentTestClassPrettified . "\n");
-    }
-
-    /**
-     * Handler for 'on test' event.
-     *
-     * @param  string  $name
-     * @param  boolean $success
-     */
-    protected function onTest($name, $success = TRUE)
-    {
-        if ($success) {
-            $this->write(' [x] ');
-        } else {
-            $this->write(' [ ] ');
-        }
-
-        $this->write($name . "\n");
-    }
-
-    /**
-     * Handler for 'end class' event.
-     *
-     * @param  string $name
-     */
-    protected function endClass($name)
-    {
-        $this->write("\n");
-    }
-}
diff --git a/tests/PHPUnit/Util/TestSuiteIterator.php b/tests/PHPUnit/Util/TestSuiteIterator.php
deleted file mode 100644
index db62349..0000000
--- a/tests/PHPUnit/Util/TestSuiteIterator.php
+++ /dev/null
@@ -1,149 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.1.0
- */
-
-/**
- * Iterator for test suites.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.1.0
- */
-class PHPUnit_Util_TestSuiteIterator implements RecursiveIterator
-{
-    /**
-     * @var    integer
-     */
-    protected $position;
-
-    /**
-     * @var    PHPUnit_Framework_Test[]
-     */
-    protected $tests;
-
-    /**
-     * Constructor.
-     *
-     * @param  PHPUnit_Framework_TestSuite $suite
-     */
-    public function __construct(PHPUnit_Framework_TestSuite $testSuite)
-    {
-        $this->tests = $testSuite->tests();
-    }
-
-    /**
-     * Rewinds the Iterator to the first element.
-     *
-     */
-    public function rewind()
-    {
-        $this->position = 0;
-    }
-
-    /**
-     * Checks if there is a current element after calls to rewind() or next().
-     *
-     * @return boolean
-     */
-    public function valid()
-    {
-        return $this->position < count($this->tests);
-    }
-
-    /**
-     * Returns the key of the current element.
-     *
-     * @return integer
-     */
-    public function key()
-    {
-        return $this->position;
-    }
-
-    /**
-     * Returns the current element.
-     *
-     * @return PHPUnit_Framework_Test
-     */
-    public function current()
-    {
-        return $this->valid() ? $this->tests[$this->position] : NULL;
-    }
-
-    /**
-     * Moves forward to next element.
-     *
-     */
-    public function next()
-    {
-        $this->position++;
-    }
-
-    /**
-     * Returns the sub iterator for the current element.
-     *
-     * @return PHPUnit_Util_TestSuiteIterator
-     */
-    public function getChildren()
-    {
-        return new PHPUnit_Util_TestSuiteIterator(
-          $this->tests[$this->position]
-        );
-    }
-
-    /**
-     * Checks whether the current element has children.
-     *
-     * @return boolean
-     */
-    public function hasChildren()
-    {
-        return $this->tests[$this->position] instanceof PHPUnit_Framework_TestSuite;
-    }
-}
diff --git a/tests/PHPUnit/Util/Type.php b/tests/PHPUnit/Util/Type.php
deleted file mode 100644
index afbf852..0000000
--- a/tests/PHPUnit/Util/Type.php
+++ /dev/null
@@ -1,192 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.0.0
- */
-
-/**
- * Utility class for textual type (and value) representation.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.0.0
- */
-class PHPUnit_Util_Type
-{
-    public static function isType($type)
-    {
-        return in_array(
-          $type,
-          array(
-            'numeric',
-            'integer',
-            'int',
-            'float',
-            'string',
-            'boolean',
-            'bool',
-            'null',
-            'array',
-            'object',
-            'resource',
-            'scalar'
-          )
-        );
-    }
-
-    public static function shortenedExport($value)
-    {
-        if (is_string($value)) {
-            return self::shortenedString($value);
-        }
-
-        elseif (is_array($value)) {
-            if (count($value) == 0) {
-                return 'array()';
-            }
-
-            $a1 = array_slice($value, 0, 1, TRUE);
-            $k1 = key($a1);
-            $v1 = $a1[$k1];
-
-            if (is_string($v1)) {
-                $v1 = self::shortenedString($v1);
-            }
-
-            elseif (is_array($v1)) {
-                $v1 = 'array(...)';
-            } else {
-                $v1 = self::toString($v1);
-            }
-
-            $a2 = FALSE;
-
-            if (count($value) > 1) {
-                $a2 = array_slice($value, -1, 1, TRUE);
-                $k2 = key($a2);
-                $v2 = $a2[$k2];
-
-                if (is_string($v2)) {
-                    $v2 = self::shortenedString($v2);
-                }
-
-                elseif (is_array($v2)) {
-                    $v2 = 'array(...)';
-                } else {
-                    $v2 = self::toString($v2);
-                }
-            }
-
-            $text = 'array( ' . self::toString($k1) . ' => ' . $v1;
-
-            if ($a2 !== FALSE) {
-                $text .= ', ..., ' . self::toString($k2) . ' => ' . $v2 . ' )';
-            } else {
-                $text .= ' )';
-            }
-
-            return $text;
-        }
-
-        elseif (is_object($value)) {
-            return get_class($value) . '(...)';
-        }
-
-        return self::toString($value);
-    }
-
-    public static function shortenedString($string)
-    {
-        $string = preg_replace('#\n|\r\n|\r#', ' ', $string);
-
-        if (strlen($string) > 14) {
-            return PHPUnit_Util_Type::toString(
-              substr($string, 0, 7) . '...' . substr($string, -7)
-            );
-        } else {
-            return PHPUnit_Util_Type::toString($string);
-        }
-    }
-
-    public static function toString($value, $short = FALSE)
-    {
-        if (is_array($value) || is_object($value)) {
-            if (!$short) {
-                return "\n" . print_r($value, TRUE);
-            } else {
-                if (is_array($value)) {
-                    return '<array>';
-                } else {
-                    return '<' . get_class($value) . '>';
-                }
-            }
-        }
-
-        if (is_string($value) && strpos($value, "\n") !== FALSE) {
-            return '<text>';
-        }
-
-        if (!is_null($value)) {
-            $type = gettype($value) . ':';
-        } else {
-            $type  = '';
-            $value = 'null';
-        }
-
-        if (is_bool($value)) {
-            if ($value === TRUE) {
-                $value = 'true';
-            }
-
-            else if ($value === FALSE) {
-                $value = 'false';
-            }
-        }
-
-        return '<' . $type . $value . '>';
-    }
-}
diff --git a/tests/PHPUnit/Util/XML.php b/tests/PHPUnit/Util/XML.php
deleted file mode 100644
index b9acf17..0000000
--- a/tests/PHPUnit/Util/XML.php
+++ /dev/null
@@ -1,958 +0,0 @@
-<?php
-/**
- * PHPUnit
- *
- * Copyright (c) 2002-2010, Sebastian Bergmann <sebastian@phpunit.de>.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- *   * Redistributions of source code must retain the above copyright
- *     notice, this list of conditions and the following disclaimer.
- *
- *   * Redistributions in binary form must reproduce the above copyright
- *     notice, this list of conditions and the following disclaimer in
- *     the documentation and/or other materials provided with the
- *     distribution.
- *
- *   * Neither the name of Sebastian Bergmann nor the names of his
- *     contributors may be used to endorse or promote products derived
- *     from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
- * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
- * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
- * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
- * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
- * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
- * POSSIBILITY OF SUCH DAMAGE.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @link       http://www.phpunit.de/
- * @since      File available since Release 3.2.0
- */
-
-/**
- * XML helpers.
- *
- * @package    PHPUnit
- * @subpackage Util
- * @author     Sebastian Bergmann <sebastian@phpunit.de>
- * @copyright  2002-2010 Sebastian Bergmann <sebastian@phpunit.de>
- * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
- * @version    Release: @package_version@
- * @link       http://www.phpunit.de/
- * @since      Class available since Release 3.2.0
- */
-class PHPUnit_Util_XML
-{
-    /**
-     * @param  string $string
-     * @return string
-     * @author Kore Nordmann <mail@kore-nordmann.de>
-     * @since  Method available since Release 3.4.6
-     */
-    public static function prepareString($string)
-    {
-        return preg_replace(
-          '([\\x00-\\x04\\x0b\\x0c\\x0e-\\x1f\\x7f])e',
-          'sprintf( "&#x%02x;", ord( "\\1" ) )',
-          htmlspecialchars(
-            self::convertToUtf8($string), ENT_COMPAT, 'UTF-8'
-          )
-        );
-    }
-
-    /**
-     * Converts a string to UTF-8 encoding.
-     *
-     * @param  string $string
-     * @return string
-     * @since  Method available since Release 3.2.19
-     */
-    protected static function convertToUtf8($string)
-    {
-        if (!self::isUtf8($string)) {
-            if (function_exists('mb_convert_encoding')) {
-                $string = mb_convert_encoding($string, 'UTF-8');
-            } else {
-                $string = utf8_encode($string);
-            }
-        }
-
-        return $string;
-    }
-
-    /**
-     * Checks a string for UTF-8 encoding.
-     *
-     * @param  string $string
-     * @return boolean
-     * @since  Method available since Release 3.3.0
-     */
-    protected static function isUtf8($string)
-    {
-        $length = strlen($string);
-
-        for ($i = 0; $i < $length; $i++) {
-            if (ord($string[$i]) < 0x80) {
-                $n = 0;
-            }
-
-            else if ((ord($string[$i]) & 0xE0) == 0xC0) {
-                $n = 1;
-            }
-
-            else if ((ord($string[$i]) & 0xF0) == 0xE0) {
-                $n = 2;
-            }
-
-            else if ((ord($string[$i]) & 0xF0) == 0xF0) {
-                $n = 3;
-            }
-
-            else {
-                return FALSE;
-            }
-
-            for ($j = 0; $j < $n; $j++) {
-                if ((++$i == $length) || ((ord($string[$i]) & 0xC0) != 0x80)) {
-                    return FALSE;
-                }
-            }
-        }
-
-        return TRUE;
-    }
-
-    /**
-     * Loads an XML (or HTML) file into a DOMDocument object.
-     *
-     * @param  string  $filename
-     * @param  boolean $isHtml
-     * @return DOMDocument
-     * @since  Method available since Release 3.3.0
-     */
-    public static function loadFile($filename, $isHtml = FALSE)
-    {
-        $reporting = error_reporting(0);
-        $contents  = file_get_contents($filename);
-        error_reporting($reporting);
-
-        if ($contents === FALSE) {
-            throw new PHPUnit_Framework_Exception(
-              sprintf(
-                'Could not read "%s".',
-                $filename
-              )
-            );
-        }
-
-        return self::load($contents, $isHtml, $filename);
-    }
-
-    /**
-     * Load an $actual document into a DOMDocument.  This is called
-     * from the selector assertions.
-     *
-     * If $actual is already a DOMDocument, it is returned with
-     * no changes.  Otherwise, $actual is loaded into a new DOMDocument
-     * as either HTML or XML, depending on the value of $isHtml.
-     *
-     * Note: prior to PHPUnit 3.3.0, this method loaded a file and
-     * not a string as it currently does.  To load a file into a
-     * DOMDocument, use loadFile() instead.
-     *
-     * @param  string|DOMDocument  $actual
-     * @param  boolean             $isHtml
-     * @param  string              $filename
-     * @return DOMDocument
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function load($actual, $isHtml = FALSE, $filename = '')
-    {
-        if ($actual instanceof DOMDocument) {
-            return $actual;
-        }
-
-        $internal  = libxml_use_internal_errors(TRUE);
-        $reporting = error_reporting(0);
-        $dom       = new DOMDocument;
-
-        if ($isHtml) {
-            $loaded = $dom->loadHTML($actual);
-        } else {
-            $loaded = $dom->loadXML($actual);
-        }
-
-        libxml_use_internal_errors($internal);
-        error_reporting($reporting);
-
-        if ($loaded === FALSE) {
-            $message = '';
-
-            foreach (libxml_get_errors() as $error) {
-                $message .= $error->message;
-            }
-
-            if ($filename != '') {
-                throw new PHPUnit_Framework_Exception(
-                  sprintf(
-                    'Could not load "%s".%s',
-
-                    $filename,
-                    $message != '' ? "\n" . $message : ''
-                  )
-                );
-            } else {
-                throw new PHPUnit_Framework_Exception($message);
-            }
-        }
-
-        return $dom;
-    }
-
-    /**
-     *
-     *
-     * @param  DOMNode $node
-     * @return string
-     * @since  Method available since Release 3.4.0
-     */
-    public static function nodeToText(DOMNode $node)
-    {
-        if ($node->childNodes->length == 1) {
-            return $node->nodeValue;
-        }
-
-        $result = '';
-
-        foreach ($node->childNodes as $childNode) {
-            $result .= $node->ownerDocument->saveXML($childNode);
-        }
-
-        return $result;
-    }
-
-    /**
-     *
-     *
-     * @param  DOMNode $node
-     * @since  Method available since Release 3.3.0
-     * @author Mattis Stordalen Flister <mattis@xait.no>
-     */
-    public static function removeCharacterDataNodes(DOMNode $node)
-    {
-        if ($node->hasChildNodes()) {
-            for ($i = $node->childNodes->length - 1; $i >= 0; $i--) {
-                if (($child = $node->childNodes->item($i)) instanceof DOMCharacterData) {
-                    $node->removeChild($child);
-                }
-            }
-        }
-    }
-
-    /**
-     * "Convert" a DOMElement object into a PHP variable.
-     *
-     * @param  DOMElement $element
-     * @return mixed
-     * @since  Method available since Release 3.4.0
-     */
-    public static function xmlToVariable(DOMElement $element)
-    {
-        $variable = NULL;
-
-        switch ($element->tagName) {
-            case 'array': {
-                $variable = array();
-
-                foreach ($element->getElementsByTagName('element') as $element) {
-                    $value = self::xmlToVariable($element->childNodes->item(1));
-
-                    if ($element->hasAttribute('key')) {
-                        $variable[(string)$element->getAttribute('key')] = $value;
-                    } else {
-                        $variable[] = $value;
-                    }
-                }
-            }
-            break;
-
-            case 'object': {
-                $className = $element->getAttribute('class');
-
-                if ($element->hasChildNodes()) {
-                    $arguments       = $element->childNodes->item(1)->childNodes;
-                    $constructorArgs = array();
-
-                    foreach ($arguments as $argument) {
-                        if ($argument instanceof DOMElement) {
-                            $constructorArgs[] = self::xmlToVariable($argument);
-                        }
-                    }
-
-                    $class    = new ReflectionClass($className);
-                    $variable = $class->newInstanceArgs($constructorArgs);
-                } else {
-                    $variable = new $className;
-                }
-            }
-            break;
-
-            case 'boolean': {
-                $variable = $element->nodeValue == 'true' ? TRUE : FALSE;
-            }
-            break;
-
-            case 'integer':
-            case 'double':
-            case 'string': {
-                $variable = $element->nodeValue;
-
-                settype($variable, $element->tagName);
-            }
-            break;
-        }
-
-        return $variable;
-    }
-
-    /**
-     * Validate list of keys in the associative array.
-     *
-     * @param  array $hash
-     * @param  array $validKeys
-     * @return array
-     * @throws InvalidArgumentException
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function assertValidKeys(array $hash, array $validKeys)
-    {
-        $valids = array();
-
-        // Normalize validation keys so that we can use both indexed and
-        // associative arrays.
-        foreach ($validKeys as $key => $val) {
-            is_int($key) ? $valids[$val] = NULL : $valids[$key] = $val;
-        }
-
-        $validKeys = array_keys($valids);
-
-        // Check for invalid keys.
-        foreach ($hash as $key => $value) {
-            if (!in_array($key, $validKeys)) {
-                $unknown[] = $key;
-            }
-        }
-
-        if (!empty($unknown)) {
-            throw new InvalidArgumentException(
-              'Unknown key(s): ' . implode(', ', $unknown)
-            );
-        }
-
-        // Add default values for any valid keys that are empty.
-        foreach ($valids as $key => $value) {
-            if (!isset($hash[$key])) {
-                $hash[$key] = $value;
-            }
-        }
-
-        return $hash;
-    }
-
-    /**
-     * Parse a CSS selector into an associative array suitable for
-     * use with findNodes().
-     *
-     * @param  string $selector
-     * @param  mixed  $content
-     * @return array
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    public static function convertSelectToTag($selector, $content = TRUE)
-    {
-        $selector = trim(preg_replace("/\s+/", " ", $selector));
-
-        // substitute spaces within attribute value
-        while (preg_match('/\[[^\]]+"[^"]+\s[^"]+"\]/', $selector)) {
-            $selector = preg_replace(
-              '/(\[[^\]]+"[^"]+)\s([^"]+"\])/', "$1__SPACE__$2", $selector
-            );
-        }
-
-        if (strstr($selector, ' ')) {
-            $elements = explode(' ', $selector);
-        } else {
-            $elements = array($selector);
-        }
-
-        $previousTag = array();
-
-        foreach (array_reverse($elements) as $element) {
-            $element = str_replace('__SPACE__', ' ', $element);
-
-            // child selector
-            if ($element == '>') {
-                $previousTag = array('child' => $previousTag['descendant']);
-                continue;
-            }
-
-            $tag = array();
-
-            // match element tag
-            preg_match("/^([^\.#\[]*)/", $element, $eltMatches);
-
-            if (!empty($eltMatches[1])) {
-                $tag['tag'] = $eltMatches[1];
-            }
-
-            // match attributes (\[[^\]]*\]*), ids (#[^\.#\[]*),
-            // and classes (\.[^\.#\[]*))
-            preg_match_all(
-              "/(\[[^\]]*\]*|#[^\.#\[]*|\.[^\.#\[]*)/", $element, $matches
-            );
-
-            if (!empty($matches[1])) {
-                $classes = array();
-                $attrs   = array();
-
-                foreach ($matches[1] as $match) {
-                    // id matched
-                    if (substr($match, 0, 1) == '#') {
-                        $tag['id'] = substr($match, 1);
-                    }
-
-                    // class matched
-                    else if (substr($match, 0, 1) == '.') {
-                        $classes[] = substr($match, 1);
-                    }
-
-                    // attribute matched
-                    else if (substr($match, 0, 1) == '[' &&
-                             substr($match, -1, 1) == ']') {
-                        $attribute = substr($match, 1, strlen($match) - 2);
-                        $attribute = str_replace('"', '', $attribute);
-
-                        // match single word
-                        if (strstr($attribute, '~=')) {
-                            list($key, $value) = explode('~=', $attribute);
-                            $value             = "regexp:/.*\b$value\b.*/";
-                        }
-
-                        // match substring
-                        else if (strstr($attribute, '*=')) {
-                            list($key, $value) = explode('*=', $attribute);
-                            $value             = "regexp:/.*$value.*/";
-                        }
-
-                        // exact match
-                        else {
-                            list($key, $value) = explode('=', $attribute);
-                        }
-
-                        $attrs[$key] = $value;
-                    }
-                }
-
-                if ($classes) {
-                    $tag['class'] = join(' ', $classes);
-                }
-
-                if ($attrs) {
-                    $tag['attributes'] = $attrs;
-                }
-            }
-
-            // tag content
-            if (is_string($content)) {
-                $tag['content'] = $content;
-            }
-
-            // determine previous child/descendants
-            if (!empty($previousTag['descendant'])) {
-                $tag['descendant'] = $previousTag['descendant'];
-            }
-
-            else if (!empty($previousTag['child'])) {
-                $tag['child'] = $previousTag['child'];
-            }
-
-            $previousTag = array('descendant' => $tag);
-        }
-
-        return $tag;
-    }
-
-    /**
-     * Parse an $actual document and return an array of DOMNodes
-     * matching the CSS $selector.  If an error occurs, it will
-     * return FALSE.
-     *
-     * To only return nodes containing a certain content, give
-     * the $content to match as a string.  Otherwise, setting
-     * $content to TRUE will return all nodes matching $selector.
-     *
-     * The $actual document may be a DOMDocument or a string
-     * containing XML or HTML, identified by $isHtml.
-     *
-     * @param  array   $selector
-     * @param  string  $content
-     * @param  mixed   $actual
-     * @param  boolean $isHtml
-     * @return false|array
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     * @author Tobias Schlitt <toby@php.net>
-     */
-    public static function cssSelect($selector, $content, $actual, $isHtml = TRUE)
-    {
-        $matcher = self::convertSelectToTag($selector, $content);
-        $dom     = self::load($actual, $isHtml);
-        $tags    = self::findNodes($dom, $matcher, $isHtml);
-
-        return $tags;
-    }
-
-    /**
-     * Parse out the options from the tag using DOM object tree.
-     *
-     * @param  DOMDocument $dom
-     * @param  array       $options
-     * @param  boolean     $isHtml
-     * @return array
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     * @author Tobias Schlitt <toby@php.net>
-     */
-    public static function findNodes(DOMDocument $dom, array $options, $isHtml = TRUE)
-    {
-        $valid = array(
-          'id', 'class', 'tag', 'content', 'attributes', 'parent',
-          'child', 'ancestor', 'descendant', 'children'
-        );
-
-        $filtered = array();
-        $options  = self::assertValidKeys($options, $valid);
-
-        // find the element by id
-        if ($options['id']) {
-            $options['attributes']['id'] = $options['id'];
-        }
-
-        if ($options['class']) {
-            $options['attributes']['class'] = $options['class'];
-        }
-
-        // find the element by a tag type
-        if ($options['tag']) {
-            if ($isHtml) {
-                $elements = self::getElementsByCaseInsensitiveTagName(
-                  $dom, $options['tag']
-                );
-            } else {
-                $elements = $dom->getElementsByTagName($options['tag']);
-            }
-
-            foreach ($elements as $element) {
-                $nodes[] = $element;
-            }
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // no tag selected, get them all
-        else {
-            $tags = array(
-              'a', 'abbr', 'acronym', 'address', 'area', 'b', 'base', 'bdo',
-              'big', 'blockquote', 'body', 'br', 'button', 'caption', 'cite',
-              'code', 'col', 'colgroup', 'dd', 'del', 'div', 'dfn', 'dl',
-              'dt', 'em', 'fieldset', 'form', 'frame', 'frameset', 'h1', 'h2',
-              'h3', 'h4', 'h5', 'h6', 'head', 'hr', 'html', 'i', 'iframe',
-              'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'link',
-              'map', 'meta', 'noframes', 'noscript', 'object', 'ol', 'optgroup',
-              'option', 'p', 'param', 'pre', 'q', 'samp', 'script', 'select',
-              'small', 'span', 'strong', 'style', 'sub', 'sup', 'table',
-              'tbody', 'td', 'textarea', 'tfoot', 'th', 'thead', 'title',
-              'tr', 'tt', 'ul', 'var'
-            );
-
-            foreach ($tags as $tag) {
-                if ($isHtml) {
-                    $elements = self::getElementsByCaseInsensitiveTagName(
-                      $dom, $tag
-                    );
-                } else {
-                    $elements = $dom->getElementsByTagName($tag);
-                }
-
-                foreach ($elements as $element) {
-                    $nodes[] = $element;
-                }
-            }
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // filter by attributes
-        if ($options['attributes']) {
-            foreach ($nodes as $node) {
-                $invalid = FALSE;
-
-                foreach ($options['attributes'] as $name => $value) {
-                    // match by regexp if like "regexp:/foo/i"
-                    if (preg_match('/^regexp\s*:\s*(.*)/i', $value, $matches)) {
-                        if (!preg_match($matches[1], $node->getAttribute($name))) {
-                            $invalid = TRUE;
-                        }
-                    }
-
-                    // class can match only a part
-                    else if ($name == 'class') {
-                        // split to individual classes
-                        $findClasses = explode(
-                          ' ', preg_replace("/\s+/", " ", $value)
-                        );
-
-                        $allClasses = explode(
-                          ' ',
-                          preg_replace("/\s+/", " ", $node->getAttribute($name))
-                        );
-
-                        // make sure each class given is in the actual node
-                        foreach ($findClasses as $findClass) {
-                            if (!in_array($findClass, $allClasses)) {
-                                $invalid = TRUE;
-                            }
-                        }
-                    }
-
-                    // match by exact string
-                    else {
-                        if ($node->getAttribute($name) != $value) {
-                            $invalid = TRUE;
-                        }
-                    }
-                }
-
-                // if every attribute given matched
-                if (!$invalid) {
-                    $filtered[] = $node;
-                }
-            }
-
-            $nodes    = $filtered;
-            $filtered = array();
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // filter by content
-        if ($options['content'] !== NULL) {
-            foreach ($nodes as $node) {
-                $invalid = FALSE;
-
-                // match by regexp if like "regexp:/foo/i"
-                if (preg_match('/^regexp\s*:\s*(.*)/i', $options['content'], $matches)) {
-                    if (!preg_match($matches[1], self::getNodeText($node))) {
-                        $invalid = TRUE;
-                    }
-                }
-
-                // match by exact string
-                else if (strstr(self::getNodeText($node), $options['content']) === FALSE) {
-                    $invalid = TRUE;
-                }
-
-                if (!$invalid) {
-                    $filtered[] = $node;
-                }
-            }
-
-            $nodes    = $filtered;
-            $filtered = array();
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // filter by parent node
-        if ($options['parent']) {
-            $parentNodes = self::findNodes($dom, $options['parent'], $isHtml);
-            $parentNode  = isset($parentNodes[0]) ? $parentNodes[0] : NULL;
-
-            foreach ($nodes as $node) {
-                if ($parentNode !== $node->parentNode) {
-                    break;
-                }
-
-                $filtered[] = $node;
-            }
-
-            $nodes    = $filtered;
-            $filtered = array();
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // filter by child node
-        if ($options['child']) {
-            $childNodes = self::findNodes($dom, $options['child'], $isHtml);
-            $childNodes = !empty($childNodes) ? $childNodes : array();
-
-            foreach ($nodes as $node) {
-                foreach ($node->childNodes as $child) {
-                    foreach ($childNodes as $childNode) {
-                        if ($childNode === $child) {
-                            $filtered[] = $node;
-                        }
-                    }
-                }
-            }
-
-            $nodes    = $filtered;
-            $filtered = array();
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // filter by ancestor
-        if ($options['ancestor']) {
-            $ancestorNodes = self::findNodes($dom, $options['ancestor'], $isHtml);
-            $ancestorNode  = isset($ancestorNodes[0]) ? $ancestorNodes[0] : NULL;
-
-            foreach ($nodes as $node) {
-                $parent = $node->parentNode;
-
-                while ($parent->nodeType != XML_HTML_DOCUMENT_NODE) {
-                    if ($parent === $ancestorNode) {
-                        $filtered[] = $node;
-                    }
-
-                    $parent = $parent->parentNode;
-                }
-            }
-
-            $nodes    = $filtered;
-            $filtered = array();
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // filter by descendant
-        if ($options['descendant']) {
-            $descendantNodes = self::findNodes($dom, $options['descendant'], $isHtml);
-            $descendantNodes = !empty($descendantNodes) ? $descendantNodes : array();
-
-            foreach ($nodes as $node) {
-                foreach (self::getDescendants($node) as $descendant) {
-                    foreach ($descendantNodes as $descendantNode) {
-                        if ($descendantNode === $descendant) {
-                            $filtered[] = $node;
-                        }
-                    }
-                }
-            }
-
-            $nodes    = $filtered;
-            $filtered = array();
-
-            if (empty($nodes)) {
-                return FALSE;
-            }
-        }
-
-        // filter by children
-        if ($options['children']) {
-            $validChild   = array('count', 'greater_than', 'less_than', 'only');
-            $childOptions = self::assertValidKeys(
-                              $options['children'], $validChild
-                            );
-
-            foreach ($nodes as $node) {
-                $childNodes = $node->childNodes;
-
-                foreach ($childNodes as $childNode) {
-                    if ($childNode->nodeType !== XML_CDATA_SECTION_NODE &&
-                        $childNode->nodeType !== XML_TEXT_NODE) {
-                        $children[] = $childNode;
-                    }
-                }
-
-                // we must have children to pass this filter
-                if (!empty($children)) {
-                    // exact count of children
-                    if ($childOptions['count'] !== NULL) {
-                        if (count($children) !== $childOptions['count']) {
-                            break;
-                        }
-                    }
-
-                    // range count of children
-                    else if ($childOptions['less_than']    !== NULL &&
-                            $childOptions['greater_than'] !== NULL) {
-                        if (count($children) >= $childOptions['less_than'] ||
-                            count($children) <= $childOptions['greater_than']) {
-                            break;
-                        }
-                    }
-
-                    // less than a given count
-                    else if ($childOptions['less_than'] !== NULL) {
-                        if (count($children) >= $childOptions['less_than']) {
-                            break;
-                        }
-                    }
-
-                    // more than a given count
-                    else if ($childOptions['greater_than'] !== NULL) {
-                        if (count($children) <= $childOptions['greater_than']) {
-                            break;
-                        }
-                    }
-
-                    // match each child against a specific tag
-                    if ($childOptions['only']) {
-                        $onlyNodes = self::findNodes(
-                          $dom, $childOptions['only'], $isHtml
-                        );
-
-                        // try to match each child to one of the 'only' nodes
-                        foreach ($children as $child) {
-                            $matched = FALSE;
-
-                            foreach ($onlyNodes as $onlyNode) {
-                                if ($onlyNode === $child) {
-                                    $matched = TRUE;
-                                }
-                            }
-
-                            if (!$matched) {
-                                break(2);
-                            }
-                        }
-                    }
-
-                    $filtered[] = $node;
-                }
-            }
-
-            $nodes    = $filtered;
-            $filtered = array();
-
-            if (empty($nodes)) {
-                return;
-            }
-        }
-
-        // return the first node that matches all criteria
-        return !empty($nodes) ? $nodes : array();
-    }
-
-    /**
-     * Recursively get flat array of all descendants of this node.
-     *
-     * @param  DOMNode $node
-     * @return array
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    protected static function getDescendants(DOMNode $node)
-    {
-        $allChildren = array();
-        $childNodes  = $node->childNodes ? $node->childNodes : array();
-
-        foreach ($childNodes as $child) {
-            if ($child->nodeType === XML_CDATA_SECTION_NODE ||
-                $child->nodeType === XML_TEXT_NODE) {
-                continue;
-            }
-
-            $children    = self::getDescendants($child);
-            $allChildren = array_merge($allChildren, $children, array($child));
-        }
-
-        return isset($allChildren) ? $allChildren : array();
-    }
-
-    /**
-     * Gets elements by case insensitive tagname.
-     *
-     * @param  DOMDocument $dom
-     * @param  string      $tag
-     * @return DOMNodeList
-     * @since  Method available since Release 3.4.0
-     */
-    protected static function getElementsByCaseInsensitiveTagName(DOMDocument $dom, $tag)
-    {
-        $elements = $dom->getElementsByTagName(strtolower($tag));
-
-        if ($elements->length == 0) {
-            $elements = $dom->getElementsByTagName(strtoupper($tag));
-        }
-
-        return $elements;
-    }
-
-    /**
-     * Get the text value of this node's child text node.
-     *
-     * @param  DOMNode $node
-     * @return string
-     * @since  Method available since Release 3.3.0
-     * @author Mike Naberezny <mike@maintainable.com>
-     * @author Derek DeVries <derek@maintainable.com>
-     */
-    protected static function getNodeText(DOMNode $node)
-    {
-        if (!$node->childNodes instanceof DOMNodeList) {
-            return '';
-        }
-
-        $result = '';
-
-        foreach ($node->childNodes as $childNode) {
-            if ($childNode->nodeType === XML_TEXT_NODE) {
-                $result .= trim($childNode->data) . ' ';
-            } else {
-                $result .= self::getNodeText($childNode);
-            }
-        }
-
-        return str_replace('  ', ' ', $result);
-    }
-}
diff --git a/tests/SnakeCase_PHPUnit_Framework_TestCase.php b/tests/SnakeCase_PHPUnit_Framework_TestCase.php
deleted file mode 100644
index fce5e6e..0000000
--- a/tests/SnakeCase_PHPUnit_Framework_TestCase.php
+++ /dev/null
@@ -1,64 +0,0 @@
-<?php
-class SnakeCase_PHPUnit_Framework_TestCase extends PHPUnit_Framework_TestCase
-{
-	public function __call($meth, $args)
-	{
-		$camel_cased_method = ActiveRecord\Inflector::instance()->camelize($meth);
-
-		if (method_exists($this, $camel_cased_method))
-			return call_user_func_array(array($this, $camel_cased_method), $args);
-
-		$class_name = get_called_class();
-		$trace = debug_backtrace();
-		die("PHP Fatal Error:  Call to undefined method $class_name::$meth() in {$trace[1]['file']} on line {$trace[1]['line']}" . PHP_EOL);
-	}
-
-	public function setUp()
-	{
-		if (method_exists($this,'set_up'))
-			call_user_func_array(array($this,'set_up'),func_get_args());
-	}
-
-	public function tearDown()
-	{
-		if (method_exists($this,'tear_down'))
-			call_user_func_array(array($this,'tear_down'),func_get_args());
-	}
-
-	private function setup_assert_keys($args)
-	{
-		$last = count($args)-1;
-		$keys = array_slice($args,0,$last);
-		$array = $args[$last];
-		return array($keys,$array);
-	}
-
-	public function assert_has_keys(/* $keys..., $array */)
-	{
-		list($keys,$array) = $this->setup_assert_keys(func_get_args());
-
-		$this->assert_not_null($array,'Array was null');
-
-		foreach ($keys as $name)
-			$this->assert_array_has_key($name,$array);
-	}
-
-	public function assert_doesnt_has_keys(/* $keys..., $array */)
-	{
-		list($keys,$array) = $this->setup_assert_keys(func_get_args());
-
-		foreach ($keys as $name)
-			$this->assert_array_not_has_key($name,$array);
-	}
-
-	public function assert_is_a($expected_class, $object)
-	{
-		$this->assert_equals($expected_class,get_class($object));
-	}
-
-	public function assert_datetime_equals($expected, $actual)
-	{
-		$this->assert_equals($expected->format(DateTime::ISO8601),$actual->format(DateTime::ISO8601));
-	}
-}
-?>
\ No newline at end of file
diff --git a/tests/region_test.php b/tests/region_test.php
deleted file mode 100644
index 4bb770e..0000000
--- a/tests/region_test.php
+++ /dev/null
@@ -1,31 +0,0 @@
-<?php
-/**
- * unit test Regions
- *
- * @package    tests
- * @subpackage Regions
- * @since      07.10.2010 10:20:00
- * @author     enesterov
- */
-
-	require_once 'PHPUnit/Framework/TestCase.php';
-	require_once 'SnakeCase_PHPUnit_Framework_TestCase.php';
-	require_once dirname(__FILE__) . '/../lib/ActiveRecord.php';
-	
-
-	$GLOBALS['slow_tests'] = false;
-	
-	
-	ActiveRecord\Config::initialize(function($cfg)
-	{
-		$cfg->set_model_directory(realpath(dirname(__FILE__) . '/../models'));
-		$cfg->set_default_connection('test');
-	}
-	// create some people
-	/*$region = new Regions(array('name' => 'Москва', 'mvideo_region_id' => 1));
-	$region->save();
-	
-	// compact way to create and save a model
-	$tito = Regions::create(array('name' => 'Ростов-на-Дону', 'mvideo_region_id' => 0));
-	
-	print_r(Regions::first());*/
\ No newline at end of file
